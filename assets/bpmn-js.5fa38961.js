import{e as N}from"./inherits-browser.72a78a64.js";import{I as rr}from"./ids.4153fd02.js";import{i as Vo,h as Re,f as X,a as G,b as L,s as nt,m as en,c as A,o as Zn,d as or,e as Jn,g as Qe,r as ze,j as Ce,k as tn,l as Qn,n as jn,p as ei,q as ti,t as Uo,u as $n,v as Yo}from"./min-dash.9e14f76b.js";import{d as qo,a as et,b as Ae,q as be,r as Ko,e as Xo,c as sr}from"./min-dom.bb3c67f4.js";import{i as sa,a as _e,c as ne,b as me,d as Zo,r as Jo}from"./tiny-svg.77613367.js";import{s as Qo}from"./bpmn-moddle.5f62ef14.js";import{D as nn,c as an,B as cr,r as es,t as ca,a as pr,b as ts,T as ns,g as W,d as rn,e as is,f as as,h as K,C,O as lr,i as ni,R as rs,S as on,K as ur,M as dr,Z as fr,j as Be,k as hr,A as os,l as ii,P as sn,m as ai,n as ss,o as Ne,p as ri,q as mr,s as vr,u as br,v as cs,w as ps,x as gr,y as ls,z as yr,E as Er,F as oi,G as it,H as wr,I as us,J as si,L as ci,N as ds,Q as fs,U as hs,V as ms,W as xr,X as pi,Y as pe,_ as J,$ as li,a0 as pa,a1 as vs,a2 as Hn,a3 as la,a4 as Xt,a5 as bs,a6 as gs,a7 as ys,a8 as Es,a9 as ws,aa as ui,ab as xs,ac as _s,ad as Ss,ae as _r,af as di,ag as Ds,ah as Sr,ai as fi,aj as hi,ak as Ps,al as Ts,am as As,an as Rs,ao as Cs,ap as Bs,aq as Ns,ar as ks,as as Ms,at as Ls,au as Os,av as Is,aw as Fs,ax as Ze,ay as ce,az as xt,aA as js,aB as $s,aC as Hs,aD as zs,aE as Ws,aF as Gs,aG as Vs,aH as Us,aI as Ys,aJ as qs,aK as Ks}from"./diagram-js.3ed9effe.js";import{D as Dr}from"./diagram-js-direct-editing.2d0a4ddf.js";import{c as ua}from"./css.escape.bdedfc1b.js";function Z(e){return e?"<"+e.$type+(e.id?' id="'+e.id:"")+'" />':"<null>"}function at(e){return function(){if(!window.Promise)throw new Error("Promises is not supported in this environment. Please polyfill Promise.");var t=arguments.length;if(t>=1&&Vo(arguments[t-1])){var i=arguments[t-1];console.warn(new Error("Passing callbacks to "+e.name+" is deprecated and will be removed in a future major release. Please switch to promises: https://bpmn.io/l/moving-to-promises.html"));var n=Array.prototype.slice.call(arguments,0,-1);e.apply(this,n).then(function(a){var r=Object.keys(a)[0];return i(null,a[r])},function(a){return i(a,a.warnings)})}else return e.apply(this,arguments)}}var Xs="Tried to access di from the businessObject. The di is available through the diagram element only. For more information, see https://github.com/bpmn-io/bpmn-js/issues/1472";function Pr(e){Re(e,"di")||Object.defineProperty(e,"di",{enumerable:!1,get:function(){throw new Error(Xs)}})}function ie(e,t){return e.$instanceOf(t)}function Zs(e){return X(e.rootElements,function(t){return ie(t,"bpmn:Process")||ie(t,"bpmn:Collaboration")})}function Js(e,t){var i={},n=[],a={};function r(y,x){return function(B){y(B,x)}}function o(y){i[y.id]=y}function c(y){return i[y.id]}function s(y,x){var B=y.gfx;if(B)throw new Error(t("already rendered {element}",{element:Z(y)}));return e.element(y,a[y.id],x)}function p(y,x){return e.root(y,a[y.id],x)}function u(y,x){try{var B=a[y.id]&&s(y,x);return o(y),B}catch(z){f(z.message,{element:y,error:z}),console.error(t("failed to import {element}",{element:Z(y)})),console.error(z)}}function f(y,x){e.error(y,x)}function h(y){var x=y.bpmnElement;x?a[x.id]?f(t("multiple DI elements defined for {element}",{element:Z(x)}),{element:x}):(a[x.id]=y,Pr(x)):f(t("no bpmnElement referenced in {element}",{element:Z(y)}),{element:y})}function v(y){b(y.plane)}function b(y){h(y),L(y.planeElement,w)}function w(y){h(y)}function _(y,x){var B=y.diagrams;if(x&&B.indexOf(x)===-1)throw new Error(t("diagram not part of bpmn:Definitions"));if(!x&&B&&B.length&&(x=B[0]),!x)throw new Error(t("no diagram to display"));a={},v(x);var z=x.plane;if(!z)throw new Error(t("no plane for {element}",{element:Z(x)}));var U=z.bpmnElement;if(!U)if(U=Zs(y),U)f(t("correcting missing bpmnElement on {plane} to {rootElement}",{plane:Z(z),rootElement:Z(U)})),z.bpmnElement=U,h(z);else throw new Error(t("no process or collaboration to display"));var Ie=p(U,z);if(ie(U,"bpmn:Process")||ie(U,"bpmn:SubProcess"))P(U,Ie);else if(ie(U,"bpmn:Collaboration"))E(U,Ie),k(y.rootElements,Ie);else throw new Error(t("unsupported bpmnElement for {plane}: {rootElement}",{plane:Z(z),rootElement:Z(U)}));D()}function D(){for(var y;n.length;)y=n.shift(),y()}function P(y,x){m(y,x),he(y.ioSpecification,x),fe(y.artifacts,x),o(y)}function k(y,x){var B=G(y,function(z){return!c(z)&&ie(z,"bpmn:Process")&&z.laneSets});B.forEach(r(P,x))}function F(y,x){u(y,x)}function q(y,x){L(y,r(F,x))}function re(y,x){u(y,x)}function O(y,x){u(y,x)}function de(y,x){u(y,x)}function M(y,x){u(y,x)}function fe(y,x){L(y,function(B){ie(B,"bpmn:Association")?n.push(function(){M(B,x)}):M(B,x)})}function he(y,x){!y||(L(y.dataInputs,r(O,x)),L(y.dataOutputs,r(de,x)))}function xe(y,x){m(y,x),fe(y.artifacts,x)}function ct(y,x){var B=u(y,x);ie(y,"bpmn:SubProcess")&&xe(y,B||x),ie(y,"bpmn:Activity")&&he(y.ioSpecification,x),n.push(function(){L(y.dataInputAssociations,r(re,x)),L(y.dataOutputAssociations,r(re,x))})}function Rn(y,x){u(y,x)}function pt(y,x){u(y,x)}function Cn(y,x){n.push(function(){var B=u(y,x);y.childLaneSet&&Ye(y.childLaneSet,B||x),S(y)})}function Ye(y,x){L(y.lanes,r(Cn,x))}function Bn(y,x){L(y,r(Ye,x))}function m(y,x){l(y.flowElements,x),y.laneSets&&Bn(y.laneSets,x)}function l(y,x){L(y,function(B){ie(B,"bpmn:SequenceFlow")?n.push(function(){Rn(B,x)}):ie(B,"bpmn:BoundaryEvent")?n.unshift(function(){ct(B,x)}):ie(B,"bpmn:FlowNode")?ct(B,x):ie(B,"bpmn:DataObject")||(ie(B,"bpmn:DataStoreReference")||ie(B,"bpmn:DataObjectReference")?pt(B,x):f(t("unrecognized flowElement {element} in context {context}",{element:Z(B),context:x?Z(x.businessObject):"null"}),{element:B,context:x}))})}function g(y,x){var B=u(y,x),z=y.processRef;z&&P(z,B||x)}function E(y,x){L(y.participants,r(g,x)),fe(y.artifacts,x),n.push(function(){q(y.messageFlows,x)})}function S(y){L(y.flowNodeRef,function(x){var B=x.get("lanes");B&&B.push(y)})}return{handleDeferred:D,handleDefinitions:_,handleSubProcess:xe,registerDi:h}}function d(e,t){var i=R(e);return i&&typeof i.$instanceOf=="function"&&i.$instanceOf(t)}function I(e,t){return nt(t,function(i){return d(e,i)})}function R(e){return e&&e.businessObject||e}function H(e){return e&&e.di}function Qs(e,t,i){var n,a,r,o,c,s=[];function p(u,f){var h={root:function(_,D){return n.add(_,D)},element:function(_,D,P){return n.add(_,D,P)},error:function(_,D){s.push({message:_,context:D})}},v=new Js(h,r);f=f||u.diagrams&&u.diagrams[0];var b=ec(u,f);if(!b)throw new Error(r("no diagram to display"));L(b,function(_){v.handleDefinitions(u,_)});var w=f.plane.bpmnElement.id;o.setRootElement(o.findRoot(w+"_plane")||o.findRoot(w))}return new Promise(function(u,f){try{return n=e.get("bpmnImporter"),a=e.get("eventBus"),r=e.get("translate"),o=e.get("canvas"),a.fire("import.render.start",{definitions:t}),p(t,i),a.fire("import.render.complete",{error:c,warnings:s}),u({warnings:s})}catch(h){return h.warnings=s,f(h)}})}function ec(e,t){if(!!t){var i=t.plane.bpmnElement,n=i;!d(i,"bpmn:Process")&&!d(i,"bpmn:Collaboration")&&(n=tc(i));var a;d(n,"bpmn:Collaboration")?a=n:a=X(e.rootElements,function(p){if(!!d(p,"bpmn:Collaboration"))return X(p.participants,function(u){return u.processRef===n})});var r=[n];a&&(r=en(a.participants,function(p){return p.processRef}),r.push(a));var o=Tr(r),c=[t],s=[i];return L(e.diagrams,function(p){var u=p.plane.bpmnElement;o.indexOf(u)!==-1&&s.indexOf(u)===-1&&(c.push(p),s.push(u))}),c}}function Tr(e){var t=[];return L(e,function(i){!i||(t.push(i),t=t.concat(Tr(i.flowElements)))}),t}function tc(e){for(var t=e;t;){if(d(t,"bpmn:Process"))return t;t=t.$parent}}var nc='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14.02 5.57" width="53" height="21"><path fill="currentColor" d="M1.88.92v.14c0 .41-.13.68-.4.8.33.14.46.44.46.86v.33c0 .61-.33.95-.95.95H0V0h.95c.65 0 .93.3.93.92zM.63.57v1.06h.24c.24 0 .38-.1.38-.43V.98c0-.28-.1-.4-.32-.4zm0 1.63v1.22h.36c.2 0 .32-.1.32-.39v-.35c0-.37-.12-.48-.4-.48H.63zM4.18.99v.52c0 .64-.31.98-.94.98h-.3V4h-.62V0h.92c.63 0 .94.35.94.99zM2.94.57v1.35h.3c.2 0 .3-.09.3-.37v-.6c0-.29-.1-.38-.3-.38h-.3zm2.89 2.27L6.25 0h.88v4h-.6V1.12L6.1 3.99h-.6l-.46-2.82v2.82h-.55V0h.87zM8.14 1.1V4h-.56V0h.79L9 2.4V0h.56v4h-.64zm2.49 2.29v.6h-.6v-.6zM12.12 1c0-.63.33-1 .95-1 .61 0 .95.37.95 1v2.04c0 .64-.34 1-.95 1-.62 0-.95-.37-.95-1zm.62 2.08c0 .28.13.39.33.39s.32-.1.32-.4V.98c0-.29-.12-.4-.32-.4s-.33.11-.33.4z"/><path fill="currentColor" d="M0 4.53h14.02v1.04H0zM11.08 0h.63v.62h-.63zm.63 4V1h-.63v2.98z"/></svg>',Ar=nc,Rr={verticalAlign:"middle"},Cr={color:"#404040"},ic={zIndex:"1001",position:"fixed",top:"0",left:"0",right:"0",bottom:"0"},ac={width:"100%",height:"100%",background:"rgba(40,40,40,0.2)"},rc={position:"absolute",left:"50%",top:"40%",transform:"translate(-50%)",width:"260px",padding:"10px",background:"white",boxShadow:"0 1px 4px rgba(0,0,0,0.3)",fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",display:"flex",lineHeight:"1.3"},oc='<div class="bjs-powered-by-lightbox"><div class="backdrop"></div><div class="notice"><a href="https://bpmn.io" target="_blank" rel="noopener" class="link">'+Ar+'</a><span>Web-based tooling for BPMN, DMN and CMMN diagrams powered by <a href="https://bpmn.io" target="_blank" rel="noopener">bpmn.io</a>.</span></div></div>',Ee;function sc(){Ee=et(oc),Ae(Ee,ic),Ae(be("svg",Ee),Rr),Ae(be(".backdrop",Ee),ac),Ae(be(".notice",Ee),rc),Ae(be(".link",Ee),Cr,{margin:"15px 20px 15px 10px",alignSelf:"center"})}function cc(){Ee||(sc(),qo.bind(Ee,".backdrop","click",function(e){document.body.removeChild(Ee)})),document.body.appendChild(Ee)}function V(e){e=A({},lc,e),this._moddle=this._createModdle(e),this._container=this._createContainer(e),dc(this._container),this._init(this._container,this._moddle,e)}N(V,nn);V.prototype.importXML=at(async function(t,i){const n=this;function a(o){const c=n.get("eventBus").createEvent(o);return Object.defineProperty(c,"context",{enumerable:!0,get:function(){return console.warn(new Error("import.parse.complete <context> is deprecated and will be removed in future library versions")),{warnings:o.warnings,references:o.references,elementsById:o.elementsById}}}),c}let r=[];try{t=this._emit("import.parse.start",{xml:t})||t;let o;try{o=await this._moddle.fromXML(t,"bpmn:Definitions")}catch(h){throw this._emit("import.parse.complete",{error:h}),h}let c=o.rootElement;const s=o.references,p=o.warnings,u=o.elementsById;r=r.concat(p),c=this._emit("import.parse.complete",a({error:null,definitions:c,elementsById:u,references:s,warnings:r}))||c;const f=await this.importDefinitions(c,i);return r=r.concat(f.warnings),this._emit("import.done",{error:null,warnings:r}),{warnings:r}}catch(o){let c=o;throw r=r.concat(c.warnings||[]),Vt(c,r),c=pc(c),this._emit("import.done",{error:c,warnings:c.warnings}),c}});V.prototype.importDefinitions=at(async function(t,i){return this._setDefinitions(t),{warnings:(await this.open(i)).warnings}});V.prototype.open=at(async function(t){const i=this._definitions;let n=t;if(!i){const r=new Error("no XML imported");throw Vt(r,[]),r}if(typeof t=="string"&&(n=uc(i,t),!n)){const r=new Error("BPMNDiagram <"+t+"> not found");throw Vt(r,[]),r}try{this.clear()}catch(r){throw Vt(r,[]),r}const{warnings:a}=await Qs(this,i,n);return{warnings:a}});V.prototype.saveXML=at(async function(t){t=t||{};let i=this._definitions,n,a;try{if(!i)throw new Error("no definitions loaded");i=this._emit("saveXML.start",{definitions:i})||i,a=(await this._moddle.toXML(i,t)).xml,a=this._emit("saveXML.serialized",{xml:a})||a}catch(o){n=o}const r=n?{error:n}:{xml:a};if(this._emit("saveXML.done",r),n)throw n;return r});V.prototype.saveSVG=at(async function(t={}){this._emit("saveSVG.start");let i,n;try{const a=this.get("canvas"),r=a.getActiveLayer(),o=be("defs",a._svg),c=sa(r),s=o?"<defs>"+sa(o)+"</defs>":"",p=r.getBBox();i=`<?xml version="1.0" encoding="utf-8"?>
<!-- created with bpmn-js / http://bpmn.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="`+p.width+'" height="'+p.height+'" viewBox="'+p.x+" "+p.y+" "+p.width+" "+p.height+'" version="1.1">'+s+c+"</svg>"}catch(a){n=a}if(this._emit("saveSVG.done",{error:n,svg:i}),n)throw n;return{svg:i}});V.prototype._setDefinitions=function(e){this._definitions=e};V.prototype.getModules=function(e){return this._modules};V.prototype.clear=function(){!this.getDefinitions()||nn.prototype.clear.call(this)};V.prototype.destroy=function(){nn.prototype.destroy.call(this),Ko(this._container)};V.prototype.on=function(e,t,i,n){return this.get("eventBus").on(e,t,i,n)};V.prototype.off=function(e,t){this.get("eventBus").off(e,t)};V.prototype.attachTo=function(e){if(!e)throw new Error("parentNode required");this.detach(),e.get&&e.constructor.prototype.jquery&&(e=e.get(0)),typeof e=="string"&&(e=be(e)),e.appendChild(this._container),this._emit("attach",{}),this.get("canvas").resized()};V.prototype.getDefinitions=function(){return this._definitions};V.prototype.detach=function(){const e=this._container,t=e.parentNode;!t||(this._emit("detach",{}),t.removeChild(e))};V.prototype._init=function(e,t,i){const n=i.modules||this.getModules(i),a=i.additionalModules||[],r=[{bpmnjs:["value",this],moddle:["value",t]}],o=[].concat(r,n,a),c=A(Zn(i,["additionalModules"]),{canvas:A({},i.canvas,{container:e}),modules:o});nn.call(this,c),i&&i.container&&this.attachTo(i.container)};V.prototype._emit=function(e,t){return this.get("eventBus").fire(e,t)};V.prototype._createContainer=function(e){const t=et('<div class="bjs-container"></div>');return Ae(t,{width:da(e.width),height:da(e.height),position:e.position}),t};V.prototype._createModdle=function(e){const t=A({},this._moddleExtensions,e.moddleExtensions);return new Qo(t)};V.prototype._modules=[];function Vt(e,t){return e.warnings=t,e}function pc(e){const i=/unparsable content <([^>]+)> detected([\s\S]*)$/.exec(e.message);return i&&(e.message="unparsable content <"+i[1]+"> detected; this may indicate an invalid BPMN 2.0 diagram file"+i[2]),e}const lc={width:"100%",height:"100%",position:"relative"};function da(e){return e+(or(e)?"px":"")}function uc(e,t){return t&&X(e.diagrams,function(i){return i.id===t})||null}function dc(e){const i='<a href="http://bpmn.io" target="_blank" class="bjs-powered-by" title="Powered by bpmn.io" >'+Ar+"</a>",n=et(i);Ae(be("svg",n),Rr),Ae(n,Cr,{position:"absolute",bottom:"15px",right:"15px",zIndex:"100"}),e.appendChild(n),Xo.bind(n,"click",function(a){cc(),a.preventDefault()})}function _t(e){V.call(this,e),this.on("import.parse.complete",function(t){t.error||this._collectIds(t.definitions,t.elementsById)},this),this.on("diagram.destroy",function(){this.get("moddle").ids.clear()},this)}N(_t,V);_t.prototype._createModdle=function(e){var t=V.prototype._createModdle.call(this,e);return t.ids=new rr([32,36,1]),t};_t.prototype._collectIds=function(e,t){var i=e.$model,n=i.ids,a;n.clear();for(a in t)n.claim(a,t[a])};function $(e,t){return d(e,"bpmn:CallActivity")?!1:d(e,"bpmn:SubProcess")?(t=t||H(e),t&&d(t,"bpmndi:BPMNPlane")?!0:t&&!!t.isExpanded):d(e,"bpmn:Participant")?!!R(e).processRef:!0}function fc(e){return e&&R(e).isInterrupting!==!1}function oe(e){return e&&!!R(e).triggeredByEvent}function cn(e,t){var i=R(e),n=!1;return i.eventDefinitions&&L(i.eventDefinitions,function(a){d(a,t)&&(n=!0)}),n}function hc(e){return cn(e,"bpmn:ErrorEventDefinition")}function mc(e){return cn(e,"bpmn:EscalationEventDefinition")}function vc(e){return cn(e,"bpmn:CompensateEventDefinition")}function Br(e){if(d(e,"bpmn:FlowElement")||d(e,"bpmn:Participant")||d(e,"bpmn:Lane")||d(e,"bpmn:SequenceFlow")||d(e,"bpmn:MessageFlow")||d(e,"bpmn:DataInput")||d(e,"bpmn:DataOutput"))return"name";if(d(e,"bpmn:TextAnnotation"))return"text";if(d(e,"bpmn:Group"))return"categoryValueRef"}function bc(e){var t=e.categoryValueRef;return t&&t.value||""}function ge(e){var t=e.businessObject,i=Br(t);if(i)return i==="categoryValueRef"?bc(t):t[i]||""}function gc(e,t,i){var n=e.businessObject,a=Br(n);return a&&(a==="categoryValueRef"?n.categoryValueRef.value=t:n[a]=t),e}var ft="hsl(225, 10%, 15%)";function ye(e,t,i){function n(a,r){return Jn(r,function(o,c){return a[c]==o})}return nt(e.eventDefinitions,function(a){return a.$type===t&&n(e,i)})}function yc(e){return e.$type==="bpmn:IntermediateThrowEvent"||e.$type==="bpmn:EndEvent"}function Ec(e){var t=e.dataObjectRef;return e.isCollection||t&&t.isCollection}function te(e){return e.businessObject}function j(e,t){var i=H(e);return i.get("color:background-color")||i.get("bioc:fill")||t||"white"}function T(e,t){var i=H(e);return i.get("color:border-color")||i.get("bioc:stroke")||t||ft}function lt(e,t,i){var n=H(e),a=n.get("label");return a&&a.get("color:color")||t||T(e,i)}function wc(e){var t=e.x+e.width/2,i=e.y+e.height/2,n=e.width/2,a=[["M",t,i],["m",0,-n],["a",n,n,0,1,1,0,2*n],["a",n,n,0,1,1,0,-2*n],["z"]];return an(a)}function xc(e,t){var i=e.x,n=e.y,a=e.width,r=e.height,o=[["M",i+t,n],["l",a-t*2,0],["a",t,t,0,0,1,t,t],["l",0,r-t*2],["a",t,t,0,0,1,-t,t],["l",t*2-a,0],["a",t,t,0,0,1,-t,-t],["l",0,t*2-r],["a",t,t,0,0,1,t,-t],["z"]];return an(o)}function _c(e){var t=e.width,i=e.height,n=e.x,a=e.y,r=t/2,o=i/2,c=[["M",n+r,a],["l",r,o],["l",-r,o],["l",-r,-o],["z"]];return an(c)}function Sc(e){var t=e.x,i=e.y,n=e.width,a=e.height,r=[["M",t,i],["l",n,0],["l",0,a],["l",-n,0],["z"]];return an(r)}var Dc=new rr,Ut=10,Nn=3,qe=.95,Pc=.35,Tc=10;function We(e,t,i,n,a,r,o){cr.call(this,t,o);var c=e&&e.defaultFillColor,s=e&&e.defaultStrokeColor,p=e&&e.defaultLabelColor,u=Dc.next(),f={};function h(m){return i.computeStyle(m,{strokeLinecap:"round",strokeLinejoin:"round",stroke:ft,strokeWidth:2,fill:"white"})}function v(m){return i.computeStyle(m,["no-fill"],{strokeLinecap:"round",strokeLinejoin:"round",stroke:ft,strokeWidth:2})}function b(m,l){var{ref:g={x:0,y:0},scale:E=1,element:S}=l,y=ne("marker",{id:m,viewBox:"0 0 20 20",refX:g.x,refY:g.y,markerWidth:20*E,markerHeight:20*E,orient:"auto"});me(y,S);var x=be("defs",a._svg);x||(x=ne("defs"),me(a._svg,x)),me(x,y),f[m]=y}function w(m){return m.replace(/[^0-9a-zA-z]+/g,"_")}function _(m,l,g){var E=m+"-"+w(l)+"-"+w(g)+"-"+u;return f[E]||D(E,m,l,g),"url(#"+E+")"}function D(m,l,g,E){if(l==="sequenceflow-end"){var S=ne("path",{d:"M 1 5 L 11 10 L 1 15 Z",...h({fill:E,stroke:E,strokeWidth:1})});b(m,{element:S,ref:{x:11,y:10},scale:.5})}if(l==="messageflow-start"){var y=ne("circle",{cx:6,cy:6,r:3.5,...h({fill:g,stroke:E,strokeWidth:1,strokeDasharray:[1e4,1]})});b(m,{element:y,ref:{x:6,y:6}})}if(l==="messageflow-end"){var x=ne("path",{d:"m 1 5 l 0 -3 l 7 3 l -7 3 z",...h({fill:g,stroke:E,strokeWidth:1,strokeDasharray:[1e4,1]})});b(m,{element:x,ref:{x:8.5,y:5}})}if(l==="association-start"){var B=ne("path",{d:"M 11 5 L 1 10 L 11 15",...v({fill:"none",stroke:E,strokeWidth:1.5,strokeDasharray:[1e4,1]})});b(m,{element:B,ref:{x:1,y:10},scale:.5})}if(l==="association-end"){var z=ne("path",{d:"M 1 5 L 11 10 L 1 15",...v({fill:"none",stroke:E,strokeWidth:1.5,strokeDasharray:[1e4,1]})});b(m,{element:z,ref:{x:11,y:10},scale:.5})}if(l==="conditional-flow-marker"){var U=ne("path",{d:"M 0 10 L 8 6 L 16 10 L 8 14 Z",...h({fill:g,stroke:E})});b(m,{element:U,ref:{x:-1,y:10},scale:.5})}if(l==="conditional-default-flow-marker"){var Ie=ne("path",{d:"M 6 4 L 10 16",...h({stroke:E})});b(m,{element:Ie,ref:{x:0,y:10},scale:.5})}}function P(m,l,g,E,S){Qe(E)&&(S=E,E=0),E=E||0,S=h(S),S.fill==="none"&&delete S.fillOpacity;var y=l/2,x=g/2,B=ne("circle",{cx:y,cy:x,r:Math.round((l+g)/4-E),...S});return me(m,B),B}function k(m,l,g,E,S,y){Qe(S)&&(y=S,S=0),S=S||0,y=h(y);var x=ne("rect",{x:S,y:S,width:l-S*2,height:g-S*2,rx:E,ry:E,...y});return me(m,x),x}function F(m,l,g,E){var S=l/2,y=g/2,x=[{x:S,y:0},{x:l,y},{x:S,y:g},{x:0,y}],B=x.map(function(U){return U.x+","+U.y}).join(" ");E=h(E);var z=ne("polygon",{...E,points:B});return me(m,z),z}function q(m,l,g,E){g=v(g);var S=ts(l,g,E);return me(m,S),S}function re(m,l,g){return q(m,l,g,5)}function O(m,l,g){g=v(g);var E=ne("path",{...g,d:l});return me(m,E),E}function de(m,l,g,E){return O(l,g,A({"data-marker":m},E))}function M(m){return Cn[m]}function fe(m){return function(l,g){return M(m)(l,g)}}function he(m,l){var g=te(m),E=yc(g);return g.eventDefinitions&&g.eventDefinitions.length>1?g.parallelMultiple?M("bpmn:ParallelMultipleEventDefinition")(l,m,E):M("bpmn:MultipleEventDefinition")(l,m,E):ye(g,"bpmn:MessageEventDefinition")?M("bpmn:MessageEventDefinition")(l,m,E):ye(g,"bpmn:TimerEventDefinition")?M("bpmn:TimerEventDefinition")(l,m,E):ye(g,"bpmn:ConditionalEventDefinition")?M("bpmn:ConditionalEventDefinition")(l,m):ye(g,"bpmn:SignalEventDefinition")?M("bpmn:SignalEventDefinition")(l,m,E):ye(g,"bpmn:EscalationEventDefinition")?M("bpmn:EscalationEventDefinition")(l,m,E):ye(g,"bpmn:LinkEventDefinition")?M("bpmn:LinkEventDefinition")(l,m,E):ye(g,"bpmn:ErrorEventDefinition")?M("bpmn:ErrorEventDefinition")(l,m,E):ye(g,"bpmn:CancelEventDefinition")?M("bpmn:CancelEventDefinition")(l,m,E):ye(g,"bpmn:CompensateEventDefinition")?M("bpmn:CompensateEventDefinition")(l,m,E):ye(g,"bpmn:TerminateEventDefinition")?M("bpmn:TerminateEventDefinition")(l,m,E):null}function xe(m,l,g){g=A({size:{width:100}},g);var E=r.createText(l||"",g);return Zo(E).add("djs-label"),me(m,E),E}function ct(m,l,g){var E=te(l);return xe(m,E.name,{box:l,align:g,padding:7,style:{fill:lt(l,p,s)}})}function Rn(m,l){var g={width:90,height:30,x:l.width/2+l.x,y:l.height/2+l.y};return xe(m,ge(l),{box:g,fitBox:!0,style:A({},r.getExternalStyle(),{fill:lt(l,p,s)})})}function pt(m,l,g){var E=xe(m,l,{box:{height:30,width:g.height},align:"center-middle",style:{fill:lt(g,p,s)}}),S=-1*g.height;ca(E,0,-S,270)}var Cn=this.handlers={"bpmn:Event":function(m,l,g){return"fillOpacity"in g||(g.fillOpacity=qe),P(m,l.width,l.height,g)},"bpmn:StartEvent":function(m,l){var g={fill:j(l,c),stroke:T(l,s)},E=te(l);E.isInterrupting||(g={strokeDasharray:"6",fill:j(l,c),stroke:T(l,s)});var S=M("bpmn:Event")(m,l,g);return he(l,m),S},"bpmn:MessageEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_MESSAGE",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:l.width,containerHeight:l.height,position:{mx:.235,my:.315}}),S=g?T(l,s):j(l,c),y=g?j(l,c):T(l,s),x=O(m,E,{strokeWidth:1,fill:S,stroke:y});return x},"bpmn:TimerEventDefinition":function(m,l){var g=P(m,l.width,l.height,.2*l.height,{strokeWidth:2,fill:j(l,c),stroke:T(l,s)}),E=n.getScaledPath("EVENT_TIMER_WH",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:l.width,containerHeight:l.height,position:{mx:.5,my:.5}});O(m,E,{strokeWidth:2,stroke:T(l,s)});for(var S=0;S<12;S++){var y=n.getScaledPath("EVENT_TIMER_LINE",{xScaleFactor:.75,yScaleFactor:.75,containerWidth:l.width,containerHeight:l.height,position:{mx:.5,my:.5}}),x=l.width/2,B=l.height/2;O(m,y,{strokeWidth:1,transform:"rotate("+S*30+","+B+","+x+")",stroke:T(l,s)})}return g},"bpmn:EscalationEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_ESCALATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.5,my:.2}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)})},"bpmn:ConditionalEventDefinition":function(m,l){var g=n.getScaledPath("EVENT_CONDITIONAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.5,my:.222}});return O(m,g,{strokeWidth:1,stroke:T(l,s)})},"bpmn:LinkEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_LINK",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.57,my:.263}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)})},"bpmn:ErrorEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_ERROR",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:l.width,containerHeight:l.height,position:{mx:.2,my:.722}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)})},"bpmn:CancelEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_CANCEL_45",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.638,my:-.055}}),S=g?T(l,s):"none",y=O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)});return es(y,45),y},"bpmn:CompensateEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.22,my:.5}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)})},"bpmn:SignalEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_SIGNAL",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:l.width,containerHeight:l.height,position:{mx:.5,my:.2}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S,stroke:T(l,s)})},"bpmn:MultipleEventDefinition":function(m,l,g){var E=n.getScaledPath("EVENT_MULTIPLE",{xScaleFactor:1.1,yScaleFactor:1.1,containerWidth:l.width,containerHeight:l.height,position:{mx:.222,my:.36}}),S=g?T(l,s):"none";return O(m,E,{strokeWidth:1,fill:S})},"bpmn:ParallelMultipleEventDefinition":function(m,l){var g=n.getScaledPath("EVENT_PARALLEL_MULTIPLE",{xScaleFactor:1.2,yScaleFactor:1.2,containerWidth:l.width,containerHeight:l.height,position:{mx:.458,my:.194}});return O(m,g,{strokeWidth:1,fill:T(l,s),stroke:T(l,s)})},"bpmn:EndEvent":function(m,l){var g=M("bpmn:Event")(m,l,{strokeWidth:4,fill:j(l,c),stroke:T(l,s)});return he(l,m),g},"bpmn:TerminateEventDefinition":function(m,l){var g=P(m,l.width,l.height,8,{strokeWidth:4,fill:T(l,s),stroke:T(l,s)});return g},"bpmn:IntermediateEvent":function(m,l){var g=M("bpmn:Event")(m,l,{strokeWidth:1.5,fill:j(l,c),stroke:T(l,s)});return P(m,l.width,l.height,Nn,{strokeWidth:1.5,fill:j(l,"none"),stroke:T(l,s)}),he(l,m),g},"bpmn:IntermediateCatchEvent":fe("bpmn:IntermediateEvent"),"bpmn:IntermediateThrowEvent":fe("bpmn:IntermediateEvent"),"bpmn:Activity":function(m,l,g){return g=g||{},"fillOpacity"in g||(g.fillOpacity=qe),k(m,l.width,l.height,Ut,g)},"bpmn:Task":function(m,l){var g={fill:j(l,c),stroke:T(l,s)},E=M("bpmn:Activity")(m,l,g);return ct(m,l,"center-middle"),Ye(m,l),E},"bpmn:ServiceTask":function(m,l){var g=M("bpmn:Task")(m,l),E=n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:12,y:18}});O(m,E,{strokeWidth:1,fill:j(l,c),stroke:T(l,s)});var S=n.getScaledPath("TASK_TYPE_SERVICE_FILL",{abspos:{x:17.2,y:18}});O(m,S,{strokeWidth:0,fill:j(l,c)});var y=n.getScaledPath("TASK_TYPE_SERVICE",{abspos:{x:17,y:22}});return O(m,y,{strokeWidth:1,fill:j(l,c),stroke:T(l,s)}),g},"bpmn:UserTask":function(m,l){var g=M("bpmn:Task")(m,l),E=15,S=12,y=n.getScaledPath("TASK_TYPE_USER_1",{abspos:{x:E,y:S}});O(m,y,{strokeWidth:.5,fill:j(l,c),stroke:T(l,s)});var x=n.getScaledPath("TASK_TYPE_USER_2",{abspos:{x:E,y:S}});O(m,x,{strokeWidth:.5,fill:j(l,c),stroke:T(l,s)});var B=n.getScaledPath("TASK_TYPE_USER_3",{abspos:{x:E,y:S}});return O(m,B,{strokeWidth:.5,fill:T(l,s),stroke:T(l,s)}),g},"bpmn:ManualTask":function(m,l){var g=M("bpmn:Task")(m,l),E=n.getScaledPath("TASK_TYPE_MANUAL",{abspos:{x:17,y:15}});return O(m,E,{strokeWidth:.5,fill:j(l,c),stroke:T(l,s)}),g},"bpmn:SendTask":function(m,l){var g=M("bpmn:Task")(m,l),E=n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:1,yScaleFactor:1,containerWidth:21,containerHeight:14,position:{mx:.285,my:.357}});return O(m,E,{strokeWidth:1,fill:T(l,s),stroke:j(l,c)}),g},"bpmn:ReceiveTask":function(m,l){var g=te(l),E=M("bpmn:Task")(m,l),S;return g.instantiate?(P(m,28,28,20*.22,{strokeWidth:1}),S=n.getScaledPath("TASK_TYPE_INSTANTIATING_SEND",{abspos:{x:7.77,y:9.52}})):S=n.getScaledPath("TASK_TYPE_SEND",{xScaleFactor:.9,yScaleFactor:.9,containerWidth:21,containerHeight:14,position:{mx:.3,my:.4}}),O(m,S,{strokeWidth:1,fill:j(l,c),stroke:T(l,s)}),E},"bpmn:ScriptTask":function(m,l){var g=M("bpmn:Task")(m,l),E=n.getScaledPath("TASK_TYPE_SCRIPT",{abspos:{x:15,y:20}});return O(m,E,{strokeWidth:1,stroke:T(l,s)}),g},"bpmn:BusinessRuleTask":function(m,l){var g=M("bpmn:Task")(m,l),E=n.getScaledPath("TASK_TYPE_BUSINESS_RULE_HEADER",{abspos:{x:8,y:8}}),S=O(m,E);_e(S,{strokeWidth:1,fill:j(l,"#aaaaaa"),stroke:T(l,s)});var y=n.getScaledPath("TASK_TYPE_BUSINESS_RULE_MAIN",{abspos:{x:8,y:8}}),x=O(m,y);return _e(x,{strokeWidth:1,stroke:T(l,s)}),g},"bpmn:SubProcess":function(m,l,g){g={fill:j(l,c),stroke:T(l,s),...g};var E=M("bpmn:Activity")(m,l,g),S=$(l);return oe(l)&&_e(E,{strokeDasharray:"0, 5.5",strokeWidth:2.5}),ct(m,l,S?"center-top":"center-middle"),S?Ye(m,l):Ye(m,l,["SubProcessMarker"]),E},"bpmn:AdHocSubProcess":function(m,l){return M("bpmn:SubProcess")(m,l)},"bpmn:Transaction":function(m,l){var g=M("bpmn:SubProcess")(m,l,{strokeWidth:1.5}),E=i.style(["no-fill","no-events"],{stroke:T(l,s),strokeWidth:1.5});return k(m,l.width,l.height,Ut-3,Nn,E),g},"bpmn:CallActivity":function(m,l){return M("bpmn:SubProcess")(m,l,{strokeWidth:5})},"bpmn:Participant":function(m,l){var g=1.5,E={fillOpacity:qe,fill:j(l,c),stroke:T(l,s),strokeWidth:g},S=M("bpmn:Lane")(m,l,E),y=$(l);if(y){q(m,[{x:30,y:0},{x:30,y:l.height}],{stroke:T(l,s),strokeWidth:g});var x=te(l).name;pt(m,x,l)}else{var B=te(l).name;xe(m,B,{box:l,align:"center-middle",style:{fill:lt(l,p,s)}})}var z=!!te(l).participantMultiplicity;return z&&M("ParticipantMultiplicityMarker")(m,l),S},"bpmn:Lane":function(m,l,g){var E=k(m,l.width,l.height,0,{fill:j(l,c),fillOpacity:Pc,stroke:T(l,s),strokeWidth:1.5,...g}),S=te(l);if(S.$type==="bpmn:Lane"){var y=S.name;pt(m,y,l)}return E},"bpmn:InclusiveGateway":function(m,l){var g=M("bpmn:Gateway")(m,l);return P(m,l.width,l.height,l.height*.24,{strokeWidth:2.5,fill:j(l,c),stroke:T(l,s)}),g},"bpmn:ExclusiveGateway":function(m,l){var g=M("bpmn:Gateway")(m,l),E=n.getScaledPath("GATEWAY_EXCLUSIVE",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:l.width,containerHeight:l.height,position:{mx:.32,my:.3}});return H(l).isMarkerVisible&&O(m,E,{strokeWidth:1,fill:T(l,s),stroke:T(l,s)}),g},"bpmn:ComplexGateway":function(m,l){var g=M("bpmn:Gateway")(m,l),E=n.getScaledPath("GATEWAY_COMPLEX",{xScaleFactor:.5,yScaleFactor:.5,containerWidth:l.width,containerHeight:l.height,position:{mx:.46,my:.26}});return O(m,E,{strokeWidth:1,fill:T(l,s),stroke:T(l,s)}),g},"bpmn:ParallelGateway":function(m,l){var g=M("bpmn:Gateway")(m,l),E=n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.6,yScaleFactor:.6,containerWidth:l.width,containerHeight:l.height,position:{mx:.46,my:.2}});return O(m,E,{strokeWidth:1,fill:T(l,s),stroke:T(l,s)}),g},"bpmn:EventBasedGateway":function(m,l){var g=te(l),E=M("bpmn:Gateway")(m,l);P(m,l.width,l.height,l.height*.2,{strokeWidth:1,fill:"none",stroke:T(l,s)});var S=g.eventGatewayType,y=!!g.instantiate;function x(){var z=n.getScaledPath("GATEWAY_EVENT_BASED",{xScaleFactor:.18,yScaleFactor:.18,containerWidth:l.width,containerHeight:l.height,position:{mx:.36,my:.44}});O(m,z,{strokeWidth:2,fill:j(l,"none"),stroke:T(l,s)})}if(S==="Parallel"){var B=n.getScaledPath("GATEWAY_PARALLEL",{xScaleFactor:.4,yScaleFactor:.4,containerWidth:l.width,containerHeight:l.height,position:{mx:.474,my:.296}});O(m,B,{strokeWidth:1,fill:"none"})}else S==="Exclusive"&&(y||P(m,l.width,l.height,l.height*.26,{strokeWidth:1,fill:"none",stroke:T(l,s)}),x());return E},"bpmn:Gateway":function(m,l){return F(m,l.width,l.height,{fill:j(l,c),fillOpacity:qe,stroke:T(l,s)})},"bpmn:SequenceFlow":function(m,l){var g=j(l,c),E=T(l,s),S=re(m,l.waypoints,{markerEnd:_("sequenceflow-end",g,E),stroke:T(l,s)}),y=te(l),x;return l.source&&(x=l.source.businessObject,y.conditionExpression&&x.$instanceOf("bpmn:Activity")&&_e(S,{markerStart:_("conditional-flow-marker",g,E)}),x.default&&(x.$instanceOf("bpmn:Gateway")||x.$instanceOf("bpmn:Activity"))&&x.default===y&&_e(S,{markerStart:_("conditional-default-flow-marker",g,E)})),S},"bpmn:Association":function(m,l,g){var E=te(l),S=j(l,c),y=T(l,s);return g={strokeDasharray:"0, 5",stroke:T(l,s),...g},(E.associationDirection==="One"||E.associationDirection==="Both")&&(g.markerEnd=_("association-end",S,y)),E.associationDirection==="Both"&&(g.markerStart=_("association-start",S,y)),re(m,l.waypoints,g)},"bpmn:DataInputAssociation":function(m,l){var g=j(l,c),E=T(l,s);return M("bpmn:Association")(m,l,{markerEnd:_("association-end",g,E)})},"bpmn:DataOutputAssociation":function(m,l){var g=j(l,c),E=T(l,s);return M("bpmn:Association")(m,l,{markerEnd:_("association-end",g,E)})},"bpmn:MessageFlow":function(m,l){var g=te(l),E=H(l),S=j(l,c),y=T(l,s),x=re(m,l.waypoints,{markerEnd:_("messageflow-end",S,y),markerStart:_("messageflow-start",S,y),strokeDasharray:"10, 11",strokeWidth:1.5,stroke:T(l,s)});if(g.messageRef){var B=x.getPointAtLength(x.getTotalLength()/2),z=n.getScaledPath("MESSAGE_FLOW_MARKER",{abspos:{x:B.x,y:B.y}}),U={strokeWidth:1};E.messageVisibleKind==="initiating"?(U.fill="white",U.stroke=ft):(U.fill="#888",U.stroke="white");var Ie=O(m,z,U),$o=g.messageRef.name,oa=xe(m,$o,{align:"center-top",fitBox:!0,style:{fill:T(l,p)}}),Ho=Ie.getBBox(),zo=oa.getBBox(),Wo=B.x-zo.width/2,Go=B.y+Ho.height/2+Tc;ca(oa,Wo,Go,0)}return x},"bpmn:DataObject":function(m,l){var g=n.getScaledPath("DATA_OBJECT_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.474,my:.296}}),E=O(m,g,{fill:j(l,c),fillOpacity:qe,stroke:T(l,s)}),S=te(l);return Ec(S)&&Bn(m,l),E},"bpmn:DataObjectReference":fe("bpmn:DataObject"),"bpmn:DataInput":function(m,l){var g=n.getRawPath("DATA_ARROW"),E=M("bpmn:DataObject")(m,l);return O(m,g,{strokeWidth:1}),E},"bpmn:DataOutput":function(m,l){var g=n.getRawPath("DATA_ARROW"),E=M("bpmn:DataObject")(m,l);return O(m,g,{strokeWidth:1,fill:ft}),E},"bpmn:DataStoreReference":function(m,l){var g=n.getScaledPath("DATA_STORE",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:0,my:.133}}),E=O(m,g,{strokeWidth:2,fill:j(l,c),fillOpacity:qe,stroke:T(l,s)});return E},"bpmn:BoundaryEvent":function(m,l){var g=te(l),E=g.cancelActivity,S={strokeWidth:1.5,fill:j(l,c),stroke:T(l,s)};E||(S.strokeDasharray="6");var y={...S,fillOpacity:1},x={...S,fill:"none"},B=M("bpmn:Event")(m,l,y);return P(m,l.width,l.height,Nn,x),he(l,m),B},"bpmn:Group":function(m,l){return k(m,l.width,l.height,Ut,{stroke:T(l,s),strokeWidth:1.5,strokeDasharray:"10,6,0,6",fill:"none",pointerEvents:"none"})},label:function(m,l){return Rn(m,l)},"bpmn:TextAnnotation":function(m,l){var g=k(m,l.width,l.height,0,0,{fill:"none",stroke:"none"}),E=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:0,my:0}});O(m,E,{stroke:T(l,s)});var S=te(l).text||"";return xe(m,S,{box:l,align:"left-top",padding:7,style:{fill:lt(l,p,s)}}),g},ParticipantMultiplicityMarker:function(m,l){var g=n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:l.width/2/l.width,my:(l.height-15)/l.height}});de("participant-multiplicity",m,g,{strokeWidth:2,fill:j(l,c),stroke:T(l,s)})},SubProcessMarker:function(m,l){var g=k(m,14,14,0,{strokeWidth:1,fill:j(l,c),stroke:T(l,s)});pr(g,l.width/2-7.5,l.height-20);var E=n.getScaledPath("MARKER_SUB_PROCESS",{xScaleFactor:1.5,yScaleFactor:1.5,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2-7.5)/l.width,my:(l.height-20)/l.height}});de("sub-process",m,E,{fill:j(l,c),stroke:T(l,s)})},ParallelMarker:function(m,l,g){var E=n.getScaledPath("MARKER_PARALLEL",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2+g.parallel)/l.width,my:(l.height-20)/l.height}});de("parallel",m,E,{fill:j(l,c),stroke:T(l,s)})},SequentialMarker:function(m,l,g){var E=n.getScaledPath("MARKER_SEQUENTIAL",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2+g.seq)/l.width,my:(l.height-19)/l.height}});de("sequential",m,E,{fill:j(l,c),stroke:T(l,s)})},CompensationMarker:function(m,l,g){var E=n.getScaledPath("MARKER_COMPENSATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2+g.compensation)/l.width,my:(l.height-13)/l.height}});de("compensation",m,E,{strokeWidth:1,fill:j(l,c),stroke:T(l,s)})},LoopMarker:function(m,l,g){var E=n.getScaledPath("MARKER_LOOP",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2+g.loop)/l.width,my:(l.height-7)/l.height}});de("loop",m,E,{strokeWidth:1.5,fill:j(l,c),stroke:T(l,s),strokeMiterlimit:.5})},AdhocMarker:function(m,l,g){var E=n.getScaledPath("MARKER_ADHOC",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:(l.width/2+g.adhoc)/l.width,my:(l.height-15)/l.height}});de("adhoc",m,E,{strokeWidth:1,fill:T(l,s),stroke:T(l,s)})}};function Ye(m,l,g){var E=te(l),S=g&&g.indexOf("SubProcessMarker")!==-1,y;S?y={seq:-21,parallel:-22,compensation:-42,loop:-18,adhoc:10}:y={seq:-3,parallel:-6,compensation:-27,loop:0,adhoc:10},L(g,function(z){M(z)(m,l,y)}),E.isForCompensation&&M("CompensationMarker")(m,l,y),E.$type==="bpmn:AdHocSubProcess"&&M("AdhocMarker")(m,l,y);var x=E.loopCharacteristics,B=x&&x.isSequential;x&&(B===void 0&&M("LoopMarker")(m,l,y),B===!1&&M("ParallelMarker")(m,l,y),B===!0&&M("SequentialMarker")(m,l,y))}function Bn(m,l){var g=(l.height-18)/l.height,E=n.getScaledPath("DATA_OBJECT_COLLECTION_PATH",{xScaleFactor:1,yScaleFactor:1,containerWidth:l.width,containerHeight:l.height,position:{mx:.33,my:g}});O(m,E,{strokeWidth:2})}this._drawPath=O,this._renderer=M}N(We,cr);We.$inject=["config.bpmnRenderer","eventBus","styles","pathMap","canvas","textRenderer"];We.prototype.canRender=function(e){return d(e,"bpmn:BaseElement")};We.prototype.drawShape=function(e,t){var i=t.type,n=this._renderer(i);return n(e,t)};We.prototype.drawConnection=function(e,t){var i=t.type,n=this._renderer(i);return n(e,t)};We.prototype.getShapePath=function(e){return d(e,"bpmn:Event")?wc(e):d(e,"bpmn:Activity")?xc(e,Ut):d(e,"bpmn:Gateway")?_c(e):Sc(e)};var Ac=12,Rc=1.2,Cc=30;function Nr(e){var t=A({fontFamily:"Arial, sans-serif",fontSize:Ac,fontWeight:"normal",lineHeight:Rc},e&&e.defaultStyle||{}),i=parseInt(t.fontSize,10)-1,n=A({},t,{fontSize:i},e&&e.externalStyle||{}),a=new ns({style:t});this.getExternalLabelBounds=function(r,o){var c=a.getDimensions(o,{box:{width:90,height:30,x:r.width/2+r.x,y:r.height/2+r.y},style:n});return{x:Math.round(r.x+r.width/2-c.width/2),y:Math.round(r.y),width:Math.ceil(c.width),height:Math.ceil(c.height)}},this.getTextAnnotationBounds=function(r,o){var c=a.getDimensions(o,{box:r,style:t,align:"left-top",padding:5});return{x:r.x,y:r.y,width:r.width,height:Math.max(Cc,Math.round(c.height))}},this.createText=function(r,o){return a.createText(r,o||{})},this.getDefaultStyle=function(){return t},this.getExternalStyle=function(){return n}}Nr.$inject=["config.textRenderer"];function Bc(){this.pathMap={EVENT_MESSAGE:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:36,width:36,heightElements:[6,14],widthElements:[10.5,21]},EVENT_SIGNAL:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x1},0 Z",height:36,width:36,heightElements:[18],widthElements:[10,20]},EVENT_ESCALATION:{d:"M {mx},{my} l {e.x0},{e.y0} l -{e.x0},-{e.y1} l -{e.x0},{e.y1} Z",height:36,width:36,heightElements:[20,7],widthElements:[8]},EVENT_CONDITIONAL:{d:"M {e.x0},{e.y0} l {e.x1},0 l 0,{e.y2} l -{e.x1},0 Z M {e.x2},{e.y3} l {e.x0},0 M {e.x2},{e.y4} l {e.x0},0 M {e.x2},{e.y5} l {e.x0},0 M {e.x2},{e.y6} l {e.x0},0 M {e.x2},{e.y7} l {e.x0},0 M {e.x2},{e.y8} l {e.x0},0 ",height:36,width:36,heightElements:[8.5,14.5,18,11.5,14.5,17.5,20.5,23.5,26.5],widthElements:[10.5,14.5,12.5]},EVENT_LINK:{d:"m {mx},{my} 0,{e.y0} -{e.x1},0 0,{e.y1} {e.x1},0 0,{e.y0} {e.x0},-{e.y2} -{e.x0},-{e.y2} z",height:36,width:36,heightElements:[4.4375,6.75,7.8125],widthElements:[9.84375,13.5]},EVENT_ERROR:{d:"m {mx},{my} {e.x0},-{e.y0} {e.x1},-{e.y1} {e.x2},{e.y2} {e.x3},-{e.y3} -{e.x4},{e.y4} -{e.x5},-{e.y5} z",height:36,width:36,heightElements:[.023,8.737,8.151,16.564,10.591,8.714],widthElements:[.085,6.672,6.97,4.273,5.337,6.636]},EVENT_CANCEL_45:{d:"m {mx},{my} -{e.x1},0 0,{e.x0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:36,width:36,heightElements:[4.75,8.5],widthElements:[4.75,8.5]},EVENT_COMPENSATION:{d:"m {mx},{my} {e.x0},-{e.y0} 0,{e.y1} z m {e.x1},-{e.y2} {e.x2},-{e.y3} 0,{e.y1} -{e.x2},-{e.y3} z",height:36,width:36,heightElements:[6.5,13,.4,6.1],widthElements:[9,9.3,8.7]},EVENT_TIMER_WH:{d:"M {mx},{my} l {e.x0},-{e.y0} m -{e.x0},{e.y0} l {e.x1},{e.y1} ",height:36,width:36,heightElements:[10,2],widthElements:[3,7]},EVENT_TIMER_LINE:{d:"M {mx},{my} m {e.x0},{e.y0} l -{e.x1},{e.y1} ",height:36,width:36,heightElements:[10,3],widthElements:[0,0]},EVENT_MULTIPLE:{d:"m {mx},{my} {e.x1},-{e.y0} {e.x1},{e.y0} -{e.x0},{e.y1} -{e.x2},0 z",height:36,width:36,heightElements:[6.28099,12.56199],widthElements:[3.1405,9.42149,12.56198]},EVENT_PARALLEL_MULTIPLE:{d:"m {mx},{my} {e.x0},0 0,{e.y1} {e.x1},0 0,{e.y0} -{e.x1},0 0,{e.y1} -{e.x0},0 0,-{e.y1} -{e.x1},0 0,-{e.y0} {e.x1},0 z",height:36,width:36,heightElements:[2.56228,7.68683],widthElements:[2.56228,7.68683]},GATEWAY_EXCLUSIVE:{d:"m {mx},{my} {e.x0},{e.y0} {e.x1},{e.y0} {e.x2},0 {e.x4},{e.y2} {e.x4},{e.y1} {e.x2},0 {e.x1},{e.y3} {e.x0},{e.y3} {e.x3},0 {e.x5},{e.y1} {e.x5},{e.y2} {e.x3},0 z",height:17.5,width:17.5,heightElements:[8.5,6.5312,-6.5312,-8.5],widthElements:[6.5,-6.5,3,-3,5,-5]},GATEWAY_PARALLEL:{d:"m {mx},{my} 0,{e.y1} -{e.x1},0 0,{e.y0} {e.x1},0 0,{e.y1} {e.x0},0 0,-{e.y1} {e.x1},0 0,-{e.y0} -{e.x1},0 0,-{e.y1} -{e.x0},0 z",height:30,width:30,heightElements:[5,12.5],widthElements:[5,12.5]},GATEWAY_EVENT_BASED:{d:"m {mx},{my} {e.x0},{e.y0} {e.x0},{e.y1} {e.x1},{e.y2} {e.x2},0 z",height:11,width:11,heightElements:[-6,6,12,-12],widthElements:[9,-3,-12]},GATEWAY_COMPLEX:{d:"m {mx},{my} 0,{e.y0} -{e.x0},-{e.y1} -{e.x1},{e.y2} {e.x0},{e.y1} -{e.x2},0 0,{e.y3} {e.x2},0  -{e.x0},{e.y1} l {e.x1},{e.y2} {e.x0},-{e.y1} 0,{e.y0} {e.x3},0 0,-{e.y0} {e.x0},{e.y1} {e.x1},-{e.y2} -{e.x0},-{e.y1} {e.x2},0 0,-{e.y3} -{e.x2},0 {e.x0},-{e.y1} -{e.x1},-{e.y2} -{e.x0},{e.y1} 0,-{e.y0} -{e.x3},0 z",height:17.125,width:17.125,heightElements:[4.875,3.4375,2.125,3],widthElements:[3.4375,2.125,4.875,3]},DATA_OBJECT_PATH:{d:"m 0,0 {e.x1},0 {e.x0},{e.y0} 0,{e.y1} -{e.x2},0 0,-{e.y2} {e.x1},0 0,{e.y0} {e.x0},0",height:61,width:51,heightElements:[10,50,60],widthElements:[10,40,50,60]},DATA_OBJECT_COLLECTION_PATH:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},DATA_ARROW:{d:"m 5,9 9,0 0,-3 5,5 -5,5 0,-3 -9,0 z",height:61,width:51,heightElements:[],widthElements:[]},DATA_STORE:{d:"m  {mx},{my} l  0,{e.y2} c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 l  0,-{e.y2} c -{e.x0},-{e.y1} -{e.x1},-{e.y1} -{e.x2},0c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0 m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1} {e.x2},0m  -{e.x2},{e.y0}c  {e.x0},{e.y1} {e.x1},{e.y1}  {e.x2},0",height:61,width:61,heightElements:[7,10,45],widthElements:[2,58,60]},TEXT_ANNOTATION:{d:"m {mx}, {my} m 10,0 l -10,0 l 0,{e.y0} l 10,0",height:30,width:10,heightElements:[30],widthElements:[10]},MARKER_SUB_PROCESS:{d:"m{mx},{my} m 7,2 l 0,10 m -5,-5 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_PARALLEL:{d:"m{mx},{my} m 3,2 l 0,10 m 3,-10 l 0,10 m 3,-10 l 0,10",height:10,width:10,heightElements:[],widthElements:[]},MARKER_SEQUENTIAL:{d:"m{mx},{my} m 0,3 l 10,0 m -10,3 l 10,0 m -10,3 l 10,0",height:10,width:10,heightElements:[],widthElements:[]},MARKER_COMPENSATION:{d:"m {mx},{my} 7,-5 0,10 z m 7.1,-0.3 6.9,-4.7 0,10 -6.9,-4.7 z",height:10,width:21,heightElements:[],widthElements:[]},MARKER_LOOP:{d:"m {mx},{my} c 3.526979,0 6.386161,-2.829858 6.386161,-6.320661 0,-3.490806 -2.859182,-6.320661 -6.386161,-6.320661 -3.526978,0 -6.38616,2.829855 -6.38616,6.320661 0,1.745402 0.714797,3.325567 1.870463,4.469381 0.577834,0.571908 1.265885,1.034728 2.029916,1.35457 l -0.718163,-3.909793 m 0.718163,3.909793 -3.885211,0.802902",height:13.9,width:13.7,heightElements:[],widthElements:[]},MARKER_ADHOC:{d:"m {mx},{my} m 0.84461,2.64411 c 1.05533,-1.23780996 2.64337,-2.07882 4.29653,-1.97997996 2.05163,0.0805 3.85579,1.15803 5.76082,1.79107 1.06385,0.34139996 2.24454,0.1438 3.18759,-0.43767 0.61743,-0.33642 1.2775,-0.64078 1.7542,-1.17511 0,0.56023 0,1.12046 0,1.6807 -0.98706,0.96237996 -2.29792,1.62393996 -3.6918,1.66181996 -1.24459,0.0927 -2.46671,-0.2491 -3.59505,-0.74812 -1.35789,-0.55965 -2.75133,-1.33436996 -4.27027,-1.18121996 -1.37741,0.14601 -2.41842,1.13685996 -3.44288,1.96782996 z",height:4,width:15,heightElements:[],widthElements:[]},TASK_TYPE_SEND:{d:"m {mx},{my} l 0,{e.y1} l {e.x1},0 l 0,-{e.y1} z l {e.x0},{e.y0} l {e.x0},-{e.y0}",height:14,width:21,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_SCRIPT:{d:"m {mx},{my} c 9.966553,-6.27276 -8.000926,-7.91932 2.968968,-14.938 l -8.802728,0 c -10.969894,7.01868 6.997585,8.66524 -2.968967,14.938 z m -7,-12 l 5,0 m -4.5,3 l 4.5,0 m -3,3 l 5,0m -4,3 l 5,0",height:15,width:12.6,heightElements:[6,14],widthElements:[10.5,21]},TASK_TYPE_USER_1:{d:"m {mx},{my} c 0.909,-0.845 1.594,-2.049 1.594,-3.385 0,-2.554 -1.805,-4.62199999 -4.357,-4.62199999 -2.55199998,0 -4.28799998,2.06799999 -4.28799998,4.62199999 0,1.348 0.974,2.562 1.89599998,3.405 -0.52899998,0.187 -5.669,2.097 -5.794,4.7560005 v 6.718 h 17 v -6.718 c 0,-2.2980005 -5.5279996,-4.5950005 -6.0509996,-4.7760005 zm -8,6 l 0,5.5 m 11,0 l 0,-5"},TASK_TYPE_USER_2:{d:"m {mx},{my} m 2.162,1.009 c 0,2.4470005 -2.158,4.4310005 -4.821,4.4310005 -2.66499998,0 -4.822,-1.981 -4.822,-4.4310005 "},TASK_TYPE_USER_3:{d:"m {mx},{my} m -6.9,-3.80 c 0,0 2.25099998,-2.358 4.27399998,-1.177 2.024,1.181 4.221,1.537 4.124,0.965 -0.098,-0.57 -0.117,-3.79099999 -4.191,-4.13599999 -3.57499998,0.001 -4.20799998,3.36699999 -4.20699998,4.34799999 z"},TASK_TYPE_MANUAL:{d:"m {mx},{my} c 0.234,-0.01 5.604,0.008 8.029,0.004 0.808,0 1.271,-0.172 1.417,-0.752 0.227,-0.898 -0.334,-1.314 -1.338,-1.316 -2.467,-0.01 -7.886,-0.004 -8.108,-0.004 -0.014,-0.079 0.016,-0.533 0,-0.61 0.195,-0.042 8.507,0.006 9.616,0.002 0.877,-0.007 1.35,-0.438 1.353,-1.208 0.003,-0.768 -0.479,-1.09 -1.35,-1.091 -2.968,-0.002 -9.619,-0.013 -9.619,-0.013 v -0.591 c 0,0 5.052,-0.016 7.225,-0.016 0.888,-0.002 1.354,-0.416 1.351,-1.193 -0.006,-0.761 -0.492,-1.196 -1.361,-1.196 -3.473,-0.005 -10.86,-0.003 -11.0829995,-0.003 -0.022,-0.047 -0.045,-0.094 -0.069,-0.139 0.3939995,-0.319 2.0409995,-1.626 2.4149995,-2.017 0.469,-0.4870005 0.519,-1.1650005 0.162,-1.6040005 -0.414,-0.511 -0.973,-0.5 -1.48,-0.236 -1.4609995,0.764 -6.5999995,3.6430005 -7.7329995,4.2710005 -0.9,0.499 -1.516,1.253 -1.882,2.19 -0.37000002,0.95 -0.17,2.01 -0.166,2.979 0.004,0.718 -0.27300002,1.345 -0.055,2.063 0.629,2.087 2.425,3.312 4.859,3.318 4.6179995,0.014 9.2379995,-0.139 13.8569995,-0.158 0.755,-0.004 1.171,-0.301 1.182,-1.033 0.012,-0.754 -0.423,-0.969 -1.183,-0.973 -1.778,-0.01 -5.824,-0.004 -6.04,-0.004 10e-4,-0.084 0.003,-0.586 10e-4,-0.67 z"},TASK_TYPE_INSTANTIATING_SEND:{d:"m {mx},{my} l 0,8.4 l 12.6,0 l 0,-8.4 z l 6.3,3.6 l 6.3,-3.6"},TASK_TYPE_SERVICE:{d:"m {mx},{my} v -1.71335 c 0.352326,-0.0705 0.703932,-0.17838 1.047628,-0.32133 0.344416,-0.14465 0.665822,-0.32133 0.966377,-0.52145 l 1.19431,1.18005 1.567487,-1.57688 -1.195028,-1.18014 c 0.403376,-0.61394 0.683079,-1.29908 0.825447,-2.01824 l 1.622133,-0.01 v -2.2196 l -1.636514,0.01 c -0.07333,-0.35153 -0.178319,-0.70024 -0.323564,-1.04372 -0.145244,-0.34406 -0.321407,-0.6644 -0.522735,-0.96217 l 1.131035,-1.13631 -1.583305,-1.56293 -1.129598,1.13589 c -0.614052,-0.40108 -1.302883,-0.68093 -2.022633,-0.82247 l 0.0093,-1.61852 h -2.241173 l 0.0042,1.63124 c -0.353763,0.0736 -0.705369,0.17977 -1.049785,0.32371 -0.344415,0.14437 -0.665102,0.32092 -0.9635006,0.52046 l -1.1698628,-1.15823 -1.5667691,1.5792 1.1684265,1.15669 c -0.4026573,0.61283 -0.68308,1.29797 -0.8247287,2.01713 l -1.6588041,0.003 v 2.22174 l 1.6724648,-0.006 c 0.073327,0.35077 0.1797598,0.70243 0.3242851,1.04472 0.1452428,0.34448 0.3214064,0.6644 0.5227339,0.96066 l -1.1993431,1.19723 1.5840256,1.56011 1.1964668,-1.19348 c 0.6140517,0.40346 1.3028827,0.68232 2.0233517,0.82331 l 7.19e-4,1.69892 h 2.226848 z m 0.221462,-3.9957 c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_SERVICE_FILL:{d:"m {mx},{my} c -1.788948,0.7502 -3.8576,-0.0928 -4.6097055,-1.87438 -0.7521065,-1.78321 0.090598,-3.84627 1.8802645,-4.59604 1.78823,-0.74936 3.856881,0.0929 4.608987,1.87437 0.752106,1.78165 -0.0906,3.84612 -1.879546,4.59605 z"},TASK_TYPE_BUSINESS_RULE_HEADER:{d:"m {mx},{my} 0,4 20,0 0,-4 z"},TASK_TYPE_BUSINESS_RULE_MAIN:{d:"m {mx},{my} 0,12 20,0 0,-12 zm 0,8 l 20,0 m -13,-4 l 0,8"},MESSAGE_FLOW_MARKER:{d:"m {mx},{my} m -10.5 ,-7 l 0,14 l 21,0 l 0,-14 z l 10.5,6 l 10.5,-6"}},this.getRawPath=function(t){return this.pathMap[t].d},this.getScaledPath=function(t,i){var n=this.pathMap[t],a,r;i.abspos?(a=i.abspos.x,r=i.abspos.y):(a=i.containerWidth*i.position.mx,r=i.containerHeight*i.position.my);var o={};if(i.position){for(var c=i.containerHeight/n.height*i.yScaleFactor,s=i.containerWidth/n.width*i.xScaleFactor,p=0;p<n.heightElements.length;p++)o["y"+p]=n.heightElements[p]*c;for(var u=0;u<n.widthElements.length;u++)o["x"+u]=n.widthElements[u]*s}var f=Lc(n.d,{mx:a,my:r,e:o});return f}}var Nc=/\{([^{}]+)\}/g,kc=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;function Mc(e,t,i){var n=i;return t.replace(kc,function(a,r,o,c,s){r=r||c,n&&(r in n&&(n=n[r]),typeof n=="function"&&s&&(n=n()))}),n=(n==null||n==i?e:n)+"",n}function Lc(e,t){return String(e).replace(Nc,function(i,n){return Mc(i,n,t)})}var Oc={__init__:["bpmnRenderer"],bpmnRenderer:["type",We],textRenderer:["type",Nr],pathMap:["type",Bc]},bt={width:90,height:20},fa=15;function He(e){return d(e,"bpmn:Event")||d(e,"bpmn:Gateway")||d(e,"bpmn:DataStoreReference")||d(e,"bpmn:DataObjectReference")||d(e,"bpmn:DataInput")||d(e,"bpmn:DataOutput")||d(e,"bpmn:SequenceFlow")||d(e,"bpmn:MessageFlow")||d(e,"bpmn:Group")}function pn(e){return Y(e.label)}function Ic(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)],a=Fc(e),r=Math.atan((n.y-i.y)/(n.x-i.x)),o=a.x,c=a.y;return Math.abs(r)<Math.PI/2?c-=fa:o+=fa,{x:o,y:c}}function Fc(e){var t=e.length/2-1,i=e[Math.floor(t)],n=e[Math.ceil(t+.01)];return{x:i.x+(n.x-i.x)/2,y:i.y+(n.y-i.y)/2}}function ln(e){return e.waypoints?Ic(e.waypoints):d(e,"bpmn:Group")?{x:e.x+e.width/2,y:e.y+bt.height/2}:{x:e.x+e.width/2,y:e.y+e.height+bt.height/2}}function jc(e,t){var i,n,a,r=e.label;return r&&r.bounds?(a=r.bounds,n={width:Math.max(bt.width,a.width),height:a.height},i={x:a.x+a.width/2,y:a.y+a.height/2}):(i=ln(t),n=bt),A({x:i.x-n.width/2,y:i.y-n.height/2},n)}function Y(e){return e&&!!e.labelTarget}function Yt(e,t,i){return A({id:e.id,type:e.$type,businessObject:e,di:t},i)}function $c(e,t,i){var n=e.waypoint;return!n||n.length<2?[W(t),W(i)]:n.map(function(a){return{x:a.x,y:a.y}})}function kr(e,t,i,n){return new Error(e("element {element} referenced by {referenced}#{property} not yet drawn",{element:Z(i),referenced:Z(t),property:n}))}function Te(e,t,i,n,a,r){this._eventBus=e,this._canvas=t,this._elementFactory=i,this._elementRegistry=n,this._translate=a,this._textRenderer=r}Te.$inject=["eventBus","canvas","elementFactory","elementRegistry","translate","textRenderer"];Te.prototype.add=function(e,t,i){var n,a=this._translate,r,o;if(d(t,"bpmndi:BPMNPlane")){var c=d(e,"bpmn:SubProcess")?{id:e.id+"_plane"}:{};n=this._elementFactory.createRoot(Yt(e,t,c)),this._canvas.addRootElement(n)}else if(d(t,"bpmndi:BPMNShape")){var s=!$(e,t),p=zc(e);r=i&&(i.hidden||i.collapsed);var u=t.bounds;n=this._elementFactory.createShape(Yt(e,t,{collapsed:s,hidden:r,x:Math.round(u.x),y:Math.round(u.y),width:Math.round(u.width),height:Math.round(u.height),isFrame:p})),d(e,"bpmn:BoundaryEvent")&&this._attachBoundary(e,n),d(e,"bpmn:Lane")&&(o=0),d(e,"bpmn:DataStoreReference")&&(Hc(i,W(u))||(i=this._canvas.findRoot(i))),this._canvas.addShape(n,i,o)}else if(d(t,"bpmndi:BPMNEdge")){var f=this._getSource(e),h=this._getTarget(e);r=i&&(i.hidden||i.collapsed),n=this._elementFactory.createConnection(Yt(e,t,{hidden:r,source:f,target:h,waypoints:$c(t,f,h)})),d(e,"bpmn:DataAssociation")&&(i=this._canvas.findRoot(i)),this._canvas.addConnection(n,i,o)}else throw new Error(a("unknown di {di} for element {semantic}",{di:Z(t),semantic:Z(e)}));return He(e)&&ge(n)&&this.addLabel(e,t,n),this._eventBus.fire("bpmnElement.added",{element:n}),n};Te.prototype._attachBoundary=function(e,t){var i=this._translate,n=e.attachedToRef;if(!n)throw new Error(i("missing {semantic}#attachedToRef",{semantic:Z(e)}));var a=this._elementRegistry.get(n.id),r=a&&a.attachers;if(!a)throw kr(i,e,n,"attachedToRef");t.host=a,r||(a.attachers=r=[]),r.indexOf(t)===-1&&r.push(t)};Te.prototype.addLabel=function(e,t,i){var n,a,r;return n=jc(t,i),a=ge(i),a&&(n=this._textRenderer.getExternalLabelBounds(n,a)),r=this._elementFactory.createLabel(Yt(e,t,{id:e.id+"_label",labelTarget:i,type:"label",hidden:i.hidden||!ge(i),x:Math.round(n.x),y:Math.round(n.y),width:Math.round(n.width),height:Math.round(n.height)})),this._canvas.addShape(r,i.parent)};Te.prototype._getEnd=function(e,t){var i,n,a=e.$type,r=this._translate;if(n=e[t+"Ref"],t==="source"&&a==="bpmn:DataInputAssociation"&&(n=n&&n[0]),(t==="source"&&a==="bpmn:DataOutputAssociation"||t==="target"&&a==="bpmn:DataInputAssociation")&&(n=e.$parent),i=n&&this._getElement(n),i)return i;throw n?kr(r,e,n,t+"Ref"):new Error(r("{semantic}#{side} Ref not specified",{semantic:Z(e),side:t}))};Te.prototype._getSource=function(e){return this._getEnd(e,"source")};Te.prototype._getTarget=function(e){return this._getEnd(e,"target")};Te.prototype._getElement=function(e){return this._elementRegistry.get(e.id)};function Hc(e,t){var i=t.x,n=t.y;return i>=e.x&&i<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function zc(e){return d(e,"bpmn:Group")}var Wc={__depends__:[rn],bpmnImporter:["type",Te]},Gc={__depends__:[Oc,Wc]},Mr="_plane";function ha(e){var t=e.id;return Vc(t)}function Se(e){var t=e.id;return d(e,"bpmn:SubProcess")?Lr(t):t}function Fe(e){return Lr(e)}function kn(e){var t=H(e);return d(t,"bpmndi:BPMNPlane")}function Lr(e){return e+Mr}function Vc(e){return e.replace(new RegExp(Mr+"$"),"")}var Uc="bjs-breadcrumbs-shown";function Or(e,t,i,n){var a=et('<ul class="bjs-breadcrumbs"></ul>'),r=n.getContainer(),o=sr(r);r.appendChild(a);var c=[];e.on("element.changed",function(p){var u=p.element,f=R(u),h=X(c,function(v){return v===f});!h||s()});function s(p){p&&(c=Yc(p));var u=c.map(function(h){var v=is(h.name||h.id),b=et('<li><span class="bjs-crumb"><a title="'+v+'">'+v+"</a></span></li>"),w=n.findRoot(Se(h))||n.findRoot(h.id);if(!w&&d(h,"bpmn:Process")){var _=t.find(function(D){var P=R(D);return P&&P.processRef&&P.processRef===h});w=n.findRoot(_.id)}return b.addEventListener("click",function(){n.setRootElement(w)}),b});a.innerHTML="";var f=u.length>1;o.toggle(Uc,f),u.forEach(function(h){a.appendChild(h)})}e.on("root.set",function(p){s(p.element)})}Or.$inject=["eventBus","elementRegistry","overlays","canvas"];function Yc(e){for(var t=R(e),i=[],n=t;n;n=n.$parent)(d(n,"bpmn:SubProcess")||d(n,"bpmn:Process"))&&i.push(n);return i.reverse()}function Ir(e,t){var i=null,n=new qc;e.on("root.set",function(a){var r=a.element,o=t.viewbox(),c=n.get(r);if(n.set(i,{x:o.x,y:o.y,zoom:o.scale}),i=r,!(d(r,"bpmn:Collaboration")&&!c)){c=c||{x:0,y:0,zoom:1};var s=(o.x-c.x)*o.scale,p=(o.y-c.y)*o.scale;(s!==0||p!==0)&&t.scroll({dx:s,dy:p}),c.zoom!==o.scale&&t.zoom(c.zoom,{x:0,y:0})}}),e.on("diagram.clear",function(){n.clear(),i=null})}Ir.$inject=["eventBus","canvas"];function qc(){this._entries=[],this.set=function(e,t){var i=!1;for(var n in this._entries)if(this._entries[n][0]===e){this._entries[n][1]=t,i=!0;break}i||this._entries.push([e,t])},this.get=function(e){for(var t in this._entries)if(this._entries[t][0]===e)return this._entries[t][1];return null},this.clear=function(){this._entries.length=0},this.remove=function(e){var t=-1;for(var i in this._entries)if(this._entries[i][0]===e){t=i;break}t!==-1&&this._entries.splice(t,1)}}var ma={x:180,y:160};function Ge(e,t){this._eventBus=e,this._moddle=t;var i=this;e.on("import.render.start",1500,function(n,a){i.handleImport(a.definitions)})}Ge.prototype.handleImport=function(e){if(!!e.diagrams){var t=this;this._definitions=e,this._processToDiagramMap={},e.diagrams.forEach(function(n){!n.plane||!n.plane.bpmnElement||(t._processToDiagramMap[n.plane.bpmnElement.id]=n)});var i=[];e.diagrams.forEach(function(n){var a=t.createNewDiagrams(n.plane);Array.prototype.push.apply(i,a)}),i.forEach(function(n){t.movePlaneElementsToOrigin(n.plane)})}};Ge.prototype.createNewDiagrams=function(e){var t=this,i=[],n=[];e.get("planeElement").forEach(function(r){var o=r.bpmnElement;if(!!o){var c=o.$parent;d(o,"bpmn:SubProcess")&&!r.isExpanded&&i.push(o),Xc(o,e)&&n.push({diElement:r,parent:c})}});var a=[];return i.forEach(function(r){if(!t._processToDiagramMap[r.id]){var o=t.createDiagram(r);t._processToDiagramMap[r.id]=o,a.push(o)}}),n.forEach(function(r){for(var o=r.diElement,c=r.parent;c&&i.indexOf(c)===-1;)c=c.$parent;if(!!c){var s=t._processToDiagramMap[c.id];t.moveToDiPlane(o,s.plane)}}),a};Ge.prototype.movePlaneElementsToOrigin=function(e){var t=e.get("planeElement"),i=Kc(e),n={x:i.x-ma.x,y:i.y-ma.y};t.forEach(function(a){a.waypoint?a.waypoint.forEach(function(r){r.x=r.x-n.x,r.y=r.y-n.y}):a.bounds&&(a.bounds.x=a.bounds.x-n.x,a.bounds.y=a.bounds.y-n.y)})};Ge.prototype.moveToDiPlane=function(e,t){var i=Fr(e),n=i.plane.get("planeElement");n.splice(n.indexOf(e),1),t.get("planeElement").push(e)};Ge.prototype.createDiagram=function(e){var t=this._moddle.create("bpmndi:BPMNPlane",{bpmnElement:e}),i=this._moddle.create("bpmndi:BPMNDiagram",{plane:t});return t.$parent=i,t.bpmnElement=e,i.$parent=this._definitions,this._definitions.diagrams.push(i),i};Ge.$inject=["eventBus","moddle"];function Fr(e){return d(e,"bpmndi:BPMNDiagram")?e:Fr(e.$parent)}function Kc(e){var t={top:1/0,right:-1/0,bottom:-1/0,left:1/0};return e.planeElement.forEach(function(i){if(!!i.bounds){var n=K(i.bounds);t.top=Math.min(n.top,t.top),t.left=Math.min(n.left,t.left)}}),as(t)}function Xc(e,t){var i=e.$parent;return!(!d(i,"bpmn:SubProcess")||i===t.bpmnElement||I(e,["bpmn:DataInputAssociation","bpmn:DataOutputAssociation"]))}var Ot=250,Zc='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.81801948,3.50735931 L10.4996894,9.1896894 L10.5,4 L12,4 L12,12 L4,12 L4,10.5 L9.6896894,10.4996894 L3.75735931,4.56801948 C3.46446609,4.27512627 3.46446609,3.80025253 3.75735931,3.50735931 C4.05025253,3.21446609 4.52512627,3.21446609 4.81801948,3.50735931 Z"/></svg>',Jc="bjs-drilldown-empty";function ke(e,t,i,n){C.call(this,t),this._canvas=e,this._eventBus=t,this._elementRegistry=i,this._overlays=n;var a=this;this.executed("shape.toggleCollapse",Ot,function(r){var o=r.shape;a.canDrillDown(o)?a.addOverlay(o):a.removeOverlay(o)},!0),this.reverted("shape.toggleCollapse",Ot,function(r){var o=r.shape;a.canDrillDown(o)?a.addOverlay(o):a.removeOverlay(o)},!0),this.executed(["shape.create","shape.move","shape.delete"],Ot,function(r){var o=r.oldParent,c=r.newParent||r.parent,s=r.shape;a.canDrillDown(s)&&a.addOverlay(s),a.updateDrilldownOverlay(o),a.updateDrilldownOverlay(c),a.updateDrilldownOverlay(s)},!0),this.reverted(["shape.create","shape.move","shape.delete"],Ot,function(r){var o=r.oldParent,c=r.newParent||r.parent,s=r.shape;a.canDrillDown(s)&&a.addOverlay(s),a.updateDrilldownOverlay(o),a.updateDrilldownOverlay(c),a.updateDrilldownOverlay(s)},!0),t.on("import.render.complete",function(){i.filter(function(r){return a.canDrillDown(r)}).map(function(r){a.addOverlay(r)})})}N(ke,C);ke.prototype.updateDrilldownOverlay=function(e){var t=this._canvas;if(!!e){var i=t.findRoot(e);i&&this.updateOverlayVisibility(i)}};ke.prototype.canDrillDown=function(e){var t=this._canvas;return d(e,"bpmn:SubProcess")&&t.findRoot(Se(e))};ke.prototype.updateOverlayVisibility=function(e){var t=this._overlays,i=e.businessObject,n=t.get({element:i.id,type:"drilldown"})[0];if(!!n){var a=i&&i.flowElements&&i.flowElements.length;sr(n.html).toggle(Jc,!a)}};ke.prototype.addOverlay=function(e){var t=this._canvas,i=this._overlays,n=i.get({element:e,type:"drilldown"});n.length&&this.removeOverlay(e);var a=et('<button class="bjs-drilldown">'+Zc+"</button>");a.addEventListener("click",function(){t.setRootElement(t.findRoot(Se(e)))}),i.add(e,"drilldown",{position:{bottom:-7,right:-8},html:a}),this.updateOverlayVisibility(e)};ke.prototype.removeOverlay=function(e){var t=this._overlays;t.remove({element:e,type:"drilldown"})};ke.$inject=["canvas","eventBus","elementRegistry","overlays"];var Qc={__depends__:[lr,ni,rs],__init__:["drilldownBreadcrumbs","drilldownOverlayBehavior","drilldownCentering","subprocessCompatibility"],drilldownBreadcrumbs:["type",Or],drilldownCentering:["type",Ir],drilldownOverlayBehavior:["type",ke],subprocessCompatibility:["type",Ge]};function Me(e){V.call(this,e)}N(Me,V);Me.prototype._modules=[Gc,rn,on,lr,Qc];Me.prototype._moddleExtensions={};function gt(e){Me.call(this,e)}N(gt,Me);gt.prototype._navigationModules=[ur,dr,fr];gt.prototype._modules=[].concat(Me.prototype._modules,gt.prototype._navigationModules);var ep={align:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%202000%202000%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M200%20150v1700%22%2F%3E%3Crect%20x%3D%22500%22%20y%3D%22150%22%20width%3D%221300%22%20height%3D%22700%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%22500%22%20y%3D%221150%22%20width%3D%22700%22%20height%3D%22700%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",bottom:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M150%201650h1500%22%2F%3E%3Crect%20x%3D%22150%22%20y%3D%22350%22%20width%3D%22600%22%20height%3D%221300%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%221050%22%20y%3D%22850%22%20width%3D%22600%22%20height%3D%22800%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",center:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M900%20150v1500%22%2F%3E%3Crect%20x%3D%22250%22%20y%3D%22150%22%20width%3D%221300%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%22500%22%20y%3D%221050%22%20width%3D%22800%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",left:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M100%20150v1500%22%2F%3E%3Crect%20x%3D%22100%22%20y%3D%22150%22%20width%3D%221300%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%22100%22%20y%3D%221050%22%20width%3D%22800%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",right:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M1650%20150v1500%22%2F%3E%3Crect%20x%3D%22350%22%20y%3D%22150%22%20width%3D%221300%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%22850%22%20y%3D%221050%22%20width%3D%22800%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",top:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M150%20150h1500%22%2F%3E%3Crect%20x%3D%22150%22%20y%3D%22150%22%20width%3D%22600%22%20height%3D%221300%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%221050%22%20y%3D%22150%22%20width%3D%22600%22%20height%3D%22800%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",middle:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22stroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linecap%3Around%22%20d%3D%22M150%20900h1500%22%2F%3E%3Crect%20x%3D%22150%22%20y%3D%22250%22%20width%3D%22600%22%20height%3D%221300%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%221050%22%20y%3D%22500%22%20width%3D%22600%22%20height%3D%22800%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E"},jr=ep,tp=900;function rt(e,t,i,n){e.registerProvider(tp,this),this._contextPad=e,this._popupMenu=t,this._translate=i,this._canvas=n}rt.$inject=["contextPad","popupMenu","translate","canvas"];rt.prototype.getMultiElementContextPadEntries=function(e){var t={};return this._isAllowed(e)&&A(t,this._getEntries(e)),t};rt.prototype._isAllowed=function(e){return!this._popupMenu.isEmpty(e,"align-elements")};rt.prototype._getEntries=function(e){var t=this;return{"align-elements":{group:"align-elements",title:t._translate("Align elements"),imageUrl:jr.align,action:{click:function(i,n){var a=t._getMenuPosition(n);A(a,{cursor:{x:i.x,y:i.y}}),t._popupMenu.open(n,"align-elements",a)}}}}};rt.prototype._getMenuPosition=function(e){var t=5,i=this._contextPad.getPad(e).html,n=i.getBoundingClientRect(),a={x:n.left,y:n.bottom+t};return a};var np=["left","center","right","top","middle","bottom"];function St(e,t,i,n){this._alignElements=t,this._translate=i,this._popupMenu=e,this._rules=n,e.registerProvider("align-elements",this)}St.$inject=["popupMenu","alignElements","translate","rules"];St.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&A(t,this._getEntries(e)),t};St.prototype._isAllowed=function(e){return this._rules.allowed("elements.align",{elements:e})};St.prototype._getEntries=function(e){var t=this._alignElements,i=this._translate,n=this._popupMenu,a={};return L(np,function(r){a["align-elements-"+r]={group:"align",title:i("Align elements "+r),className:"bjs-align-elements-menu-entry",imageUrl:jr[r],action:function(o,c){t.trigger(e,r),n.close()}}}),a};function un(e){Be.call(this,e)}un.$inject=["eventBus"];N(un,Be);un.prototype.init=function(){this.addRule("elements.align",function(e){var t=e.elements,i=G(t,function(n){return!(n.waypoints||n.host||n.labelTarget)});return i=hr(i),i.length<2?!1:i})};var ip={__depends__:[os,ii,sn],__init__:["alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements"],alignElementsContextPadProvider:["type",rt],alignElementsMenuProvider:["type",St],bpmnAlignElements:["type",un]};function Zt(e,t){for(typeof t=="string"&&(t=[t]);e=e.parent;)if(I(e,t))return e;return null}function $r(e,t){if(d(t,"bpmn:TextAnnotation"))return op(e,t);if(I(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"]))return sp(e,t);if(d(t,"bpmn:FlowNode"))return ap(e,t)}function ap(e,t){var i=K(e),n=W(e),a=ss(e,{filter:function(u){return d(u,"bpmn:SequenceFlow")}}),r=30,o=80,c="left";d(e,"bpmn:BoundaryEvent")&&(c=Ne(e,e.host,-25),c.indexOf("top")!==-1&&(r*=-1));var s={x:i.right+a+t.width/2,y:n.y+rp(c,o)},p={y:{margin:r,minDistance:o}};return ai(e,t,s,ri(p))}function rp(e,t){return e.indexOf("top")!=-1?-1*t:e.indexOf("bottom")!=-1?t:0}function op(e,t){var i=K(e),n={x:i.right+t.width/2,y:i.top-50-t.height/2};cp(e)&&(n=W(e),n.x+=100,n.y-=50);var a={y:{margin:-30,minDistance:20}};return ai(e,t,n,ri(a))}function sp(e,t){var i=K(e),n={x:i.right-10+t.width/2,y:i.bottom+40+t.width/2},a={x:{margin:30,minDistance:30}};return ai(e,t,n,ri(a))}function cp(e){return!!e.waypoints}function Hr(e){e.on("autoPlace",function(t){var i=t.shape,n=t.source;return $r(n,i)})}Hr.$inject=["eventBus"];var zr={__depends__:[mr],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",Hr]};function dn(e){e.invoke(vr,this)}dn.$inject=["injector"];N(dn,vr);dn.prototype.resize=function(e,t,i){d(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,i):this._modeling.resizeShape(e,t,null,i)};function fn(e,t){br.call(this,e),this._modeling=t}N(fn,br);fn.$inject=["eventBus","modeling"];fn.prototype.canResize=function(e,t){if(d(t.di,"bpmndi:BPMNPlane")||!d(t,"bpmn:Participant")&&!d(t,"bpmn:Lane")&&!d(t,"bpmn:SubProcess"))return!1;var i=!0;return L(e,function(n){if(d(n,"bpmn:Lane")||n.labelTarget){i=!1;return}}),i};var pp={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",dn],bpmnAutoResizeProvider:["type",fn]};function Mn(e,t,i){Ce(i)||(i=[i]),L(i,function(n){tn(e[n])||(t[n]=e[n])})}var Ln=750;function Wr(e,t,i){function n(s,p){var u=e.create(s.$type);return i.copyElement(s,u,null,p)}t.on("copyPaste.copyElement",Ln,function(s){var p=s.descriptor,u=s.element,f=R(u);if(va(u))return p;var h=p.businessObject=n(f,!0),v=p.di=n(H(u),!0);v.bpmnElement=h,Mn(h,p,"name"),Mn(v,p,"isExpanded"),f.default&&(p.default=f.default.id)});var a="-bpmn-js-refs";function r(s){return s[a]=s[a]||{}}function o(s,p){s[a]=p}function c(s,p,u){var f=R(s);return s.default&&(u[s.default]={element:f,property:"default"}),s.host&&(R(s).attachedToRef=R(p[s.host])),Zn(u,ze(u,function(h,v,b){var w=v.element,_=v.property;return b===s.id&&(w[_]=f,h.push(s.id)),h},[]))}t.on("copyPaste.pasteElement",function(s){var p=s.cache,u=s.descriptor,f=u.businessObject,h=u.di;if(va(u)){u.businessObject=R(p[u.labelTarget]),u.di=H(p[u.labelTarget]);return}f=u.businessObject=n(f),h=u.di=n(h),h.bpmnElement=f,Mn(u,f,["isExpanded","name"]),u.type=f.$type}),t.on("copyPaste.copyElement",Ln,function(s){var p=s.descriptor,u=s.element;if(!!d(u,"bpmn:Participant")){var f=R(u);f.processRef&&(p.processRef=n(f.processRef,!0))}}),t.on("copyPaste.pasteElement",function(s){var p=s.descriptor,u=p.processRef;u&&(p.processRef=n(u))}),t.on("copyPaste.pasteElement",Ln,function(s){var p=s.cache,u=s.descriptor;o(p,c(u,p,r(p)))})}Wr.$inject=["bpmnFactory","eventBus","moddleCopy"];function va(e){return!!e.labelTarget}var lp=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing","categoryValue"];function Dt(e,t,i){this._bpmnFactory=t,this._eventBus=e,this._moddle=i,e.on("moddleCopy.canCopyProperties",function(n){var a=n.propertyNames;if(!(!a||!a.length))return Qn(a,function(r){return r==="extensionElements"})}),e.on("moddleCopy.canCopyProperty",function(n){var a=n.parent,r=Qe(a)&&a.$descriptor,o=n.propertyName;if(o&&lp.indexOf(o)!==-1||o&&r&&!X(r.properties,ei({name:o})))return!1}),e.on("moddleCopy.canSetCopiedProperty",function(n){var a=n.property;if(up(a,"bpmn:ExtensionElements")&&(!a.values||!a.values.length))return!1})}Dt.$inject=["eventBus","bpmnFactory","moddle"];Dt.prototype.copyElement=function(e,t,i,n){var a=this;i&&!Ce(i)&&(i=[i]),i=i||zn(e.$descriptor);var r=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:i,sourceElement:e,targetElement:t,clone:n});return r===!1||(Ce(r)&&(i=r),L(i,function(o){var c;Re(e,o)&&(c=e.get(o));var s=a.copyProperty(c,t,o,n);if(!!jn(s)){var p=a._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:s,propertyName:o});p!==!1&&t.set(o,s)}})),t};Dt.prototype.copyProperty=function(e,t,i,n){var a=this,r=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:i,clone:n});if(r!==!1){if(r)return Qe(r)&&r.$type&&!r.$parent&&(r.$parent=t),r;var o=this._moddle.getPropertyDescriptor(t,i);if(!o.isReference)return o.isId?e&&this._copyId(e,t,n):Ce(e)?ze(e,function(c,s){return r=a.copyProperty(s,t,i,n),r?c.concat(r):c},[]):Qe(e)&&e.$type?this._moddle.getElementDescriptor(e).isGeneric?void 0:(r=a._bpmnFactory.create(e.$type),r.$parent=t,r=a.copyElement(e,r,null,n),r):e}};Dt.prototype._copyId=function(e,t,i){if(i)return e;if(!this._moddle.ids.assigned(e))return this._moddle.ids.claim(e,t),e};function zn(e,t){return ze(e.properties,function(i,n){return t&&n.default?i:i.concat(n.name)},[])}function up(e,t){return e&&typeof e.$instanceOf=="function"&&e.$instanceOf(t)}var Gr={__depends__:[cs],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",Wr],moddleCopy:["type",Dt]};function dp(e,t,i){Ce(i)||(i=[i]),L(i,function(n){tn(e[n])||(t[n]=e[n])})}var fp=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function hp(e,t){var i=e&&Re(e,"collapsed")?e.collapsed:!$(e),n;return t&&(Re(t,"collapsed")||Re(t,"isExpanded"))?n=Re(t,"collapsed")?t.collapsed:!t.isExpanded:n=i,i!==n}function Vr(e,t,i,n,a,r,o){function c(s,p,u){u=u||{};var f=p.type,h=s.businessObject;if(It(h)&&f==="bpmn:SubProcess"&&hp(s,p))return n.toggleCollapse(s),s;var v=e.create(f),b={type:f,businessObject:v};b.di={},dp(s.di,b.di,["fill","stroke","background-color","border-color","color"]);var w=zn(h.$descriptor),_=zn(v.$descriptor,!0),D=mp(w,_);A(v,ti(p,fp));var P=G(D,function(F){return F==="eventDefinitions"?ba(s,p.eventDefinitionType):F==="loopCharacteristics"?!oe(v):!(Re(v,F)||F==="processRef"&&p.isExpanded===!1||F==="triggeredByEvent")});if(v=i.copyElement(h,v,P),p.eventDefinitionType&&(ba(v,p.eventDefinitionType)||(b.eventDefinitionType=p.eventDefinitionType,b.eventDefinitionAttrs=p.eventDefinitionAttrs)),d(h,"bpmn:Activity")){if(It(h))b.isExpanded=$(s);else if(p&&Re(p,"isExpanded")){b.isExpanded=p.isExpanded;var k=t.getDefaultSize(v,{isExpanded:b.isExpanded});b.width=k.width,b.height=k.height,b.x=s.x-(b.width-s.width)/2,b.y=s.y-(b.height-s.height)/2}$(s)&&!d(h,"bpmn:Task")&&b.isExpanded&&(b.width=s.width,b.height=s.height)}return It(h)&&!It(v)&&(u.moveChildren=!1),d(h,"bpmn:Participant")&&(p.isExpanded===!0?v.processRef=e.create("bpmn:Process"):u.moveChildren=!1,b.width=s.width,b.height=t.getDefaultSize(b).height),r.allowed("shape.resize",{shape:v})||(b.height=t.getDefaultSize(b).height,b.width=t.getDefaultSize(b).width),v.name=h.name,I(h,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&I(v,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(v.default=h.default),p.host&&!d(h,"bpmn:BoundaryEvent")&&d(v,"bpmn:BoundaryEvent")&&(b.host=p.host),(b.type==="bpmn:DataStoreReference"||b.type==="bpmn:DataObjectReference")&&(b.x=s.x+(s.width-b.width)/2),b=a.replaceElement(s,b,u),u.select!==!1&&o.select(b),b}this.replaceElement=c}Vr.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules","selection"];function It(e){return d(e,"bpmn:SubProcess")}function ba(e,t){var i=R(e);return t&&i.get("eventDefinitions").some(function(n){return d(n,t)})}function mp(e,t){return e.filter(function(i){return t.indexOf(i)!==-1})}var Ur={__depends__:[Gr,ps,on],bpmnReplace:["type",Vr]};function ga(e){return function(t){var i=t.target,n=R(e),a=n.eventDefinitions&&n.eventDefinitions[0],r=n.$type===i.type,o=(a&&a.$type)===i.eventDefinitionType,c=!!i.triggeredByEvent==!!n.triggeredByEvent,s=i.isExpanded===void 0||i.isExpanded===$(e);return!r||!o||!c||!s}}var vp=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],bp=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],gp=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message Intermediate Catch Event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link Intermediate Throw Event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation Intermediate Throw Event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],yp=[{label:"Start Event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End Event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message End Event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],Ep=[{label:"Exclusive Gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex Gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event based Gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],wp=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],Yr=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Sub Process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Event Sub Process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],xp=Yr,ya=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User Task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service Task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send Task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive Task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"Manual Task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business Rule Task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script Task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub Process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}}],_p=[{label:"Data Store Reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],Sp=[{label:"Data Object Reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],Dp=[{label:"Message Boundary Event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],Pp=[{label:"Message Start Event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Error Start Event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Escalation Start Event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Compensation Start Event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation Start Event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],Tp=[{label:"Sequence Flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default Flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional Flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],Ap=[{label:"Expanded Pool",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty Pool";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}];function le(e,t,i,n,a,r,o){this._bpmnFactory=e,this._popupMenu=t,this._modeling=i,this._moddle=n,this._bpmnReplace=a,this._rules=r,this._translate=o,this.register()}le.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate"];le.prototype.register=function(){this._popupMenu.registerProvider("bpmn-replace",this)};le.prototype.getEntries=function(e){var t=e.businessObject,i=this._rules,n;if(!i.allowed("shape.replace",{element:e}))return[];var a=ga(e);return d(t,"bpmn:DataObjectReference")?this._createEntries(e,_p):d(t,"bpmn:DataStoreReference")&&!d(e.parent,"bpmn:Collaboration")?this._createEntries(e,Sp):d(t,"bpmn:StartEvent")&&!d(t.$parent,"bpmn:SubProcess")?(n=G(vp,a),this._createEntries(e,n)):d(t,"bpmn:Participant")?(n=G(Ap,function(r){return $(e)!==r.target.isExpanded}),this._createEntries(e,n)):d(t,"bpmn:StartEvent")&&oe(t.$parent)?(n=G(Pp,function(r){var o=r.target,c=o.isInterrupting!==!1,s=R(e).isInterrupting===c;return a(r)||!a(r)&&!s}),this._createEntries(e,n)):d(t,"bpmn:StartEvent")&&!oe(t.$parent)&&d(t.$parent,"bpmn:SubProcess")?(n=G(bp,a),this._createEntries(e,n)):d(t,"bpmn:EndEvent")?(n=G(yp,function(r){var o=r.target;return o.eventDefinitionType=="bpmn:CancelEventDefinition"&&!d(t.$parent,"bpmn:Transaction")?!1:a(r)}),this._createEntries(e,n)):d(t,"bpmn:BoundaryEvent")?(n=G(Dp,function(r){var o=r.target;if(o.eventDefinitionType=="bpmn:CancelEventDefinition"&&!d(t.attachedToRef,"bpmn:Transaction"))return!1;var c=o.cancelActivity!==!1,s=t.cancelActivity==c;return a(r)||!a(r)&&!s}),this._createEntries(e,n)):d(t,"bpmn:IntermediateCatchEvent")||d(t,"bpmn:IntermediateThrowEvent")?(n=G(gp,a),this._createEntries(e,n)):d(t,"bpmn:Gateway")?(n=G(Ep,a),this._createEntries(e,n)):d(t,"bpmn:Transaction")?(n=G(Yr,a),this._createEntries(e,n)):oe(t)&&$(e)?(n=G(xp,a),this._createEntries(e,n)):d(t,"bpmn:SubProcess")&&$(e)?(n=G(wp,a),this._createEntries(e,n)):d(t,"bpmn:AdHocSubProcess")&&!$(e)?(n=G(ya,function(r){var o=r.target,c=o.type==="bpmn:SubProcess",s=o.isExpanded===!0;return ga(e)&&(!c||s)}),this._createEntries(e,n)):d(t,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,Tp):d(t,"bpmn:FlowNode")?(n=G(ya,a),d(t,"bpmn:SubProcess")&&!$(e)&&(n=G(n,function(r){return r.label!=="Sub Process (collapsed)"})),this._createEntries(e,n)):[]};le.prototype.getHeaderEntries=function(e){var t=[];return d(e,"bpmn:Activity")&&!oe(e)&&(t=t.concat(this._getLoopEntries(e))),d(e,"bpmn:DataObjectReference")&&(t=t.concat(this._getDataObjectIsCollection(e))),d(e,"bpmn:Participant")&&(t=t.concat(this._getParticipantMultiplicity(e))),d(e,"bpmn:SubProcess")&&!d(e,"bpmn:Transaction")&&!oe(e)&&t.push(this._getAdHocEntry(e)),t};le.prototype._createEntries=function(e,t){var i=[],n=this;return L(t,function(a){var r=n._createMenuEntry(a,e);i.push(r)}),i};le.prototype._createSequenceFlowEntries=function(e,t){var i=R(e),n=[],a=this._modeling,r=this._moddle,o=this;return L(t,function(c){switch(c.actionName){case"replace-with-default-flow":i.sourceRef.default!==i&&(d(i.sourceRef,"bpmn:ExclusiveGateway")||d(i.sourceRef,"bpmn:InclusiveGateway")||d(i.sourceRef,"bpmn:ComplexGateway")||d(i.sourceRef,"bpmn:Activity"))&&n.push(o._createMenuEntry(c,e,function(){a.updateProperties(e.source,{default:i})}));break;case"replace-with-conditional-flow":!i.conditionExpression&&d(i.sourceRef,"bpmn:Activity")&&n.push(o._createMenuEntry(c,e,function(){var s=r.create("bpmn:FormalExpression",{body:""});a.updateProperties(e,{conditionExpression:s})}));break;default:if(d(i.sourceRef,"bpmn:Activity")&&i.conditionExpression)return n.push(o._createMenuEntry(c,e,function(){a.updateProperties(e,{conditionExpression:void 0})}));if((d(i.sourceRef,"bpmn:ExclusiveGateway")||d(i.sourceRef,"bpmn:InclusiveGateway")||d(i.sourceRef,"bpmn:ComplexGateway")||d(i.sourceRef,"bpmn:Activity"))&&i.sourceRef.default===i)return n.push(o._createMenuEntry(c,e,function(){a.updateProperties(e.source,{default:void 0})}))}}),n};le.prototype._createMenuEntry=function(e,t,i){var n=this._translate,a=this._bpmnReplace.replaceElement,r=function(){return a(t,e.target)},o=e.label;o&&typeof o=="function"&&(o=o(t)),i=i||r;var c={label:n(o),className:e.className,id:e.actionName,action:i};return c};le.prototype._getLoopEntries=function(e){var t=this,i=this._translate;function n(u,f){var h=R(e).loopCharacteristics;f.active?h=void 0:((tn(f.options.isSequential)||!h||!d(h,f.options.loopCharacteristics))&&(h=t._moddle.create(f.options.loopCharacteristics)),h.isSequential=f.options.isSequential),t._modeling.updateProperties(e,{loopCharacteristics:h})}var a=R(e),r=a.loopCharacteristics,o,c,s;r&&(o=r.isSequential,c=r.isSequential===void 0,s=r.isSequential!==void 0&&!r.isSequential);var p=[{id:"toggle-parallel-mi",className:"bpmn-icon-parallel-mi-marker",title:i("Parallel Multi Instance"),active:s,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},{id:"toggle-sequential-mi",className:"bpmn-icon-sequential-mi-marker",title:i("Sequential Multi Instance"),active:o,action:n,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},{id:"toggle-loop",className:"bpmn-icon-loop-marker",title:i("Loop"),active:c,action:n,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}];return p};le.prototype._getDataObjectIsCollection=function(e){var t=this,i=this._translate,n=e.businessObject.dataObjectRef;if(!n)return[];function a(c,s){t._modeling.updateModdleProperties(e,n,{isCollection:!s.active})}var r=n.isCollection,o=[{id:"toggle-is-collection",className:"bpmn-icon-parallel-mi-marker",title:i("Collection"),active:r,action:a}];return o};le.prototype._getParticipantMultiplicity=function(e){var t=this,i=this._bpmnFactory,n=this._translate;function a(c,s){var p=s.active,u;p||(u=i.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:u})}var r=e.businessObject.participantMultiplicity,o=[{id:"toggle-participant-multiplicity",className:"bpmn-icon-parallel-mi-marker",title:n("Participant Multiplicity"),active:!!r,action:a}];return o};le.prototype._getAdHocEntry=function(e){var t=this._translate,i=R(e),n=d(i,"bpmn:AdHocSubProcess"),a=this._bpmnReplace.replaceElement,r={id:"toggle-adhoc",className:"bpmn-icon-ad-hoc-marker",title:t("Ad-hoc"),active:n,action:function(o,c){return n?a(e,{type:"bpmn:SubProcess"},{autoResize:!1,layoutConnection:!1}):a(e,{type:"bpmn:AdHocSubProcess"},{autoResize:!1,layoutConnection:!1})}};return r};var Rp={__depends__:[sn,Ur,zr],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",le]},Ft=Math.abs;function Cp(e,t){return gr(K(t),K(e))}var Bp=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],Je=30;function hn(e,t){return t=t||[],e.children.filter(function(i){d(i,"bpmn:Lane")&&(hn(i,t),t.push(i))}),t}function Ve(e){return e.children.filter(function(t){return d(t,"bpmn:Lane")})}function ve(e){return Zt(e,Bp)||e}function Np(e,t){var i=ve(e),n=d(i,"bpmn:Process")?[]:[i],a=hn(i,n),r=K(e),o=K(t),c=Cp(e,t),s=[];return a.forEach(function(p){if(p!==e){var u=0,f=c.right,h=0,v=c.left,b=K(p);c.top&&(Ft(b.bottom-r.top)<10&&(h=o.top-b.bottom),Ft(b.top-r.top)<5&&(u=o.top-b.top)),c.bottom&&(Ft(b.top-r.bottom)<10&&(u=o.bottom-b.top),Ft(b.bottom-r.bottom)<5&&(h=o.bottom-b.bottom)),(u||f||h||v)&&s.push({shape:p,newBounds:ls(p,{top:u,right:f,bottom:h,left:v})})}}),s}function Pt(e,t,i,n,a,r,o,c,s,p,u,f){e=e||{},n.registerProvider(this),this._contextPad=n,this._modeling=a,this._elementFactory=r,this._connect=o,this._create=c,this._popupMenu=s,this._canvas=p,this._rules=u,this._translate=f,e.autoPlace!==!1&&(this._autoPlace=t.get("autoPlace",!1)),i.on("create.end",250,function(h){var v=h.context,b=v.shape;if(!(!yr(h)||!n.isOpen(b))){var w=n.getEntries(b);w.replace&&w.replace.action.click(h,b)}})}Pt.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate"];Pt.prototype.getMultiElementContextPadEntries=function(e){var t=this._modeling,i={};return this._isDeleteAllowed(e)&&A(i,{delete:{group:"edit",className:"bpmn-icon-trash",title:this._translate("Remove"),action:{click:function(n,a){t.removeElements(a.slice())}}}}),i};Pt.prototype._isDeleteAllowed=function(e){var t=this._rules.allowed("elements.delete",{elements:e});return Ce(t)?Jn(t,function(i){return kp(t,i)}):t};Pt.prototype.getContextPadEntries=function(e){var t=this._contextPad,i=this._modeling,n=this._elementFactory,a=this._connect,r=this._create,o=this._popupMenu,c=this._rules,s=this._autoPlace,p=this._translate,u={};if(e.type==="label")return u;var f=e.businessObject;function h(k,F){a.start(k,F)}function v(k,F){i.removeElements([F])}function b(k){var F=5,q=t.getPad(k).html,re=q.getBoundingClientRect(),O={x:re.left,y:re.bottom+F};return O}function w(k,F,q,re){typeof q!="string"&&(re=q,q=p("Append {type}",{type:k.replace(/^bpmn:/,"")}));function O(M,fe){var he=n.createShape(A({type:k},re));r.start(M,he,{source:fe})}var de=s?function(M,fe){var he=n.createShape(A({type:k},re));s.append(fe,he)}:O;return{group:"model",className:F,title:q,action:{dragstart:O,click:de}}}function _(k){return function(F,q){i.splitLane(q,k),t.open(q,!0)}}if(I(f,["bpmn:Lane","bpmn:Participant"])&&$(e)){var D=Ve(e);A(u,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:p("Add Lane above"),action:{click:function(k,F){i.addLane(F,"top")}}}}),D.length<2&&(e.height>=120&&A(u,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:p("Divide into two Lanes"),action:{click:_(2)}}}),e.height>=180&&A(u,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:p("Divide into three Lanes"),action:{click:_(3)}}})),A(u,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:p("Add Lane below"),action:{click:function(k,F){i.addLane(F,"bottom")}}}})}d(f,"bpmn:FlowNode")&&(d(f,"bpmn:EventBasedGateway")?A(u,{"append.receive-task":w("bpmn:ReceiveTask","bpmn-icon-receive-task",p("Append ReceiveTask")),"append.message-intermediate-event":w("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",p("Append MessageIntermediateCatchEvent"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":w("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",p("Append TimerIntermediateCatchEvent"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":w("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",p("Append ConditionIntermediateCatchEvent"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":w("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",p("Append SignalIntermediateCatchEvent"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):Ea(f,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?A(u,{"append.compensation-activity":w("bpmn:Task","bpmn-icon-task",p("Append compensation activity"),{isForCompensation:!0})}):!d(f,"bpmn:EndEvent")&&!f.isForCompensation&&!Ea(f,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!oe(f)&&A(u,{"append.end-event":w("bpmn:EndEvent","bpmn-icon-end-event-none",p("Append EndEvent")),"append.gateway":w("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",p("Append Gateway")),"append.append-task":w("bpmn:Task","bpmn-icon-task",p("Append Task")),"append.intermediate-event":w("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",p("Append Intermediate/Boundary Event"))})),o.isEmpty(e,"bpmn-replace")||A(u,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:p("Change type"),action:{click:function(k,F){var q=A(b(F),{cursor:{x:k.x,y:k.y}});o.open(F,"bpmn-replace",q,{title:p("Change element"),width:300,search:!0})}}}}),d(f,"bpmn:SequenceFlow")&&A(u,{"append.text-annotation":w("bpmn:TextAnnotation","bpmn-icon-text-annotation")}),I(f,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&A(u,{"append.text-annotation":w("bpmn:TextAnnotation","bpmn-icon-text-annotation"),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:p("Connect using "+(f.isForCompensation?"":"Sequence/MessageFlow or ")+"Association"),action:{click:h,dragstart:h}}}),d(f,"bpmn:TextAnnotation")&&A(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:p("Connect using Association"),action:{click:h,dragstart:h}}}),I(f,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&A(u,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:p("Connect using DataInputAssociation"),action:{click:h,dragstart:h}}}),d(f,"bpmn:Group")&&A(u,{"append.text-annotation":w("bpmn:TextAnnotation","bpmn-icon-text-annotation")});var P=c.allowed("elements.delete",{elements:[e]});return Ce(P)&&(P=P[0]===e),P&&A(u,{delete:{group:"edit",className:"bpmn-icon-trash",title:p("Remove"),action:{click:v}}}),u};function Ea(e,t,i){var n=e.$instanceOf(t),a=!1,r=e.eventDefinitions||[];return L(r,function(o){o.$type===i&&(a=!0)}),n&&a}function kp(e,t){return e.indexOf(t)!==-1}var Mp={__depends__:[Dr,ii,on,Er,oi,Rp],__init__:["contextPadProvider"],contextPadProvider:["type",Pt]},Tt={id:"events",name:"Events"},Lp={id:"tasks",name:"Tasks"},Op={id:"data",name:"Data"},Ip={id:"participants",name:"Participants"},Fp={id:"subprocess",name:"Sub Processes"},jp={id:"gateways",name:"Gateways"},$p=[{label:"Start Event",actionName:"none-start-event",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate Throw Event",actionName:"none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"Boundary Event",actionName:"none-boundary-event",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:BoundaryEvent"}},{label:"End Event",actionName:"none-end-event",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}].map(e=>({...e,group:Tt})),Hp=[{label:"Message Start Event",actionName:"message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Start Event",actionName:"timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional Start Event",actionName:"conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal Start Event",actionName:"signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}].map(e=>({...e,group:Tt})),zp=[{label:"Message Intermediate Catch Event",actionName:"message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message Intermediate Throw Event",actionName:"message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Intermediate Catch Event",actionName:"timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Intermediate Throw Event",actionName:"escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Intermediate Catch Event",actionName:"conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link Intermediate Catch Event",actionName:"link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link Intermediate Throw Event",actionName:"link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation Intermediate Throw Event",actionName:"compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal Intermediate Catch Event",actionName:"signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal Intermediate Throw Event",actionName:"signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}].map(e=>({...e,group:Tt})),Wp=[{label:"Message Boundary Event",actionName:"message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer Boundary Event",actionName:"timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation Boundary Event",actionName:"escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional Boundary Event",actionName:"conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Error Boundary Event",actionName:"error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel Boundary Event",actionName:"cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Signal Boundary Event",actionName:"signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Compensation Boundary Event",actionName:"compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Message Boundary Event (non-interrupting)",actionName:"non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer Boundary Event (non-interrupting)",actionName:"non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation Boundary Event (non-interrupting)",actionName:"non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional Boundary Event (non-interrupting)",actionName:"non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal Boundary Event (non-interrupting)",actionName:"non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}].map(e=>({...e,group:Tt})),Gp=[{label:"Message End Event",actionName:"message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation End Event",actionName:"escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error End Event",actionName:"error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel End Event",actionName:"cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation End Event",actionName:"compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal End Event",actionName:"signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate End Event",actionName:"terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}].map(e=>({...e,group:Tt})),Vp=[{label:"Exclusive Gateway",actionName:"exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel Gateway",actionName:"parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive Gateway",search:"or",actionName:"inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"},rank:-1},{label:"Complex Gateway",actionName:"complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"},rank:-1},{label:"Event based Gateway",actionName:"event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}].map(e=>({...e,group:jp})),Up=[{label:"Transaction",actionName:"transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event Sub Process",search:"subprocess",actionName:"event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Sub Process (collapsed)",search:"subprocess",actionName:"collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub Process (expanded)",search:"subprocess",actionName:"expanded-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!0}}].map(e=>({...e,group:Fp})),Yp=[{label:"Task",actionName:"task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User Task",actionName:"user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service Task",actionName:"service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send Task",actionName:"send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"},rank:-1},{label:"Receive Task",actionName:"receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"},rank:-1},{label:"Manual Task",actionName:"manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"},rank:-1},{label:"Business Rule Task",actionName:"rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script Task",actionName:"script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call Activity",actionName:"call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}}].map(e=>({...e,group:Lp})),qp=[{label:"Data Store Reference",actionName:"data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}},{label:"Data Object Reference",actionName:"data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}].map(e=>({...e,group:Op})),Kp=[{label:"Expanded Pool",search:"Participant",actionName:"expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:"Empty Pool",search:"Collapsed Participant",actionName:"collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}].map(e=>({...e,group:Ip})),qr=[...Vp,...Yp,...Up,...$p,...Hp,...zp,...Gp,...Wp,...qp,...Kp];function At(e,t,i,n,a,r){this._elementFactory=e,this._popupMenu=t,this._create=i,this._autoPlace=n,this._mouse=a,this._translate=r,this.register()}At.$inject=["elementFactory","popupMenu","create","autoPlace","mouse","translate"];At.prototype.register=function(){this._popupMenu.registerProvider("bpmn-create",this)};At.prototype.getPopupMenuEntries=function(){const e={};return qr.forEach(t=>{const{actionName:i,className:n,label:a,target:r,description:o,group:c,search:s,rank:p}=t,u=this._createEntryAction(r);e[`create-${i}`]={label:a&&this._translate(a),className:n,description:o,group:c&&{...c,name:this._translate(c.name)},search:s,rank:p,action:{click:u,dragstart:u}}}),e};At.prototype._createEntryAction=function(e){const t=this._create,i=this._mouse,n=this._popupMenu,a=this._elementFactory;let r;return o=>(n.close(),e.type==="bpmn:Participant"?r=a.createParticipantShape(e):r=a.create("shape",e),o instanceof KeyboardEvent&&(o=i.getLastMoveEvent()),t.start(o,r))};const Xp="data:image/svg+xml,%3Csvg%20width%3D%2222%22%20height%3D%2222%22%20viewBox%3D%220%200%205.82%205.82%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%3Cpath%20d%3D%22M1.3%203.4c.3%200%20.5-.2.5-.5s-.2-.4-.5-.4c-.2%200-.4.1-.4.4%200%20.3.2.5.4.5zM3%203.4c.2%200%20.4-.2.4-.5s-.2-.4-.4-.4c-.3%200-.5.1-.5.4%200%20.3.2.5.5.5zM4.6%203.4c.2%200%20.4-.2.4-.5s-.2-.4-.4-.4c-.3%200-.5.1-.5.4%200%20.3.2.5.5.5z%22%2F%3E%0A%3C%2Fsvg%3E",Zp="data:image/svg+xml,%3Csvg%20width%3D%2246%22%20height%3D%2246%22%20viewBox%3D%22-2%20-2%209.82%209.82%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Cpath%20d%3D%22M1.3%203.4c.3%200%20.5-.2.5-.5s-.2-.4-.5-.4c-.2%200-.4.1-.4.4%200%20.3.2.5.4.5zM3%203.4c.2%200%20.4-.2.4-.5s-.2-.4-.4-.4c-.3%200-.5.1-.5.4%200%20.3.2.5.5.5zM4.6%203.4c.2%200%20.4-.2.4-.5s-.2-.4-.4-.4c-.3%200-.5.1-.5.4%200%20.3.2.5.5.5z%22%2F%3E%0A%3C%2Fsvg%3E";function mi(e,t,i,n,a){this._translate=t,this._popupMenu=i,this._canvas=n,this._mouse=a,e.registerProvider(800,this)}mi.$inject=["palette","translate","popupMenu","canvas","mouse"];mi.prototype.getPaletteEntries=function(e){const t=this._translate,i=this._popupMenu,n=this._canvas,a=this._mouse,r=o=>{if(o instanceof KeyboardEvent)return o=a.getLastMoveEvent(),{x:o.x,y:o.y};const p=o&&o.target||be('.djs-palette [data-action="create"]'),u=p.getBoundingClientRect();return p&&{x:u.left+u.width/2+35,y:u.top+u.height/2+10}};return{create:{group:"create",imageUrl:Zp,title:t("Create element"),action:{click:function(o){const c=r(o),s=n.getRootElement();i.open(s,"bpmn-create",c,{title:t("Create element"),width:300,search:!0})}}}}};function vi(e){this._injector=e,this.registerActions()}vi.$inject=["injector"];vi.prototype.registerActions=function(){var e=this._injector.get("editorActions",!1),t=this._injector.get("selection",!1),i=this._injector.get("contextPad",!1),n=this._injector.get("palette",!1),a=this._injector.get("popupMenu",!1);const r={};t&&i&&n&&a&&n&&A(r,{appendElement:function(o){const c=t&&t.get();c.length==1&&!a.isEmpty(c[0],"bpmn-append")?i.triggerEntry("append","click",o):n.triggerEntry("create","click",o)}}),n&&A(r,{createElement:function(o){n.triggerEntry("create","click",o)}}),e&&e.register(r)};function mn(e){this._injector=e,this._keyboard=this._injector.get("keyboard",!1),this._editorActions=this._injector.get("editorActions",!1),this._keyboard&&this._injector.invoke(it,this)}N(mn,it);mn.$inject=["injector"];mn.prototype.registerBindings=function(){var e=this._keyboard,t=this._editorActions;it.prototype.registerBindings.call(this,e,t);function i(n,a){t&&t.isRegistered(n)&&e&&e.addListener(a)}i("appendElement",function(n){var a=n.keyEvent;if(!(e&&e.hasModifier(a))&&e&&e.isKey(["a","A"],a))return t&&t.trigger("appendElement",a),!0}),i("createElement",function(n){var a=n.keyEvent;if(!(e&&e.hasModifier(a))&&e&&e.isKey(["n","N"],a))return t&&t.trigger("createElement",a),!0})};function Ue(e,t,i,n,a,r,o){this._elementFactory=e,this._popupMenu=t,this._create=i,this._autoPlace=n,this._rules=a,this._create=i,this._mouse=r,this._translate=o,this.register()}Ue.$inject=["elementFactory","popupMenu","create","autoPlace","rules","mouse","translate"];Ue.prototype.register=function(){this._popupMenu.registerProvider("bpmn-append",this)};Ue.prototype.getPopupMenuEntries=function(e){const t=this._rules,i=this._translate,n={};return t.allowed("shape.append",{element:e})?(this._filterEntries(qr).forEach(r=>{const{actionName:o,className:c,label:s,target:p,description:u,group:f,search:h,rank:v}=r;n[`append-${o}`]={label:s&&i(s),className:c,description:u,group:f&&{...f,name:i(f.name)},search:h,rank:v,action:this._createEntryAction(e,p)}}),n):[]};Ue.prototype._filterEntries=function(e){return e.filter(t=>{const i=t.target,{type:n,eventDefinitionType:a}=i;return!(["bpmn:StartEvent","bpmn:Participant"].includes(n)||n==="bpmn:BoundaryEvent"&&tn(a))})};Ue.prototype._createEntryAction=function(e,t){const i=this._elementFactory,n=this._autoPlace,a=this._create,r=this._mouse,o=()=>{const s=i.create("shape",t);n.append(e,s)},c=s=>{const p=i.create("shape",t);return s instanceof KeyboardEvent&&(s=r.getLastMoveEvent()),a.start(s,p,{source:e})};return{click:this._canAutoPlaceElement(t)?o:c,dragstart:c}};Ue.prototype._canAutoPlaceElement=e=>{const{type:t}=e;return!(t==="bpmn:BoundaryEvent"||t==="bpmn:SubProcess"&&e.triggeredByEvent||t==="bpmn:IntermediateCatchEvent"&&e.eventDefinitionType==="bpmn:LinkEventDefinition")};var Jp=900;function vn(e,t,i,n){e.registerProvider(Jp,this),this._contextPad=e,this._popupMenu=t,this._translate=i,this._canvas=n}vn.$inject=["contextPad","popupMenu","translate","canvas"];vn.prototype.getContextPadEntries=function(e){const t=this._popupMenu,i=this._translate,n=this._getAppendMenuPosition.bind(this);if(!t.isEmpty(e,"bpmn-append"))return{append:{group:"model",imageUrl:Xp,title:i("Append element"),action:{click:function(a,r){var o=A(n(r),{cursor:{x:a.x,y:a.y}});t.open(r,"bpmn-append",o,{title:i("Append element"),width:300,search:!0})}}}}};vn.prototype._getAppendMenuPosition=function(e){const t=this._contextPad,i=5,a=t.getPad(e).html.getBoundingClientRect();return{x:a.right+i,y:a.top}};function bn(e){Be.call(this,e)}N(bn,Be);bn.$inject=["eventBus"];bn.prototype.init=function(){this.addRule("shape.append",function(e){var t=e.element;const i=R(t);if(Y(t)||I(t,["bpmn:EndEvent","bpmn:Group","bpmn:TextAnnotation","bpmn:Lane","bpmn:Participant","bpmn:DataStoreReference","bpmn:DataObjectReference"])||el(t)||d(t,"bpmn:IntermediateThrowEvent")&&Qp(t,"bpmn:LinkEventDefinition")||d(t,"bpmn:SubProcess")&&i.triggeredByEvent)return!1})};function Qp(e,t){var i=R(e);return!!X(i.eventDefinitions||[],function(n){return d(n,t)})}function el(e){return e.waypoints}var tl={__depends__:[wr,sn,mr,ii],__init__:["createMenuProvider","createPaletteProvider","createAppendEditorActions","createAppendKeyboardBindings","appendMenuProvider","appendContextPadProvider","appendRules"],createMenuProvider:["type",At],createPaletteProvider:["type",mi],createAppendEditorActions:["type",vi],createAppendKeyboardBindings:["type",mn],appendMenuProvider:["type",Ue],appendContextPadProvider:["type",vn],appendRules:["type",bn]};function gn(e,t,i){Be.call(this,t)}gn.$inject=["distributeElements","eventBus","rules"];N(gn,Be);gn.prototype.init=function(){this.addRule("elements.distribute",function(e){var t=e.elements;return t=G(t,function(i){var n=I(i,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(i.labelTarget||n)}),t=hr(t),t.length<3?!1:t})};var nl={horizontal:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linejoin%3Around%22%20d%3D%22M450%20400V150h900v250%22%2F%3E%3Crect%20x%3D%22150%22%20y%3D%22450%22%20width%3D%22600%22%20height%3D%221200%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%221050%22%20y%3D%22450%22%20width%3D%22600%22%20height%3D%22800%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E",vertical:"data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201800%201800%22%3E%3Cpath%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bstroke-linejoin%3Around%22%20d%3D%22M400%201350H150V450h250%22%2F%3E%3Crect%20x%3D%22450%22%20y%3D%22150%22%20width%3D%221200%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3Anone%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%22%2F%3E%3Crect%20x%3D%22450%22%20y%3D%221050%22%20width%3D%22800%22%20height%3D%22600%22%20rx%3D%221%22%20style%3D%22fill%3AcurrentColor%3Bstroke%3AcurrentColor%3Bstroke-width%3A100%3Bopacity%3A.5%22%2F%3E%3C%2Fsvg%3E"},wa=nl,il=900;function Rt(e,t,i,n){this._distributeElements=t,this._translate=i,this._popupMenu=e,this._rules=n,e.registerProvider("align-elements",il,this)}Rt.$inject=["popupMenu","distributeElements","translate","rules"];Rt.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&A(t,this._getEntries(e)),t};Rt.prototype._isAllowed=function(e){return this._rules.allowed("elements.distribute",{elements:e})};Rt.prototype._getEntries=function(e){var t=this._distributeElements,i=this._translate,n=this._popupMenu,a={"distribute-elements-horizontal":{group:"distribute",title:i("Distribute elements horizontally"),className:"bjs-align-elements-menu-entry",imageUrl:wa.horizontal,action:function(r,o){t.trigger(e,"horizontal"),n.close()}},"distribute-elements-vertical":{group:"distribute",title:i("Distribute elements vertically"),imageUrl:wa.vertical,action:function(r,o){t.trigger(e,"vertical"),n.close()}}};return a};var al={__depends__:[sn,us],__init__:["bpmnDistributeElements","distributeElementsMenuProvider"],bpmnDistributeElements:["type",gn],distributeElementsMenuProvider:["type",Rt]};function yn(e){e.invoke(si,this)}N(yn,si);yn.$inject=["injector"];yn.prototype._registerDefaultActions=function(e){si.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),i=e.get("elementRegistry",!1),n=e.get("selection",!1),a=e.get("spaceTool",!1),r=e.get("lassoTool",!1),o=e.get("handTool",!1),c=e.get("globalConnect",!1),s=e.get("distributeElements",!1),p=e.get("alignElements",!1),u=e.get("directEditing",!1),f=e.get("searchPad",!1),h=e.get("modeling",!1),v=e.get("contextPad",!1);t&&i&&n&&this._registerAction("selectElements",function(){var b=t.getRootElement(),w=i.filter(function(_){return _!==b});return n.select(w),w}),a&&this._registerAction("spaceTool",function(){a.toggle()}),r&&this._registerAction("lassoTool",function(){r.toggle()}),o&&this._registerAction("handTool",function(){o.toggle()}),c&&this._registerAction("globalConnectTool",function(){c.toggle()}),n&&s&&this._registerAction("distributeElements",function(b){var w=n.get(),_=b.type;w.length&&s.trigger(w,_)}),n&&p&&this._registerAction("alignElements",function(b){var w=n.get(),_=[],D=b.type;w.length&&(_=G(w,function(P){return!d(P,"bpmn:Lane")}),p.trigger(_,D))}),n&&h&&this._registerAction("setColor",function(b){var w=n.get();w.length&&h.setColor(w,b)}),n&&u&&this._registerAction("directEditing",function(){var b=n.get();b.length&&u.activate(b[0])}),f&&this._registerAction("find",function(){f.toggle()}),t&&h&&this._registerAction("moveToOrigin",function(){var b=t.getRootElement(),w,_;d(b,"bpmn:Collaboration")?_=i.filter(function(D){return d(D.parent,"bpmn:Collaboration")}):_=i.filter(function(D){return D!==b&&!d(D.parent,"bpmn:SubProcess")}),w=ci(_),h.moveElements(_,{x:-w.x,y:-w.y},b)}),n&&v&&this._registerAction("replaceElement",function(b){v.triggerEntry("replace","click",b)})};var rl={__depends__:[ds],editorActions:["type",yn]};function Kr(e){e.on(["create.init","shape.move.init"],function(t){var i=t.context,n=t.shape;I(n,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(i.gridSnappingContext||(i.gridSnappingContext={}),i.gridSnappingContext.snapLocation="top-left")})}Kr.$inject=["eventBus"];var ol=2e3;function Xr(e,t){e.on("autoPlace",ol,function(i){var n=i.source,a=W(n),r=i.shape,o=$r(n,r);return["x","y"].forEach(function(c){var s={};o[c]!==a[c]&&(o[c]>a[c]?s.min=o[c]:s.max=o[c],d(r,"bpmn:TextAnnotation")&&(sl(c)?s.offset=-r.width/2:s.offset=-r.height/2),o[c]=t.snapValue(o[c],s))}),o})}Xr.$inject=["eventBus","gridSnapping"];function sl(e){return e==="x"}var cl=1750;function Zr(e,t,i){t.on(["create.start","shape.move.start"],cl,function(n){var a=n.context,r=a.shape,o=e.getRootElement();if(!(!d(r,"bpmn:Participant")||!d(o,"bpmn:Process")||!o.children.length)){var c=a.createConstraints;!c||(r.width=i.snapValue(r.width,{min:r.width}),r.height=i.snapValue(r.height,{min:r.height}))}})}Zr.$inject=["canvas","eventBus","gridSnapping"];var pl=3e3;function En(e,t,i){C.call(this,e),this._gridSnapping=t;var n=this;this.postExecuted(["connection.create","connection.layout"],pl,function(a){var r=a.context,o=r.connection,c=r.hints||{},s=o.waypoints;c.connectionStart||c.connectionEnd||c.createElementsBehavior===!1||!ll(s)||i.updateWaypoints(o,n.snapMiddleSegments(s))})}En.$inject=["eventBus","gridSnapping","modeling"];N(En,C);En.prototype.snapMiddleSegments=function(e){var t=this._gridSnapping,i;e=e.slice();for(var n=1;n<e.length-2;n++)i=fl(t,e[n],e[n+1]),e[n]=i[0],e[n+1]=i[1];return e};function ll(e){return e.length>3}function ul(e){return e==="h"}function dl(e){return e==="v"}function fl(e,t,i){var n=fs(t,i),a={};return ul(n)&&(a.y=e.snapValue(t.y)),dl(n)&&(a.x=e.snapValue(t.x)),("x"in a||"y"in a)&&(t=A({},t,a),i=A({},i,a)),[t,i]}var hl={__init__:["gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",Xr],gridSnappingParticipantBehavior:["type",Zr],gridSnappingLayoutConnectionBehavior:["type",En]},ml={__depends__:[hs,hl],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",Kr]},vl=30,bl=30;function Ct(e,t){this._interactionEvents=t;var i=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],function(n){var a=n.element,r=n.gfx;if(d(a,"bpmn:Lane"))return i.createParticipantHit(a,r);if(d(a,"bpmn:Participant"))return $(a)?i.createParticipantHit(a,r):i.createDefaultHit(a,r);if(d(a,"bpmn:SubProcess"))return $(a)?i.createSubProcessHit(a,r):i.createDefaultHit(a,r)})}Ct.$inject=["eventBus","interactionEvents"];Ct.prototype.createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0};Ct.prototype.createParticipantHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:vl,height:e.height}),!0};Ct.prototype.createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:bl}),!0};var gl={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",Ct]};function wn(e){e.invoke(it,this)}N(wn,it);wn.$inject=["injector"];wn.prototype.registerBindings=function(e,t){it.prototype.registerBindings.call(this,e,t);function i(n,a){t.isRegistered(n)&&e.addListener(a)}i("selectElements",function(n){var a=n.keyEvent;if(e.isKey(["a","A"],a)&&e.isCmd(a))return t.trigger("selectElements"),!0}),i("find",function(n){var a=n.keyEvent;if(e.isKey(["f","F"],a)&&e.isCmd(a))return t.trigger("find"),!0}),i("spaceTool",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["s","S"],a))return t.trigger("spaceTool"),!0}),i("lassoTool",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["l","L"],a))return t.trigger("lassoTool"),!0}),i("handTool",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["h","H"],a))return t.trigger("handTool"),!0}),i("globalConnectTool",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["c","C"],a))return t.trigger("globalConnectTool"),!0}),i("directEditing",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["e","E"],a))return t.trigger("directEditing"),!0}),i("replaceElement",function(n){var a=n.keyEvent;if(!e.hasModifier(a)&&e.isKey(["r","R"],a))return t.trigger("replaceElement",a),!0})};var yl={__depends__:[ms],__init__:["keyboardBindings"],keyboardBindings:["type",wn]},El=2e3;function Bt(e,t,i,n,a,r,o){this._bpmnFactory=t,this._canvas=i,this._modeling=a,this._textRenderer=o,n.registerProvider(this),e.on("element.dblclick",function(s){c(s.element,!0)}),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set","selection.changed"],function(s){n.isActive()&&n.complete()}),e.on(["shape.remove","connection.remove"],El,function(s){n.isActive(s.element)&&n.cancel()}),e.on(["commandStack.changed"],function(s){n.isActive()&&n.cancel()}),e.on("directEditing.activate",function(s){r.removeResizers()}),e.on("create.end",500,function(s){var p=s.context,u=p.shape,f=s.context.canExecute,h=s.isTouch;h||!f||p.hints&&p.hints.createElementsBehavior===!1||c(u)}),e.on("autoPlace.end",500,function(s){c(s.shape)});function c(s,p){(p||I(s,["bpmn:Task","bpmn:TextAnnotation","bpmn:Participant"])||bi(s))&&n.activate(s)}}Bt.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"];Bt.prototype.activate=function(e){var t=ge(e);if(t!==void 0){var i={text:t},n=this.getEditingBBox(e);A(i,n);var a={};return(I(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||bi(e))&&A(a,{centerVertically:!0}),He(e)&&A(a,{autoResize:!0}),d(e,"bpmn:TextAnnotation")&&A(a,{resizable:!0,autoResize:!0}),A(i,{options:a}),i}};Bt.prototype.getEditingBBox=function(e){var t=this._canvas,i=e.label||e,n=t.getAbsoluteBBox(i),a={x:n.x+n.width/2,y:n.y+n.height/2},r={x:n.x,y:n.y},o=t.zoom(),c=this._textRenderer.getDefaultStyle(),s=this._textRenderer.getExternalStyle(),p=s.fontSize*o,u=s.lineHeight,f=c.fontSize*o,h=c.lineHeight,v={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};(d(e,"bpmn:Lane")||_l(e))&&(A(r,{width:n.height,height:30*o,x:n.x-n.height/2+15*o,y:a.y-30*o/2}),A(v,{fontSize:f+"px",lineHeight:h,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px",transform:"rotate(-90deg)"})),(I(e,["bpmn:Task","bpmn:CallActivity"])||xl(e)||bi(e))&&(A(r,{width:n.width,height:n.height}),A(v,{fontSize:f+"px",lineHeight:h,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px"})),wl(e)&&(A(r,{width:n.width,x:n.x}),A(v,{fontSize:f+"px",lineHeight:h,paddingTop:7*o+"px",paddingBottom:7*o+"px",paddingLeft:5*o+"px",paddingRight:5*o+"px"}));var b=90*o,w=7*o,_=4*o;if(i.labelTarget&&(A(r,{width:b,height:n.height+w+_,x:a.x-b/2,y:n.y-w}),A(v,{fontSize:p+"px",lineHeight:u,paddingTop:w+"px",paddingBottom:_+"px"})),He(i)&&!pn(i)&&!Y(i)){var D=ln(e),P=t.getAbsoluteBBox({x:D.x,y:D.y,width:0,height:0}),k=p+w+_;A(r,{width:b,height:k,x:P.x-b/2,y:P.y-k/2}),A(v,{fontSize:p+"px",lineHeight:u,paddingTop:w+"px",paddingBottom:_+"px"})}return d(e,"bpmn:TextAnnotation")&&(A(r,{width:n.width,height:n.height,minWidth:30*o,minHeight:10*o}),A(v,{textAlign:"left",paddingTop:5*o+"px",paddingBottom:7*o+"px",paddingLeft:7*o+"px",paddingRight:5*o+"px",fontSize:f+"px",lineHeight:h})),{bounds:r,style:v}};Bt.prototype.update=function(e,t,i,n){var a,r;d(e,"bpmn:TextAnnotation")&&(r=this._canvas.getAbsoluteBBox(e),a={x:e.x,y:e.y,width:e.width/r.width*n.width,height:e.height/r.height*n.height}),Sl(t)&&(t=null),this._modeling.updateLabel(e,t,a)};function bi(e){return d(e,"bpmn:SubProcess")&&!$(e)}function wl(e){return d(e,"bpmn:SubProcess")&&$(e)}function xl(e){return d(e,"bpmn:Participant")&&!$(e)}function _l(e){return d(e,"bpmn:Participant")&&$(e)}function Sl(e){return!e||!e.trim()}var xa="djs-element-hidden",_a="djs-label-hidden";function Jr(e,t,i,n){var a=this,r=t.getDefaultLayer(),o,c,s;e.on("directEditing.activate",function(p){var u=p.active;if(o=u.element.label||u.element,d(o,"bpmn:TextAnnotation")){c=t.getAbsoluteBBox(o),s=ne("g");var f=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:o.height,position:{mx:0,my:0}}),h=a.path=ne("path");_e(h,{d:f,strokeWidth:2,stroke:Dl(o)}),me(s,h),me(r,s),pr(s,o.x,o.y)}d(o,"bpmn:TextAnnotation")||o.labelTarget?t.addMarker(o,xa):(d(o,"bpmn:Task")||d(o,"bpmn:CallActivity")||d(o,"bpmn:SubProcess")||d(o,"bpmn:Participant"))&&t.addMarker(o,_a)}),e.on("directEditing.resize",function(p){if(d(o,"bpmn:TextAnnotation")){var u=p.height,f=p.dy,h=Math.max(o.height/c.height*(u+f),0),v=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:h,position:{mx:0,my:0}});_e(a.path,{d:v})}}),e.on(["directEditing.complete","directEditing.cancel"],function(p){var u=p.active;u&&(t.removeMarker(u.element.label||u.element,xa),t.removeMarker(o,_a)),o=void 0,c=void 0,s&&(Jo(s),s=void 0)})}Jr.$inject=["eventBus","canvas","elementRegistry","pathMap"];function Dl(e,t){var i=H(e);return i.get("stroke")||t||"black"}var Pl={__depends__:[ni,xr,Dr],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",Bt],labelEditingPreview:["type",Jr]},gi=["top","bottom","left","right"],jt=10;function yi(e,t){C.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],function(a){var r=a.context,o=r.connection,c=o.source,s=o.target,p=r.hints||{};p.createElementsBehavior!==!1&&(i(c),i(s))}),this.postExecuted(["label.create"],function(a){var r=a.context,o=r.shape,c=r.hints||{};c.createElementsBehavior!==!1&&i(o.labelTarget)}),this.postExecuted(["elements.create"],function(a){var r=a.context,o=r.elements,c=r.hints||{};c.createElementsBehavior!==!1&&o.forEach(function(s){i(s)})});function i(a){if(!!pn(a)){var r=Rl(a);!r||n(a,r)}}function n(a,r){var o=W(a),c=a.label,s=W(c);if(!!c.parent){var p=K(a),u;switch(r){case"top":u={x:o.x,y:p.top-jt-c.height/2};break;case"left":u={x:p.left-jt-c.width/2,y:o.y};break;case"bottom":u={x:o.x,y:p.bottom+jt+c.height/2};break;case"right":u={x:p.right+jt+c.width/2,y:o.y};break}var f=pi(u,s);t.moveShape(c,f)}}}N(yi,C);yi.$inject=["eventBus","modeling"];function Tl(e){var t=e.host,i=W(e),n=Ne(i,t),a;n.indexOf("-")>=0?a=n.split("-"):a=[n];var r=gi.filter(function(o){return a.indexOf(o)===-1});return r}function Al(e){var t=W(e),i=[].concat(e.incoming.map(function(n){return n.waypoints[n.waypoints.length-2]}),e.outgoing.map(function(n){return n.waypoints[1]})).map(function(n){return Qr(t,n)});return i}function Rl(e){var t=W(e.label),i=W(e),n=Qr(i,t);if(!!Cl(n)){var a=Al(e);if(e.host){var r=Tl(e);a=a.concat(r)}var o=gi.filter(function(c){return a.indexOf(c)===-1});if(o.indexOf(n)===-1)return o[0]}}function Qr(e,t){return Ne(t,e,5)}function Cl(e){return gi.indexOf(e)!==-1}function Ei(e,t,i){C.call(this,e),this.preExecute("shape.append",function(n){var a=n.source,r=n.shape;n.position||(d(r,"bpmn:TextAnnotation")?n.position={x:a.x+a.width/2+75,y:a.y-50-r.height/2}:n.position={x:a.x+a.width+80+r.width/2,y:a.y+a.height/2})},!0)}N(Ei,C);Ei.$inject=["eventBus","elementFactory","bpmnRules"];function wi(e,t){e.invoke(C,this),this.postExecute("shape.move",function(i){var n=i.newParent,a=i.shape,r=G(a.incoming.concat(a.outgoing),function(o){return d(o,"bpmn:Association")});L(r,function(o){t.moveConnection(o,{x:0,y:0},n)})},!0)}N(wi,C);wi.$inject=["injector","modeling"];var Sa=500;function xn(e,t){t.invoke(C,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",Sa,function(n){var a=n.elements;a=a.filter(function(r){var o=r.host;return Da(r,o)}),a.length===1&&a.map(function(r){return a.indexOf(r)}).forEach(function(r){var o=a[r];n.elements[r]=i.replaceShape(a[r],o)})},!0),this.preExecute("elements.move",Sa,function(n){var a=n.shapes,r=n.newHost;if(a.length===1){var o=a[0];Da(o,r)&&(n.shapes=[i.replaceShape(o,r)])}},!0)}xn.$inject=["bpmnReplace","injector"];N(xn,C);xn.prototype.replaceShape=function(e,t){var i=Bl(e),n={type:"bpmn:BoundaryEvent",host:t};return i&&(n.eventDefinitionType=i.$type),this._bpmnReplace.replaceElement(e,n,{layoutConnection:!1})};function Bl(e){var t=R(e),i=t.eventDefinitions;return i&&i[0]}function Da(e,t){return!Y(e)&&I(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function xi(e,t){C.call(this,e);function i(n){return G(n.attachers,function(a){return d(a,"bpmn:BoundaryEvent")})}this.postExecute("connection.create",function(n){var a=n.context.source,r=n.context.target,o=i(r);d(a,"bpmn:EventBasedGateway")&&d(r,"bpmn:ReceiveTask")&&o.length>0&&t.removeElements(o)}),this.postExecute("connection.reconnect",function(n){var a=n.context.oldSource,r=n.context.newSource;d(a,"bpmn:Gateway")&&d(r,"bpmn:EventBasedGateway")&&L(r.outgoing,function(o){var c=o.target,s=i(c);d(c,"bpmn:ReceiveTask")&&s.length>0&&t.removeElements(s)})})}xi.$inject=["eventBus","modeling"];N(xi,C);function _i(e){e.invoke(C,this),this.preExecute("shape.create",1500,function(t){var i=t.context,n=i.parent,a=i.shape;d(n,"bpmn:Lane")&&!d(a,"bpmn:Lane")&&(i.parent=Zt(n,"bpmn:Participant"))})}_i.$inject=["injector"];N(_i,C);function Si(e,t,i){C.call(this,e),this.preExecute("shape.create",function(n){var a=n.context,r=a.shape;if(d(r,"bpmn:DataObjectReference")&&r.type!=="label"){var o=t.create("bpmn:DataObject");r.businessObject.dataObjectRef=o}})}Si.$inject=["eventBus","bpmnFactory","moddle"];N(Si,C);var Wn=20,Gn=20,eo=30,$t=2e3;function Di(e,t,i){C.call(this,t),t.on(["create.start","shape.move.start"],$t,function(a){var r=a.context,o=r.shape,c=e.getRootElement();if(!(!d(o,"bpmn:Participant")||!d(c,"bpmn:Process")||!c.children.length)){var s=c.children.filter(function(f){return!d(f,"bpmn:Group")&&!Y(f)&&!Ml(f)});if(!!s.length){var p=ci(s),u=Nl(o,p);A(o,u),r.createConstraints=kl(o,p)}}}),t.on("create.start",$t,function(a){var r=a.context,o=r.shape,c=e.getRootElement(),s=e.getGraphics(c);function p(u){u.element=c,u.gfx=s}d(o,"bpmn:Participant")&&d(c,"bpmn:Process")&&(t.on("element.hover",$t,p),t.once("create.cleanup",function(){t.off("element.hover",p)}))});function n(){var a=e.getRootElement();return d(a,"bpmn:Collaboration")?a:i.makeCollaboration()}this.preExecute("elements.create",$t,function(a){var r=a.elements,o=a.parent,c=Ll(r),s;c&&d(o,"bpmn:Process")&&(a.parent=n(),s=a.hints=a.hints||{},s.participant=c,s.process=o,s.processRef=R(c).get("processRef"))},!0),this.preExecute("shape.create",function(a){var r=a.parent,o=a.shape;d(o,"bpmn:Participant")&&d(r,"bpmn:Process")&&(a.parent=n(),a.process=r,a.processRef=R(o).get("processRef"))},!0),this.execute("shape.create",function(a){var r=a.hints||{},o=a.process||r.process,c=a.shape,s=r.participant;o&&(!s||c===s)&&R(c).set("processRef",R(o))},!0),this.revert("shape.create",function(a){var r=a.hints||{},o=a.process||r.process,c=a.processRef||r.processRef,s=a.shape,p=r.participant;o&&(!p||s===p)&&R(s).set("processRef",c)},!0),this.postExecute("shape.create",function(a){var r=a.hints||{},o=a.process||a.hints.process,c=a.shape,s=r.participant;if(o){var p=o.children.slice();s?c===s&&i.moveElements(p,{x:0,y:0},s):i.moveElements(p,{x:0,y:0},c)}},!0)}Di.$inject=["canvas","eventBus","modeling"];N(Di,C);function Nl(e,t){t={width:t.width+Wn*2+eo,height:t.height+Gn*2};var i=Math.max(e.width,t.width),n=Math.max(e.height,t.height);return{x:-i/2,y:-n/2,width:i,height:n}}function kl(e,t){return t=K(t),{bottom:t.top+e.height/2-Gn,left:t.right-e.width/2+Wn,top:t.bottom-e.height/2+Gn,right:t.left+e.width/2-Wn-eo}}function Ml(e){return!!e.waypoints}function Ll(e){return X(e,function(t){return d(t,"bpmn:Participant")})}var Pa="__targetRef_placeholder";function Pi(e,t){C.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Ta(r)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Ta(r));function i(o,c,s){var p=o.get("dataInputAssociations");return X(p,function(u){return u!==s&&u.targetRef===c})}function n(o,c){var s=o.get("properties"),p=X(s,function(u){return u.name===Pa});return!p&&c&&(p=t.create("bpmn:Property",{name:Pa}),pe(s,p)),p}function a(o,c){var s=n(o);!s||i(o,s,c)||J(o.get("properties"),s)}function r(o){var c=o.context,s=c.connection,p=s.businessObject,u=s.target,f=u&&u.businessObject,h=c.newTarget,v=h&&h.businessObject,b=c.oldTarget||c.target,w=b&&b.businessObject,_=s.businessObject,D;w&&w!==f&&a(w,p),v&&v!==f&&a(v,p),f?(D=n(f,!0),_.targetRef=D):_.targetRef=null}}Pi.$inject=["eventBus","bpmnFactory"];N(Pi,C);function Ta(e){return function(t){var i=t.context,n=i.connection;if(d(n,"bpmn:DataInputAssociation"))return e(t)}}function _n(e){this._bpmnUpdater=e}_n.$inject=["bpmnUpdater"];_n.prototype.execute=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.newSemanticParent,a=e.newDiParent;e.oldSemanticParent=t.$parent,e.oldDiParent=i.$parent,this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,a)};_n.prototype.revert=function(e){var t=e.dataStoreBo,i=e.dataStoreDi,n=e.oldSemanticParent,a=e.oldDiParent;this._bpmnUpdater.updateSemanticParent(t,n),this._bpmnUpdater.updateDiParent(i,a)};function Ti(e,t,i,n){C.call(this,n),t.registerHandler("dataStore.updateContainment",_n);function a(){return i.filter(function(c){return d(c,"bpmn:Participant")&&R(c).processRef})[0]}function r(c){return c.children.filter(function(s){return d(s,"bpmn:DataStoreReference")&&!s.labelTarget})}function o(c,s){var p=c.businessObject||c;if(s=s||a(),s){var u=s.businessObject||s;t.execute("dataStore.updateContainment",{dataStoreBo:p,dataStoreDi:H(c),newSemanticParent:u.processRef||u,newDiParent:H(s)})}}this.preExecute("shape.create",function(c){var s=c.context,p=s.shape;d(p,"bpmn:DataStoreReference")&&p.type!=="label"&&(s.hints||(s.hints={}),s.hints.autoResize=!1)}),this.preExecute("elements.move",function(c){var s=c.context,p=s.shapes,u=p.filter(function(f){return d(f,"bpmn:DataStoreReference")});u.length&&(s.hints||(s.hints={}),s.hints.autoResize=p.filter(function(f){return!d(f,"bpmn:DataStoreReference")}))}),this.postExecute("shape.create",function(c){var s=c.context,p=s.shape,u=p.parent;d(p,"bpmn:DataStoreReference")&&p.type!=="label"&&d(u,"bpmn:Collaboration")&&o(p)}),this.postExecute("shape.move",function(c){var s=c.context,p=s.shape,u=s.oldParent,f=p.parent;if(!d(u,"bpmn:Collaboration")&&d(p,"bpmn:DataStoreReference")&&p.type!=="label"&&d(f,"bpmn:Collaboration")){var h=d(u,"bpmn:Participant")?u:Il(u,"bpmn:Participant");o(p,h)}}),this.postExecute("shape.delete",function(c){var s=c.context,p=s.shape,u=e.getRootElement();I(p,["bpmn:Participant","bpmn:SubProcess"])&&d(u,"bpmn:Collaboration")&&r(u).filter(function(f){return Ol(f,p)}).forEach(function(f){o(f)})}),this.postExecute("canvas.updateRoot",function(c){var s=c.context,p=s.oldRoot,u=s.newRoot,f=r(p);f.forEach(function(h){d(u,"bpmn:Process")&&o(h,u)})})}Ti.$inject=["canvas","commandStack","elementRegistry","eventBus"];N(Ti,C);function Ol(e,t){for(var i=e.businessObject||e,n=t.businessObject||t;i.$parent;){if(i.$parent===n.processRef||n)return!0;i=i.$parent}return!1}function Il(e,t){for(;e.parent;){if(d(e.parent,t))return e.parent;e=e.parent}}var Fl=500;function Ai(e,t,i){C.call(this,e);function n(a,r){var o=Ve(r),c=[],s=[];if(li(o,function(h){return h.y>a.y?s.push(h):c.push(h),h.children}),!!o.length){var p;s.length&&c.length?p=a.height/2:p=a.height;var u,f;c.length&&(u=i.calculateAdjustments(c,"y",p,a.y-10),i.makeSpace(u.movingShapes,u.resizingShapes,{x:0,y:p},"s")),s.length&&(f=i.calculateAdjustments(s,"y",-p,a.y+a.height+10),i.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:-p},"n"))}}this.postExecuted("shape.delete",Fl,function(a){var r=a.context,o=r.hints,c=r.shape,s=r.oldParent;!d(c,"bpmn:Lane")||o&&o.nested||n(c,s)})}Ai.$inject=["eventBus","modeling","spaceTool"];N(Ai,C);var Aa=500;function Sn(e,t){t.invoke(C,this),this._bpmnReplace=e;var i=this;this.postExecuted("elements.create",Aa,function(n){var a=n.elements;a.filter(function(r){var o=r.host;return Ra(r,o)}).map(function(r){return a.indexOf(r)}).forEach(function(r){n.elements[r]=i.replaceShape(a[r])})},!0),this.preExecute("elements.move",Aa,function(n){var a=n.shapes,r=n.newHost;a.forEach(function(o,c){var s=o.host;Ra(o,$l(a,s)?s:r)&&(a[c]=i.replaceShape(o))})},!0)}Sn.$inject=["bpmnReplace","injector"];N(Sn,C);Sn.prototype.replaceShape=function(e){var t=jl(e),i;return t?i={type:"bpmn:IntermediateCatchEvent",eventDefinitionType:t.$type}:i={type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,i,{layoutConnection:!1})};function jl(e){var t=R(e),i=t.eventDefinitions;return i&&i[0]}function Ra(e,t){return!Y(e)&&d(e,"bpmn:BoundaryEvent")&&!t}function $l(e,t){return e.indexOf(t)!==-1}function Ri(e,t,i){C.call(this,e);function n(a,r,o){var c=r.waypoints,s,p,u,f,h,v,b,w=a.outgoing.slice(),_=a.incoming.slice(),D;or(o.width)?D=W(o):D=o;var P=pa(c,D);if(P){if(s=c.slice(0,P.index),p=c.slice(P.index+(P.bendpoint?1:0)),!s.length||!p.length)return;u=P.bendpoint?c[P.index]:D,(s.length===1||!Ca(a,s[s.length-1]))&&s.push(Ba(u)),(p.length===1||!Ca(a,p[0]))&&p.unshift(Ba(u))}f=r.source,h=r.target,t.canConnect(f,a,r)&&(i.reconnectEnd(r,a,s||D),v=r),t.canConnect(a,h,r)&&(v?b=i.connect(a,h,{type:r.type,waypoints:p}):(i.reconnectStart(r,a,p||D),b=r));var k=[].concat(v&&G(_,function(F){return F.source===v.source})||[],b&&G(w,function(F){return F.target===b.target})||[]);k.length&&i.removeElements(k)}this.preExecute("elements.move",function(a){var r=a.newParent,o=a.shapes,c=a.delta,s=o[0];if(!(!s||!r)){r&&r.waypoints&&(a.newParent=r=r.parent);var p=W(s),u={x:p.x+c.x,y:p.y+c.y},f=X(r.children,function(h){var v=t.canInsert(o,h);return v&&pa(h.waypoints,u)});f&&(a.targetFlow=f,a.position=u)}},!0),this.postExecuted("elements.move",function(a){var r=a.shapes,o=a.targetFlow,c=a.position;o&&n(r[0],o,c)},!0),this.preExecute("shape.create",function(a){var r=a.parent,o=a.shape;t.canInsert(o,r)&&(a.targetFlow=r,a.parent=r.parent)},!0),this.postExecuted("shape.create",function(a){var r=a.shape,o=a.targetFlow,c=a.position;o&&n(r,o,c)},!0)}N(Ri,C);Ri.$inject=["eventBus","bpmnRules","modeling"];function Ca(e,t){var i=t.x,n=t.y;return i>=e.x&&i<=e.x+e.width&&n>=e.y&&n<=e.y+e.height}function Ba(e){return A({},e)}function Ci(e,t){C.call(this,e),this.preExecuted("connection.create",function(i){var n=i.context,a=n.connection,r=n.source,o=n.target,c=n.hints;if(!(c&&c.createElementsBehavior===!1)&&!!Ke(a)){var s=[];d(r,"bpmn:EventBasedGateway")?s=o.incoming.filter(Ke):s=o.incoming.filter(function(p){return Ke(p)&&d(p.source,"bpmn:EventBasedGateway")}),s.forEach(function(p){t.removeConnection(p)})}}),this.preExecuted("shape.replace",function(i){var n=i.context,a=n.newShape;if(!!d(a,"bpmn:EventBasedGateway")){var r=a.outgoing.filter(Ke).reduce(function(o,c){return o.includes(c.target)?o:o.concat(c.target)},[]);r.forEach(function(o){o.incoming.filter(Ke).forEach(function(c){const s=o.incoming.filter(Ke).filter(function(p){return p.source===a});(c.source!==a||s.length>1)&&t.removeConnection(c)})})}})}Ci.$inject=["eventBus","modeling"];N(Ci,C);function Ke(e){return d(e,"bpmn:SequenceFlow")}var Ht=1500,Hl=2e3;function to(e,t,i){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Ht,function(n){var a=n.context,r=a.shape||n.shape,o=n.hover;d(o,"bpmn:Lane")&&!I(r,["bpmn:Lane","bpmn:Participant"])&&(n.hover=ve(o),n.hoverGfx=e.getGraphics(n.hover));var c=i.getRootElement();o!==c&&(r.labelTarget||d(r,"bpmn:Group"))&&(n.hover=c,n.hoverGfx=e.getGraphics(n.hover))}),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Ht,function(n){var a=n.hover;d(a,"bpmn:Lane")&&(n.hover=ve(a)||a,n.hoverGfx=e.getGraphics(n.hover))}),t.on(["bendpoint.move.hover"],Ht,function(n){var a=n.context,r=n.hover,o=a.type;d(r,"bpmn:Lane")&&/reconnect/.test(o)&&(n.hover=ve(r)||r,n.hoverGfx=e.getGraphics(n.hover))}),t.on(["connect.start"],Ht,function(n){var a=n.context,r=a.start;d(r,"bpmn:Lane")&&(a.start=ve(r)||r)}),t.on("shape.move.start",Hl,function(n){var a=n.shape;d(a,"bpmn:Lane")&&(n.shape=ve(a)||a)})}to.$inject=["elementRegistry","eventBus","canvas"];function zl(e){return e.create("bpmn:Category")}function Wl(e){return e.create("bpmn:CategoryValue")}function Gl(e,t,i){return pe(t.get("categoryValue"),e),e.$parent=t,pe(i.get("rootElements"),t),t.$parent=i,e}function Vl(e){var t=e.$parent;return t&&(J(t.get("categoryValue"),e),e.$parent=null),e}function Ul(e){var t=e.$parent;return t&&(J(t.get("rootElements"),e),e.$parent=null),e}var Na=770;function Bi(e,t,i,n,a,r){a.invoke(C,this);function o(){return i.filter(function(b){return d(b,"bpmn:Group")})}function c(b,w){return b.some(function(_){var D=R(_),P=D.categoryValueRef&&D.categoryValueRef.$parent;return P===w})}function s(b,w){return b.some(function(_){var D=R(_);return D.categoryValueRef===w})}function p(b,w,_){var D=o().filter(function(P){return P.businessObject!==_});w&&!c(D,w)&&Ul(w),b&&!s(D,b)&&Vl(b)}function u(b,w){return Gl(b,w,t.getDefinitions())}function f(b,w){var _=R(b),D=_.categoryValueRef;D||(D=_.categoryValueRef=w.categoryValue=w.categoryValue||Wl(e));var P=D.$parent;P||(P=D.$parent=w.category=w.category||zl(e)),u(D,P,t.getDefinitions())}function h(b,w){var _=w.category,D=w.categoryValue,P=R(b);D?(P.categoryValueRef=null,p(D,_,P)):p(null,P.categoryValueRef.$parent,P)}this.execute("label.create",function(b){var w=b.context,_=w.labelTarget;!d(_,"bpmn:Group")||f(_,w)}),this.revert("label.create",function(b){var w=b.context,_=w.labelTarget;!d(_,"bpmn:Group")||h(_,w)}),this.execute("shape.delete",function(b){var w=b.context,_=w.shape,D=R(_);if(!(!d(_,"bpmn:Group")||_.labelTarget)){var P=w.categoryValue=D.categoryValueRef,k;P&&(k=w.category=P.$parent,p(P,k,D),D.categoryValueRef=null)}}),this.reverted("shape.delete",function(b){var w=b.context,_=w.shape;if(!(!d(_,"bpmn:Group")||_.labelTarget)){var D=w.category,P=w.categoryValue,k=R(_);P&&(k.categoryValueRef=P,u(P,D))}}),this.execute("shape.create",function(b){var w=b.context,_=w.shape;!d(_,"bpmn:Group")||_.labelTarget||R(_).categoryValueRef&&f(_,w)}),this.reverted("shape.create",function(b){var w=b.context,_=w.shape;!d(_,"bpmn:Group")||_.labelTarget||R(_).categoryValueRef&&h(_,w)});function v(b,w){var _=e.create(b.$type);return r.copyElement(b,_,null,w)}n.on("copyPaste.copyElement",Na,function(b){var w=b.descriptor,_=b.element;if(!(!d(_,"bpmn:Group")||_.labelTarget)){var D=R(_);if(D.categoryValueRef){var P=D.categoryValueRef;w.categoryValue=v(P,!0),P.$parent&&(w.category=v(P.$parent,!0))}}}),n.on("copyPaste.pasteElement",Na,function(b){var w=b.descriptor,_=w.businessObject,D=w.categoryValue,P=w.category;D&&(D=_.categoryValueRef=v(D)),P&&(D.$parent=v(P)),delete w.category,delete w.categoryValue})}Bi.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"];N(Bi,C);function Vn(e,t,i,n){var a,r,o,c,s;return a=(n.y-i.y)*(t.x-e.x)-(n.x-i.x)*(t.y-e.y),a==0?null:(r=e.y-i.y,o=e.x-i.x,s=(n.x-i.x)*r-(n.y-i.y)*o,c=s/a,{x:Math.round(e.x+c*(t.x-e.x)),y:Math.round(e.y+c*(t.y-e.y))})}function no(e){function t(n,a,r){var o={x:r.x,y:r.y-50},c={x:r.x-50,y:r.y},s=Vn(n,a,r,o),p=Vn(n,a,r,c),u;s&&p?ka(s,r)>ka(p,r)?u=p:u=s:u=s||p,n.original=u}function i(n){var a=n.waypoints;t(a[0],a[1],W(n.source)),t(a[a.length-1],a[a.length-2],W(n.target))}e.on("bpmnElement.added",function(n){var a=n.element;a.waypoints&&i(a)})}no.$inject=["eventBus"];function ka(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ni(e){C.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],function(i){var n=i.context.shape,a=R(n),r=H(n);I(a,t)&&!r.get("isHorizontal")&&r.set("isHorizontal",!0)})}Ni.$inject=["eventBus"];N(Ni,C);var io=Math.sqrt,ao=Math.min,Yl=Math.max,Ma=Math.abs;function La(e){return Math.pow(e,2)}function ut(e,t){return io(La(e.x-t.x)+La(e.y-t.y))}function ql(e,t){var i=0,n,a,r,o,c,s,p,u,f,h,v;for(i=0;i<t.length-1;i++){if(n=t[i],a=t[i+1],Ia(n,a)?p=[n]:(r=ut(e,n),o=ut(e,a),s=ao(r,o),p=Kl(n,a,e,s)),p.length<1)throw new Error("expected between [1, 2] circle -> line intersections");p.length===1&&(u={type:"bendpoint",position:p[0],segmentIndex:i,bendpointIndex:Ia(n,p[0])?i:i+1}),p.length===2&&(c=Zl(p[0],p[1]),u={type:"segment",position:c,segmentIndex:i,relativeLocation:ut(n,c)/ut(n,a)}),f=ut(u.position,e),(!v||h>f)&&(v=u,h=f)}return v}function Kl(e,t,i,n){var a=t.x-e.x,r=t.y-e.y,o=i.x-e.x,c=i.y-e.y,s=a*a+r*r,p=a*o+r*c,u=o*o+c*c-n*n,f=p/s,h=u/s,v=f*f-h;if(v<0&&v>-1e-6&&(v=0),v<0)return[];var b=io(v),w=-f+b,_=-f-b,D={x:e.x-a*w,y:e.y-r*w};if(v===0)return[D];var P={x:e.x-a*_,y:e.y-r*_};return[D,P].filter(function(k){return Xl(k,e,t)})}function Xl(e,t,i){return Oa(e.x,t.x,i.x)&&Oa(e.y,t.y,i.y)}function Oa(e,t,i){return e>=ao(t,i)-Jt&&e<=Yl(t,i)+Jt}function Zl(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}var Jt=.1;function Ia(e,t){return Ma(e.x-t.x)<=Jt&&Ma(e.y-t.y)<=Jt}function Jl(e,t,i,n){var a=i.segmentIndex,r=t.length-e.length;if(n.segmentMove){var o=n.segmentMove.segmentStartIndex,c=n.segmentMove.newSegmentStartIndex;return a===o?c:a>=c?a+r<c?c:a+r:a}if(n.bendpointMove){var s=n.bendpointMove.insert,p=n.bendpointMove.bendpointIndex,u;if(r===0)return a;if(a>=p&&(u=s?a+1:a-1),a<p&&(u=a,s&&i.type!=="bendpoint"&&p-1===a)){var f=oo(t,p);f<i.relativeLocation&&u++}return u}return r===0?a:n.connectionStart&&a===0?0:n.connectionEnd&&a===e.length-2?t.length-2:Math.floor((t.length-2)/2)}function ro(e,t,i,n){var a=0,r=0,o={point:e,delta:{x:0,y:0}},c=ql(e,i),s=c.segmentIndex,p=Jl(i,t,c,n);if(p<0||p>t.length-2||p===null)return o;var u=Fa(i,s),f=Fa(t,p),h=c.position,v=eu(u,h),b=Ql(u,f);if(c.type==="bendpoint"){var w=t.length-i.length,_=c.bendpointIndex,D=i[_];if(t.indexOf(D)!==-1)return o;if(w===0){var P=t[_];return a=P.x-c.position.x,r=P.y-c.position.y,{delta:{x:a,y:r},point:{x:e.x+a,y:e.y+r}}}w<0&&_!==0&&_<i.length-1&&(v=oo(i,_))}var k={x:(f[1].x-f[0].x)*v+f[0].x,y:(f[1].y-f[0].y)*v+f[0].y},F=vs({x:e.x-h.x,y:e.y-h.y},b);return a=k.x+F.x-e.x,r=k.y+F.y-e.y,{point:Hn(k),delta:Hn({x:a,y:r})}}function oo(e,t){var i=Xt(e[t-1],e[t]),n=Xt(e[t],e[t+1]),a=i/(i+n);return a}function Ql(e,t){var i=la(e),n=la(t);return n-i}function Fa(e,t){return[e[t],e[t+1]]}function eu(e,t){var i=Xt(e[0],e[1]),n=Xt(e[0],t);return i===0?0:n/i}function tu(e,t,i,n){var a=nu(e);return ro(a,t,i,n).delta}function nu(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}var iu={width:90,height:20},ja="name",$a="text";function ki(e,t,i,n){C.call(this,e),this.postExecute("element.updateProperties",function(r){var o=r.context,c=o.element,s=o.properties;if(ja in s&&t.updateLabel(c,s[ja]),$a in s&&d(c,"bpmn:TextAnnotation")){var p=n.getTextAnnotationBounds({x:c.x,y:c.y,width:c.width,height:c.height},s[$a]||"");t.updateLabel(c,s.text,p)}}),this.postExecute(["shape.create","connection.create"],function(r){var o=r.context,c=o.hints||{};if(c.createElementsBehavior!==!1){var s=o.shape||o.connection,p=s.businessObject;if(!(Y(s)||!He(s))&&!!ge(s)){var u=ln(s),f=n.getExternalLabelBounds(iu,ge(s));t.createLabel(s,u,{id:p.id+"_label",businessObject:p,width:f.width,height:f.height})}}}),this.postExecute("shape.delete",function(r){var o=r.context,c=o.labelTarget,s=o.hints||{};c&&s.unsetLabel!==!1&&t.updateLabel(c,null,null,{removeShape:!1})}),this.postExecute(["label.create"],function(r){var o=r.context,c=o.shape,s=o.labelTarget,p;!s||!d(s,"bpmn:BaseElement")||(p=H(s),p.label||(p.label=i.create("bpmndi:BPMNLabel",{bounds:i.create("dc:Bounds")}),c.di=p),A(p.label.bounds,{x:c.x,y:c.y,width:c.width,height:c.height}))});function a(r){var o=r.context,c=o.connection,s=c.label,p=A({},o.hints),u=o.newWaypoints||c.waypoints,f=o.oldWaypoints;return typeof p.startChanged>"u"&&(p.startChanged=!!p.connectionStart),typeof p.endChanged>"u"&&(p.endChanged=!!p.connectionEnd),tu(s,u,f,p)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(r){var o=r.context,c=o.hints||{};if(c.labelBehavior!==!1){var s=o.connection,p=s.label,u;!p||!p.parent||(u=a(r),t.moveShape(p,u))}}),this.postExecute(["shape.replace"],function(r){var o=r.context,c=o.newShape,s=o.oldShape,p=R(c);p&&He(p)&&s.label&&c.label&&(c.label.x=s.label.x,c.label.y=s.label.y)}),this.postExecute("shape.resize",function(r){var o=r.context,c=o.shape,s=o.newBounds,p=o.oldBounds;if(pn(c)){var u=c.label,f=W(u),h=ou(p),v=ru(f,h),b=au(v,p,s);t.moveShape(u,b)}})}N(ki,C);ki.$inject=["eventBus","modeling","bpmnFactory","textRenderer"];function au(e,t,i){var n=bs(e,t,i);return Hn(pi(n,e))}function ru(e,t){if(!!t.length){var i=su(e,t);return gs(e,i)}}function ou(e){return[[{x:e.x,y:e.y},{x:e.x+(e.width||0),y:e.y}],[{x:e.x+(e.width||0),y:e.y},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y+(e.height||0)},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y},{x:e.x,y:e.y+(e.height||0)}]]}function su(e,t){var i=t.map(function(a){return{line:a,distance:ys(e,a)}}),n=Qn(i,"distance");return n[0].line}function cu(e,t,i,n){return ro(e,t,i,n).point}function Mi(e,t){C.call(this,e);function i(n,a){var r=n.context,o=r.connection,c=A({},r.hints),s=r.newWaypoints||o.waypoints,p=r.oldWaypoints;return typeof c.startChanged>"u"&&(c.startChanged=!!c.connectionStart),typeof c.endChanged>"u"&&(c.endChanged=!!c.connectionEnd),cu(a,s,p,c)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(n){var a=n.context,r=a.connection,o=r.outgoing,c=r.incoming;c.forEach(function(s){var p=s.waypoints[s.waypoints.length-1],u=i(n,p),f=[].concat(s.waypoints.slice(0,-1),[u]);t.updateWaypoints(s,f)}),o.forEach(function(s){var p=s.waypoints[0],u=i(n,p),f=[].concat([u],s.waypoints.slice(1));t.updateWaypoints(s,f)})}),this.postExecute(["connection.move"],function(n){var a=n.context,r=a.connection,o=r.outgoing,c=r.incoming,s=a.delta;c.forEach(function(p){var u=p.waypoints[p.waypoints.length-1],f={x:u.x+s.x,y:u.y+s.y},h=[].concat(p.waypoints.slice(0,-1),[f]);t.updateWaypoints(p,h)}),o.forEach(function(p){var u=p.waypoints[0],f={x:u.x+s.x,y:u.y+s.y},h=[].concat([f],p.waypoints.slice(1));t.updateWaypoints(p,h)})})}N(Mi,C);Mi.$inject=["eventBus","modeling"];function Li(e,t){C.call(this,e),this.postExecute("shape.replace",function(i){var n=i.oldShape,a=i.newShape;if(!!pu(n,a)){var r=lu(n);r.incoming.forEach(function(o){var c=Es(o,a,n);t.reconnectEnd(o,a,c)}),r.outgoing.forEach(function(o){var c=ws(o,a,n);t.reconnectStart(o,a,c)})}},!0)}Li.$inject=["eventBus","modeling"];N(Li,C);function pu(e,t){return d(e,"bpmn:Participant")&&$(e)&&d(t,"bpmn:Participant")&&!$(t)}function lu(e){var t=ui([e],!1),i=[],n=[];return t.forEach(function(a){a!==e&&(a.incoming.forEach(function(r){d(r,"bpmn:MessageFlow")&&i.push(r)}),a.outgoing.forEach(function(r){d(r,"bpmn:MessageFlow")&&n.push(r)}))},[]),{incoming:i,outgoing:n}}var uu="flow elements must be children of pools/participants";function so(e,t,i){function n(a,r,o){t.add({position:{x:a.x+5,y:a.y+5},type:"error",timeout:o||2e3,html:"<div>"+r+"</div>"})}e.on(["shape.move.rejected","create.rejected"],function(a){var r=a.context,o=r.shape,c=r.target;d(c,"bpmn:Collaboration")&&d(o,"bpmn:FlowNode")&&n(a,i(uu))})}so.$inject=["eventBus","tooltips","translate"];function Oi(e,t){C.call(this,e),this.preExecute("shape.resize",function(i){var n=i.shape,a=H(n),r=a&&a.get("label"),o=r&&r.get("bounds");o&&t.updateModdleProperties(n,r,{bounds:void 0})},!0)}N(Oi,C);Oi.$inject=["eventBus","modeling"];function Ii(e,t,i){C.call(this,e),this.preExecute("shape.delete",function(n){var a=n.context.shape;if(!(a.incoming.length!==1||a.outgoing.length!==1)){var r=a.incoming[0],o=a.outgoing[0];if(!(!d(r,"bpmn:SequenceFlow")||!d(o,"bpmn:SequenceFlow"))&&t.canConnect(r.source,o.target,r)){var c=du(r.waypoints,o.waypoints);i.reconnectEnd(r,o.target,c)}}})}N(Ii,C);Ii.$inject=["eventBus","bpmnRules","modeling"];function Xe(e){return e.original||e}function du(e,t){var i=Vn(Xe(e[e.length-2]),Xe(e[e.length-1]),Xe(t[1]),Xe(t[0]));return i?[].concat(e.slice(0,e.length-1),[i],t.slice(1)):[Xe(e[0]),Xe(t[t.length-1])]}function Fi(e,t){C.call(this,e),this.preExecute("shape.delete",function(i){var n=i.shape,a=n.parent;d(n,"bpmn:Participant")&&(i.collaborationRoot=a)},!0),this.postExecute("shape.delete",function(i){var n=i.collaborationRoot;n&&!n.businessObject.participants.length&&t.makeProcess()},!0)}Fi.$inject=["eventBus","modeling"];N(Fi,C);function ji(e,t,i,n){C.call(this,e);var a=n.get("dragging",!1);function r(s){var p=s.source,u=s.target,f=s.parent;if(!!f){var h,v;d(s,"bpmn:SequenceFlow")&&(i.canConnectSequenceFlow(p,u)||(v=!0),i.canConnectMessageFlow(p,u)&&(h="bpmn:MessageFlow")),d(s,"bpmn:MessageFlow")&&(i.canConnectMessageFlow(p,u)||(v=!0),i.canConnectSequenceFlow(p,u)&&(h="bpmn:SequenceFlow")),d(s,"bpmn:Association")&&!i.canConnectAssociation(p,u)&&(v=!0),v&&t.removeConnection(s),h&&t.connect(p,u,{type:h,waypoints:s.waypoints.slice()})}}function o(s){var p=s.context,u=p.connection,f=p.newSource||u.source,h=p.newTarget||u.target,v,b;v=i.canConnect(f,h),!(!v||v.type===u.type)&&(b=t.connect(f,h,{type:v.type,waypoints:u.waypoints.slice()}),t.removeConnection(u),p.connection=b,a&&c(u,b))}function c(s,p){var u=a.context(),f=u&&u.payload.previousSelection,h;!f||!f.length||(h=f.indexOf(s),h!==-1&&f.splice(h,1,p))}this.postExecuted("elements.move",function(s){var p=s.closure,u=p.allConnections;L(u,r)},!0),this.preExecute("connection.reconnect",o),this.postExecuted("element.updateProperties",function(s){var p=s.context,u=p.properties,f=p.element,h=f.businessObject,v;u.default&&(v=X(f.outgoing,ei({id:f.businessObject.default.id})),v&&t.updateProperties(v,{conditionExpression:void 0})),u.conditionExpression&&h.sourceRef.default===h&&t.updateProperties(f.source,{default:void 0})})}N(ji,C);ji.$inject=["eventBus","modeling","bpmnRules","injector"];function Dn(e,t,i,n,a,r){n.invoke(C,this),this._bpmnReplace=e,this._elementRegistry=i,this._selection=r,this.postExecuted(["elements.create"],500,function(o){var c=o.context,s=c.parent,p=c.elements,u=ze(p,function(f,h){var v=t.canReplace([h],h.host||h.parent||s);return v?f.concat(v.replacements):f},[]);u.length&&this.replaceElements(p,u)},this),this.postExecuted(["elements.move"],500,function(o){var c=o.context,s=c.newParent,p=c.newHost,u=[];L(c.closure.topLevel,function(h){oe(h)?u=u.concat(h.children):u=u.concat(h)}),u.length===1&&p&&(s=p);var f=t.canReplace(u,s);f&&this.replaceElements(u,f.replacements,p)},this),this.postExecute(["shape.replace"],1500,function(o){var c=o.context,s=c.oldShape,p=c.newShape,u=s.attachers,f;u&&u.length&&(f=t.canReplace(u,p),this.replaceElements(u,f.replacements))},this),this.postExecuted(["shape.replace"],1500,function(o){var c=o.context,s=c.oldShape,p=c.newShape;a.unclaimId(s.businessObject.id,s.businessObject),a.updateProperties(p,{id:s.id})})}N(Dn,C);Dn.prototype.replaceElements=function(e,t){var i=this._elementRegistry,n=this._bpmnReplace,a=this._selection;L(t,function(r){var o={type:r.newElementType},c=i.get(r.oldElementId),s=e.indexOf(c);e[s]=n.replaceElement(c,o,{select:!1})}),t&&a.select(e)};Dn.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var fu=1500,hu={width:140,height:120},je={width:300,height:60},yt={width:300,height:150},co={width:140,height:120},po={width:50,height:30};function lo(e){e.on("resize.start",fu,function(t){var i=t.context,n=i.shape,a=i.direction,r=i.balanced;(d(n,"bpmn:Lane")||d(n,"bpmn:Participant"))&&(i.resizeConstraints=wu(n,a,r)),d(n,"bpmn:Participant")&&(i.minDimensions=yt),d(n,"bpmn:SubProcess")&&$(n)&&(i.minDimensions=co),d(n,"bpmn:TextAnnotation")&&(i.minDimensions=po)})}lo.$inject=["eventBus"];var zt=Math.abs,mu=Math.min,vu=Math.max;function uo(e,t,i,n){var a=e[t];e[t]=a===void 0?i:n(i,a)}function Wt(e,t,i){return uo(e,t,i,mu)}function Gt(e,t,i){return uo(e,t,i,vu)}var bu=20,gu=50,yu=20,Eu=20;function wu(e,t,i){var n=ve(e),a=!0,r=!0,o=hn(n,[n]),c=K(e),s={},p={};/e/.test(t)?p.right=c.left+je.width:/w/.test(t)&&(p.left=c.right-je.width),o.forEach(function(f){var h=K(f);/n/.test(t)&&(h.top<c.top-10&&(a=!1),i&&zt(c.top-h.bottom)<10&&Gt(s,"top",h.top+je.height),zt(c.top-h.top)<5&&Wt(p,"top",h.bottom-je.height)),/s/.test(t)&&(h.bottom>c.bottom+10&&(r=!1),i&&zt(c.bottom-h.top)<10&&Wt(s,"bottom",h.bottom-je.height),zt(c.bottom-h.bottom)<5&&Gt(p,"bottom",h.top+je.height))});var u=n.children.filter(function(f){return!f.hidden&&!f.waypoints&&(d(f,"bpmn:FlowElement")||d(f,"bpmn:Artifact"))});return u.forEach(function(f){var h=K(f);a&&/n/.test(t)&&Wt(p,"top",h.top-yu),/e/.test(t)&&Gt(p,"right",h.right+bu),r&&/s/.test(t)&&Gt(p,"bottom",h.bottom+Eu),/w/.test(t)&&Wt(p,"left",h.left-gu)}),{min:p,max:s}}var Ha=1001;function fo(e,t){e.on("resize.start",Ha+500,function(i){var n=i.context,a=n.shape;(d(a,"bpmn:Lane")||d(a,"bpmn:Participant"))&&(n.balanced=!yr(i))}),e.on("resize.end",Ha,function(i){var n=i.context,a=n.shape,r=n.canExecute,o=n.newBounds;if(d(a,"bpmn:Lane")||d(a,"bpmn:Participant"))return r&&(o=xs(o),t.resizeLane(a,o,n.balanced)),!1})}fo.$inject=["eventBus","modeling"];var xu=500;function $i(e,t,i,n,a){i.invoke(C,this);function r(u){return I(u,["bpmn:ReceiveTask","bpmn:SendTask"])||_u(u,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function o(u){var f=e.getDefinitions(),h=f.get("rootElements");return!!X(h,ei({id:u.id}))}function c(u){if(d(u,"bpmn:ErrorEventDefinition"))return"errorRef";if(d(u,"bpmn:EscalationEventDefinition"))return"escalationRef";if(d(u,"bpmn:MessageEventDefinition"))return"messageRef";if(d(u,"bpmn:SignalEventDefinition"))return"signalRef"}function s(u){if(I(u,["bpmn:ReceiveTask","bpmn:SendTask"]))return u.get("messageRef");var f=u.get("eventDefinitions"),h=f[0];return h.get(c(h))}function p(u,f){if(I(u,["bpmn:ReceiveTask","bpmn:SendTask"]))return u.set("messageRef",f);var h=u.get("eventDefinitions"),v=h[0];return v.set(c(v),f)}this.executed("shape.create",function(u){var f=u.shape;if(!!r(f)){var h=R(f),v=s(h),b;v&&!o(v)&&(b=e.getDefinitions().get("rootElements"),pe(b,v),u.addedRootElement=v)}},!0),this.reverted("shape.create",function(u){var f=u.addedRootElement;if(!!f){var h=e.getDefinitions().get("rootElements");J(h,f)}},!0),t.on("copyPaste.copyElement",function(u){var f=u.descriptor,h=u.element;if(!(h.labelTarget||!r(h))){var v=R(h),b=s(v);b&&(f.referencedRootElement=b)}}),t.on("copyPaste.pasteElement",xu,function(u){var f=u.descriptor,h=f.businessObject,v=f.referencedRootElement;!v||(o(v)||(v=n.copyElement(v,a.create(v.$type))),p(h,v),delete f.referencedRootElement)})}$i.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"];N($i,C);function _u(e,t){return Ce(t)||(t=[t]),nt(t,function(i){return cn(e,i)})}var Su=Math.max;function ho(e){e.on("spaceTool.getMinDimensions",function(t){var i=t.shapes,n=t.axis,a=t.start,r={};return L(i,function(o){var c=o.id;d(o,"bpmn:Participant")&&(Du(n)?r[c]=yt:r[c]={width:yt.width,height:Pu(o,a)}),d(o,"bpmn:SubProcess")&&$(o)&&(r[c]=co),d(o,"bpmn:TextAnnotation")&&(r[c]=po),d(o,"bpmn:Group")&&(r[c]=hu)}),r})}ho.$inject=["eventBus"];function Du(e){return e==="x"}function Pu(e,t){var i;return Tu(e)?(i=Au(e,t),Su(yt.height,i)):yt.height}function Tu(e){return!!Ve(e).length}function Au(e,t){var i=Ve(e),n;return n=mo(i,t),e.height-n.height+je.height}function mo(e,t){var i,n,a;for(i=0;i<e.length;i++)if(n=e[i],t>=n.y&&t<=n.y+n.height)return a=Ve(n),a.length?mo(a,t):n}var za=400,Ru=600,Wa={x:180,y:160};function Le(e,t,i,n,a,r,o){C.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=i,this._elementFactory=n,this._bpmnFactory=a,this._bpmnjs=r,this._elementRegistry=o;var c=this;function s(f){return d(f,"bpmn:SubProcess")&&!$(f)}function p(f){var h=f.shape,v=f.newRootElement,b=R(h);v=c._addDiagram(v||b),f.newRootElement=e.addRootElement(v)}function u(f){var h=f.shape,v=R(h);c._removeDiagram(v);var b=f.newRootElement=o.get(Se(v));e.removeRootElement(b)}this.executed("shape.create",function(f){var h=f.shape;!s(h)||p(f)},!0),this.postExecuted("shape.create",function(f){var h=f.shape,v=f.newRootElement;!v||!h.children||(c._showRecursively(h.children),c._moveChildrenToShape(h,v))},!0),this.reverted("shape.create",function(f){var h=f.shape;!s(h)||u(f)},!0),this.preExecuted("shape.delete",function(f){var h=f.shape;if(!!s(h)){var v=o.get(Se(h));!v||i.removeElements(v.children.slice())}},!0),this.executed("shape.delete",function(f){var h=f.shape;!s(h)||u(f)},!0),this.reverted("shape.delete",function(f){var h=f.shape;!s(h)||p(f)},!0),this.preExecuted("shape.replace",function(f){var h=f.oldShape,v=f.newShape;!s(h)||!s(v)||(f.oldRoot=e.removeRootElement(Se(h)))},!0),this.postExecuted("shape.replace",function(f){var h=f.newShape,v=f.oldRoot,b=e.findRoot(Se(h));if(!(!v||!b)){var w=v.children;i.moveElements(w,{x:0,y:0},b)}},!0),this.executed("element.updateProperties",function(f){var h=f.element;if(!!d(h,"bpmn:SubProcess")){var v=f.properties,b=f.oldProperties,w=b.id,_=v.id;if(w!==_){if(kn(h)){o.updateId(h,Fe(_)),o.updateId(w,_);return}var D=o.get(Fe(w));!D||o.updateId(Fe(w),Fe(_))}}},!0),this.reverted("element.updateProperties",function(f){var h=f.element;if(!!d(h,"bpmn:SubProcess")){var v=f.properties,b=f.oldProperties,w=b.id,_=v.id;if(w!==_){if(kn(h)){o.updateId(h,Fe(w)),o.updateId(_,w);return}var D=o.get(Fe(_));!D||o.updateId(D,Fe(w))}}},!0),t.on("element.changed",function(f){var h=f.element;if(!!kn(h)){var v=h,b=o.get(ha(v));!b||b===v||t.fire("element.changed",{element:b})}}),this.executed("shape.toggleCollapse",za,function(f){var h=f.shape;!d(h,"bpmn:SubProcess")||($(h)?u(f):(p(f),c._showRecursively(h.children)))},!0),this.reverted("shape.toggleCollapse",za,function(f){var h=f.shape;!d(h,"bpmn:SubProcess")||($(h)?u(f):(p(f),c._showRecursively(h.children)))},!0),this.postExecuted("shape.toggleCollapse",Ru,function(f){var h=f.shape;if(!!d(h,"bpmn:SubProcess")){var v=f.newRootElement;!v||($(h)?c._moveChildrenToShape(v,h):c._moveChildrenToShape(h,v))}},!0),t.on("copyPaste.createTree",function(f){var h=f.element,v=f.children;if(!!s(h)){var b=Se(h),w=o.get(b);w&&v.push.apply(v,w.children)}}),t.on("copyPaste.copyElement",function(f){var h=f.descriptor,v=f.element,b=f.elements,w=v.parent,_=d(H(w),"bpmndi:BPMNPlane");if(!!_){var D=ha(w),P=X(b,function(k){return k.id===D});!P||(h.parent=P.id)}}),t.on("copyPaste.pasteElement",function(f){var h=f.descriptor;!h.parent||(s(h.parent)||h.parent.hidden)&&(h.hidden=!0)})}N(Le,C);Le.prototype._moveChildrenToShape=function(e,t){var i=this._modeling,n=e.children,a;if(!!n){n=n.concat(n.reduce(function(p,u){return u.label&&u.label.parent!==e?p.concat(u.label):p},[]));var r=n.filter(function(p){return!p.hidden});if(!r.length){i.moveElements(n,{x:0,y:0},t,{autoResize:!1});return}var o=ci(r);if(!t.x)a={x:Wa.x-o.x,y:Wa.y-o.y};else{var c=W(t),s=W(o);a={x:c.x-s.x,y:c.y-s.y}}i.moveElements(n,a,t,{autoResize:!1})}};Le.prototype._showRecursively=function(e,t){var i=this,n=[];return e.forEach(function(a){a.hidden=!!t,n=n.concat(a),a.children&&(n=n.concat(i._showRecursively(a.children,a.collapsed||t)))}),n};Le.prototype._addDiagram=function(e){var t=this._bpmnjs,i=t.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),i.push(e.di.$parent),e};Le.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,i=this._elementFactory,n=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),a=t.create("bpmndi:BPMNDiagram",{plane:n});n.$parent=a;var r=i.createRoot({id:Se(e),type:e.$type,di:n,businessObject:e,collapsed:!0});return r};Le.prototype._removeDiagram=function(e){var t=this._bpmnjs,i=t.getDefinitions().diagrams,n=X(i,function(a){return a.plane.bpmnElement.id===e.id});return i.splice(i.indexOf(n),1),n};Le.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"];function Hi(e,t){e.invoke(C,this),this.postExecuted("shape.replace",function(i){var n=i.context.oldShape,a=i.context.newShape;if(!(!d(a,"bpmn:SubProcess")||!(d(n,"bpmn:Task")||d(n,"bpmn:CallActivity"))||!$(a))){var r=Cu(a);t.createShape({type:"bpmn:StartEvent"},r,a)}})}Hi.$inject=["injector","modeling"];N(Hi,C);function Cu(e){return{x:e.x+e.width/6,y:e.y+e.height/2}}function zi(e,t){C.call(this,e),this.postExecuted("shape.toggleCollapse",1500,function(i){var n=i.shape;if($(n))return;var a=ui(n);a.forEach(function(o){var c=o.incoming.slice(),s=o.outgoing.slice();L(c,function(p){r(p,!0)}),L(s,function(p){r(p,!1)})});function r(o,c){a.indexOf(o.source)!==-1&&a.indexOf(o.target)!==-1||(c?t.reconnectEnd(o,n,W(n)):t.reconnectStart(o,n,W(n)))}},!0)}N(zi,C);zi.$inject=["eventBus","modeling"];var On=500;function Wi(e,t,i,n){C.call(this,e);function a(c){c.length&&c.forEach(function(s){s.type==="label"&&!s.businessObject.name&&(s.hidden=!0)})}function r(c,s){var p=c.children,u=s,f,h;return f=Bu(p).concat([c]),h=_s(f),h?(u.width=Math.max(h.width,u.width),u.height=Math.max(h.height,u.height),u.x=h.x+(h.width-u.width)/2,u.y=h.y+(h.height-u.height)/2):(u.x=c.x+(c.width-u.width)/2,u.y=c.y+(c.height-u.height)/2),u}function o(c,s){return{x:c.x+(c.width-s.width)/2,y:c.y+(c.height-s.height)/2,width:s.width,height:s.height}}this.executed(["shape.toggleCollapse"],On,function(c){var s=c.context,p=s.shape;!d(p,"bpmn:SubProcess")||(p.collapsed?H(p).isExpanded=!1:(a(p.children),H(p).isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],On,function(c){var s=c.context,p=s.shape;p.collapsed?H(p).isExpanded=!1:H(p).isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],On,function(c){var s=c.context.shape,p=t.getDefaultSize(s),u;s.collapsed?u=o(s,p):u=r(s,p),i.resizeShape(s,u,null,{autoResize:s.collapsed?!1:"nwse"})})}N(Wi,C);Wi.$inject=["eventBus","elementFactory","modeling"];function Bu(e){return e.filter(function(t){return!t.hidden})}function Gi(e,t,i,n){t.invoke(C,this),this.preExecute("shape.delete",function(a){var r=a.context,o=r.shape,c=o.businessObject;Y(o)||(d(o,"bpmn:Participant")&&$(o)&&i.ids.unclaim(c.processRef.id),n.unclaimId(c.id,c))}),this.preExecute("connection.delete",function(a){var r=a.context,o=r.connection,c=o.businessObject;n.unclaimId(c.id,c)}),this.preExecute("canvas.updateRoot",function(){var a=e.getRootElement(),r=a.businessObject;d(a,"bpmn:Collaboration")&&i.ids.unclaim(r.id)})}N(Gi,C);Gi.$inject=["canvas","injector","moddle","modeling"];function Vi(e,t){C.call(this,e),this.preExecute("connection.delete",function(i){var n=i.context,a=n.connection,r=a.source;Nu(a,r)&&t.updateProperties(r,{default:null})})}N(Vi,C);Vi.$inject=["eventBus","modeling"];function Nu(e,t){if(!d(e,"bpmn:SequenceFlow"))return!1;var i=R(t),n=R(e);return i.get("default")===n}var ku=500,Mu=5e3;function Ui(e,t,i){C.call(this,e);var n;function a(){return n=n||new Lu,n.enter(),n}function r(){if(!n)throw new Error(i("out of bounds release"));return n}function o(){if(!n)throw new Error(i("out of bounds release"));var s=n.leave();return s&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null),s}var c=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(c,Mu,function(s){a()}),this.postExecuted(c,ku,function(s){o()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(s){var p=s.context,u=p.shape,f=r();u.labelTarget||(d(u,"bpmn:Lane")&&f.addLane(u),d(u,"bpmn:FlowNode")&&f.addFlowNode(u))})}Ui.$inject=["eventBus","modeling","translate"];N(Ui,C);function Lu(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}var Ou={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","layoutConnectionBehavior","messageFlowBehavior","modelingFeedback","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior"],adaptiveLabelPositioningBehavior:["type",yi],appendBehavior:["type",Ei],associationBehavior:["type",wi],attachEventBehavior:["type",xn],boundaryEventBehavior:["type",xi],createBehavior:["type",_i],createDataObjectBehavior:["type",Si],createParticipantBehavior:["type",Di],dataInputAssociationBehavior:["type",Pi],dataStoreBehavior:["type",Ti],deleteLaneBehavior:["type",Ai],detachEventBehavior:["type",Sn],dropOnFlowBehavior:["type",Ri],eventBasedGatewayBehavior:["type",Ci],fixHoverBehavior:["type",to],groupBehavior:["type",Bi],importDockingFix:["type",no],isHorizontalFix:["type",Ni],labelBehavior:["type",ki],layoutConnectionBehavior:["type",Mi],messageFlowBehavior:["type",Li],modelingFeedback:["type",so],removeElementBehavior:["type",Ii],removeEmbeddedLabelBoundsBehavior:["type",Oi],removeParticipantBehavior:["type",Fi],replaceConnectionBehavior:["type",ji],replaceElementBehaviour:["type",Dn],resizeBehavior:["type",lo],resizeLaneBehavior:["type",fo],rootElementReferenceBehavior:["type",$i],spaceToolBehavior:["type",ho],subProcessPlaneBehavior:["type",Le],subProcessStartEventBehavior:["type",Hi],toggleCollapseConnectionBehaviour:["type",zi],toggleElementCollapseBehaviour:["type",Wi],unclaimIdBehavior:["type",Gi],unsetDefaultFlowBehavior:["type",Vi],updateFlowNodeRefsBehavior:["type",Ui]};function vo(e,t){var i=Ne(e,t,-15);return i!=="intersect"?i:null}function Q(e){Be.call(this,e)}N(Q,Be);Q.$inject=["eventBus"];Q.prototype.init=function(){this.addRule("connection.start",function(e){var t=e.source;return Iu(t)}),this.addRule("connection.create",function(e){var t=e.source,i=e.target,n=e.hints||{},a=n.targetParent,r=n.targetAttach;if(r)return!1;a&&(i.parent=a);try{return qt(t,i)}finally{a&&(i.parent=null)}}),this.addRule("connection.reconnect",function(e){var t=e.connection,i=e.source,n=e.target;return qt(i,n,t)}),this.addRule("connection.updateWaypoints",function(e){return{type:e.connection.type}}),this.addRule("shape.resize",function(e){var t=e.shape,i=e.newBounds;return _o(t,i)}),this.addRule("elements.create",function(e){var t=e.elements,i=e.position,n=e.target;return Ua(n)&&!Qt(t,n)?!1:Jn(t,function(a){return Ua(a)?qt(a.source,a.target,a):a.host?ht(a,a.host,null,i):Kn(a,n,null)})}),this.addRule("elements.move",function(e){var t=e.target,i=e.shapes,n=e.position;return ht(i,t,null,n)||wo(i,t,n)||xo(i,t)||Qt(i,t)}),this.addRule("shape.create",function(e){return Kn(e.shape,e.target,e.source,e.position)}),this.addRule("shape.attach",function(e){return ht(e.shape,e.target,null,e.position)}),this.addRule("element.copy",function(e){var t=e.element,i=e.elements;return To(i,t)})};Q.prototype.canConnectMessageFlow=Do;Q.prototype.canConnectSequenceFlow=Po;Q.prototype.canConnectDataAssociation=Ki;Q.prototype.canConnectAssociation=So;Q.prototype.canMove=xo;Q.prototype.canAttach=ht;Q.prototype.canReplace=wo;Q.prototype.canDrop=tt;Q.prototype.canInsert=Qt;Q.prototype.canCreate=Kn;Q.prototype.canConnect=qt;Q.prototype.canResize=_o;Q.prototype.canCopy=To;function Iu(e){return Un(e)?null:I(e,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}function Un(e){return!e||Y(e)}function Fu(e,t){return e===t}function Ga(e){do{if(d(e,"bpmn:Process"))return R(e);if(d(e,"bpmn:Participant"))return R(e).processRef||R(e)}while(e=e.parent)}function Yn(e){return d(e,"bpmn:TextAnnotation")}function Yi(e){return d(e,"bpmn:Group")&&!e.labelTarget}function qi(e){return d(e,"bpmn:BoundaryEvent")&&we(e,"bpmn:CompensateEventDefinition")}function ot(e){return R(e).isForCompensation}function ju(e,t){var i=Ga(e),n=Ga(t);return i===n}function $u(e){return d(e,"bpmn:InteractionNode")&&!d(e,"bpmn:BoundaryEvent")&&(!d(e,"bpmn:Event")||d(e,"bpmn:ThrowEvent")&&bo(e,"bpmn:MessageEventDefinition"))}function Hu(e){return d(e,"bpmn:InteractionNode")&&!ot(e)&&(!d(e,"bpmn:Event")||d(e,"bpmn:CatchEvent")&&bo(e,"bpmn:MessageEventDefinition"))&&!(d(e,"bpmn:BoundaryEvent")&&!we(e,"bpmn:MessageEventDefinition"))}function Va(e){for(var t=e;t=t.parent;){if(d(t,"bpmn:FlowElementsContainer"))return R(t);if(d(t,"bpmn:Participant"))return R(t).processRef}return null}function zu(e,t){var i=Va(e),n=Va(t);return i===n}function we(e,t){var i=R(e);return!!X(i.eventDefinitions||[],function(n){return d(n,t)})}function bo(e,t){var i=R(e);return(i.eventDefinitions||[]).every(function(n){return d(n,t)})}function Wu(e){return d(e,"bpmn:FlowNode")&&!d(e,"bpmn:EndEvent")&&!oe(e)&&!(d(e,"bpmn:IntermediateThrowEvent")&&we(e,"bpmn:LinkEventDefinition"))&&!qi(e)&&!ot(e)}function Gu(e){return d(e,"bpmn:FlowNode")&&!d(e,"bpmn:StartEvent")&&!d(e,"bpmn:BoundaryEvent")&&!oe(e)&&!(d(e,"bpmn:IntermediateCatchEvent")&&we(e,"bpmn:LinkEventDefinition"))&&!ot(e)}function Vu(e){return d(e,"bpmn:ReceiveTask")||d(e,"bpmn:IntermediateCatchEvent")&&(we(e,"bpmn:MessageEventDefinition")||we(e,"bpmn:TimerEventDefinition")||we(e,"bpmn:ConditionalEventDefinition")||we(e,"bpmn:SignalEventDefinition"))}function Ua(e){return e.waypoints}function Uu(e){for(var t=[];e;)e=e.parent,e&&t.push(e);return t}function qn(e,t){var i=Uu(t);return i.indexOf(e)!==-1}function qt(e,t,i){if(Un(e)||Un(t))return null;if(!d(i,"bpmn:DataAssociation")){if(Do(e,t))return{type:"bpmn:MessageFlow"};if(Po(e,t))return{type:"bpmn:SequenceFlow"}}var n=Ki(e,t);return n||(qi(e)&&ot(t)?{type:"bpmn:Association",associationDirection:"One"}:So(e,t)?{type:"bpmn:Association"}:!1)}function tt(e,t,i){return Y(e)||Yi(e)?!0:d(t,"bpmn:Participant")&&!$(t)?!1:d(e,"bpmn:Participant")?d(t,"bpmn:Process")||d(t,"bpmn:Collaboration"):I(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:d(e,"bpmn:Lane")?d(t,"bpmn:Participant")||d(t,"bpmn:Lane"):d(e,"bpmn:BoundaryEvent")&&!Yu(e)?!1:d(e,"bpmn:FlowElement")&&!d(e,"bpmn:DataStoreReference")?d(t,"bpmn:FlowElementsContainer")?$(t):I(t,["bpmn:Participant","bpmn:Lane"]):d(e,"bpmn:DataStoreReference")&&d(t,"bpmn:Collaboration")?nt(R(t).get("participants"),function(n){return!!n.get("processRef")}):I(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?I(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):d(e,"bpmn:MessageFlow")?d(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t:!1}function Yu(e){return R(e).cancelActivity&&(go(e)||yo(e))}function qu(e){return!Y(e)&&d(e,"bpmn:BoundaryEvent")}function Ku(e){return d(e,"bpmn:Lane")}function Xu(e){return qu(e)||d(e,"bpmn:IntermediateThrowEvent")&&go(e)?!0:d(e,"bpmn:IntermediateCatchEvent")&&yo(e)}function go(e){var t=R(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function yo(e){return Eo(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function Eo(e,t){return t.some(function(i){return we(e,i)})}function Zu(e){return d(e,"bpmn:ReceiveTask")&&X(e.incoming,function(t){return d(t.source,"bpmn:EventBasedGateway")})}function ht(e,t,i,n){if(Array.isArray(e)||(e=[e]),e.length!==1)return!1;var a=e[0];return Y(a)||!Xu(a)||oe(t)||!d(t,"bpmn:Activity")||ot(t)||n&&!vo(n,t)||Zu(t)?!1:"attach"}function wo(e,t,i){if(!t)return!1;var n={replacements:[]};return L(e,function(a){oe(t)||d(a,"bpmn:StartEvent")&&a.type!=="label"&&tt(a,t)&&(fc(a)||n.replacements.push({oldElementId:a.id,newElementType:"bpmn:StartEvent"}),(hc(a)||mc(a)||vc(a))&&n.replacements.push({oldElementId:a.id,newElementType:"bpmn:StartEvent"}),Eo(a,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&d(t,"bpmn:SubProcess")&&n.replacements.push({oldElementId:a.id,newElementType:"bpmn:StartEvent"})),d(t,"bpmn:Transaction")||we(a,"bpmn:CancelEventDefinition")&&a.type!=="label"&&(d(a,"bpmn:EndEvent")&&tt(a,t)&&n.replacements.push({oldElementId:a.id,newElementType:"bpmn:EndEvent"}),d(a,"bpmn:BoundaryEvent")&&ht(a,t,null,i)&&n.replacements.push({oldElementId:a.id,newElementType:"bpmn:BoundaryEvent"}))}),n.replacements.length?n:!1}function xo(e,t){return nt(e,Ku)?!1:t?e.every(function(i){return tt(i,t)}):!0}function Kn(e,t,i,n){return t?Y(e)||Yi(e)?!0:Fu(i,t)||i&&qn(i,t)?!1:tt(e,t)||Qt(e,t):!1}function _o(e,t){return d(e,"bpmn:SubProcess")?$(e)&&(!t||t.width>=100&&t.height>=80):d(e,"bpmn:Lane")?!t||t.width>=130&&t.height>=60:d(e,"bpmn:Participant")?!t||t.width>=250&&t.height>=50:!!(Yn(e)||Yi(e))}function Ju(e,t){var i=Yn(e),n=Yn(t);return(i||n)&&i!==n}function So(e,t){return qi(e)&&ot(t)?!0:qn(t,e)||qn(e,t)?!1:Ju(e,t)?!0:!!Ki(e,t)}function Do(e,t){return Ya(e)&&!Ya(t)?!1:$u(e)&&Hu(t)&&!ju(e,t)}function Po(e,t){return Wu(e)&&Gu(t)&&zu(e,t)&&!(d(e,"bpmn:EventBasedGateway")&&!Vu(t))}function Ki(e,t){return I(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&I(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:I(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&I(e,["bpmn:Activity","bpmn:CatchEvent"])?{type:"bpmn:DataOutputAssociation"}:!1}function Qt(e,t,i){if(!t)return!1;if(Array.isArray(e)){if(e.length!==1)return!1;e=e[0]}return t.source===e||t.target===e?!1:I(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!Y(t)&&d(e,"bpmn:FlowNode")&&!d(e,"bpmn:BoundaryEvent")&&tt(e,t.parent)}function Qu(e,t){return e&&t&&e.indexOf(t)!==-1}function To(e,t){return Y(t)?!0:!(d(t,"bpmn:Lane")&&!Qu(e,t.parent))}function Ya(e){return Zt(e,"bpmn:Process")||Zt(e,"bpmn:Collaboration")}var ed={__depends__:[Ss],__init__:["bpmnRules"],bpmnRules:["type",Q]},td=2e3;function Ao(e,t){e.on("saveXML.start",td,i);function i(){var n=t.getRootElements();L(n,function(a){var r=H(a),o,c;o=ui([a],!1),o=G(o,function(s){return s!==a&&!s.labelTarget}),c=en(o,H),r.set("planeElement",c)})}}Ao.$inject=["eventBus","canvas"];var nd={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",Ao]};function Xi(e,t,i){_r.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:9,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function a(c){if(c.labelTarget)return{level:10};var s=X(n,function(p){return I(c,[p.type])});return s&&s.order||{level:1}}function r(c){var s=c.order;if(s||(c.order=s=a(c)),!s)throw new Error("no order for <"+c.id+">");return s}function o(c,s,p){for(var u=s;u&&!I(u,p);)u=u.parent;if(!u)throw new Error("no parent for <"+c.id+"> in <"+(s&&s.id)+">");return u}this.getOrdering=function(c,s){if(c.labelTarget)return{parent:t.findRoot(s)||t.getRootElement(),index:-1};var p=r(c);p.containers&&(s=o(c,s,p.containers));var u=s.children.indexOf(c),f=Uo(s.children,function(h){return!c.labelTarget&&h.labelTarget?!1:p.level<r(h).level});return f!==-1&&u!==-1&&u<f&&(f-=1),{index:f,parent:s}}}Xi.$inject=["eventBus","canvas","translate"];N(Xi,_r);var id={__depends__:[rn],__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",Xi]};function Pn(e){e.invoke(di,this)}Pn.$inject=["injector"];N(Pn,di);Pn.prototype.calculateAdjustments=function(e,t,i,n){var a=di.prototype.calculateAdjustments.call(this,e,t,i,n);return a.resizingShapes=a.resizingShapes.filter(function(r){return!d(r,"bpmn:TextAnnotation")}),a};var Ro={__depends__:[Ds],spaceTool:["type",Pn]};function ue(e){this._model=e}ue.$inject=["moddle"];ue.prototype._needsId=function(e){return I(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])};ue.prototype._ensureId=function(e){if(e.id){this._model.ids.claim(e.id,e);return}var t;d(e,"bpmn:Activity")?t="Activity":d(e,"bpmn:Event")?t="Event":d(e,"bpmn:Gateway")?t="Gateway":I(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?t="Flow":t=(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e))};ue.prototype.create=function(e,t){var i=this._model.create(e,t||{});return this._ensureId(i),i};ue.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})};ue.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",A({bpmnElement:e,bounds:this.createDiBounds()},t))};ue.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)};ue.prototype.createDiWaypoints=function(e){var t=this;return en(e,function(i){return t.createDiWaypoint(i)})};ue.prototype.createDiWaypoint=function(e){return this.create("dc:Point",ti(e,["x","y"]))};ue.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",A({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))};ue.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",A({bpmnElement:e},t))};function ae(e,t,i,n){C.call(this,e),this._bpmnFactory=t,this._translate=n;var a=this;function r(v){var b=v.context,w=b.hints||{},_;!b.cropped&&w.createElementsBehavior!==!1&&(_=b.connection,_.waypoints=i.getCroppedWaypoints(_),b.cropped=!0)}this.executed(["connection.layout","connection.create"],r),this.reverted(["connection.layout"],function(v){delete v.context.cropped});function o(v){var b=v.context;a.updateParent(b.shape||b.connection,b.oldParent)}function c(v){var b=v.context,w=b.shape||b.connection,_=b.parent||b.newParent;a.updateParent(w,_)}this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],se(o)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],se(c));function s(v){var b=v.context,w=b.oldRoot,_=w.children;L(_,function(D){d(D,"bpmn:BaseElement")&&a.updateParent(D)})}this.executed(["canvas.updateRoot"],s),this.reverted(["canvas.updateRoot"],s);function p(v){var b=v.context.shape;!d(b,"bpmn:BaseElement")||a.updateBounds(b)}this.executed(["shape.move","shape.create","shape.resize"],se(function(v){v.context.shape.type!=="label"&&p(v)})),this.reverted(["shape.move","shape.create","shape.resize"],se(function(v){v.context.shape.type!=="label"&&p(v)})),e.on("shape.changed",function(v){v.element.type==="label"&&p({context:{shape:v.element}})});function u(v){a.updateConnection(v.context)}this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],se(u)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],se(u));function f(v){a.updateConnectionWaypoints(v.context.connection)}this.executed(["connection.layout","connection.move","connection.updateWaypoints"],se(f)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],se(f)),this.executed("connection.reconnect",se(function(v){var b=v.context,w=b.connection,_=b.oldSource,D=b.newSource,P=R(w),k=R(_),F=R(D);P.conditionExpression&&!I(F,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(b.oldConditionExpression=P.conditionExpression,delete P.conditionExpression),_!==D&&k.default===P&&(b.oldDefault=k.default,delete k.default)})),this.reverted("connection.reconnect",se(function(v){var b=v.context,w=b.connection,_=b.oldSource,D=b.newSource,P=R(w),k=R(_),F=R(D);b.oldConditionExpression&&(P.conditionExpression=b.oldConditionExpression),b.oldDefault&&(k.default=b.oldDefault,delete F.default)}));function h(v){a.updateAttachment(v.context)}this.executed(["element.updateAttachment"],se(h)),this.reverted(["element.updateAttachment"],se(h))}N(ae,C);ae.$inject=["eventBus","bpmnFactory","connectionDocking","translate"];ae.prototype.updateAttachment=function(e){var t=e.shape,i=t.businessObject,n=t.host;i.attachedToRef=n&&n.businessObject};ae.prototype.updateParent=function(e,t){if(!(e instanceof Sr)&&!(d(e,"bpmn:DataStoreReference")&&e.parent&&d(e.parent,"bpmn:Collaboration"))){var i=e.parent,n=e.businessObject,a=H(e),r=i&&i.businessObject,o=H(i);d(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(n,r,t&&t.businessObject),d(e,"bpmn:DataOutputAssociation")&&(e.source?r=e.source.businessObject:r=null),d(e,"bpmn:DataInputAssociation")&&(e.target?r=e.target.businessObject:r=null),this.updateSemanticParent(n,r),d(e,"bpmn:DataObjectReference")&&n.dataObjectRef&&this.updateSemanticParent(n.dataObjectRef,r),this.updateDiParent(a,o)}};ae.prototype.updateBounds=function(e){var t=H(e),i=rd(e);if(i){var n=pi(i,t.get("bounds"));A(i,{x:e.x+n.x,y:e.y+n.y})}var a=e instanceof Sr?this._getLabel(t):t,r=a.bounds;r||(r=this._bpmnFactory.createDiBounds(),a.set("bounds",r)),A(r,{x:e.x,y:e.y,width:e.width,height:e.height})};ae.prototype.updateFlowNodeRefs=function(e,t,i){if(i!==t){var n,a;d(i,"bpmn:Lane")&&(n=i.get("flowNodeRef"),J(n,e)),d(t,"bpmn:Lane")&&(a=t.get("flowNodeRef"),pe(a,e))}};ae.prototype.updateDiConnection=function(e,t,i){var n=H(e),a=H(t),r=H(i);n.sourceElement&&n.sourceElement.bpmnElement!==R(t)&&(n.sourceElement=t&&a),n.targetElement&&n.targetElement.bpmnElement!==R(i)&&(n.targetElement=i&&r)};ae.prototype.updateDiParent=function(e,t){if(t&&!d(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var i=(t||e.$parent).get("planeElement");t?(i.push(e),e.$parent=t):(J(i,e),e.$parent=null)}};function ad(e){for(;e&&!d(e,"bpmn:Definitions");)e=e.$parent;return e}ae.prototype.getLaneSet=function(e){var t,i;return d(e,"bpmn:Lane")?(t=e.childLaneSet,t||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(d(e,"bpmn:Participant")&&(e=e.processRef),i=e.get("laneSets"),t=i[0],t||(t=this._bpmnFactory.create("bpmn:LaneSet"),t.$parent=e,i.push(t)),t)};ae.prototype.updateSemanticParent=function(e,t,i){var n,a=this._translate;if(e.$parent!==t&&!((d(e,"bpmn:DataInput")||d(e,"bpmn:DataOutput"))&&(d(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),"ioSpecification"in t&&t.ioSpecification===e.$parent))){if(d(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),n="lanes";else if(d(e,"bpmn:FlowElement")){if(t){if(d(t,"bpmn:Participant"))t=t.processRef;else if(d(t,"bpmn:Lane"))do t=t.$parent.$parent;while(d(t,"bpmn:Lane"))}n="flowElements"}else if(d(e,"bpmn:Artifact")){for(;t&&!d(t,"bpmn:Process")&&!d(t,"bpmn:SubProcess")&&!d(t,"bpmn:Collaboration");)if(d(t,"bpmn:Participant")){t=t.processRef;break}else t=t.$parent;n="artifacts"}else if(d(e,"bpmn:MessageFlow"))n="messageFlows";else if(d(e,"bpmn:Participant")){n="participants";var r=e.processRef,o;r&&(o=ad(e.$parent||t),e.$parent&&(J(o.get("rootElements"),r),r.$parent=null),t&&(pe(o.get("rootElements"),r),r.$parent=o))}else d(e,"bpmn:DataOutputAssociation")?n="dataOutputAssociations":d(e,"bpmn:DataInputAssociation")&&(n="dataInputAssociations");if(!n)throw new Error(a("no parent for {element} in {parent}",{element:e.id,parent:t.id}));var c;if(e.$parent&&(c=e.$parent.get(n),J(c,e)),t?(c=t.get(n),c.push(e),e.$parent=t):e.$parent=null,i){var s=i.get(n);J(c,e),t&&(s||(s=[],t.set(n,s)),s.push(e))}}};ae.prototype.updateConnectionWaypoints=function(e){var t=H(e);t.set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))};ae.prototype.updateConnection=function(e){var t=e.connection,i=R(t),n=t.source,a=R(n),r=t.target,o=R(t.target),c;if(d(i,"bpmn:DataAssociation"))d(i,"bpmn:DataInputAssociation")?(i.get("sourceRef")[0]=a,c=e.parent||e.newParent||o,this.updateSemanticParent(i,o,c)):d(i,"bpmn:DataOutputAssociation")&&(c=e.parent||e.newParent||a,this.updateSemanticParent(i,a,c),i.targetRef=o);else{var s=d(i,"bpmn:SequenceFlow");i.sourceRef!==a&&(s&&(J(i.sourceRef&&i.sourceRef.get("outgoing"),i),a&&a.get("outgoing")&&a.get("outgoing").push(i)),i.sourceRef=a),i.targetRef!==o&&(s&&(J(i.targetRef&&i.targetRef.get("incoming"),i),o&&o.get("incoming")&&o.get("incoming").push(i)),i.targetRef=o)}this.updateConnectionWaypoints(t),this.updateDiConnection(t,n,r)};ae.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label};function se(e){return function(t){var i=t.context,n=i.shape||i.connection;d(n,"bpmn:BaseElement")&&e(t)}}function rd(e){if(!!d(e,"bpmn:Activity")){var t=H(e);if(!!t){var i=t.get("label");if(!!i)return i.get("bounds")}}}function Oe(e,t,i){fi.call(this),this._bpmnFactory=e,this._moddle=t,this._translate=i}N(Oe,fi);Oe.$inject=["bpmnFactory","moddle","translate"];Oe.prototype.baseCreate=fi.prototype.create;Oe.prototype.create=function(e,t){if(e==="label"){var i=t.di||this._bpmnFactory.createDiLabel();return this.baseCreate(e,A({type:"label",di:i},bt,t))}return this.createBpmnElement(e,t)};Oe.prototype.createBpmnElement=function(e,t){var i,n=this._translate;t=A({},t||{});var a=t.businessObject,r=t.di;if(!a){if(!t.type)throw new Error(n("no shape type specified"));a=this._bpmnFactory.create(t.type),Pr(a)}if(!sd(r)){var o=A({},r||{},{id:a.id+"_di"});e==="root"?r=this._bpmnFactory.createDiPlane(a,o):e==="connection"?r=this._bpmnFactory.createDiEdge(a,o):r=this._bpmnFactory.createDiShape(a,o)}d(a,"bpmn:Group")&&(t=A({isFrame:!0},t)),t=od(a,t,["processRef","isInterrupting","associationDirection","isForCompensation"]),t.isExpanded&&(t=Co(r,t,"isExpanded")),d(a,"bpmn:SubProcess")&&(t.collapsed=!$(a,r)),d(a,"bpmn:ExclusiveGateway")&&(r.isMarkerVisible=!0),jn(t.triggeredByEvent)&&(a.triggeredByEvent=t.triggeredByEvent,delete t.triggeredByEvent),jn(t.cancelActivity)&&(a.cancelActivity=t.cancelActivity,delete t.cancelActivity);var c,s;return t.eventDefinitionType&&(c=a.get("eventDefinitions")||[],s=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),t.eventDefinitionType==="bpmn:ConditionalEventDefinition"&&(s.condition=this._bpmnFactory.create("bpmn:FormalExpression")),c.push(s),s.$parent=a,a.eventDefinitions=c,delete t.eventDefinitionType),i=this.getDefaultSize(a,r),t=A({id:a.id},i,t,{businessObject:a,di:r}),this.baseCreate(e,t)};Oe.prototype.getDefaultSize=function(e,t){var i=R(e);return t=t||H(e),d(i,"bpmn:SubProcess")?$(i,t)?{width:350,height:200}:{width:100,height:80}:d(i,"bpmn:Task")?{width:100,height:80}:d(i,"bpmn:Gateway")?{width:50,height:50}:d(i,"bpmn:Event")?{width:36,height:36}:d(i,"bpmn:Participant")?$(i,t)?{width:600,height:250}:{width:400,height:60}:d(i,"bpmn:Lane")?{width:400,height:100}:d(i,"bpmn:DataObjectReference")?{width:36,height:50}:d(i,"bpmn:DataStoreReference")?{width:50,height:50}:d(i,"bpmn:TextAnnotation")?{width:100,height:30}:d(i,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}};Oe.prototype.createParticipantShape=function(e){return Qe(e)||(e={isExpanded:e}),e=A({type:"bpmn:Participant"},e||{}),e.isExpanded!==!1&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)};function od(e,t,i){return L(i,function(n){t=Co(e,t,n)}),t}function Co(e,t,i){return t[i]===void 0?t:(e[i]=t[i],Zn(t,[i]))}function sd(e){return I(e,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])}function Nt(e){this._elementRegistry=e}Nt.$inject=["elementRegistry"];Nt.prototype.execute=function(e){var t=e.element,i=e.moddleElement,n=e.properties;if(!i)throw new Error("<moddleElement> required");var a=e.changed||this.getVisualReferences(i).concat(t),r=e.oldProperties||cd(i,$n(n));return Bo(i,n),e.oldProperties=r,e.changed=a,a};Nt.prototype.revert=function(e){var t=e.oldProperties,i=e.moddleElement,n=e.changed;return Bo(i,t),n};Nt.prototype.getVisualReferences=function(e){var t=this._elementRegistry;return d(e,"bpmn:DataObject")?pd(e,t):[]};function cd(e,t){return ze(t,function(i,n){return i[n]=e.get(n),i},{})}function Bo(e,t){L(t,function(i,n){e.set(n,i)})}function pd(e,t){return t.filter(function(i){return d(i,"bpmn:DataObjectReference")&&R(i).dataObjectRef===e})}var dt="default",De="id",No="di",ld={width:0,height:0};function kt(e,t,i,n,a){this._elementRegistry=e,this._moddle=t,this._translate=i,this._modeling=n,this._textRenderer=a}kt.$inject=["elementRegistry","moddle","translate","modeling","textRenderer"];kt.prototype.execute=function(e){var t=e.element,i=[t],n=this._translate;if(!t)throw new Error(n("element required"));var a=this._elementRegistry,r=this._moddle.ids,o=t.businessObject,c=md(e.properties),s=e.oldProperties||ud(t,c);return ko(c,o)&&(r.unclaim(o[De]),a.updateId(t,c[De]),r.claim(c[De],o)),dt in c&&(c[dt]&&i.push(a.get(c[dt].id)),o[dt]&&i.push(a.get(o[dt].id))),Mo(t,c),e.oldProperties=s,e.changed=i,i};kt.prototype.postExecute=function(e){var t=e.element,i=t.label,n=i&&R(i).name;if(!!n){var a=this._textRenderer.getExternalLabelBounds(i,n);this._modeling.resizeShape(i,a,ld)}};kt.prototype.revert=function(e){var t=e.element,i=e.properties,n=e.oldProperties,a=t.businessObject,r=this._elementRegistry,o=this._moddle.ids;return Mo(t,n),ko(i,a)&&(o.unclaim(i[De]),r.updateId(t,n[De]),o.claim(n[De],a)),e.changed};function ko(e,t){return De in e&&e[De]!==t[De]}function ud(e,t){var i=$n(t),n=e.businessObject,a=H(e);return ze(i,function(r,o){return o!==No?r[o]=n.get(o):r[o]=dd(a,$n(t.di)),r},{})}function dd(e,t){return ze(t,function(i,n){return i[n]=e&&e.get(n),i},{})}function Mo(e,t){var i=e.businessObject,n=H(e);L(t,function(a,r){r!==No?i.set(r,a):n&&fd(n,a)})}function fd(e,t){L(t,function(i,n){e.set(n,i)})}var hd=["default"];function md(e){var t=A({},e);return hd.forEach(function(i){i in e&&(t[i]=R(t[i]))}),t}function Tn(e,t){this._canvas=e,this._modeling=t}Tn.$inject=["canvas","modeling"];Tn.prototype.execute=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,a=t.getRootElement(),r=a.businessObject,o=r.$parent,c=H(a);t.setRootElement(i),t.removeRootElement(a),pe(o.rootElements,n),n.$parent=o,J(o.rootElements,r),r.$parent=null,a.di=null,c.bpmnElement=n,i.di=c,e.oldRoot=a};Tn.prototype.revert=function(e){var t=this._canvas,i=e.newRoot,n=i.businessObject,a=e.oldRoot,r=a.businessObject,o=n.$parent,c=H(i);t.setRootElement(a),t.removeRootElement(i),J(o.rootElements,n),n.$parent=null,pe(o.rootElements,r),r.$parent=o,i.di=null,c.bpmnElement=r,a.di=c};function Zi(e,t){this._modeling=e,this._spaceTool=t}Zi.$inject=["modeling","spaceTool"];Zi.prototype.preExecute=function(e){var t=this._spaceTool,i=this._modeling,n=e.shape,a=e.location,r=ve(n),o=r===n,c=o?n:n.parent,s=Ve(c);s.length||i.createShape({type:"bpmn:Lane"},{x:n.x+Je,y:n.y,width:n.width-Je,height:n.height},c);var p=[];li(r,function(w){return p.push(w),w.label&&p.push(w.label),w===n?[]:G(w.children,function(_){return _!==n})});var u=a==="top"?-120:120,f=a==="top"?n.y:n.y+n.height,h=f+(a==="top"?10:-10),v=a==="top"?"n":"s",b=t.calculateAdjustments(p,"y",u,h);t.makeSpace(b.movingShapes,b.resizingShapes,{x:0,y:u},v,h),e.newLane=i.createShape({type:"bpmn:Lane"},{x:n.x+(o?Je:0),y:f-(a==="top"?120:0),width:n.width-(o?Je:0),height:120},c)};function Ji(e,t){this._modeling=e,this._translate=t}Ji.$inject=["modeling","translate"];Ji.prototype.preExecute=function(e){var t=this._modeling,i=this._translate,n=e.shape,a=e.count,r=Ve(n),o=r.length;if(o>a)throw new Error(i("more than {count} child lanes",{count:a}));var c=Math.round(n.height/a),s,p,u,f,h;for(h=0;h<a;h++)s=n.y+h*c,h===a-1?p=n.height-c*h:p=c,u={x:n.x+Je,y:s,width:n.width-Je,height:p},h<o?t.resizeShape(r[h],u):(f={type:"bpmn:Lane"},t.createShape(f,u,n))};function Mt(e,t){this._modeling=e,this._spaceTool=t}Mt.$inject=["modeling","spaceTool"];Mt.prototype.preExecute=function(e){var t=e.shape,i=e.newBounds,n=e.balanced;n!==!1?this.resizeBalanced(t,i):this.resizeSpace(t,i)};Mt.prototype.resizeBalanced=function(e,t){var i=this._modeling,n=Np(e,t);i.resizeShape(e,t),n.forEach(function(a){i.resizeShape(a.shape,a.newBounds)})};Mt.prototype.resizeSpace=function(e,t){var i=this._spaceTool,n=K(e),a=K(t),r=gr(a,n),o=ve(e),c=[],s=[];li(o,function(b){return c.push(b),(d(b,"bpmn:Lane")||d(b,"bpmn:Participant"))&&s.push(b),b.children});var p,u,f,h,v;(r.bottom||r.top)&&(p=r.bottom||r.top,u=e.y+(r.bottom?e.height:0)+(r.bottom?-10:10),f=r.bottom?"s":"n",h=r.top>0||r.bottom<0?-p:p,v=i.calculateAdjustments(c,"y",h,u),i.makeSpace(v.movingShapes,v.resizingShapes,{x:0,y:p},f)),(r.left||r.right)&&(p=r.right||r.left,u=e.x+(r.right?e.width:0)+(r.right?-10:100),f=r.right?"e":"w",h=r.left>0||r.right<0?-p:p,v=i.calculateAdjustments(s,"x",h,u),i.makeSpace(v.movingShapes,v.resizingShapes,{x:p,y:0},f))};var Et="flowNodeRef",Qi="lanes";function Lt(e){this._elementRegistry=e}Lt.$inject=["elementRegistry"];Lt.prototype.computeUpdates=function(e,t){var i=[],n=[],a={},r=[];function o(u,f){var h=K(f),v={x:u.x+u.width/2,y:u.y+u.height/2};return v.x>h.left&&v.x<h.right&&v.y>h.top&&v.y<h.bottom}function c(u){i.indexOf(u)===-1&&(r.push(u),i.push(u))}function s(u){var f=ve(u);return a[f.id]||(a[f.id]=hn(f)),a[f.id]}function p(u){if(!u.parent)return[];var f=s(u);return f.filter(function(h){return o(u,h)}).map(function(h){return h.businessObject})}return t.forEach(function(u){var f=ve(u);if(!(!f||i.indexOf(f)!==-1)){var h=f.children.filter(function(v){return d(v,"bpmn:FlowNode")});h.forEach(c),i.push(f)}}),e.forEach(c),r.forEach(function(u){var f=u.businessObject,h=f.get(Qi),v=h.slice(),b=p(u);n.push({flowNode:f,remove:v,add:b})}),t.forEach(function(u){var f=u.businessObject;u.parent||f.get(Et).forEach(function(h){n.push({flowNode:h,remove:[f],add:[]})})}),n};Lt.prototype.execute=function(e){var t=e.updates;t||(t=e.updates=this.computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach(function(i){var n=i.flowNode,a=n.get(Qi);i.remove.forEach(function(r){J(a,r),J(r.get(Et),n)}),i.add.forEach(function(r){pe(a,r),pe(r.get(Et),n)})})};Lt.prototype.revert=function(e){var t=e.updates;t.forEach(function(i){var n=i.flowNode,a=n.get(Qi);i.add.forEach(function(r){J(a,r),J(r.get(Et),n)}),i.remove.forEach(function(r){pe(a,r),pe(r.get(Et),n)})})};function An(e){this._moddle=e}An.$inject=["moddle"];An.prototype.execute=function(e){var t=this._moddle.ids,i=e.id,n=e.element,a=e.claiming;a?t.claim(i,n):t.unclaim(i)};An.prototype.revert=function(e){var t=this._moddle.ids,i=e.id,n=e.element,a=e.claiming;a?t.unclaim(i):t.claim(i,n)};var vd={fill:void 0,stroke:void 0};function ea(e){this._commandStack=e,this._normalizeColor=function(t){if(!!t){if(Yo(t)){var i=bd(t);if(i)return i}throw new Error("invalid color value: "+t)}}}ea.$inject=["commandStack"];ea.prototype.postExecute=function(e){var t=e.elements,i=e.colors||vd,n=this,a={};"fill"in i&&A(a,{"background-color":this._normalizeColor(i.fill)}),"stroke"in i&&A(a,{"border-color":this._normalizeColor(i.stroke)}),L(t,function(r){var o=gd(r)?ti(a,["border-color"]):a,c=H(r);if(yd(o),Y(r))n._commandStack.execute("element.updateModdleProperties",{element:r,moddleElement:c.label,properties:{color:a["border-color"]}});else{if(!I(c,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;n._commandStack.execute("element.updateProperties",{element:r,properties:{di:o}})}})};function bd(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}function gd(e){return!!e.waypoints}function yd(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}var Ed={width:0,height:0};function Lo(e,t,i){function n(p,u){if(!He(p)){var f=H(p);u&&!f.label&&(f.label=i.create("bpmndi:BPMNLabel")),!u&&f.label&&delete f.label}}function a(p,u){var f=p.label||p,h=p.labelTarget||p;return gc(f,u),n(p,u),[f,h]}function r(p){var u=p.element,f=u.businessObject,h=p.newLabel;if(!Y(u)&&He(u)&&!pn(u)&&!qa(h)){var v=7,b=ln(u);b={x:b.x,y:b.y+v},e.createLabel(u,b,{id:f.id+"_label",businessObject:f,di:u.di})}}function o(p){return p.oldLabel=ge(p.element),a(p.element,p.newLabel)}function c(p){return a(p.element,p.oldLabel)}function s(p){var u=p.element,f=u.label||u,h=p.newLabel,v=p.newBounds,b=p.hints||{};if(!(!Y(f)&&!d(f,"bpmn:TextAnnotation"))){if(Y(f)&&qa(h)){b.removeShape!==!1&&e.removeShape(f,{unsetLabel:!1});return}var w=ge(f);typeof v>"u"&&(v=t.getExternalLabelBounds(f,w)),v&&e.resizeShape(f,v,Ed)}}this.preExecute=r,this.execute=o,this.revert=c,this.postExecute=s}Lo.$inject=["modeling","textRenderer","bpmnFactory"];function qa(e){return!e||!e.trim()}function ee(e,t,i,n){hi.call(this,e,t,i),this._bpmnRules=n}N(ee,hi);ee.$inject=["eventBus","elementFactory","commandStack","bpmnRules"];ee.prototype.getHandlers=function(){var e=hi.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=Nt,e["element.updateProperties"]=kt,e["canvas.updateRoot"]=Tn,e["lane.add"]=Zi,e["lane.resize"]=Mt,e["lane.split"]=Ji,e["lane.updateRefs"]=Lt,e["id.updateClaim"]=An,e["element.setColor"]=ea,e["element.updateLabel"]=Lo,e};ee.prototype.updateLabel=function(e,t,i,n){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:i,hints:n||{}})};ee.prototype.connect=function(e,t,i,n){var a=this._bpmnRules;if(i||(i=a.canConnect(e,t)),!!i)return this.createConnection(e,t,i,e.parent,n)};ee.prototype.updateModdleProperties=function(e,t,i){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:i})};ee.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})};ee.prototype.resizeLane=function(e,t,i){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:i})};ee.prototype.addLane=function(e,t){var i={shape:e,location:t};return this._commandStack.execute("lane.add",i),i.newLane};ee.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})};ee.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};ee.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})};ee.prototype.makeProcess=function(){var e=this._create("root",{type:"bpmn:Process"}),t={newRoot:e};this._commandStack.execute("canvas.updateRoot",t)};ee.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})};ee.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})};ee.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})};var wd=-10,xd=40,ta={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},Kt={top:"t",right:"r",bottom:"b",left:"l"};function na(){}N(na,Ps);na.prototype.layoutConnection=function(e,t){t||(t={});var i=t.source||e.source,n=t.target||e.target,a=t.waypoints||e.waypoints,r=t.connectionStart,o=t.connectionEnd,c,s;return r||(r=Ka(a&&a[0],i)),o||(o=Ka(a&&a[a.length-1],n)),(d(e,"bpmn:Association")||d(e,"bpmn:DataAssociation"))&&a&&!Xa(i,n)?[].concat([r],a.slice(1,-1),[o]):(d(e,"bpmn:MessageFlow")?c=Sd(i,n):(d(e,"bpmn:SequenceFlow")||Xa(i,n))&&(i===n?c={preferredLayouts:Nd(i,e)}:d(i,"bpmn:BoundaryEvent")?c={preferredLayouts:kd(i,n,o)}:wt(i)||wt(n)?c=Pd(i):d(i,"bpmn:Gateway")?c={preferredLayouts:["v:h"]}:d(n,"bpmn:Gateway")?c={preferredLayouts:["h:v"]}:c={preferredLayouts:["h:h"]}),c&&(c=A(c,t),s=Ts(As(i,n,r,o,a,c))),s||[r,o])};function _d(e){var t=e.host;return Ne(W(e),t,wd)}function Sd(e,t){return{preferredLayouts:["straight","v:v"],preserveDocking:Dd(e,t)}}function Dd(e,t){return d(t,"bpmn:Participant")?"source":d(e,"bpmn:Participant")?"target":wt(t)?"source":wt(e)||d(t,"bpmn:Event")?"target":d(e,"bpmn:Event")?"source":null}function Pd(e){return{preferredLayouts:["straight","h:h"],preserveDocking:Td(e)}}function Td(e){return wt(e)?"target":"source"}function Ka(e,t){return e?e.original||e:W(t)}function Xa(e,t){return d(t,"bpmn:Activity")&&d(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function wt(e){return d(e,"bpmn:SubProcess")&&$(e)}function mt(e,t){return e===t}function Ad(e,t){return t.indexOf(e)!==-1}function vt(e){var t=/right|left/.exec(e);return t&&t[0]}function $e(e){var t=/top|bottom/.exec(e);return t&&t[0]}function Rd(e,t){return ta[e]===t}function Cd(e,t){var i=vt(e),n=ta[i];return t.indexOf(n)!==-1}function Bd(e,t){var i=$e(e),n=ta[i];return t.indexOf(n)!==-1}function Xn(e){return e==="right"||e==="left"}function Nd(e,t){var i=t.waypoints,n=i&&i.length&&Ne(i[0],e);return n==="top"?["t:r"]:n==="right"?["r:b"]:n==="left"?["l:t"]:["b:l"]}function kd(e,t,i){var n=W(e),a=W(t),r=_d(e),o,c,s=mt(e.host,t),p=Ad(r,["top","right","bottom","left"]),u=Ne(a,n,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return s?Md(r,p,e,t,i):(o=Ld(r,u,p),c=Od(r,u,p),[o+":"+c])}function Md(e,t,i,n,a){var r=t?e:$e(e),o=Kt[r],c;return t?Xn(e)?c=Za("y",i,n,a)?"h":"b":c=Za("x",i,n,a)?"v":"l":c="v",[o+":"+c]}function Za(e,t,i,n){var a=xd;return!(In(e,n,i,a)||In(e,n,{x:i.x+i.width,y:i.y+i.height},a)||In(e,n,W(t),a))}function In(e,t,i,n){return Math.abs(t[e]-i[e])<n}function Ld(e,t,i){return i?Kt[e]:mt($e(e),$e(t))||Rd(vt(e),vt(t))?Kt[$e(e)]:Kt[vt(e)]}function Od(e,t,i){return i?Xn(e)?Cd(e,t)||mt(e,t)?"h":"v":Bd(e,t)||mt(e,t)?"v":"h":Xn(t)||mt($e(e),$e(t))&&vt(t)?"h":"v"}var Id={__init__:["modeling","bpmnUpdater"],__depends__:[Ou,ed,nd,id,Ur,Rs,Cs,Bs,Ns,on,ni,Ro],bpmnFactory:["type",ue],bpmnUpdater:["type",ae],elementFactory:["type",Oe],modeling:["type",ee],layouter:["type",na],connectionDocking:["type",ks]};function ia(e,t,i,n,a,r,o,c){this._palette=e,this._create=t,this._elementFactory=i,this._spaceTool=n,this._lassoTool=a,this._handTool=r,this._globalConnect=o,this._translate=c,e.registerProvider(this)}ia.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];ia.prototype.getPaletteEntries=function(e){var t={},i=this._create,n=this._elementFactory,a=this._spaceTool,r=this._lassoTool,o=this._handTool,c=this._globalConnect,s=this._translate;function p(h,v,b,w,_){function D(k){var F=n.createShape(A({type:h},_));if(_){var q=H(F);q.isExpanded=_.isExpanded}i.start(k,F)}var P=h.replace(/^bpmn:/,"");return{group:v,className:b,title:w||s("Create {type}",{type:P}),action:{dragstart:D,click:D}}}function u(h){var v=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),b=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:v});i.start(h,[v,b],{hints:{autoSelect:[v]}})}function f(h){i.start(h,n.createParticipantShape())}return A(t,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:s("Activate the hand tool"),action:{click:function(h){o.activateHand(h)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:s("Activate the lasso tool"),action:{click:function(h){r.activateSelection(h)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:s("Activate the create/remove space tool"),action:{click:function(h){a.activateSelection(h)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:s("Activate the global connect tool"),action:{click:function(h){c.start(h)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":p("bpmn:StartEvent","event","bpmn-icon-start-event-none",s("Create StartEvent")),"create.intermediate-event":p("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",s("Create Intermediate/Boundary Event")),"create.end-event":p("bpmn:EndEvent","event","bpmn-icon-end-event-none",s("Create EndEvent")),"create.exclusive-gateway":p("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",s("Create Gateway")),"create.task":p("bpmn:Task","activity","bpmn-icon-task",s("Create Task")),"create.data-object":p("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",s("Create DataObjectReference")),"create.data-store":p("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",s("Create DataStoreReference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:s("Create expanded SubProcess"),action:{dragstart:u,click:u}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:s("Create Pool/Participant"),action:{dragstart:f,click:f}},"create.group":p("bpmn:Group","artifact","bpmn-icon-group",s("Create Group"))}),t};var Fd={__depends__:[wr,oi,Ro,Ms,Ls,Os,rn],__init__:["paletteProvider"],paletteProvider:["type",ia]},jd=250;function aa(e,t,i,n,a){C.call(this,e);function r(c){var s=c.canExecute.replacements;L(s,function(p){var u=p.oldElementId,f={type:p.newElementType};if(!c.visualReplacements[u]){var h=t.get(u);A(f,{x:h.x,y:h.y});var v=i.createShape(f);n.addShape(v,h.parent);var b=be('[data-element-id="'+ua(h.id)+'"]',c.dragGroup);b&&_e(b,{display:"none"});var w=a.addDragger(v,c.dragGroup);c.visualReplacements[u]=w,n.removeShape(v)}})}function o(c){var s=c.visualReplacements;L(s,function(p,u){var f=be('[data-element-id="'+ua(u)+'"]',c.dragGroup);f&&_e(f,{display:"inline"}),p.remove(),s[u]&&delete s[u]})}e.on("shape.move.move",jd,function(c){var s=c.context,p=s.canExecute;s.visualReplacements||(s.visualReplacements={}),p&&p.replacements?r(s):o(s)})}aa.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"];N(aa,C);var $d={__depends__:[Is],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",aa]},Hd=1250,Fn=40,zd=20,Wd=10,Ja=20,Oo=["x","y"],Gd=Math.abs;function Io(e){e.on(["connect.hover","connect.move","connect.end"],Hd,function(t){var i=t.context,n=i.canExecute,a=i.start,r=i.hover,o=i.source,c=i.target;t.originalEvent&&Fs(t.originalEvent)||(i.initialConnectionStart||(i.initialConnectionStart=i.connectionStart),n&&r&&Vd(t,r,Kd(r)),r&&qd(n,["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"])?(i.connectionStart=Ze(a),I(r,["bpmn:Event","bpmn:Gateway"])&&Qa(t,Ze(r)),I(r,["bpmn:Task","bpmn:SubProcess"])&&Ud(t,r),d(o,"bpmn:BoundaryEvent")&&c===o.host&&Yd(t)):Fo(n,"bpmn:MessageFlow")?(d(a,"bpmn:Event")&&(i.connectionStart=Ze(a)),d(r,"bpmn:Event")&&Qa(t,Ze(r))):i.connectionStart=i.initialConnectionStart)})}Io.$inject=["eventBus"];function Vd(e,t,i){Oo.forEach(function(n){var a=jo(n,t);e[n]<t[n]+i?ce(e,n,t[n]+i):e[n]>t[n]+a-i&&ce(e,n,t[n]+a-i)})}function Ud(e,t){var i=Ze(t);Oo.forEach(function(n){Xd(e,t,n)&&ce(e,n,i[n])})}function Yd(e){var t=e.context,i=t.source,n=t.target;if(!Zd(t)){var a=Ze(i),r=Ne(a,n,-10),o=[];/top|bottom/.test(r)&&o.push("x"),/left|right/.test(r)&&o.push("y"),o.forEach(function(c){var s=e[c],p;Gd(s-a[c])<Fn&&(s>a[c]?p=a[c]+Fn:p=a[c]-Fn,ce(e,c,p))})}}function Qa(e,t){ce(e,"x",t.x),ce(e,"y",t.y)}function Fo(e,t){return e&&e.type===t}function qd(e,t){return nt(t,function(i){return Fo(e,i)})}function jo(e,t){return e==="x"?t.width:t.height}function Kd(e){return d(e,"bpmn:Task")?Wd:zd}function Xd(e,t,i){return e[i]>t[i]+Ja&&e[i]<t[i]+jo(i,t)-Ja}function Zd(e){var t=e.hover,i=e.source;return t&&i&&t===i}var er=1500;function st(e,t){t.invoke(xt,this),e.on(["create.move","create.end"],er,tf),e.on(["create.move","create.end","shape.move.move","shape.move.end"],er,function(i){var n=i.context,a=n.canExecute,r=n.target,o=a&&(a==="attach"||a.attach);o&&!js(i)&&Jd(i,r)})}N(st,xt);st.$inject=["eventBus","injector"];st.prototype.initSnap=function(e){var t=xt.prototype.initSnap.call(this,e),i=e.shape,n=!!this._elementRegistry.get(i.id);return L(i.outgoing,function(a){var r=a.waypoints[0];r=r.original||r,t.setSnapOrigin(a.id+"-docking",nr(r,n,e))}),L(i.incoming,function(a){var r=a.waypoints[a.waypoints.length-1];r=r.original||r,t.setSnapOrigin(a.id+"-docking",nr(r,n,e))}),d(i,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t};st.prototype.addSnapTargetPoints=function(e,t,i){xt.prototype.addSnapTargetPoints.call(this,e,t,i);var n=this.getSnapTargets(t,i);L(n,function(r){(ef(r)||Qd([t,r],"bpmn:TextAnnotation"))&&(e.add("top-left",$s(r)),e.add("bottom-right",Hs(r)))});var a=this._elementRegistry;return L(t.incoming,function(r){if(a.get(t.id)){tr(n,r.source)||e.add("mid",W(r.source));var o=r.waypoints[0];e.add(r.id+"-docking",o.original||o)}}),L(t.outgoing,function(r){if(a.get(t.id)){tr(n,r.target)||e.add("mid",W(r.target));var o=r.waypoints[r.waypoints.length-1];e.add(r.id+"-docking",o.original||o)}}),d(i,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,i.parent)),e};st.prototype.getSnapTargets=function(e,t){return xt.prototype.getSnapTargets.call(this,e,t).filter(function(i){return!d(i,"bpmn:Lane")})};function Jd(e,t){var i=K(t),n=vo(e,t),a=e.context,r=a.shape,o;r.parent?o={x:0,y:0}:o=W(r),/top/.test(n)?ce(e,"y",i.top-o.y):/bottom/.test(n)&&ce(e,"y",i.bottom-o.y),/left/.test(n)?ce(e,"x",i.left-o.x):/right/.test(n)&&ce(e,"x",i.right-o.x)}function Qd(e,t){return e.every(function(i){return d(i,t)})}function ef(e){return d(e,"bpmn:SubProcess")&&$(e)?!0:d(e,"bpmn:Participant")}function tf(e){var t=e.context,i=t.createConstraints;if(!!i){var n=i.top,a=i.right,r=i.bottom,o=i.left;(o&&o>=e.x||a&&a<=e.x)&&ce(e,"x",e.x),(n&&n>=e.y||r&&r<=e.y)&&ce(e,"y",e.y)}}function tr(e,t){return e.indexOf(t)!==-1}function nr(e,t,i){return t?{x:e.x-i.x,y:e.y-i.y}:{x:e.x,y:e.y}}var nf={__depends__:[zs],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",Io],createMoveSnapping:["type",st]};function ra(e,t,i){this._elementRegistry=e,this._canvas=i,t.registerProvider(this)}ra.$inject=["elementRegistry","searchPad","canvas"];ra.prototype.find=function(e){var t=this._canvas.getRootElement(),i=this._elementRegistry.filter(function(n){return!n.labelTarget});return i=G(i,function(n){return n!==t}),i=en(i,function(n){return{primaryTokens:ar(ge(n),e),secondaryTokens:ar(n.id,e),element:n}}),i=G(i,function(n){return ir(n.primaryTokens)||ir(n.secondaryTokens)}),i=Qn(i,function(n){return ge(n.element)+n.element.id}),i};function ir(e){var t=G(e,function(i){return!!i.matched});return t.length>0}function ar(e,t){var i=[],n=e;if(!e)return i;e=e.toLowerCase(),t=t.toLowerCase();var a=e.indexOf(t);return a>-1?(a!==0&&i.push({normal:n.substr(0,a)}),i.push({matched:n.substr(a,t.length)}),t.length+a<e.length&&i.push({normal:n.substr(t.length+a,e.length)})):i.push({normal:n}),i}var af={__depends__:[Ws],__init__:["bpmnSearch"],bpmnSearch:["type",ra]},rf='<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>';function Pe(e){_t.call(this,e)}N(Pe,_t);Pe.Viewer=Me;Pe.NavigatedViewer=gt;Pe.prototype.createDiagram=at(function(){return this.importXML(rf)});Pe.prototype._interactionModules=[ur,dr,Gs,fr];Pe.prototype._modelingModules=[ip,zr,Vs,pp,Us,Er,Ys,Mp,Gr,oi,tl,al,rl,ml,gl,yl,qs,Pl,Id,Ks,Fd,$d,xr,nf,af];Pe.prototype._modules=[].concat(Me.prototype._modules,Pe.prototype._interactionModules,Pe.prototype._modelingModules);export{Pe as M};
