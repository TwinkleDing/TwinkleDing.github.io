import{aL as B}from"./diagram-js.5bb9cb39.js";import{y as z,q as H,c as b,f as D}from"./min-dash.9e14f76b.js";import{a as R,q as k,e as a,r as w}from"./min-dom.bb3c67f4.js";var C=Math.min,S=Math.max;function _(t){t.preventDefault()}function m(t){t.stopPropagation()}function A(t){return t.nodeType===Node.TEXT_NODE}function E(t){return[].slice.call(t)}function c(t){this.container=t.container,this.parent=R('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=k("[contenteditable]",this.parent),this.keyHandler=t.keyHandler||function(){},this.resizeHandler=t.resizeHandler||function(){},this.autoResize=z(this.autoResize,this),this.handlePaste=z(this.handlePaste,this)}c.prototype.create=function(t,e,i,n){var o=this,p=this.parent,s=this.content,f=this.container;n=this.options=n||{},e=this.style=e||{};var l=H(e,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);b(p.style,{width:t.width+"px",height:t.height+"px",maxWidth:t.maxWidth+"px",maxHeight:t.maxHeight+"px",minWidth:t.minWidth+"px",minHeight:t.minHeight+"px",left:t.x+"px",top:t.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},l);var h=H(e,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return b(s.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},h),n.centerVertically&&b(s.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},h),s.innerText=i,a.bind(s,"keydown",this.keyHandler),a.bind(s,"mousedown",m),a.bind(s,"paste",o.handlePaste),n.autoResize&&a.bind(s,"input",this.autoResize),n.resizable&&this.resizable(e),f.appendChild(p),this.setSelection(s.lastChild,s.lastChild&&s.lastChild.length),p};c.prototype.handlePaste=function(t){var e=this.options,i=this.style;t.preventDefault();var n;if(t.clipboardData?n=t.clipboardData.getData("text/plain"):n=window.clipboardData.getData("Text"),this.insertText(n),e.autoResize){var o=this.autoResize(i);o&&this.resizeHandler(o)}};c.prototype.insertText=function(t){t=I(t);var e=document.execCommand("insertText",!1,t);e||this._insertTextIE(t)};c.prototype._insertTextIE=function(t){var e=this.getSelection(),i=e.startContainer,n=e.endContainer,o=e.startOffset,p=e.endOffset,s=e.commonAncestorContainer,f=E(s.childNodes),l,h;if(A(s)){var g=i.textContent;i.textContent=g.substring(0,o)+t+g.substring(p),l=i,h=o+t.length}else if(i===this.content&&n===this.content){var v=document.createTextNode(t);this.content.insertBefore(v,f[o]),l=v,h=v.textContent.length}else{var x=f.indexOf(i),y=f.indexOf(n);f.forEach(function(r,u){u===x?r.textContent=i.textContent.substring(0,o)+t+n.textContent.substring(p):u>x&&u<=y&&w(r)}),l=i,h=o+t.length}l&&h!==void 0&&setTimeout(function(){self.setSelection(l,h)})};c.prototype.autoResize=function(){var t=this.parent,e=this.content,i=parseInt(this.style.fontSize)||12;if(e.scrollHeight>t.offsetHeight||e.scrollHeight<t.offsetHeight-i){var n=t.getBoundingClientRect(),o=e.scrollHeight;t.style.height=o+"px",this.resizeHandler({width:n.width,height:n.height,dx:0,dy:o-n.height})}};c.prototype.resizable=function(){var t=this,e=this.parent,i=this.resizeHandle,n=parseInt(this.style.minWidth)||0,o=parseInt(this.style.minHeight)||0,p=parseInt(this.style.maxWidth)||1/0,s=parseInt(this.style.maxHeight)||1/0;if(!i){i=this.resizeHandle=R('<div class="djs-direct-editing-resize-handle"></div>');var f,l,h,g,v=function(r){_(r),m(r),f=r.clientX,l=r.clientY;var u=e.getBoundingClientRect();h=u.width,g=u.height,a.bind(document,"mousemove",x),a.bind(document,"mouseup",y)},x=function(r){_(r),m(r);var u=C(S(h+r.clientX-f,n),p),T=C(S(g+r.clientY-l,o),s);e.style.width=u+"px",e.style.height=T+"px",t.resizeHandler({width:h,height:g,dx:r.clientX-f,dy:r.clientY-l})},y=function(r){_(r),m(r),a.unbind(document,"mousemove",x,!1),a.unbind(document,"mouseup",y,!1)};a.bind(i,"mousedown",v)}b(i.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),e.appendChild(i)};c.prototype.destroy=function(){var t=this.parent,e=this.content,i=this.resizeHandle;e.innerText="",t.removeAttribute("style"),e.removeAttribute("style"),a.unbind(e,"keydown",this.keyHandler),a.unbind(e,"mousedown",m),a.unbind(e,"input",this.autoResize),a.unbind(e,"paste",this.handlePaste),i&&(i.removeAttribute("style"),w(i)),w(t)};c.prototype.getValue=function(){return this.content.innerText.trim()};c.prototype.getSelection=function(){var t=window.getSelection(),e=t.getRangeAt(0);return e};c.prototype.setSelection=function(t,e){var i=document.createRange();t===null?i.selectNodeContents(this.content):(i.setStart(t,e),i.setEnd(t,e));var n=window.getSelection();n.removeAllRanges(),n.addRange(i)};function I(t){return t.replace(/\r\n|\r|\n/g,`
`)}function d(t,e){this._eventBus=t,this._providers=[],this._textbox=new c({container:e.getContainer(),keyHandler:z(this._handleKey,this),resizeHandler:z(this._handleResize,this)})}d.$inject=["eventBus","canvas"];d.prototype.registerProvider=function(t){this._providers.push(t)};d.prototype.isActive=function(t){return!!(this._active&&(!t||this._active.element===t))};d.prototype.cancel=function(){!this._active||(this._fire("cancel"),this.close())};d.prototype._fire=function(t,e){this._eventBus.fire("directEditing."+t,e||{active:this._active})};d.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0};d.prototype.complete=function(){var t=this._active;if(!!t){var e,i=t.context.bounds,n=this.$textbox.getBoundingClientRect(),o=this.getValue(),p=t.context.text;(o!==p||n.height!==i.height||n.width!==i.width)&&(e=this._textbox.container.getBoundingClientRect(),t.provider.update(t.element,o,t.context.text,{x:n.left-e.left,y:n.top-e.top,width:n.width,height:n.height})),this._fire("complete"),this.close()}};d.prototype.getValue=function(){return this._textbox.getValue()};d.prototype._handleKey=function(t){t.stopPropagation();var e=t.keyCode||t.charCode;if(e===27)return t.preventDefault(),this.cancel();if(e===13&&!t.shiftKey)return t.preventDefault(),this.complete()};d.prototype._handleResize=function(t){this._fire("resize",t)};d.prototype.activate=function(t){this.isActive()&&this.cancel();var e,i=D(this._providers,function(n){return(e=n.activate(t))?n:null});return e&&(this.$textbox=this._textbox.create(e.bounds,e.style,e.text,e.options),this._active={element:t,context:e,provider:i},e.options&&e.options.resizable&&(this.resizable=!0),this._fire("activate")),!!e};var V={__depends__:[B],__init__:["directEditing"],directEditing:["type",d]};export{V as D};
