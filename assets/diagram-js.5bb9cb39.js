import{I as $s}from"./didi.552c89ce.js";import{e as lt}from"./inherits-browser.72a78a64.js";import{c as $,a as P,b as D,r as K,d as H,t as De,e as Ds,f as Ae,g as $i,h as Xo}from"./tiny-svg.77613367.js";import{d as I,j as N,b as m,a as at,f as nt,g as xt,c as M,w as ze,k as js,r as de,e as Di,l as Nt,x as qo,y as Ge,n as et,i as st,v as je,p as Dt,s as Jo,o as ve,z as Cn,A as ji,q as He,B as Er,m as pt,C as Hs,D as Ns,E as zs,F as Gs}from"./min-dash.9e14f76b.js";import{b as Et,f as $n,g as _i,q as Q,d as yt,r as pe,h as ot,a as Y,c as it,m as Hi,i as Gt,e as j}from"./min-dom.bb3c67f4.js";import{H as Xt}from"./hammerjs.10ef2fb3.js";import{c as Ni}from"./css.escape.b67b94cf.js";import{c as Rn}from"./clsx.09c75e33.js";import{m as Z}from"./htm.51e0fc2f.js";import{_ as zi,F as mi,s as bn,p as ii,T as le,h as ri,D as Qo}from"./preact.bf92c9ee.js";import{i as ta}from"./path-intersection.5cedc0f7.js";import{R as Be}from"./object-refs.18ea5c37.js";var Bs=1e3;function ee(t,e){var n=this;e=e||Bs,t.on(["render.shape","render.connection"],e,function(i,r){var o=i.type,a=r.element,s=r.gfx,c=r.attrs;if(n.canRender(a))return o==="render.shape"?n.drawShape(s,a,c):n.drawConnection(s,a,c)}),t.on(["render.getShapePath","render.getConnectionPath"],e,function(i,r){if(n.canRender(r))return i.type==="render.getShapePath"?n.getShapePath(r):n.getConnectionPath(r)})}ee.prototype.canRender=function(){};ee.prototype.drawShape=function(){};ee.prototype.drawConnection=function(){};ee.prototype.getShapePath=function(){};ee.prototype.getConnectionPath=function(){};function Gi(t){return t.flat().join(",").replace(/,?([A-z]),?/g,"$1")}function Vs(t){return["M",t.x,t.y]}function oi(t){return["L",t.x,t.y]}function Ws(t,e,n){return["C",t.x,t.y,e.x,e.y,n.x,n.y]}function Us(t,e){const n=t.length,i=[Vs(t[0])];for(let r=1;r<n;r++){const o=t[r-1],a=t[r],s=t[r+1];if(!s||!e){i.push(oi(a));continue}const c=Math.min(e,xi(a.x-o.x,a.y-o.y),xi(s.x-a.x,s.y-a.y));if(!c){i.push(oi(a));continue}const u=an(a,o,c),l=an(a,o,c*.5),f=an(a,s,c),h=an(a,s,c*.5);i.push(oi(u)),i.push(Ws(l,h,f))}return i}function an(t,e,n){const i=e.x-t.x,r=e.y-t.y,o=xi(i,r),a=n/o;return{x:t.x+i*a,y:t.y+r*a}}function xi(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Bi(t,e,n){I(e)&&(n=e,e=null),e||(e={});const i=$("path",e);return I(n)&&(i.dataset.cornerRadius=String(n)),ea(i,t)}function ea(t,e){const n=parseInt(t.dataset.cornerRadius,10)||0;return P(t,{d:Gi(Us(e,n))}),t}function na(t){return at(t,function(e){return!nt(t,function(n){return n!==e&&ia(e,n)})})}function ia(t,e){if(!!e){if(t===e)return e;if(!!t.parent)return ia(t.parent,e)}}function wr(t,e,n){var i=!n||t.indexOf(e)===-1;return i&&t.push(e),i}function Dn(t,e,n){n=n||0,N(t)||(t=[t]),m(t,function(i,r){var o=e(i,r,n);N(o)&&o.length&&Dn(o,e,n+1)})}function Fs(t,e,n){var i=[],r=[];return Dn(t,function(o,a,s){wr(i,o,e);var c=o.children;if((n===-1||s<n)&&c&&wr(r,c,e))return c}),i}function ra(t,e){return Fs(t,!e,-1)}function Ks(t,e,n){js(e)&&(e=!0),xt(e)&&(n=e,e=!0),n=n||{};var i=Me(n.allShapes),r=Me(n.allConnections),o=Me(n.enclosedElements),a=Me(n.enclosedConnections),s=Me(n.topLevel,e&&ze(t,function(l){return l.id}));function c(l){s[l.source.id]&&s[l.target.id]&&(s[l.id]=[l]),i[l.source.id]&&i[l.target.id]&&(a[l.id]=o[l.id]=l),r[l.id]=l}function u(l){if(o[l.id]=l,l.waypoints)a[l.id]=r[l.id]=l;else return i[l.id]=l,m(l.incoming,c),m(l.outgoing,c),l.children}return Dn(t,u),{allShapes:i,allConnections:r,topLevel:s,enclosedConnections:a,enclosedElements:o}}function q(t,e){e=!!e,N(t)||(t=[t]);var n,i,r,o;return m(t,function(a){var s=a;a.waypoints&&!e&&(s=q(a.waypoints,!0));var c=s.x,u=s.y,l=s.height||0,f=s.width||0;(c<n||n===void 0)&&(n=c),(u<i||i===void 0)&&(i=u),(c+f>r||r===void 0)&&(r=c+f),(u+l>o||o===void 0)&&(o=u+l)}),{x:n,y:i,height:o-i,width:r-n}}function Ys(t,e){var n={};return m(t,function(i){var r=i;r.waypoints&&(r=q(r)),!I(e.y)&&r.x>e.x&&(n[i.id]=i),!I(e.x)&&r.y>e.y&&(n[i.id]=i),r.x>e.x&&r.y>e.y&&(I(e.width)&&I(e.height)&&r.width+r.x<e.width+e.x&&r.height+r.y<e.height+e.y||!I(e.width)||!I(e.height))&&(n[i.id]=i)}),n}function oa(t){return"waypoints"in t?"connection":"x"in t?"shape":"root"}function aa(t){return!!(t&&t.isFrame)}function Me(t,e){return M({},t||{},e||{})}var Zs=1;function Bt(t,e){ee.call(this,t,Zs),this.CONNECTION_STYLE=e.style(["no-fill"],{strokeWidth:5,stroke:"fuchsia"}),this.SHAPE_STYLE=e.style({fill:"white",stroke:"fuchsia",strokeWidth:2}),this.FRAME_STYLE=e.style(["no-fill"],{stroke:"fuchsia",strokeDasharray:4,strokeWidth:2})}lt(Bt,ee);Bt.prototype.canRender=function(){return!0};Bt.prototype.drawShape=function(e,n,i){var r=$("rect");return P(r,{x:0,y:0,width:n.width||0,height:n.height||0}),aa(n)?P(r,M({},this.FRAME_STYLE,i||{})):P(r,M({},this.SHAPE_STYLE,i||{})),D(e,r),r};Bt.prototype.drawConnection=function(e,n,i){var r=Bi(n.waypoints,M({},this.CONNECTION_STYLE,i||{}));return D(e,r),r};Bt.prototype.getShapePath=function(e){var n=e.x,i=e.y,r=e.width,o=e.height,a=[["M",n,i],["l",r,0],["l",0,o],["l",-r,0],["z"]];return Gi(a)};Bt.prototype.getConnectionPath=function(e){var n=e.waypoints,i,r,o=[];for(i=0;r=n[i];i++)r=r.original||r,o.push([i===0?"M":"L",r.x,r.y]);return Gi(o)};Bt.$inject=["eventBus","styles"];function Xs(){var t={"no-fill":{fill:"none"},"no-border":{strokeOpacity:0},"no-events":{pointerEvents:"none"}},e=this;this.cls=function(n,i,r){var o=this.style(i,r);return M(o,{class:n})},this.style=function(n,i){!N(n)&&!i&&(i=n,n=[]);var r=de(n,function(o,a){return M(o,t[a]||{})},{});return i?M(r,i):r},this.computeStyle=function(n,i,r){return N(i)||(r=i,i=[]),e.style(i||[],M({},r,n||{}))}}var qs={__init__:["defaultRenderer"],defaultRenderer:["type",Bt],styles:["type",Xs]};function Ve(t,e){if(!t||!e)return-1;var n=t.indexOf(e);return n!==-1&&t.splice(n,1),n}function Rt(t,e,n){if(!(!t||!e)){typeof n!="number"&&(n=-1);var i=t.indexOf(e);if(i!==-1){if(i===n)return;if(n!==-1)t.splice(i,1);else return}n!==-1?t.splice(n,0,e):t.push(e)}}function Vi(t,e){return!t||!e?-1:t.indexOf(e)}function We(t,e){return!t||!e?-1:Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Wi(t,e,n,i){if(typeof i>"u"&&(i=5),!t||!e||!n)return!1;var r=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),o=We(t,e);return Math.abs(r/o)<=i}var Js=2;function $t(t,e){var n=Array.from(arguments).flat();const i={x:"v",y:"h"};for(const[r,o]of Object.entries(i))if(Qs(r,n))return o;return!1}function Qs(t,e){const n=e[0];return Di(e,function(i){return Math.abs(n[t]-i[t])<=Js})}function Sr(t,e,n){return n=n||0,t.x>e.x-n&&t.y>e.y-n&&t.x<e.x+e.width+n&&t.y<e.y+e.height+n}function Ei(t,e){return{x:Math.round(t.x+(e.x-t.x)/2),y:Math.round(t.y+(e.y-t.y)/2)}}function tc(t){return{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(t.width),height:Math.round(t.height)}}function fe(t){return{x:Math.round(t.x),y:Math.round(t.y)}}function A(t){return{top:t.y,right:t.x+(t.width||0),bottom:t.y+(t.height||0),left:t.x}}function Ui(t){return{x:t.left,y:t.top,width:t.right-t.left,height:t.bottom-t.top}}function ec(t){return fe({x:t.x+(t.width||0)/2,y:t.y+(t.height||0)/2})}function nc(t){for(var e=t.waypoints,n=e.reduce(function(u,l,f){var h=e[f-1];if(h){var d=u[u.length-1],p=d&&d.endLength||0,_=oc(h,l);u.push({start:h,end:l,startLength:p,endLength:p+_,length:_})}return u},[]),i=n.reduce(function(u,l){return u+l.length},0),r=i/2,o=0,a=n[o];a.endLength<r;)a=n[++o];var s=(r-a.startLength)/a.length,c={x:a.start.x+(a.end.x-a.start.x)*s,y:a.start.y+(a.end.y-a.start.y)*s};return c}function V(t){return ac(t)?nc(t):ec(t)}function Ct(t,e,n){n=n||0,xt(n)||(n={x:n,y:n});var i=A(t),r=A(e),o=i.bottom+n.y<=r.top,a=i.left-n.x>=r.right,s=i.top-n.y>=r.bottom,c=i.right+n.x<=r.left,u=o?"top":s?"bottom":null,l=c?"left":a?"right":null;return l&&u?u+"-"+l:l||u||"intersect"}function wi(t,e,n){var i=ic(t,e);return i.length===1||i.length===2&&We(i[0],i[1])<1?fe(i[0]):i.length>1?(i=Nt(i,function(r){var o=Math.floor(r.t2*100)||1;return o=100-o,o=(o<10?"0":"")+o,r.segment2+"#"+o}),fe(i[n?0:i.length-1])):null}function ic(t,e){return ta(t,e)}function rc(t){t=t.slice();for(var e=0,n,i,r;t[e];)n=t[e],i=t[e-1],r=t[e+1],We(n,r)===0||Wi(i,r,n)?t.splice(e,1):e++;return t}function oc(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ac(t){return!!t.waypoints}function En(t,e){return Math.round(t*e)/e}function Cr(t){return I(t)?t+"px":t}function sc(t){for(;t.parent;)t=t.parent;return t}function cc(t){t=M({},{width:"100%",height:"100%"},t);const e=t.container||document.body,n=document.createElement("div");return n.setAttribute("class","djs-container djs-parent"),Et(n,{position:"relative",overflow:"hidden",width:Cr(t.width),height:Cr(t.height)}),e.appendChild(n),n}function sa(t,e,n){const i=$("g");H(i).add(e);const r=n!==void 0?n:t.childNodes.length-1;return t.insertBefore(i,t.childNodes[r]||null),i}const uc="base",ca=0,lc=1,fc={shape:["x","y","width","height"],connection:["waypoints"]};function k(t,e,n,i){this._eventBus=e,this._elementRegistry=i,this._graphicsFactory=n,this._rootsIdx=0,this._layers={},this._planes=[],this._rootElement=null,this._init(t||{})}k.$inject=["config.canvas","eventBus","graphicsFactory","elementRegistry"];k.prototype._init=function(t){const e=this._eventBus,n=this._container=cc(t),i=this._svg=$("svg");P(i,{width:"100%",height:"100%"}),D(n,i);const r=this._viewport=sa(i,"viewport");t.deferUpdate!==!1&&(this._viewboxChanged=qo(Ge(this._viewboxChanged,this),300)),e.on("diagram.init",function(){e.fire("canvas.init",{svg:i,viewport:r})},this),e.on(["shape.added","connection.added","shape.removed","connection.removed","elements.changed","root.set"],function(){delete this._cachedViewbox},this),e.on("diagram.destroy",500,this._destroy,this),e.on("diagram.clear",500,this._clear,this)};k.prototype._destroy=function(t){this._eventBus.fire("canvas.destroy",{svg:this._svg,viewport:this._viewport});const e=this._container.parentNode;e&&e.removeChild(this._container),delete this._svg,delete this._container,delete this._layers,delete this._planes,delete this._rootElement,delete this._viewport};k.prototype._clear=function(){this._elementRegistry.getAll().forEach(e=>{const n=oa(e);n==="root"?this.removeRootElement(e):this._removeElement(e,n)}),this._planes=[],this._rootElement=null,delete this._cachedViewbox};k.prototype.getDefaultLayer=function(){return this.getLayer(uc,ca)};k.prototype.getLayer=function(t,e){if(!t)throw new Error("must specify a name");let n=this._layers[t];if(n||(n=this._layers[t]=this._createLayer(t,e)),typeof e<"u"&&n.index!==e)throw new Error("layer <"+t+"> already created at index <"+e+">");return n.group};k.prototype._getChildIndex=function(t){return de(this._layers,function(e,n){return n.visible&&t>=n.index&&e++,e},0)};k.prototype._createLayer=function(t,e){typeof e>"u"&&(e=lc);const n=this._getChildIndex(e);return{group:sa(this._viewport,"layer-"+t,n),index:e,visible:!0}};k.prototype.showLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=this._viewport,i=e.group,r=e.index;if(e.visible)return i;const o=this._getChildIndex(r);return n.insertBefore(i,n.childNodes[o]||null),e.visible=!0,i};k.prototype.hideLayer=function(t){if(!t)throw new Error("must specify a name");const e=this._layers[t];if(!e)throw new Error("layer <"+t+"> does not exist");const n=e.group;return e.visible&&(K(n),e.visible=!1),n};k.prototype._removeLayer=function(t){const e=this._layers[t];e&&(delete this._layers[t],K(e.group))};k.prototype.getActiveLayer=function(){const t=this._findPlaneForRoot(this.getRootElement());return t?t.layer:null};k.prototype.findRoot=function(t){return typeof t=="string"&&(t=this._elementRegistry.get(t)),t?(this._findPlaneForRoot(sc(t))||{}).rootElement:void 0};k.prototype.getRootElements=function(){return this._planes.map(function(t){return t.rootElement})};k.prototype._findPlaneForRoot=function(t){return nt(this._planes,function(e){return e.rootElement===t})};k.prototype.getContainer=function(){return this._container};k.prototype._updateMarker=function(t,e,n){let i;t.id||(t=this._elementRegistry.get(t)),i=this._elementRegistry._elements[t.id],i&&(m([i.gfx,i.secondaryGfx],function(r){r&&(n?H(r).add(e):H(r).remove(e))}),this._eventBus.fire("element.marker.update",{element:t,gfx:i.gfx,marker:e,add:!!n}))};k.prototype.addMarker=function(t,e){this._updateMarker(t,e,!0)};k.prototype.removeMarker=function(t,e){this._updateMarker(t,e,!1)};k.prototype.hasMarker=function(t,e){t.id||(t=this._elementRegistry.get(t));const n=this.getGraphics(t);return H(n).has(e)};k.prototype.toggleMarker=function(t,e){this.hasMarker(t,e)?this.removeMarker(t,e):this.addMarker(t,e)};k.prototype.getRootElement=function(){const t=this._rootElement;return t||this._planes.length?t:this.setRootElement(this.addRootElement(null))};k.prototype.addRootElement=function(t){const e=this._rootsIdx++;t||(t={id:"__implicitroot_"+e,children:[],isImplicit:!0});const n=t.layer="root-"+e;this._ensureValid("root",t);const i=this.getLayer(n,ca);return this.hideLayer(n),this._addRoot(t,i),this._planes.push({rootElement:t,layer:i}),t};k.prototype.removeRootElement=function(t){if(typeof t=="string"&&(t=this._elementRegistry.get(t)),!!this._findPlaneForRoot(t))return this._removeRoot(t),this._removeLayer(t.layer),this._planes=this._planes.filter(function(n){return n.rootElement!==t}),this._rootElement===t&&(this._rootElement=null),t};k.prototype.setRootElement=function(t,e){if(et(e))throw new Error("override not supported");if(t===this._rootElement)return;let n;if(!t)throw new Error("rootElement required");return n=this._findPlaneForRoot(t),n||(t=this.addRootElement(t)),this._setRoot(t),t};k.prototype._removeRoot=function(t){const e=this._elementRegistry,n=this._eventBus;n.fire("root.remove",{element:t}),n.fire("root.removed",{element:t}),e.remove(t)};k.prototype._addRoot=function(t,e){const n=this._elementRegistry,i=this._eventBus;i.fire("root.add",{element:t}),n.add(t,e),i.fire("root.added",{element:t,gfx:e})};k.prototype._setRoot=function(t,e){const n=this._rootElement;n&&(this._elementRegistry.updateGraphics(n,null,!0),this.hideLayer(n.layer)),t&&(e||(e=this._findPlaneForRoot(t).layer),this._elementRegistry.updateGraphics(t,this._svg,!0),this.showLayer(t.layer)),this._rootElement=t,this._eventBus.fire("root.set",{element:t})};k.prototype._ensureValid=function(t,e){if(!e.id)throw new Error("element must have an id");if(this._elementRegistry.get(e.id))throw new Error("element <"+e.id+"> already exists");const n=fc[t];if(!Di(n,function(r){return typeof e[r]<"u"}))throw new Error("must supply { "+n.join(", ")+" } with "+t)};k.prototype._setParent=function(t,e,n){Rt(e.children,t,n),t.parent=e};k.prototype._addElement=function(t,e,n,i){n=n||this.getRootElement();const r=this._eventBus,o=this._graphicsFactory;this._ensureValid(t,e),r.fire(t+".add",{element:e,parent:n}),this._setParent(e,n,i);const a=o.create(t,e,i);return this._elementRegistry.add(e,a),o.update(t,e,a),r.fire(t+".added",{element:e,gfx:a}),e};k.prototype.addShape=function(t,e,n){return this._addElement("shape",t,e,n)};k.prototype.addConnection=function(t,e,n){return this._addElement("connection",t,e,n)};k.prototype._removeElement=function(t,e){const n=this._elementRegistry,i=this._graphicsFactory,r=this._eventBus;if(t=n.get(t.id||t),!!t)return r.fire(e+".remove",{element:t}),i.remove(t),Ve(t.parent&&t.parent.children,t),t.parent=null,r.fire(e+".removed",{element:t}),n.remove(t),t};k.prototype.removeShape=function(t){return this._removeElement(t,"shape")};k.prototype.removeConnection=function(t){return this._removeElement(t,"connection")};k.prototype.getGraphics=function(t,e){return this._elementRegistry.getGraphics(t,e)};k.prototype._changeViewbox=function(t){this._eventBus.fire("canvas.viewbox.changing"),t.apply(this),this._cachedViewbox=null,this._viewboxChanged()};k.prototype._viewboxChanged=function(){this._eventBus.fire("canvas.viewbox.changed",{viewbox:this.viewbox()})};k.prototype.viewbox=function(t){if(t===void 0&&this._cachedViewbox)return this._cachedViewbox;const e=this._viewport,n=this.getSize();let i,r,o,a,s,c,u;if(t)this._changeViewbox(function(){s=Math.min(n.width/t.width,n.height/t.height);const l=this._svg.createSVGMatrix().scale(s).translate(-t.x,-t.y);De(e,l)});else return o=this._rootElement?this.getActiveLayer():null,i=o&&o.getBBox()||{},a=De(e),r=a?a.matrix:Ds(),s=En(r.a,1e3),c=En(-r.e||0,1e3),u=En(-r.f||0,1e3),t=this._cachedViewbox={x:c?c/s:0,y:u?u/s:0,width:n.width/s,height:n.height/s,scale:s,inner:{width:i.width||0,height:i.height||0,x:i.x||0,y:i.y||0},outer:n},t;return t};k.prototype.scroll=function(t){const e=this._viewport;let n=e.getCTM();return t&&this._changeViewbox(function(){t=M({dx:0,dy:0},t||{}),n=this._svg.createSVGMatrix().translate(t.dx,t.dy).multiply(n),ua(e,n)}),{x:n.e,y:n.f}};k.prototype.scrollToElement=function(t,e){let n=100;typeof t=="string"&&(t=this._elementRegistry.get(t));const i=this.findRoot(t);i!==this.getRootElement()&&this.setRootElement(i),e||(e={}),typeof e=="number"&&(n=e),e={top:e.top||n,right:e.right||n,bottom:e.bottom||n,left:e.left||n};const r=q(t),o=A(r),a=this.viewbox(),s=this.zoom();let c,u;a.y+=e.top/s,a.x+=e.left/s,a.width-=(e.right+e.left)/s,a.height-=(e.bottom+e.top)/s;const l=A(a);if(!(r.width<a.width&&r.height<a.height))c=r.x-a.x,u=r.y-a.y;else{const h=Math.max(0,o.right-l.right),d=Math.min(0,o.left-l.left),p=Math.max(0,o.bottom-l.bottom),_=Math.min(0,o.top-l.top);c=h||d,u=p||_}this.scroll({dx:-c*s,dy:-u*s})};k.prototype.zoom=function(t,e){if(!t)return this.viewbox(t).scale;if(t==="fit-viewport")return this._fitViewport(e);let n,i;return this._changeViewbox(function(){typeof e!="object"&&(n=this.viewbox().outer,e={x:n.width/2,y:n.height/2}),i=this._setZoom(t,e)}),En(i.a,1e3)};function ua(t,e){const n="matrix("+e.a+","+e.b+","+e.c+","+e.d+","+e.e+","+e.f+")";t.setAttribute("transform",n)}k.prototype._fitViewport=function(t){const e=this.viewbox(),n=e.outer,i=e.inner;let r,o;return i.x>=0&&i.y>=0&&i.x+i.width<=n.width&&i.y+i.height<=n.height&&!t?o={x:0,y:0,width:Math.max(i.width+i.x,n.width),height:Math.max(i.height+i.y,n.height)}:(r=Math.min(1,n.width/i.width,n.height/i.height),o={x:i.x+(t?i.width/2-n.width/r/2:0),y:i.y+(t?i.height/2-n.height/r/2:0),width:n.width/r,height:n.height/r}),this.viewbox(o),this.viewbox(!1).scale};k.prototype._setZoom=function(t,e){const n=this._svg,i=this._viewport,r=n.createSVGMatrix(),o=n.createSVGPoint();let a,s,c,u,l;c=i.getCTM();const f=c.a;return e?(a=M(o,e),s=a.matrixTransform(c.inverse()),u=r.translate(s.x,s.y).scale(1/f*t).translate(-s.x,-s.y),l=c.multiply(u)):l=r.scale(t),ua(this._viewport,l),l};k.prototype.getSize=function(){return{width:this._container.clientWidth,height:this._container.clientHeight}};k.prototype.getAbsoluteBBox=function(t){const e=this.viewbox();let n;t.waypoints?n=this.getGraphics(t).getBBox():n=t;const i=n.x*e.scale-e.x*e.scale,r=n.y*e.scale-e.y*e.scale,o=n.width*e.scale,a=n.height*e.scale;return{x:i,y:r,width:o,height:a}};k.prototype.resized=function(){delete this._cachedViewbox,this._eventBus.fire("canvas.resized")};var ge="data-element-id";function ht(t){this._elements={},this._eventBus=t}ht.$inject=["eventBus"];ht.prototype.add=function(t,e,n){var i=t.id;this._validateId(i),P(e,ge,i),n&&P(n,ge,i),this._elements[i]={element:t,gfx:e,secondaryGfx:n}};ht.prototype.remove=function(t){var e=this._elements,n=t.id||t,i=n&&e[n];i&&(P(i.gfx,ge,""),i.secondaryGfx&&P(i.secondaryGfx,ge,""),delete e[n])};ht.prototype.updateId=function(t,e){this._validateId(e),typeof t=="string"&&(t=this.get(t)),this._eventBus.fire("element.updateId",{element:t,newId:e});var n=this.getGraphics(t),i=this.getGraphics(t,!0);this.remove(t),t.id=e,this.add(t,n,i)};ht.prototype.updateGraphics=function(t,e,n){var i=t.id||t,r=this._elements[i];return n?r.secondaryGfx=e:r.gfx=e,e&&P(e,ge,i),e};ht.prototype.get=function(t){var e;typeof t=="string"?e=t:e=t&&P(t,ge);var n=this._elements[e];return n&&n.element};ht.prototype.filter=function(t){var e=[];return this.forEach(function(n,i){t(n,i)&&e.push(n)}),e};ht.prototype.find=function(t){for(var e=this._elements,n=Object.keys(e),i=0;i<n.length;i++){var r=n[i],o=e[r],a=o.element,s=o.gfx;if(t(a,s))return a}};ht.prototype.getAll=function(){return this.filter(function(t){return t})};ht.prototype.forEach=function(t){var e=this._elements;Object.keys(e).forEach(function(n){var i=e[n],r=i.element,o=i.gfx;return t(r,o)})};ht.prototype.getGraphics=function(t,e){var n=t.id||t,i=this._elements[n];return i&&(e?i.secondaryGfx:i.gfx)};ht.prototype._validateId=function(t){if(!t)throw new Error("element must have an id");if(this._elements[t])throw new Error("element with id "+t+" already added")};var la=new Be({name:"children",enumerable:!0,collection:!0},{name:"parent"}),fa=new Be({name:"labels",enumerable:!0,collection:!0},{name:"labelTarget"}),Rr=new Be({name:"attachers",collection:!0},{name:"host"}),ha=new Be({name:"outgoing",collection:!0},{name:"source"}),da=new Be({name:"incoming",collection:!0},{name:"target"});function Ue(){Object.defineProperty(this,"businessObject",{writable:!0}),Object.defineProperty(this,"label",{get:function(){return this.labels[0]},set:function(t){var e=this.label,n=this.labels;!t&&e?n.remove(e):n.add(t,0)}}),la.bind(this,"parent"),fa.bind(this,"labels"),ha.bind(this,"outgoing"),da.bind(this,"incoming")}function ye(){Ue.call(this),la.bind(this,"children"),Rr.bind(this,"host"),Rr.bind(this,"attachers")}lt(ye,Ue);function pa(){ye.call(this)}lt(pa,ye);function ga(){ye.call(this),fa.bind(this,"labelTarget")}lt(ga,ye);function va(){Ue.call(this),ha.bind(this,"source"),da.bind(this,"target")}lt(va,Ue);var hc={connection:va,shape:ye,label:ga,root:pa};function dc(t,e){var n=hc[t];if(!n)throw new Error("unknown type: <"+t+">");return M(new n,e)}function _e(){this._uid=12}_e.prototype.createRoot=function(t){return this.create("root",t)};_e.prototype.createLabel=function(t){return this.create("label",t)};_e.prototype.createShape=function(t){return this.create("shape",t)};_e.prototype.createConnection=function(t){return this.create("connection",t)};_e.prototype.create=function(t,e){return e=M({},e||{}),e.id||(e.id=t+"_"+this._uid++),dc(t,e)};var Mn="__fn",ya=1e3,pc=Array.prototype.slice;function ft(){this._listeners={},this.on("diagram.destroy",1,this._destroy,this)}ft.prototype.on=function(t,e,n,i){if(t=N(t)?t:[t],st(e)&&(i=n,n=e,e=ya),!I(e))throw new Error("priority must be a number");var r=n;i&&(r=Ge(n,i),r[Mn]=n[Mn]||n);var o=this;t.forEach(function(a){o._addListener(a,{priority:e,callback:r,next:null})})};ft.prototype.once=function(t,e,n,i){var r=this;if(st(e)&&(i=n,n=e,e=ya),!I(e))throw new Error("priority must be a number");function o(){o.__isTomb=!0;var a=n.apply(i,arguments);return r.off(t,o),a}o[Mn]=n,this.on(t,e,o)};ft.prototype.off=function(t,e){t=N(t)?t:[t];var n=this;t.forEach(function(i){n._removeListener(i,e)})};ft.prototype.createEvent=function(t){var e=new Fe;return e.init(t),e};ft.prototype.fire=function(t,e){var n,i,r,o;if(o=pc.call(arguments),typeof t=="object"&&(e=t,t=e.type),!t)throw new Error("no event type specified");if(i=this._listeners[t],!!i){e instanceof Fe?n=e:n=this.createEvent(e),o[0]=n;var a=n.type;t!==a&&(n.type=t);try{r=this._invokeListeners(n,o,i)}finally{t!==a&&(n.type=a)}return r===void 0&&n.defaultPrevented&&(r=!1),r}};ft.prototype.handleError=function(t){return this.fire("error",{error:t})===!1};ft.prototype._destroy=function(){this._listeners={}};ft.prototype._invokeListeners=function(t,e,n){for(var i;n&&!t.cancelBubble;)i=this._invokeListener(t,e,n),n=n.next;return i};ft.prototype._invokeListener=function(t,e,n){var i;if(n.callback.__isTomb)return i;try{i=gc(n.callback,e),i!==void 0&&(t.returnValue=i,t.stopPropagation()),i===!1&&t.preventDefault()}catch(r){if(!this.handleError(r))throw console.error("unhandled error in event listener",r),r}return i};ft.prototype._addListener=function(t,e){var n=this._getListeners(t),i;if(!n){this._setListeners(t,e);return}for(;n;){if(n.priority<e.priority){e.next=n,i?i.next=e:this._setListeners(t,e);return}i=n,n=n.next}i.next=e};ft.prototype._getListeners=function(t){return this._listeners[t]};ft.prototype._setListeners=function(t,e){this._listeners[t]=e};ft.prototype._removeListener=function(t,e){var n=this._getListeners(t),i,r,o;if(!e){this._setListeners(t,null);return}for(;n;)i=n.next,o=n.callback,(o===e||o[Mn]===e)&&(r?r.next=i:this._setListeners(t,i)),r=n,n=i};function Fe(){}Fe.prototype.stopPropagation=function(){this.cancelBubble=!0};Fe.prototype.preventDefault=function(){this.defaultPrevented=!0};Fe.prototype.init=function(t){M(this,t||{})};function gc(t,e){return t.apply(null,e)}function Tn(t){return t.childNodes[0]}function vc(t){return t.parentNode.childNodes[1]}function yc(t,e,n,i,r){var o=Ae();o.setTranslate(e,n);var a=Ae();a.setRotate(i||0,0,0);var s=Ae();s.setScale(r||1,r||1),De(t,[o,a,s])}function gt(t,e,n){var i=Ae();i.setTranslate(e,n),De(t,i)}function _c(t,e){var n=Ae();n.setRotate(e,0,0),De(t,n)}function dt(t,e){this._eventBus=t,this._elementRegistry=e}dt.$inject=["eventBus","elementRegistry"];dt.prototype._getChildrenContainer=function(t){var e=this._elementRegistry.getGraphics(t),n;return t.parent?(n=vc(e),n||(n=$("g"),H(n).add("djs-children"),D(e.parentNode,n))):n=e,n};dt.prototype._clear=function(t){var e=Tn(t);return $n(e),e};dt.prototype._createContainer=function(t,e,n,i){var r=$("g");H(r).add("djs-group"),typeof n<"u"?_a(r,e,e.childNodes[n]):D(e,r);var o=$("g");H(o).add("djs-element"),H(o).add("djs-"+t),i&&H(o).add("djs-frame"),D(r,o);var a=$("g");return H(a).add("djs-visual"),D(o,a),o};dt.prototype.create=function(t,e,n){var i=this._getChildrenContainer(e.parent);return this._createContainer(t,i,n,aa(e))};dt.prototype.updateContainments=function(t){var e=this,n=this._elementRegistry,i;i=de(t,function(r,o){return o.parent&&(r[o.parent.id]=o.parent),r},{}),m(i,function(r){var o=r.children;if(!!o){var a=e._getChildrenContainer(r);m(o.slice().reverse(),function(s){var c=n.getGraphics(s);_a(c.parentNode,a)})}})};dt.prototype.drawShape=function(t,e){var n=this._eventBus;return n.fire("render.shape",{gfx:t,element:e})};dt.prototype.getShapePath=function(t){var e=this._eventBus;return e.fire("render.getShapePath",t)};dt.prototype.drawConnection=function(t,e){var n=this._eventBus;return n.fire("render.connection",{gfx:t,element:e})};dt.prototype.getConnectionPath=function(t){var e=this._eventBus;return e.fire("render.getConnectionPath",t)};dt.prototype.update=function(t,e,n){if(!!e.parent){var i=this._clear(n);if(t==="shape")this.drawShape(i,e),gt(n,e.x,e.y);else if(t==="connection")this.drawConnection(i,e);else throw new Error("unknown type: "+t);e.hidden?P(n,"display","none"):P(n,"display","block")}};dt.prototype.remove=function(t){var e=this._elementRegistry.getGraphics(t);K(e.parentNode)};function _a(t,e,n){var i=n||e.firstChild;t!==i&&e.insertBefore(t,i)}var mc={__depends__:[qs],__init__:["canvas"],canvas:["type",k],elementRegistry:["type",ht],elementFactory:["type",_e],eventBus:["type",ft],graphicsFactory:["type",dt]};function xc(t){var e=new $s(t);return e.init(),e}function Ec(t){t=t||{};var e={config:["value",t]},n=[e,mc].concat(t.modules||[]);return xc(n)}function ma(t,e){this.injector=e=e||Ec(t),this.get=e.get,this.invoke=e.invoke,this.get("eventBus").fire("diagram.init")}ma.prototype.destroy=function(){this.get("eventBus").fire("diagram.destroy")};ma.prototype.clear=function(){this.get("eventBus").fire("diagram.clear")};var wc=0,Sc={width:150,height:50};function Cc(t){var e=t.split("-");return{horizontal:e[0]||"center",vertical:e[1]||"top"}}function Rc(t){return xt(t)?M({top:0,left:0,right:0,bottom:0},t):{top:t,left:t,right:t,bottom:t}}function bc(t,e){e.textContent=t;var n;try{var i,r=t==="";return e.textContent=r?"dummy":t,n=e.getBBox(),i={width:n.width+n.x*2,height:n.height},r&&(i.width=0),i}catch{return{width:0,height:0}}}function Mc(t,e,n){for(var i=t.shift(),r=i,o;;){if(o=bc(r,n),o.width=r?o.width:0,r===" "||r===""||o.width<Math.round(e)||r.length<2)return Tc(t,r,i,o);r=Oc(r,o.width,e)}}function Tc(t,e,n,i){if(e.length<n.length){var r=n.slice(e.length).trim();t.unshift(r)}return{width:i.width,height:i.height,text:e}}var br="\xAD";function Pc(t,e){var n=t.split(/(\s|-|\u00AD)/g),i,r=[],o=0;if(n.length>1)for(;i=n.shift();)if(i.length+o<e)r.push(i),o+=i.length;else{(i==="-"||i===br)&&r.pop();break}var a=r[r.length-1];return a&&a===br&&(r[r.length-1]="-"),r.join("")}function Oc(t,e,n){var i=Math.max(t.length*(n/e),1),r=Pc(t,i);return r||(r=t.slice(0,Math.max(Math.round(i-1),1))),r}function Lc(){var t=document.getElementById("helper-svg");return t||(t=$("svg"),P(t,{id:"helper-svg"}),Et(t,{visibility:"hidden",position:"fixed",width:0,height:0}),document.body.appendChild(t)),t}function Fi(t){this._config=M({},{size:Sc,padding:wc,style:{},align:"center-top"},t||{})}Fi.prototype.createText=function(t,e){return this.layoutText(t,e).element};Fi.prototype.getDimensions=function(t,e){return this.layoutText(t,e).dimensions};Fi.prototype.layoutText=function(t,e){var n=M({},this._config.size,e.box),i=M({},this._config.style,e.style),r=Cc(e.align||this._config.align),o=Rc(e.padding!==void 0?e.padding:this._config.padding),a=e.fitBox||!1,s=Ic(i),c=t.split(/\u00AD?\r?\n/),u=[],l=n.width-o.left-o.right,f=$("text");P(f,{x:0,y:0}),P(f,i);var h=Lc();for(D(h,f);c.length;)u.push(Mc(c,l,f));r.vertical==="middle"&&(o.top=o.bottom=0);var d=de(u,function(S,v,y){return S+(s||v.height)},0)+o.top+o.bottom,p=de(u,function(S,v,y){return v.width>S?v.width:S},0),_=o.top;r.vertical==="middle"&&(_+=(n.height-d)/2),_-=(s||u[0].height)/4;var g=$("text");P(g,i),m(u,function(S){var v;switch(_+=s||S.height,r.horizontal){case"left":v=o.left;break;case"right":v=(a?p:l)-o.right-S.width;break;default:v=Math.max(((a?p:l)-S.width)/2+o.left,0)}var y=$("tspan");P(y,{x:v,y:_}),y.textContent=S.text,D(g,y)}),K(f);var b={width:p,height:d};return{dimensions:b,element:g}};function Ic(t){if("fontSize"in t&&"lineHeight"in t)return t.lineHeight*parseInt(t.fontSize,10)}function kc(t,e){return e=e||{},t.replace(/{([^}]+)}/g,function(n,i){return e[i]||"{"+i+"}"})}var Wh={translate:["value",kc]};function Mr(t){!t||typeof t.stopPropagation!="function"||t.stopPropagation()}function me(t){return t.originalEvent||t.srcEvent}function ai(t,e){Mr(t),Mr(me(t))}function zt(t){return t.pointers&&t.pointers.length&&(t=t.pointers[0]),t.touches&&t.touches.length&&(t=t.touches[0]),t?{x:t.clientX,y:t.clientY}:null}function Ac(){return/mac/i.test(navigator.platform)}function xa(t,e){return(me(t)||t).button===e}function Vt(t){return xa(t,0)}function $c(t){return xa(t,1)}function Pn(t){var e=me(t)||t;return Vt(t)?Ac()?e.metaKey:e.ctrlKey:!1}function Ea(t){var e=me(t)||t;return Vt(t)&&e.shiftKey}function Dc(t){return!0}function sn(t){return Vt(t)||$c(t)}var Tr=500;function wa(t,e,n){var i=this;function r(w,C,R){if(!s(w,C)){var T,z,U;R?z=e.getGraphics(R):(T=C.delegateTarget||C.target,T&&(z=T,R=e.get(z))),!(!z||!R)&&(U=t.fire(w,{element:R,gfx:z,originalEvent:C}),U===!1&&(C.stopPropagation(),C.preventDefault()))}}var o={};function a(w){return o[w]}function s(w,C){var R=u[w]||Vt;return!R(C)}var c={click:"element.click",contextmenu:"element.contextmenu",dblclick:"element.dblclick",mousedown:"element.mousedown",mousemove:"element.mousemove",mouseover:"element.hover",mouseout:"element.out",mouseup:"element.mouseup"},u={"element.contextmenu":Dc,"element.mousedown":sn,"element.mouseup":sn,"element.click":sn,"element.dblclick":sn};function l(w,C,R){var T=c[w];if(!T)throw new Error("unmapped DOM event name <"+w+">");return r(T,C,R)}var f="svg, .djs-element";function h(w,C,R,T){var z=o[R]=function(U){r(R,U)};T&&(u[R]=T),z.$delegate=yt.bind(w,f,C,z)}function d(w,C,R){var T=a(R);!T||yt.unbind(w,C,T.$delegate)}function p(w){m(c,function(C,R){h(w,R,C)})}function _(w){m(c,function(C,R){d(w,R,C)})}t.on("canvas.destroy",function(w){_(w.svg)}),t.on("canvas.init",function(w){p(w.svg)}),t.on(["shape.added","connection.added"],function(w){var C=w.element,R=w.gfx;t.fire("interactionEvents.createHit",{element:C,gfx:R})}),t.on(["shape.changed","connection.changed"],Tr,function(w){var C=w.element,R=w.gfx;t.fire("interactionEvents.updateHit",{element:C,gfx:R})}),t.on("interactionEvents.createHit",Tr,function(w){var C=w.element,R=w.gfx;i.createDefaultHit(C,R)}),t.on("interactionEvents.updateHit",function(w){var C=w.element,R=w.gfx;i.updateDefaultHit(C,R)});var g=x("djs-hit djs-hit-stroke"),b=x("djs-hit djs-hit-click-stroke"),S=x("djs-hit djs-hit-all"),v=x("djs-hit djs-hit-no-move"),y={all:S,"click-stroke":b,stroke:g,"no-move":v};function x(w,C){return C=M({stroke:"white",strokeWidth:15},C||{}),n.cls(w,["no-fill","no-border"],C)}function E(w,C){var R=y[C];if(!R)throw new Error("invalid hit type <"+C+">");return P(w,R),w}function O(w,C){D(w,C)}this.removeHits=function(w){var C=_i(".djs-hit",w);m(C,K)},this.createDefaultHit=function(w,C){var R=w.waypoints,T=w.isFrame,z;return R?this.createWaypointsHit(C,R):(z=T?"stroke":"all",this.createBoxHit(C,z,{width:w.width,height:w.height}))},this.createWaypointsHit=function(w,C){var R=Bi(C);return E(R,"stroke"),O(w,R),R},this.createBoxHit=function(w,C,R){R=M({x:0,y:0},R);var T=$("rect");return E(T,C),P(T,R),O(w,T),T},this.updateDefaultHit=function(w,C){var R=Q(".djs-hit",C);if(!!R)return w.waypoints?ea(R,w.waypoints):P(R,{width:w.width,height:w.height}),R},this.fire=r,this.triggerMouseEvent=l,this.mouseHandler=a,this.registerEvent=h,this.unregisterEvent=d}wa.$inject=["eventBus","elementRegistry","styles"];var jn={__init__:["interactionEvents"],interactionEvents:["type",wa]},jc=500;function Hn(t,e,n){this.offset=6;var i=e.cls("djs-outline",["no-fill"]),r=this;function o(a,s){var c=$("rect");return P(c,M({x:10,y:10,rx:4,width:100,height:100},i)),D(a,c),c}t.on(["shape.added","shape.changed"],jc,function(a){var s=a.element,c=a.gfx,u=Q(".djs-outline",c);u||(u=o(c)),r.updateShapeOutline(u,s)}),t.on(["connection.added","connection.changed"],function(a){var s=a.element,c=a.gfx,u=Q(".djs-outline",c);u||(u=o(c)),r.updateConnectionOutline(u,s)})}Hn.prototype.updateShapeOutline=function(t,e){P(t,{x:-this.offset,y:-this.offset,width:e.width+this.offset*2,height:e.height+this.offset*2})};Hn.prototype.updateConnectionOutline=function(t,e){var n=q(e);P(t,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+this.offset*2,height:n.height+this.offset*2})};Hn.$inject=["eventBus","styles","elementRegistry"];var Sa={__init__:["outline"],outline:["type",Hn]};function xe(t,e){this._eventBus=t,this._canvas=e,this._selectedElements=[];var n=this;t.on(["shape.remove","connection.remove"],function(i){var r=i.element;n.deselect(r)}),t.on(["diagram.clear","root.set"],function(i){n.select(null)})}xe.$inject=["eventBus","canvas"];xe.prototype.deselect=function(t){var e=this._selectedElements,n=e.indexOf(t);if(n!==-1){var i=e.slice();e.splice(n,1),this._eventBus.fire("selection.changed",{oldSelection:i,newSelection:e})}};xe.prototype.get=function(){return this._selectedElements};xe.prototype.isSelected=function(t){return this._selectedElements.indexOf(t)!==-1};xe.prototype.select=function(t,e){var n=this._selectedElements,i=n.slice();N(t)||(t=t?[t]:[]);var r=this._canvas,o=r.getRootElement();t=t.filter(function(a){var s=r.findRoot(a);return o===s}),e?m(t,function(a){n.indexOf(a)===-1&&n.push(a)}):this._selectedElements=n=t.slice(),this._eventBus.fire("selection.changed",{oldSelection:i,newSelection:n})};var Pr="hover",Or="selected",cn=6;function Ki(t,e,n){this._canvas=t;var i=this;this._multiSelectionBox=null;function r(a,s){t.addMarker(a,s)}function o(a,s){t.removeMarker(a,s)}e.on("element.hover",function(a){r(a.element,Pr)}),e.on("element.out",function(a){o(a.element,Pr)}),e.on("selection.changed",function(a){function s(f){o(f,Or)}function c(f){r(f,Or)}var u=a.oldSelection,l=a.newSelection;m(u,function(f){l.indexOf(f)===-1&&s(f)}),m(l,function(f){u.indexOf(f)===-1&&c(f)}),i._updateSelectionOutline(l)}),e.on("element.changed",function(a){n.isSelected(a.element)&&i._updateSelectionOutline(n.get())})}Ki.$inject=["canvas","eventBus","selection"];Ki.prototype._updateSelectionOutline=function(t){var e=this._canvas.getLayer("selectionOutline");$i(e);var n=t.length>1,i=this._canvas.getContainer();if(H(i)[n?"add":"remove"]("djs-multi-select"),!!n){var r=Hc(q(t)),o=$("rect");P(o,M({rx:3},r)),H(o).add("djs-selection-outline"),D(e,o)}};function Hc(t){return{x:t.x-cn,y:t.y-cn,width:t.width+cn*2,height:t.height+cn*2}}function Ca(t,e,n,i){t.on("create.end",500,function(r){var o=r.context,a=o.canExecute,s=o.elements,c=o.hints||{},u=c.autoSelect;if(a){if(u===!1)return;N(u)?e.select(u):e.select(s.filter(Nc))}}),t.on("connect.end",500,function(r){var o=r.context,a=o.connection;a&&e.select(a)}),t.on("shape.move.end",500,function(r){var o=r.previousSelection||[],a=i.get(r.context.shape.id),s=nt(o,function(c){return a.id===c.id});s||e.select(a)}),t.on("element.click",function(r){if(!!Vt(r)){var o=r.element;o===n.getRootElement()&&(o=null);var a=e.isSelected(o),s=e.get().length>1,c=Pn(r)||Ea(r);if(a&&s)return c?e.deselect(o):e.select(o);a?e.deselect(o):e.select(o,c)}})}Ca.$inject=["eventBus","selection","canvas","elementRegistry"];function Nc(t){return!t.hidden}var Ee={__init__:["selectionVisuals","selectionBehavior"],__depends__:[jn,Sa],selection:["type",xe],selectionVisuals:["type",Ki],selectionBehavior:["type",Ca]};function Yi(t){this._counter=0,this._prefix=(t?t+"-":"")+Math.floor(Math.random()*1e9)+"-"}Yi.prototype.next=function(){return this._prefix+ ++this._counter};var zc=new Yi("ov"),Gc=500;function J(t,e,n,i){this._eventBus=e,this._canvas=n,this._elementRegistry=i,this._ids=zc,this._overlayDefaults=M({show:null,scale:!0},t&&t.defaults),this._overlays={},this._overlayContainers=[],this._overlayRoot=Bc(n.getContainer()),this._init()}J.$inject=["config.overlays","eventBus","canvas","elementRegistry"];J.prototype.get=function(t){if(je(t)&&(t={id:t}),je(t.element)&&(t.element=this._elementRegistry.get(t.element)),t.element){var e=this._getOverlayContainer(t.element,!0);return e?t.type?at(e.overlays,Dt({type:t.type})):e.overlays.slice():[]}else return t.type?at(this._overlays,Dt({type:t.type})):t.id?this._overlays[t.id]:null};J.prototype.add=function(t,e,n){if(xt(e)&&(n=e,e=null),t.id||(t=this._elementRegistry.get(t)),!n.position)throw new Error("must specifiy overlay position");if(!n.html)throw new Error("must specifiy overlay html");if(!t)throw new Error("invalid element specified");var i=this._ids.next();return n=M({},this._overlayDefaults,n,{id:i,type:e,element:t,html:n.html}),this._addOverlay(n),i};J.prototype.remove=function(t){var e=this.get(t)||[];N(e)||(e=[e]);var n=this;m(e,function(i){var r=n._getOverlayContainer(i.element,!0);if(i&&(pe(i.html),pe(i.htmlContainer),delete i.htmlContainer,delete i.element,delete n._overlays[i.id]),r){var o=r.overlays.indexOf(i);o!==-1&&r.overlays.splice(o,1)}})};J.prototype.isShown=function(){return this._overlayRoot.style.display!=="none"};J.prototype.show=function(){Nn(this._overlayRoot)};J.prototype.hide=function(){Nn(this._overlayRoot,!1)};J.prototype.clear=function(){this._overlays={},this._overlayContainers=[],$n(this._overlayRoot)};J.prototype._updateOverlayContainer=function(t){var e=t.element,n=t.html,i=e.x,r=e.y;if(e.waypoints){var o=q(e);i=o.x,r=o.y}Ra(n,i,r),ot(t.html,"data-container-id",e.id)};J.prototype._updateOverlay=function(t){var e=t.position,n=t.htmlContainer,i=t.element,r=e.left,o=e.top;if(e.right!==void 0){var a;i.waypoints?a=q(i).width:a=i.width,r=e.right*-1+a}if(e.bottom!==void 0){var s;i.waypoints?s=q(i).height:s=i.height,o=e.bottom*-1+s}Ra(n,r||0,o||0),this._updateOverlayVisibilty(t,this._canvas.viewbox())};J.prototype._createOverlayContainer=function(t){var e=Y('<div class="djs-overlays" />');Et(e,{position:"absolute"}),this._overlayRoot.appendChild(e);var n={html:e,element:t,overlays:[]};return this._updateOverlayContainer(n),this._overlayContainers.push(n),n};J.prototype._updateRoot=function(t){var e=t.scale||1,n="matrix("+[e,0,0,e,-1*t.x*e,-1*t.y*e].join(",")+")";ba(this._overlayRoot,n)};J.prototype._getOverlayContainer=function(t,e){var n=nt(this._overlayContainers,function(i){return i.element===t});return!n&&!e?this._createOverlayContainer(t):n};J.prototype._addOverlay=function(t){var e=t.id,n=t.element,i=t.html,r,o;i.get&&i.constructor.prototype.jquery&&(i=i.get(0)),je(i)&&(i=Y(i)),o=this._getOverlayContainer(n),r=Y('<div class="djs-overlay" data-overlay-id="'+e+'">'),Et(r,{position:"absolute"}),r.appendChild(i),t.type&&it(r).add("djs-overlay-"+t.type);var a=this._canvas.findRoot(n),s=this._canvas.getRootElement();Nn(r,a===s),t.htmlContainer=r,o.overlays.push(t),o.html.appendChild(r),this._overlays[e]=t,this._updateOverlay(t),this._updateOverlayVisibilty(t,this._canvas.viewbox())};J.prototype._updateOverlayVisibilty=function(t,e){var n=t.show,i=this._canvas.findRoot(t.element),r=n&&n.minZoom,o=n&&n.maxZoom,a=t.htmlContainer,s=this._canvas.getRootElement(),c=!0;(i!==s||n&&(et(r)&&r>e.scale||et(o)&&o<e.scale))&&(c=!1),Nn(a,c),this._updateOverlayScale(t,e)};J.prototype._updateOverlayScale=function(t,e){var n=t.scale,i,r,o=t.htmlContainer,a,s="";n!==!0&&(n===!1?(i=1,r=1):(i=n.min,r=n.max),et(i)&&e.scale<i&&(a=(1/e.scale||1)*i),et(r)&&e.scale>r&&(a=(1/e.scale||1)*r)),et(a)&&(s="scale("+a+","+a+")"),ba(o,s)};J.prototype._updateOverlaysVisibilty=function(t){var e=this;m(this._overlays,function(n){e._updateOverlayVisibilty(n,t)})};J.prototype._init=function(){var t=this._eventBus,e=this;function n(i){e._updateRoot(i),e._updateOverlaysVisibilty(i),e.show()}t.on("canvas.viewbox.changing",function(i){e.hide()}),t.on("canvas.viewbox.changed",function(i){n(i.viewbox)}),t.on(["shape.remove","connection.remove"],function(i){var r=i.element,o=e.get({element:r});m(o,function(c){e.remove(c.id)});var a=e._getOverlayContainer(r);if(a){pe(a.html);var s=e._overlayContainers.indexOf(a);s!==-1&&e._overlayContainers.splice(s,1)}}),t.on("element.changed",Gc,function(i){var r=i.element,o=e._getOverlayContainer(r,!0);o&&(m(o.overlays,function(a){e._updateOverlay(a)}),e._updateOverlayContainer(o))}),t.on("element.marker.update",function(i){var r=e._getOverlayContainer(i.element,!0);r&&it(r.html)[i.add?"add":"remove"](i.marker)}),t.on("root.set",function(){e._updateOverlaysVisibilty(e._canvas.viewbox())}),t.on("diagram.clear",this.clear,this)};function Bc(t){var e=Y('<div class="djs-overlay-container" />');return Et(e,{position:"absolute",width:0,height:0}),t.insertBefore(e,t.firstChild),e}function Ra(t,e,n){Et(t,{left:e+"px",top:n+"px"})}function Nn(t,e){t.style.display=e===!1?"none":""}function ba(t,e){t.style["transform-origin"]="top left",["","-ms-","-webkit-"].forEach(function(n){t.style[n+"transform"]=e})}var Ma={__init__:["overlays"],overlays:["type",J]};function Ta(t,e,n,i){t.on("element.changed",function(r){var o=r.element;(o.parent||o===e.getRootElement())&&(r.gfx=n.getGraphics(o)),r.gfx&&t.fire(oa(o)+".changed",r)}),t.on("elements.changed",function(r){var o=r.elements;o.forEach(function(a){t.fire("element.changed",{element:a})}),i.updateContainments(o)}),t.on("shape.changed",function(r){i.update("shape",r.element,r.gfx)}),t.on("connection.changed",function(r){i.update("connection",r.element,r.gfx)})}Ta.$inject=["eventBus","canvas","elementRegistry","graphicsFactory"];var Uh={__init__:["changeSupport"],changeSupport:["type",Ta]},Vc=1e3;function rt(t){this._eventBus=t}rt.$inject=["eventBus"];function Wc(t,e){return function(n){return t.call(e||null,n.context,n.command,n)}}rt.prototype.on=function(t,e,n,i,r,o){if((st(e)||I(e))&&(o=r,r=i,i=n,n=e,e=null),st(n)&&(o=r,r=i,i=n,n=Vc),xt(r)&&(o=r,r=!1),!st(i))throw new Error("handlerFn must be a function");N(t)||(t=[t]);var a=this._eventBus;m(t,function(s){var c=["commandStack",s,e].filter(function(u){return u}).join(".");a.on(c,n,r?Wc(i,o):i,o)})};var Uc=["canExecute","preExecute","preExecuted","execute","executed","postExecute","postExecuted","revert","reverted"];m(Uc,function(t){rt.prototype[t]=function(e,n,i,r,o){(st(e)||I(e))&&(o=r,r=i,i=n,n=e,e=null),this.on(e,t,n,i,r,o)}});function Zi(t,e){e.invoke(rt,this),this.executed(function(n){var i=n.context;i.rootElement?t.setRootElement(i.rootElement):i.rootElement=t.getRootElement()}),this.revert(function(n){var i=n.context;i.rootElement&&t.setRootElement(i.rootElement)})}lt(Zi,rt);Zi.$inject=["canvas","injector"];var Fh={__init__:["rootElementsBehavior"],rootElementsBehavior:["type",Zi]},Fc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Lr(t){return t=""+t,t&&t.replace(/[&<>"']/g,function(e){return Fc[e]})}var Kc=["c","C"],Yc=["v","V"],Zc=["y","Y"],Pa=["z","Z"];function Xc(t){return t.ctrlKey||t.metaKey||t.shiftKey||t.altKey}function vt(t){return t.altKey?!1:t.ctrlKey||t.metaKey}function X(t,e){return t=N(t)?t:[t],t.indexOf(e.key)!==-1||t.indexOf(e.code)!==-1}function Xi(t){return t.shiftKey}function qc(t){return vt(t)&&X(Kc,t)}function Jc(t){return vt(t)&&X(Yc,t)}function Qc(t){return vt(t)&&!Xi(t)&&X(Pa,t)}function tu(t){return vt(t)&&(X(Zc,t)||X(Pa,t)&&Xi(t))}var zn="keyboard.keydown",eu="keyboard.keyup",Ir="input-handle-modified-keys",nu=1e3;function tt(t,e){var n=this;this._config=t||{},this._eventBus=e,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),e.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),e.on("diagram.init",function(){n._fire("init")}),e.on("attach",function(){t&&t.bindTo&&n.bind(t.bindTo)}),e.on("detach",function(){n.unbind()})}tt.$inject=["config.keyboard","eventBus"];tt.prototype._keydownHandler=function(t){this._keyHandler(t,zn)};tt.prototype._keyupHandler=function(t){this._keyHandler(t,eu)};tt.prototype._keyHandler=function(t,e){var n;if(!this._isEventIgnored(t)){var i={keyEvent:t};n=this._eventBus.fire(e||zn,i),n&&t.preventDefault()}};tt.prototype._isEventIgnored=function(t){return t.defaultPrevented?!0:iu(t.target)&&this._isModifiedKeyIgnored(t)};tt.prototype._isModifiedKeyIgnored=function(t){if(!vt(t))return!0;var e=this._getAllowedModifiers(t.target);return e.indexOf(t.key)===-1};tt.prototype._getAllowedModifiers=function(t){var e=Gt(t,"["+Ir+"]",!0);return!e||this._node&&!this._node.contains(e)?[]:e.getAttribute(Ir).split(",")};tt.prototype.bind=function(t){this.unbind(),this._node=t,j.bind(t,"keydown",this._keydownHandler),j.bind(t,"keyup",this._keyupHandler),this._fire("bind")};tt.prototype.getBinding=function(){return this._node};tt.prototype.unbind=function(){var t=this._node;t&&(this._fire("unbind"),j.unbind(t,"keydown",this._keydownHandler),j.unbind(t,"keyup",this._keyupHandler)),this._node=null};tt.prototype._fire=function(t){this._eventBus.fire("keyboard."+t,{node:this._node})};tt.prototype.addListener=function(t,e,n){st(t)&&(n=e,e=t,t=nu),this._eventBus.on(n||zn,t,e)};tt.prototype.removeListener=function(t,e){this._eventBus.off(e||zn,t)};tt.prototype.hasModifier=Xc;tt.prototype.isCmd=vt;tt.prototype.isShift=Xi;tt.prototype.isKey=X;function iu(t){return t&&(Hi(t,"input, textarea")||t.contentEditable==="true")}var ru=500;function qi(t,e){var n=this;t.on("editorActions.init",ru,function(i){var r=i.editorActions;n.registerBindings(e,r)})}qi.$inject=["eventBus","keyboard"];qi.prototype.registerBindings=function(t,e){function n(i,r){e.isRegistered(i)&&t.addListener(r)}n("undo",function(i){var r=i.keyEvent;if(Qc(r))return e.trigger("undo"),!0}),n("redo",function(i){var r=i.keyEvent;if(tu(r))return e.trigger("redo"),!0}),n("copy",function(i){var r=i.keyEvent;if(qc(r))return e.trigger("copy"),!0}),n("paste",function(i){var r=i.keyEvent;if(Jc(r))return e.trigger("paste"),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(X(["+","Add","="],r)&&vt(r))return e.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(X(["-","Subtract"],r)&&vt(r))return e.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(i){var r=i.keyEvent;if(X("0",r)&&vt(r))return e.trigger("zoom",{value:1}),!0}),n("removeSelection",function(i){var r=i.keyEvent;if(X(["Backspace","Delete","Del"],r))return e.trigger("removeSelection"),!0})};var Oa={__init__:["keyboard","keyboardBindings"],keyboard:["type",tt],keyboardBindings:["type",qi]},ou={moveSpeed:50,moveSpeedAccelerated:200};function La(t,e,n){var i=this;this._config=M({},ou,t||{}),e.addListener(r);function r(o){var a=o.keyEvent,s=i._config;if(!!e.isCmd(a)&&e.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],a)){var c=e.isShift(a)?s.moveSpeedAccelerated:s.moveSpeed,u;switch(a.key){case"ArrowLeft":case"Left":u="left";break;case"ArrowUp":case"Up":u="up";break;case"ArrowRight":case"Right":u="right";break;case"ArrowDown":case"Down":u="down";break}return i.moveCanvas({speed:c,direction:u}),!0}}this.moveCanvas=function(o){var a=0,s=0,c=o.speed,u=c/Math.min(Math.sqrt(n.viewbox().scale),1);switch(o.direction){case"left":a=u;break;case"up":s=u;break;case"right":a=-u;break;case"down":s=-u;break}n.scroll({dx:a,dy:s})}}La.$inject=["config.keyboardMove","keyboard","canvas"];var Kh={__depends__:[Oa],__init__:["keyboardMove"],keyboardMove:["type",La]},au=/^djs-cursor-.*$/;function Gn(t){var e=it(document.body);e.removeMatching(au),t&&e.add("djs-cursor-"+t)}function Ia(){Gn(null)}var su=5e3;function ka(t,e){e=e||"element.click";function n(){return!1}return t.once(e,su,n),function(){t.off(e,n)}}function $e(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function jt(t,e){return{x:t.x-e.x,y:t.y-e.y}}var cu=15;function Aa(t,e){var n;t.on("element.mousedown",500,function(a){return o(a.originalEvent)});function i(a){var s=n.start,c=n.button,u=zt(a),l=jt(u,s);if(!n.dragging&&uu(l)>cu&&(n.dragging=!0,c===0&&ka(t),Gn("grab")),n.dragging){var f=n.last||n.start;l=jt(u,f),e.scroll({dx:l.x,dy:l.y}),n.last=u}a.preventDefault()}function r(a){j.unbind(document,"mousemove",i),j.unbind(document,"mouseup",r),n=null,Ia()}function o(a){if(!Gt(a.target,".djs-draggable")){var s=a.button;if(!(s>=2||a.ctrlKey||a.shiftKey||a.altKey))return n={button:s,start:zt(a)},j.bind(document,"mousemove",i),j.bind(document,"mouseup",r),!0}}this.isActive=function(){return!!n}}Aa.$inject=["eventBus","canvas"];function uu(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}var Yh={__init__:["moveCanvas"],moveCanvas:["type",Aa]};function Si(t){return Math.log(t)/Math.log(10)}function $a(t,e){var n=Si(t.min),i=Si(t.max),r=Math.abs(n)+Math.abs(i);return r/e}function lu(t,e){return Math.max(t.min,Math.min(t.max,e))}var fu=Math.sign||function(t){return t>=0?1:-1},Ji={min:.2,max:4},Da=10,hu=.1,du=.75;function wt(t,e,n){t=t||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=Ge(this._handleWheel,this),this._totalDelta=0,this._scale=t.scale||du;var i=this;e.on("canvas.init",function(r){i._init(t.enabled!==!1)})}wt.$inject=["config.zoomScroll","eventBus","canvas"];wt.prototype.scroll=function(e){this._canvas.scroll(e)};wt.prototype.reset=function(){this._canvas.zoom("fit-viewport")};wt.prototype.zoom=function(e,n){var i=$a(Ji,Da*2);this._totalDelta+=e,Math.abs(this._totalDelta)>hu&&(this._zoom(e,n,i),this._totalDelta=0)};wt.prototype._handleWheel=function(e){if(!Gt(e.target,".djs-scrollable",!0)){var n=this._container;e.preventDefault();var i=e.ctrlKey,r=e.shiftKey,o=-1*this._scale,a;if(i?o*=e.deltaMode===0?.02:.32:o*=e.deltaMode===0?1:16,i){var s=n.getBoundingClientRect(),c={x:e.clientX-s.left,y:e.clientY-s.top};a=Math.sqrt(Math.pow(e.deltaY,2)+Math.pow(e.deltaX,2))*fu(e.deltaY)*o,this.zoom(a,c)}else r?a={dx:o*e.deltaY,dy:0}:a={dx:o*e.deltaX,dy:o*e.deltaY},this.scroll(a)}};wt.prototype.stepZoom=function(e,n){var i=$a(Ji,Da);this._zoom(e,n,i)};wt.prototype._zoom=function(t,e,n){var i=this._canvas,r=t>0?1:-1,o=Si(i.zoom()),a=Math.round(o/n)*n;a+=n*r;var s=Math.pow(10,a);i.zoom(lu(Ji,s),e)};wt.prototype.toggle=function(e){var n=this._container,i=this._handleWheel,r=this._enabled;return typeof e>"u"&&(e=!r),r!==e&&j[e?"bind":"unbind"](n,"wheel",i,!1),this._enabled=e,e};wt.prototype._init=function(t){this.toggle(t)};var Zh={__init__:["zoomScroll"],zoomScroll:["type",wt]},pu=.2,gu=4,kr=["mousedown","mouseup","mouseover","mouseout","click","dblclick"];function un(t,e){return e.get(t,!1)}function Ci(t){t.preventDefault(),typeof t.stopPropagation=="function"?t.stopPropagation():t.srcEvent&&typeof t.srcEvent.stopPropagation=="function"&&t.srcEvent.stopPropagation(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation()}function si(t){function e(u){m(kr,function(l){j.bind(t,l,Ci,!0)})}function n(u){setTimeout(function(){m(kr,function(l){j.unbind(t,l,Ci,!0)})},500)}j.bind(t,"touchstart",e,!0),j.bind(t,"touchend",n,!0),j.bind(t,"touchcancel",n,!0);var i=new Xt.Manager(t,{inputClass:Xt.TouchInput,recognizers:[],domEvents:!0}),r=new Xt.Tap,o=new Xt.Pan({threshold:10}),a=new Xt.Press,s=new Xt.Pinch,c=new Xt.Tap({event:"doubletap",taps:2});return s.requireFailure(o),s.requireFailure(a),i.add([o,a,s,c,r]),i.reset=function(u){var l=this.recognizers,f=this.session;f.stopped||(i.stop(u),setTimeout(function(){var h,d;for(h=0;d=l[h];h++)d.reset(),d.state=8;f.curRecognizer=null},0))},i.on("hammer.input",function(u){u.srcEvent.defaultPrevented&&i.reset(!0)}),i}function ja(t,e,n,i,r){var o=un("dragging",t),a=un("move",t),s=un("contextPad",t),c=un("palette",t),u;function l(d,p){return function(_){var g=f(_.target),b=g&&i.get(g);return p&&(_.srcEvent.button=p),r.fire(d,_,b)}}function f(d){var p=Gt(d,"svg, .djs-element",!0);return p}function h(d){u=si(d);function p(b){var S=0,v=0;function y(E){var O=E.deltaX-S,w=E.deltaY-v;e.scroll({dx:O,dy:w}),S=E.deltaX,v=E.deltaY}function x(E){u.off("panmove",y),u.off("panend",x),u.off("pancancel",x)}u.on("panmove",y),u.on("panend",x),u.on("pancancel",x)}function _(b){var S=f(b.target),v=S&&i.get(S);if(a&&e.getRootElement()!==v)return a.start(b,v,!0);p()}function g(b){var S=e.zoom(),v=b.center;function y(E){var O=1-(1-E.scale)/1.5,w=Math.max(pu,Math.min(gu,O*S));e.zoom(w,v),Ci(E)}function x(E){u.off("pinchmove",y),u.off("pinchend",x),u.off("pinchcancel",x),u.reset(!0)}u.on("pinchmove",y),u.on("pinchend",x),u.on("pinchcancel",x)}u.on("tap",l("element.click")),u.on("doubletap",l("element.dblclick",1)),u.on("panstart",_),u.on("press",_),u.on("pinchstart",g)}o&&n.on("drag.move",function(d){var p=d.originalEvent;if(!(!p||p instanceof MouseEvent)){var _=zt(p),g=document.elementFromPoint(_.x,_.y),b=f(g),S=b&&i.get(b);S!==d.hover&&(d.hover&&o.out(d),S&&(o.hover({element:S,gfx:b}),d.hover=S,d.hoverGfx=b))}}),s&&n.on("contextPad.create",function(d){var p=d.pad.html,_=si(p);_.on("panstart",function(g){s.trigger("dragstart",g,!0)}),_.on("press",function(g){s.trigger("dragstart",g,!0)}),_.on("tap",function(g){s.trigger("click",g)})}),c&&n.on("palette.create",function(d){var p=d.container,_=si(p);_.on("panstart",function(g){c.trigger("dragstart",g,!0)}),_.on("press",function(g){c.trigger("dragstart",g,!0)}),_.on("tap",function(g){c.trigger("click",g)})}),n.on("canvas.init",function(d){h(d.svg)})}ja.$inject=["injector","canvas","eventBus","elementRegistry","interactionEvents","touchFix"];function Qi(t,e){var n=this;e.on("canvas.init",function(i){n.addBBoxMarker(i.svg)})}Qi.$inject=["canvas","eventBus"];Qi.prototype.addBBoxMarker=function(t){var e={fill:"none",class:"outer-bound-marker"},n=$("rect");P(n,{x:-1e4,y:1e4,width:10,height:10}),P(n,e),D(t,n);var i=$("rect");P(i,{x:1e4,y:1e4,width:10,height:10}),P(i,e),D(t,i)};var vu={__depends__:[jn],__init__:["touchInteractionEvents"],touchInteractionEvents:["type",ja],touchFix:["type",Qi]},Xh={__depends__:[vu]};function ci(t){return t&&t[t.length-1]}function Ar(t){return t.y}function $r(t){return t.x}var yu={left:$r,center:$r,right:function(t){return t.x+t.width},top:Ar,middle:Ar,bottom:function(t){return t.y+t.height}};function we(t,e){this._modeling=t,this._rules=e}we.$inject=["modeling","rules"];we.prototype._getOrientationDetails=function(t){var e=["top","bottom","middle"],n="x",i="width";return e.indexOf(t)!==-1&&(n="y",i="height"),{axis:n,dimension:i}};we.prototype._isType=function(t,e){return e.indexOf(t)!==-1};we.prototype._alignmentPosition=function(t,e){var n=this._getOrientationDetails(t),i=n.axis,r=n.dimension,o={},a={},s=!1,c,u,l;function f(h,d){return Math.round((h[i]+d[i]+d[r])/2)}if(this._isType(t,["left","top"]))o[t]=e[0][i];else if(this._isType(t,["right","bottom"]))l=ci(e),o[t]=l[i]+l[r];else if(this._isType(t,["center","middle"])){if(m(e,function(h){var d=h[i]+Math.round(h[r]/2);a[d]?a[d].elements.push(h):a[d]={elements:[h],center:d}}),c=Nt(a,function(h){return h.elements.length>1&&(s=!0),h.elements.length}),s)return o[t]=ci(c).center,o;u=e[0],e=Nt(e,function(h){return h[i]+h[r]}),l=ci(e),o[t]=f(u,l)}return o};we.prototype.trigger=function(t,e){var n=this._modeling,i,r=at(t,function(c){return!(c.waypoints||c.host||c.labelTarget)});if(i=this._rules.allowed("elements.align",{elements:r}),N(i)&&(r=i),!(r.length<2||!i)){var o=yu[e],a=Nt(r,o),s=this._alignmentPosition(e,a);n.alignElements(a,s)}};var qh={__init__:["alignElements"],alignElements:["type",we]},Dr=".entry",_u=1e3,jr=12;function ct(t,e,n,i){this._canvas=t,this._eventBus=n,this._overlays=i;var r=et(e&&e.scale)?e.scale:{min:1,max:1.5};this._overlaysConfig={scale:r},this._current=null,this._init()}ct.$inject=["canvas","config.contextPad","eventBus","overlays"];ct.prototype._init=function(){var t=this;this._eventBus.on("selection.changed",function(e){var n=e.newSelection,i=n.length?n.length===1?n[0]:n:null;i?t.open(i,!0):t.close()}),this._eventBus.on("elements.changed",function(e){var n=e.elements,i=t._current;if(!!i){var r=i.target,o=Jo(N(r)?r:[r],function(a){return Ha(n,a)});o&&t.open(r,!0)}})};ct.prototype.registerProvider=function(t,e){e||(e=t,t=_u),this._eventBus.on("contextPad.getProviders",t,function(n){n.providers.push(e)})};ct.prototype.getEntries=function(t){var e=this._getProviders(),n=N(t)?"getMultiElementContextPadEntries":"getContextPadEntries",i={};return m(e,function(r){if(!!st(r[n])){var o=r[n](t);st(o)?i=o(i):m(o,function(a,s){i[s]=a})}}),i};ct.prototype.trigger=function(t,e,n){var i,r,o=e.delegateTarget||e.target;return o?(i=ot(o,"data-action"),r=e.originalEvent||e,this.triggerEntry(i,t,r,n)):e.preventDefault()};ct.prototype.triggerEntry=function(t,e,n,i){if(!!this.isShown()){var r=this._current.target,o=this._current.entries,a=o[t];if(!!a){var s=a.action;if(st(s)){if(e==="click")return s(n,r,i)}else if(s[e])return s[e](n,r,i);n.preventDefault()}}};ct.prototype.open=function(t,e){!e&&this.isOpen(t)||(this.close(),this._updateAndOpen(t))};ct.prototype._getProviders=function(){var t=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};ct.prototype._updateAndOpen=function(t){var e=this.getEntries(t),n=this.getPad(t),i=n.html,r;m(e,function(o,a){var s=o.group||"default",c=Y(o.html||'<div class="entry" draggable="true"></div>'),u;ot(c,"data-action",a),u=Q("[data-group="+Ni(s)+"]",i),u||(u=Y('<div class="group"></div>'),ot(u,"data-group",s),i.appendChild(u)),u.appendChild(c),o.className&&mu(c,o.className),o.title&&ot(c,"title",o.title),o.imageUrl&&(r=Y("<img>"),ot(r,"src",o.imageUrl),r.style.width="100%",r.style.height="100%",c.appendChild(r))}),it(i).add("open"),this._current={target:t,entries:e,pad:n},this._eventBus.fire("contextPad.open",{current:this._current})};ct.prototype.getPad=function(t){if(this.isOpen())return this._current.pad;var e=this,n=this._overlays,i=Y('<div class="djs-context-pad"></div>'),r=this._getPosition(t),o=M({html:i},this._overlaysConfig,r);yt.bind(i,Dr,"click",function(c){e.trigger("click",c)}),yt.bind(i,Dr,"dragstart",function(c){e.trigger("dragstart",c)}),j.bind(i,"mousedown",function(c){c.stopPropagation()});var a=this._canvas.getRootElement();this._overlayId=n.add(a,"context-pad",o);var s=n.get(this._overlayId);return this._eventBus.fire("contextPad.create",{target:t,pad:s}),s};ct.prototype.close=function(){!this.isOpen()||(this._overlays.remove(this._overlayId),this._overlayId=null,this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};ct.prototype.isOpen=function(t){var e=this._current;if(!e)return!1;if(!t)return!0;var n=e.target;return N(t)!==N(n)?!1:N(t)?t.length===n.length&&Di(t,function(i){return Ha(n,i)}):n===t};ct.prototype.isShown=function(){return this.isOpen()&&this._overlays.isShown()};ct.prototype._getPosition=function(t){var e=N(t)?t:[t],n=q(e);return{position:{left:n.x+n.width+jr,top:n.y-jr/2}}};function mu(t,e){var n=it(t);e=N(e)?e:e.split(/\s+/g),e.forEach(function(i){n.add(i)})}function Ha(t,e){return t.indexOf(e)!==-1}var Jh={__depends__:[jn,Ma],contextPad:["type",ct]};function xu(t){const{entry:e,selected:n,onMouseEnter:i,onMouseLeave:r,onAction:o}=t;return Z`
    <li
      class=${Rn("entry",{selected:n})}
      data-id=${e.id}
      title=${e.title||e.label}
      onClick=${o}
      onMouseEnter=${i}
      onMouseLeave=${r}
      onDragStart=${a=>o(a,e,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${Rn("djs-popup-entry-name",e.className)}
        >
          ${e.imageUrl?Z`
            <img class="djs-popup-entry-icon" src=${e.imageUrl} alt="" />
          `:null}

          ${e.label?Z`
            <span class="djs-popup-label">
              ${e.label}
            </span>
          `:null}
        </span>
        ${e.description&&Z`
          <span
            class="djs-popup-entry-description"
            title=${e.description}
          >
            ${e.description}
          </span>
        `}
      </div>
      ${e.documentationRef&&Z`
        <div class="djs-popup-entry-docs">
          <a
            href="${e.documentationRef}"
            onClick=${a=>a.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function Eu(t){const{selectedEntry:e,setSelectedEntry:n,entries:i,...r}=t,o=zi(),a=mi(()=>wu(i),[i]);return bn(()=>{const s=o.current;if(!s)return;const c=s.querySelector(".selected");c&&Su(c)},[e]),Z`
    <div class="djs-popup-results" ref=${o}>
      ${a.map(s=>Z`
        ${s.name&&Z`
          <div key=${s.id} class="entry-header" title=${s.name}>
            ${s.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${s.id}>
          ${s.entries.map(c=>Z`
            <${xu}
              key=${c.id}
              entry=${c}
              selected=${c===e}
              onMouseEnter=${()=>n(c)}
              onMouseLeave=${()=>n(null)}
              ...${r}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function wu(t){const e=[],n=o=>e.find(a=>o.id===a.id),i=o=>!!n(o),r=o=>typeof o=="string"?{id:o}:o;return t.forEach(o=>{const a=o.group?r(o.group):{id:"default"};i(a)?n(a).entries.push(o):e.push({...a,entries:[o]})}),e}function Su(t){typeof t.scrollIntoViewIfNeeded=="function"?t.scrollIntoViewIfNeeded():t.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function Cu(t){const{onClose:e,onSelect:n,className:i,headerEntries:r,position:o,title:a,width:s,scale:c,search:u,entries:l,onOpened:f,onClosed:h}=t,d=mi(()=>et(u)?l.length>5:!1,[u,l]),p=zi(),[_,g]=ii(""),b=le((T,z)=>{if(!d)return T;const U=on=>{if(!z)return(on.rank||0)>=0;const ks=[on.description||"",on.label||"",on.search||""].join("---").toLowerCase();return z.toLowerCase().split(/\s/g).every(As=>ks.includes(As))};return T.filter(U)},[d]),[S,v]=ii(b(l,_)),[y,x]=ii(S[0]),E=le(T=>{(!y||!T.includes(y))&&x(T[0]),v(T)},[y,v,x]);ri(()=>{E(b(l,_))},[_,l]),ri(()=>{const T=z=>{if(z.key==="Escape")return z.preventDefault(),e()};return document.documentElement.addEventListener("keydown",T),()=>{document.documentElement.removeEventListener("keydown",T)}},[]),bn(()=>{p.current&&p.current.focus()},[]);const O=le(T=>{let U=S.indexOf(y)+T;U<0&&(U=S.length-1),U>=S.length&&(U=0),x(S[U])},[S,y,x]),w=le(T=>{if(T.key==="Enter"&&y)return n(T,y);if(T.key==="ArrowUp"||T.key==="Tab"&&T.shiftKey)return O(-1),T.preventDefault();if(T.key==="ArrowDown"||T.key==="Tab")return O(1),T.preventDefault()},[n,e,y,O]),C=le(T=>{Hi(T.target,"input")&&g(()=>T.target.value)},[g]);ri(()=>(f(),()=>{h()}),[]);const R=mi(()=>a||r.length>0,[a,r]);return Z`
    <${Hr}
      onClose=${e}
      onKeyup=${C}
      onKeydown=${w}
      className=${i}
      position=${o}
      width=${s}
      scale=${c}
    >
      ${R&&Z`
        <div class="djs-popup-header">
          <h3 class="djs-popup-title" title=${a}>${a}</h3>
          ${r.map(T=>Z`
            <span
              class=${bu(T,T===y)}
              onClick=${z=>n(z,T)}
              title=${T.title||T.label}
              data-id=${T.id}
              onMouseEnter=${()=>x(T)}
              onMouseLeave=${()=>x(null)}
            >
              ${T.imageUrl?Z`
                <img class="djs-popup-entry-icon" src=${T.imageUrl} alt="" />
              `:null}

              ${T.label?Z`
                <span class="djs-popup-label">${T.label}</span>
              `:null}
            </span>
          `)}
        </div>
      `}
      ${l.length>0&&Z`
        <div class="djs-popup-body">

          ${d&&Z`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input
                ref=${p}
                type="text"
              />
          </div>
          `}

          <${Eu}
            entries=${S}
            selectedEntry=${y}
            setSelectedEntry=${x}
            onAction=${n}
          />
        </div>
        ${S.length===0&&Z`
          <div class="djs-popup-no-results">No matching entries found.</div>
        `}
      `}
    </${Hr}>
  `}function Hr(t){const{onClose:e,onKeydown:n,onKeyup:i,className:r,children:o,position:a}=t,s=zi(),c=le(u=>{Gt(u.target,".djs-popup",!0)||e()},[e]);return bn(()=>{if(typeof a!="function")return;const u=s.current,l=a(u);u.style.left=`${l.x}px`,u.style.top=`${l.y}px`},[s.current,a]),bn(()=>{s.current&&s.current.focus()},[]),Z`
    <div
      class="djs-popup-backdrop"
      onClick=${c}
    >
      <div
        class=${Rn("djs-popup",r)}
        style=${Ru(t)}
        onKeydown=${n}
        onKeyup=${i}
        ref=${s}
        tabIndex="-1"
      >
        ${o}
      </div>
    </div>
  `}function Ru(t){return{transform:`scale(${t.scale})`,width:`${t.width}px`}}function bu(t,e){return Rn("entry",t.className,t.active?"active":"",t.disabled?"disabled":"",e?"selected":"")}var Mu="data-id",Na=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],Tu=1e3;function W(t,e,n){this._eventBus=e,this._canvas=n,this._current=null;var i=et(t&&t.scale)?t.scale:{min:1,max:1.5};this._config={scale:i},e.on("diagram.destroy",()=>{this.close()}),e.on("element.changed",r=>{const o=this.isOpen()&&this._current.element;r.element===o&&this._render()})}W.$inject=["config.popupMenu","eventBus","canvas"];W.prototype._render=function(){const{position:t,className:e,entries:n,headerEntries:i,options:r}=this._current,o=Object.entries(n).map(([f,h])=>({id:f,...h})),a=Object.entries(i).map(([f,h])=>({id:f,...h})),s=t&&(f=>this._ensureVisible(f,t)),c=this._updateScale(this._current.container);Qo(Z`
      <${Cu}
        onClose=${f=>this.close(f)}
        onSelect=${(f,h,d)=>this.trigger(f,h,d)}
        position=${s}
        className=${e}
        entries=${o}
        headerEntries=${a}
        scale=${c}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        ...${{...r}}
      />
    `,this._current.container)};W.prototype.open=function(t,e,n,i){if(!t)throw new Error("Element is missing");if(!e)throw new Error("No registered providers for: "+e);if(!n)throw new Error("the position argument is missing");this.isOpen()&&this.close();const{entries:r,headerEntries:o}=this._getContext(t,e);this._current={position:n,className:e,element:t,entries:r,headerEntries:o,container:this._createContainer({provider:e}),options:i},this._emit("open"),this._bindAutoClose(),this._render()};W.prototype._getContext=function(t,e){const n=this._getProviders(e);if(!n||!n.length)throw new Error("No registered providers for: "+e);const i=this._getEntries(t,n),r=this._getHeaderEntries(t,n);return{entries:i,headerEntries:r,empty:!(Object.keys(i).length||Object.keys(r).length)}};W.prototype.close=function(){!this.isOpen()||(this._emit("close"),this.reset(),this._current=null)};W.prototype.reset=function(){const t=this._current.container;Qo(null,t),pe(t)};W.prototype._emit=function(t,e){this._eventBus.fire(`popupMenu.${t}`,e)};W.prototype._onOpened=function(){this._emit("opened")};W.prototype._onClosed=function(){this._emit("closed")};W.prototype._createContainer=function(t){var e=this._canvas,n=e.getContainer();const i=Y(`<div class="djs-popup-parent djs-scrollable" data-popup=${t.provider}></div>`);return n.appendChild(i),i};W.prototype._bindAutoClose=function(){this._eventBus.once(Na,this.close,this)};W.prototype._unbindAutoClose=function(){this._eventBus.off(Na,this.close,this)};W.prototype._updateScale=function(t){var e=this._canvas.zoom(),n=this._config.scale,i,r,o=e;return n!==!0&&(n===!1?(i=1,r=1):(i=n.min,r=n.max),et(i)&&e<i&&(o=i),et(r)&&e>r&&(o=r)),o};W.prototype._ensureVisible=function(t,e){var n=document.documentElement.getBoundingClientRect(),i=t.getBoundingClientRect(),r={},o=e.x,a=e.y;return e.x+i.width>n.width&&(r.x=!0),e.y+i.height>n.height&&(r.y=!0),r.x&&r.y?(o=e.x-i.width,a=e.y-i.height):r.x?(o=e.x-i.width,a=e.y):r.y&&e.y<i.height?(o=e.x,a=10):r.y&&(o=e.x,a=e.y-i.height),{x:o,y:a}};W.prototype.isEmpty=function(t,e){if(!t)throw new Error("element parameter is missing");if(!e)throw new Error("providerId parameter is missing");const n=this._getProviders(e);return!n||!n.length?!0:this._getContext(t,e).empty};W.prototype.registerProvider=function(t,e,n){n||(n=e,e=Tu),this._eventBus.on("popupMenu.getProviders."+t,e,function(i){i.providers.push(n)})};W.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"popupMenu.getProviders."+t,providers:[]});return this._eventBus.fire(e),e.providers};W.prototype._getEntries=function(t,e){var n={};return m(e,function(i){if(!i.getPopupMenuEntries){m(i.getEntries(t),function(o){var a=o.id;if(!a)throw new Error("every entry must have the id property set");n[a]=ve(o,["id"])});return}var r=i.getPopupMenuEntries(t);st(r)?n=r(n):m(r,function(o,a){n[a]=o})}),n};W.prototype._getHeaderEntries=function(t,e){var n={};return m(e,function(i){if(!i.getPopupMenuHeaderEntries){if(!i.getHeaderEntries)return;m(i.getHeaderEntries(t),function(o){var a=o.id;if(!a)throw new Error("every entry must have the id property set");n[a]=ve(o,["id"])});return}var r=i.getPopupMenuHeaderEntries(t);st(r)?n=r(n):m(r,function(o,a){n[a]=o})}),n};W.prototype.isOpen=function(){return!!this._current};W.prototype.trigger=function(t,e,n="click"){if(t.preventDefault(),!e){let r=Gt(t.delegateTarget||t.target,".entry",!0),o=ot(r,Mu);e=this._getEntry(o)}const i=e.action;if(st(i)){if(n==="click")return i(t,e)}else if(i[n])return i[n](t,e)};W.prototype._getEntry=function(t){var e=this._current.entries[t]||this._current.headerEntries[t];if(!e)throw new Error("entry not found");return e};var Qh={__init__:["popupMenu"],popupMenu:["type",W]};function Se(t){rt.call(this,t),this.init()}Se.$inject=["eventBus"];lt(Se,rt);Se.prototype.addRule=function(t,e,n){var i=this;typeof t=="string"&&(t=[t]),t.forEach(function(r){i.canExecute(r,e,function(o,a,s){return n(o)},!0)})};Se.prototype.init=function(){};var Pu=10,za=50,Ou=250;function td(t,e,n,i){for(var r;r=Lu(t,n,e);)n=i(e,n,r);return n}function ed(t){return function(e,n,i){var r={x:n.x,y:n.y};return["x","y"].forEach(function(o){var a=t[o];if(!!a){var s=o==="x"?"width":"height",c=a.margin,u=a.minDistance;c<0?r[o]=Math.min(i[o]+c-e[s]/2,n[o]-u+c):r[o]=Math.max(i[o]+i[s]+c+e[s]/2,n[o]+u+c)}}),r}}function Lu(t,e,n){var i={x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height},r=Iu(t);return nt(r,function(o){if(o===n)return!1;var a=Ct(o,i,Pu);return a==="intersect"})}function nd(t,e){e||(e={});function n(p){return p.source===t?1:-1}var i=e.defaultDistance||za,r=e.direction||"e",o=e.filter,a=e.getWeight||n,s=e.maxDistance||Ou,c=e.reference||"start";o||(o=$u);function u(p,_){return r==="n"?c==="start"?A(p).top-A(_).bottom:c==="center"?A(p).top-V(_).y:A(p).top-A(_).top:r==="w"?c==="start"?A(p).left-A(_).right:c==="center"?A(p).left-V(_).x:A(p).left-A(_).left:r==="s"?c==="start"?A(_).top-A(p).bottom:c==="center"?V(_).y-A(p).bottom:A(_).bottom-A(p).bottom:c==="start"?A(_).left-A(p).right:c==="center"?V(_).x-A(p).right:A(_).right-A(p).right}var l=t.incoming.filter(o).map(function(p){var _=a(p),g=_<0?u(p.source,t):u(t,p.source);return{id:p.source.id,distance:g,weight:_}}),f=t.outgoing.filter(o).map(function(p){var _=a(p),g=_>0?u(t,p.target):u(p.target,t);return{id:p.target.id,distance:g,weight:_}}),h=l.concat(f).reduce(function(p,_){return p[_.id+"__weight_"+_.weight]=_,p},{}),d=de(h,function(p,_){var g=_.distance,b=_.weight;return g<0||g>s||(p[String(g)]||(p[String(g)]=0),p[String(g)]+=1*b,(!p.distance||p[p.distance]<p[String(g)])&&(p.distance=g)),p},{});return d.distance||i}function Iu(t){var e=ui(t);return t.host&&(e=e.concat(ui(t.host))),t.attachers&&(e=e.concat(t.attachers.reduce(function(n,i){return n.concat(ui(i))},[]))),e}function ui(t){return Au(t).concat(ku(t))}function ku(t){return t.incoming.map(function(e){return e.source})}function Au(t){return t.outgoing.map(function(e){return e.target})}function $u(){return!0}var Du=100;function Ga(t,e,n){t.on("autoPlace",Du,function(i){var r=i.shape,o=i.source;return ju(o,r)}),t.on("autoPlace.end",function(i){n.scrollToElement(i.shape)}),this.append=function(i,r,o){t.fire("autoPlace.start",{source:i,shape:r});var a=t.fire("autoPlace",{source:i,shape:r}),s=e.appendShape(i,r,a,i.parent,o);return t.fire("autoPlace.end",{source:i,shape:s}),s}}Ga.$inject=["eventBus","modeling","canvas"];function ju(t,e,n){n||(n={});var i=n.defaultDistance||za,r=V(t),o=A(t);return{x:o.right+i+e.width/2,y:r.y}}function Ba(t,e){t.on("autoPlace.end",500,function(n){e.select(n.shape)})}Ba.$inject=["eventBus","selection"];var id={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",Ga],autoPlaceSelectionBehavior:["type",Ba]};function ne(t,e,n,i){rt.call(this,t),this._elementRegistry=e,this._modeling=n,this._rules=i;var r=this;this.postExecuted(["shape.create"],function(o){var a=o.context,s=a.hints||{},c=a.shape,u=a.parent||a.newParent;s.autoResize!==!1&&r._expand([c],u)}),this.postExecuted(["elements.move"],function(o){var a=o.context,s=Cn(ji(a.closure.topLevel)),c=a.hints,u=c?c.autoResize:!0;if(u!==!1){var l=ze(s,function(f){return f.parent.id});m(l,function(f,h){N(u)&&(f=f.filter(function(d){return nt(u,Dt({id:d.id}))})),r._expand(f,h)})}}),this.postExecuted(["shape.toggleCollapse"],function(o){var a=o.context,s=a.hints,c=a.shape;s&&s.autoResize===!1||c.collapsed||r._expand(c.children||[],c)}),this.postExecuted(["shape.resize"],function(o){var a=o.context,s=a.hints,c=a.shape,u=c.parent;s&&s.autoResize===!1||u&&r._expand([c],u)})}ne.$inject=["eventBus","elementRegistry","modeling","rules"];lt(ne,rt);ne.prototype._getOptimalBounds=function(t,e){var n=this.getOffset(e),i=this.getPadding(e),r=A(q(t)),o=A(e),a={};return r.top-o.top<i.top&&(a.top=r.top-n.top),r.left-o.left<i.left&&(a.left=r.left-n.left),o.right-r.right<i.right&&(a.right=r.right+n.right),o.bottom-r.bottom<i.bottom&&(a.bottom=r.bottom+n.bottom),Ui(M({},o,a))};ne.prototype._expand=function(t,e){typeof e=="string"&&(e=this._elementRegistry.get(e));var n=this._rules.allowed("element.autoResize",{elements:t,target:e});if(!!n){var i=this._getOptimalBounds(t,e);if(!!Hu(i,e)){var r=Nu(He(e,["x","y","width","height"]),i);this.resize(e,i,{autoResize:r});var o=e.parent;o&&this._expand([e],o)}}};ne.prototype.getOffset=function(t){return{top:60,bottom:60,left:100,right:100}};ne.prototype.getPadding=function(t){return{top:2,bottom:2,left:15,right:15}};ne.prototype.resize=function(t,e,n){this._modeling.resizeShape(t,e,null,n)};function Hu(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}function Nu(t,e){var n="";return t=A(t),e=A(e),t.top>e.top&&(n=n.concat("n")),t.right<e.right&&(n=n.concat("w")),t.bottom<e.bottom&&(n=n.concat("s")),t.left>e.left&&(n=n.concat("e")),n}function tr(t){Se.call(this,t);var e=this;this.addRule("element.autoResize",function(n){return e.canResize(n.elements,n.target)})}tr.$inject=["eventBus"];lt(tr,Se);tr.prototype.canResize=function(t,e){return!1};var Nr=1500;function Va(t,e,n){var i=this,r=n.get("dragging",!1);function o(a){if(!a.hover){var s=a.originalEvent,c=i._findTargetGfx(s),u=c&&t.get(c);c&&u&&(a.stopPropagation(),r.hover({element:u,gfx:c}),r.move(s))}}r&&e.on("drag.start",function(a){e.once("drag.move",Nr,function(s){o(s)})}),function(){var a,s;e.on("element.hover",function(c){a=c.gfx,s=c.element}),e.on("element.hover",Nr,function(c){s&&e.fire("element.out",{element:s,gfx:a})}),e.on("element.out",function(){a=null,s=null})}(),this._findTargetGfx=function(a){var s,c;if(a instanceof MouseEvent)return s=zt(a),c=document.elementFromPoint(s.x,s.y),zu(c)}}Va.$inject=["elementRegistry","eventBus","injector"];function zu(t){return Gt(t,"svg, .djs-element",!0)}var Gu={__init__:["hoverFix"],hoverFix:["type",Va]},ue=Math.round,zr="djs-drag-active";function qt(t){t.preventDefault()}function Bu(t){return typeof TouchEvent<"u"&&t instanceof TouchEvent}function Vu(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function Wa(t,e,n,i){var r={threshold:5,trapClick:!0},o;function a(v){var y=e.viewbox(),x=e._container.getBoundingClientRect();return{x:y.x+(v.x-x.left)/y.scale,y:y.y+(v.y-x.top)/y.scale}}function s(v,y){y=y||o;var x=t.createEvent(M({},y.payload,y.data,{isTouch:y.isTouch}));return t.fire("drag."+v,x)===!1?!1:t.fire(y.prefix+"."+v,x)}function c(v){var y=v.filter(function(x){return i.get(x.id)});y.length&&n.select(y)}function u(v,y){var x=o.payload,E=o.displacement,O=o.globalStart,w=zt(v),C=jt(w,O),R=o.localStart,T=a(w),z=jt(T,R);if(!o.active&&(y||Vu(C)>o.threshold)){if(M(x,{x:ue(R.x+E.x),y:ue(R.y+E.y),dx:0,dy:0},{originalEvent:v}),s("start")===!1)return g();o.active=!0,o.keepSelection||(x.previousSelection=n.get(),n.select(null)),o.cursor&&Gn(o.cursor),e.addMarker(e.getRootElement(),zr)}ai(v),o.active&&(M(x,{x:ue(T.x+E.x),y:ue(T.y+E.y),dx:ue(z.x),dy:ue(z.y)},{originalEvent:v}),s("move"))}function l(v){var y,x=!0;o.active&&(v&&(o.payload.originalEvent=v,ai(v)),x=s("end")),x===!1&&s("rejected"),y=b(x!==!0),s("ended",y)}function f(v){X("Escape",v)&&(qt(v),g())}function h(v){var y;o.active&&(y=ka(t),setTimeout(y,400),qt(v)),l(v)}function d(v){u(v)}function p(v){var y=o.payload;y.hoverGfx=v.gfx,y.hover=v.element,s("hover")}function _(v){s("out");var y=o.payload;y.hoverGfx=null,y.hover=null}function g(v){var y;if(!!o){var x=o.active;x&&s("cancel"),y=b(v),x&&s("canceled",y)}}function b(v){var y,x;s("cleanup"),Ia(),o.trapClick?x=h:x=l,j.unbind(document,"mousemove",u),j.unbind(document,"dragstart",qt),j.unbind(document,"selectstart",qt),j.unbind(document,"mousedown",x,!0),j.unbind(document,"mouseup",x,!0),j.unbind(document,"keyup",f),j.unbind(document,"touchstart",d,!0),j.unbind(document,"touchcancel",g,!0),j.unbind(document,"touchmove",u,!0),j.unbind(document,"touchend",l,!0),t.off("element.hover",p),t.off("element.out",_),e.removeMarker(e.getRootElement(),zr);var E=o.payload.previousSelection;return v!==!1&&E&&!n.get().length&&c(E),y=o,o=null,y}function S(v,y,x,E){o&&g(!1),typeof y=="string"&&(E=x,x=y,y=null),E=M({},r,E||{});var O=E.data||{},w,C,R,T,z;E.trapClick?T=h:T=l,v?(w=me(v)||v,C=zt(v),ai(v),w.type==="dragstart"&&qt(w)):(w=null,C={x:0,y:0}),R=a(C),y||(y=R),z=Bu(w),o=M({prefix:x,data:O,payload:{},globalStart:C,displacement:jt(y,R),localStart:R,isTouch:z},E),E.manual||(z?(j.bind(document,"touchstart",d,!0),j.bind(document,"touchcancel",g,!0),j.bind(document,"touchmove",u,!0),j.bind(document,"touchend",l,!0)):(j.bind(document,"mousemove",u),j.bind(document,"dragstart",qt),j.bind(document,"selectstart",qt),j.bind(document,"mousedown",T,!0),j.bind(document,"mouseup",T,!0)),j.bind(document,"keyup",f),t.on("element.hover",p),t.on("element.out",_)),s("init"),E.autoActivate&&u(v,!0)}t.on("diagram.destroy",g),this.init=S,this.move=u,this.hover=p,this.out=_,this.end=l,this.cancel=g,this.context=function(){return o},this.setOptions=function(v){M(r,v)}}Wa.$inject=["eventBus","canvas","selection","elementRegistry"];var bt={__depends__:[Gu,Ee],dragging:["type",Wa]};function Ce(t,e,n){this._canvas=n,this._opts=M({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},t);var i=this;e.on("drag.move",function(r){var o=i._toBorderPoint(r);i.startScroll(o)}),e.on(["drag.cleanup"],function(){i.stopScroll()})}Ce.$inject=["config.autoScroll","eventBus","canvas"];Ce.prototype.startScroll=function(t){var e=this._canvas,n=this._opts,i=this,r=e.getContainer().getBoundingClientRect(),o=[t.x,t.y,r.width-t.x,r.height-t.y];this.stopScroll();for(var a=0,s=0,c=0;c<4;c++)Wu(o[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(c===0?a=n.scrollStep:c==1?s=n.scrollStep:c==2?a=-n.scrollStep:c==3&&(s=-n.scrollStep));(a!==0||s!==0)&&(e.scroll({dx:a,dy:s}),this._scrolling=setTimeout(function(){i.startScroll(t)},n.scrollRepeatTimeout))};function Wu(t,e,n){return e<t&&t<n}Ce.prototype.stopScroll=function(){clearTimeout(this._scrolling)};Ce.prototype.setOptions=function(t){this._opts=M({},this._opts,t)};Ce.prototype._toBorderPoint=function(t){var e=this._canvas._container.getBoundingClientRect(),n=zt(t.originalEvent);return{x:n.x-e.left,y:n.y-e.top}};var rd={__depends__:[bt],__init__:["autoScroll"],autoScroll:["type",Ce]};function er(t){this._commandStack=t.get("commandStack",!1)}er.$inject=["injector"];er.prototype.allowed=function(t,e){var n=!0,i=this._commandStack;return i&&(n=i.canExecute(t,e)),n===void 0?!0:n};var Mt={__init__:["rules"],rules:["type",er]},ln=Math.round,Uu=Math.max;function Fu(t,e){var n=t.x,i=t.y;return[["M",n,i],["m",0,-e],["a",e,e,0,1,1,0,2*e],["a",e,e,0,1,1,0,-2*e],["z"]]}function Ku(t){var e=[];return t.forEach(function(n,i){e.push([i===0?"M":"L",n.x,n.y])}),e}var Ua=10;function Yu(t,e){var n,i;for(n=0;i=t[n];n++)if(We(i,e)<=Ua)return{point:t[n],bendpoint:!0,index:n};return null}function Zu(t,e){var n=ta(Fu(e,Ua),Ku(t)),i=n[0],r=n[n.length-1],o;return i?i!==r?i.segment2!==r.segment2?(o=Uu(i.segment2,r.segment2)-1,{point:t[o],bendpoint:!0,index:o}):{point:{x:ln(i.x+r.x)/2,y:ln(i.y+r.y)/2},index:i.segment2}:{point:{x:ln(i.x),y:ln(i.y)},index:i.segment2}:null}function Xu(t,e){return Yu(t,e)||Zu(t,e)}function Fa(t){return Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))}function od(t){return Math.atan((t[1].y-t[0].y)/(t[1].x-t[0].x))}function ad(t,e){return e?{x:Math.cos(e)*t.x-Math.sin(e)*t.y,y:Math.sin(e)*t.x+Math.cos(e)*t.y}:t}function qu(t,e,n){var i=[{n:t[0]-n[0],lambda:e[0]},{n:t[1]-n[1],lambda:e[1]}],r=i[0].n*e[0]+i[1].n*e[1],o=i[0].lambda*e[0]+i[1].lambda*e[1];return-r/o}function Ka(t,e){var n=e[0],i=e[1],r={x:i.x-n.x,y:i.y-n.y},o=qu([n.x,n.y],[r.x,r.y],[t.x,t.y]);return{x:n.x+o*r.x,y:n.y+o*r.y}}function Ju(t,e){var n=Ka(t,e),i={x:n.x-t.x,y:n.y-t.y};return Fa(i)}function sd(t,e){return Fa({x:t.x-e.x,y:t.y-e.y})}var Ya="djs-bendpoint",Za="djs-segment-dragger";function Qu(t,e){var n=zt(e),i=t._container.getBoundingClientRect(),r;r={x:i.left,y:i.top};var o=t.viewbox();return{x:o.x+(n.x-r.x)/o.scale,y:o.y+(n.y-r.y)/o.scale}}function Ri(t,e,n){var i=Qu(t,n),r=Xu(e,i);return r}function bi(t,e){var n=$("g");H(n).add(Ya),D(t,n);var i=$("circle");P(i,{cx:0,cy:0,r:4}),H(i).add("djs-visual"),D(n,i);var r=$("circle");return P(r,{cx:0,cy:0,r:10}),H(r).add("djs-hit"),D(n,r),e&&H(n).add(e),n}function tl(t,e,n,i){var r=$("g");D(t,r);var o=18,a=6,s=11,c=nl(e,n,i),u=a+s,l=$("rect");P(l,{x:-o/2,y:-a/2,width:o,height:a}),H(l).add("djs-visual"),D(r,l);var f=$("rect");return P(f,{x:-c/2,y:-u/2,width:c,height:u}),H(f).add("djs-hit"),D(r,f),_c(r,i==="v"?90:0),r}function Xa(t,e,n){var i=$("g"),r=Ei(e,n),o=$t(e,n);return D(t,i),tl(i,e,n,o),H(i).add(Za),H(i).add(o==="h"?"horizontal":"vertical"),gt(i,r.x,r.y),i}function Mi(t){return Math.abs(Math.round(t*2/3))}function el(t,e){var n=il(t,e);return Ka(t,n)}function nl(t,e,n){var i=e.x-t.x,r=e.y-t.y;return Mi(n==="h"?i:r)}function il(t,e){for(var n=e.waypoints,i=1/0,r,o=0;o<n.length-1;o++){var a=n[o],s=n[o+1],c=Ju(t,[a,s]);c<i&&(i=c,r=o)}return[n[r],n[r+1]]}function qa(t,e,n,i,r){function o(v,y,x){var E=v.index,O=v.point,w,C,R,T,z,U;return E<=0||v.bendpoint?!1:(w=y[E-1],C=y[E],R=Ei(w,C),T=$t(w,C),z=Math.abs(O.x-R.x),U=Math.abs(O.y-R.y),T&&z<=x&&U<=x)}function a(v,y){var x=v.waypoints,E,O,w,C;return y.index<=0||y.bendpoint||(E={start:x[y.index-1],end:x[y.index]},O=$t(E.start,E.end),!O)?null:(O==="h"?w=E.end.x-E.start.x:w=E.end.y-E.start.y,C=Mi(w)/2,C)}function s(v,y){var x=y.waypoints,E=Ri(e,x,v),O;if(!!E)return O=a(y,E),o(E,x,O)?r.start(v,y,E.index):i.start(v,y,E.index,!E.bendpoint),!0}function c(v,y,x){j.bind(v,y,function(E){n.triggerMouseEvent(y,E,x),E.stopPropagation()})}function u(v,y){var x=e.getLayer("overlays"),E=Q('.djs-bendpoints[data-element-id="'+Ni(v.id)+'"]',x);return!E&&y&&(E=$("g"),P(E,{"data-element-id":v.id}),H(E).add("djs-bendpoints"),D(x,E),c(E,"mousedown",v),c(E,"click",v),c(E,"dblclick",v)),E}function l(v,y){return Q('.djs-segment-dragger[data-segment-idx="'+v+'"]',y)}function f(v,y){y.waypoints.forEach(function(x,E){var O=bi(v);D(v,O),gt(O,x.x,x.y)}),bi(v,"floating")}function h(v,y){for(var x=y.waypoints,E,O,w,C=1;C<x.length;C++)E=x[C-1],O=x[C],$t(E,O)&&(w=Xa(v,E,O),P(w,{"data-segment-idx":C}),c(w,"mousemove",y))}function d(v){m(_i("."+Ya,v),function(y){K(y)})}function p(v){m(_i("."+Za,v),function(y){K(y)})}function _(v){var y=u(v);return y||(y=u(v,!0),f(y,v),h(y,v)),y}function g(v){var y=u(v);y&&(p(y),d(y),h(y,v),f(y,v))}function b(v,y){var x=Q(".floating",v),E=y.point;!x||gt(x,E.x,E.y)}function S(v,y,x){var E=l(y.index,v),O=x[y.index-1],w=x[y.index],C=y.point,R=Ei(O,w),T=$t(O,w),z,U;!E||(z=rl(E),U={x:C.x-R.x,y:C.y-R.y},T==="v"&&(U={x:U.y,y:U.x}),gt(z,U.x,U.y))}t.on("connection.changed",function(v){g(v.element)}),t.on("connection.remove",function(v){var y=u(v.element);y&&K(y)}),t.on("element.marker.update",function(v){var y=v.element,x;!y.waypoints||(x=_(y),v.add?H(x).add(v.marker):H(x).remove(v.marker))}),t.on("element.mousemove",function(v){var y=v.element,x=y.waypoints,E,O;if(x){if(E=u(y,!0),O=Ri(e,x,v.originalEvent),!O)return;b(E,O),O.bendpoint||S(E,O,x)}}),t.on("element.mousedown",function(v){if(!!Vt(v)){var y=v.originalEvent,x=v.element;if(!!x.waypoints)return s(y,x)}}),t.on("selection.changed",function(v){var y=v.newSelection,x=y[0];x&&x.waypoints&&_(x)}),t.on("element.hover",function(v){var y=v.element;y.waypoints&&(_(y),n.registerEvent(v.gfx,"mousemove","element.mousemove"))}),t.on("element.out",function(v){n.unregisterEvent(v.gfx,"mousemove","element.mousemove")}),t.on("element.updateId",function(v){var y=v.element,x=v.newId;if(y.waypoints){var E=u(y);E&&P(E,{"data-element-id":x})}}),this.addHandles=_,this.updateHandles=g,this.getBendpointsContainer=u,this.getSegmentDragger=l}qa.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function rl(t){return Q(".djs-visual",t)}var Gr=Math.round,Jt="reconnectStart",Qt="reconnectEnd",Te="updateWaypoints";function nr(t,e,n,i,r,o){this._injector=t,this.start=function(a,s,c,u){var l=n.getGraphics(s),f=s.source,h=s.target,d=s.waypoints,p;!u&&c===0?p=Jt:!u&&c===d.length-1?p=Qt:p=Te;var _=p===Te?"connection.updateWaypoints":"connection.reconnect",g=r.allowed(_,{connection:s,source:f,target:h});g===!1&&(g=r.allowed(_,{connection:s,source:h,target:f})),g!==!1&&i.init(a,"bendpoint.move",{data:{connection:s,connectionGfx:l,context:{allowed:g,bendpointIndex:c,connection:s,source:f,target:h,insert:u,type:p}}})},e.on("bendpoint.move.hover",function(a){var s=a.context,c=s.connection,u=c.source,l=c.target,f=a.hover,h=s.type;s.hover=f;var d;if(!!f){var p=h===Te?"connection.updateWaypoints":"connection.reconnect";if(d=s.allowed=r.allowed(p,{connection:c,source:h===Jt?f:u,target:h===Qt?f:l}),d){s.source=h===Jt?f:u,s.target=h===Qt?f:l;return}d===!1&&(d=s.allowed=r.allowed(p,{connection:c,source:h===Qt?f:l,target:h===Jt?f:u})),d&&(s.source=h===Qt?f:l,s.target=h===Jt?f:u)}}),e.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(a){var s=a.context,c=s.type;s.hover=null,s.source=null,s.target=null,c!==Te&&(s.allowed=!1)}),e.on("bendpoint.move.end",function(a){var s=a.context,c=s.allowed,u=s.bendpointIndex,l=s.connection,f=s.insert,h=l.waypoints.slice(),d=s.source,p=s.target,_=s.type,g=s.hints||{},b={x:Gr(a.x),y:Gr(a.y)};if(!c)return!1;_===Te?(f?h.splice(u,0,b):h[u]=b,g.bendpointMove={insert:f,bendpointIndex:u},h=this.cropWaypoints(l,h),o.updateWaypoints(l,rc(h),g)):(_===Jt?(g.docking="source",On(s)&&(g.docking="target",g.newWaypoints=h.reverse())):_===Qt&&(g.docking="target",On(s)&&(g.docking="source",g.newWaypoints=h.reverse())),o.reconnect(l,d,p,b,g))},this)}nr.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];nr.prototype.cropWaypoints=function(t,e){var n=this._injector.get("connectionDocking",!1);if(!n)return e;var i=t.waypoints;return t.waypoints=e,t.waypoints=n.getCroppedWaypoints(t),e=t.waypoints,t.waypoints=i,e};function On(t){var e=t.hover,n=t.source,i=t.target,r=t.type;if(r===Jt)return e&&i&&e===i&&n!==i;if(r===Qt)return e&&n&&e===n&&n!==i}var ol="reconnectStart",al="reconnectEnd",Br="updateWaypoints",Pe="connect-ok",fn="connect-not-ok",Vr="connect-hover",Wr="djs-updating",Ur="djs-element-hidden",Fr=1100;function Ja(t,e,n,i){this._injector=e;var r=e.get("connectionPreview",!1);n.on("bendpoint.move.start",function(o){var a=o.context,s=a.bendpointIndex,c=a.connection,u=a.insert,l=c.waypoints,f=l.slice();a.waypoints=l,u&&f.splice(s,0,{x:o.x,y:o.y}),c.waypoints=f;var h=a.draggerGfx=bi(i.getLayer("overlays"));H(h).add("djs-dragging"),i.addMarker(c,Ur),i.addMarker(c,Wr)}),n.on("bendpoint.move.hover",function(o){var a=o.context,s=a.allowed,c=a.hover,u=a.type;if(c){if(i.addMarker(c,Vr),u===Br)return;s?(i.removeMarker(c,fn),i.addMarker(c,Pe)):s===!1&&(i.removeMarker(c,Pe),i.addMarker(c,fn))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],Fr,function(o){var a=o.context,s=a.hover,c=a.target;s&&(i.removeMarker(s,Vr),i.removeMarker(s,c?Pe:fn))}),n.on("bendpoint.move.move",function(o){var a=o.context,s=a.allowed,c=a.bendpointIndex,u=a.draggerGfx,l=a.hover,f=a.type,h=a.connection,d=h.source,p=h.target,_=h.waypoints.slice(),g={x:o.x,y:o.y},b=a.hints||{},S={};r&&(b.connectionStart&&(S.connectionStart=b.connectionStart),b.connectionEnd&&(S.connectionEnd=b.connectionEnd),f===ol?On(a)?(S.connectionEnd=S.connectionEnd||g,S.source=p,S.target=l||d,_=_.reverse()):(S.connectionStart=S.connectionStart||g,S.source=l||d,S.target=p):f===al?On(a)?(S.connectionStart=S.connectionStart||g,S.source=l||p,S.target=d,_=_.reverse()):(S.connectionEnd=S.connectionEnd||g,S.source=d,S.target=l||p):(S.noCropping=!0,S.noLayout=!0,_[c]=g),f===Br&&(_=t.cropWaypoints(h,_)),S.waypoints=_,r.drawPreview(a,s,S)),gt(u,o.x,o.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],Fr,function(o){var a=o.context,s=a.connection,c=a.draggerGfx,u=a.hover,l=a.target,f=a.waypoints;s.waypoints=f,K(c),i.removeMarker(s,Wr),i.removeMarker(s,Ur),u&&(i.removeMarker(u,Pe),i.removeMarker(u,l?Pe:fn)),r&&r.cleanUp(a)})}Ja.$inject=["bendpointMove","injector","eventBus","canvas"];var Kr="connect-hover",Yr="djs-updating";function Zr(t,e,n){return ir(t,e,t[e]+n)}function ir(t,e,n){return{x:e==="x"?n:t.x,y:e==="y"?n:t.y}}function sl(t,e,n,i){var r=Math.max(e[i],n[i]),o=Math.min(e[i],n[i]),a=20,s=Math.min(Math.max(o+a,t[i]),r-a);return ir(e,i,s)}function Qa(t){return t==="x"?"y":"x"}function Xr(t,e,n){var i,r;return t.original?t.original:(i=V(e),r=Qa(n),ir(t,r,i[r]))}function ts(t,e,n,i,r,o){var a=t.get("connectionDocking",!1);this.start=function(f,h,d){var p,_=n.getGraphics(h),g=d-1,b=d,S=h.waypoints,v=S[g],y=S[b],x=Ri(n,S,f),E,O,w;E=$t(v,y),E&&(O=E==="v"?"x":"y",g===0&&(v=Xr(v,h.source,O)),b===S.length-1&&(y=Xr(y,h.target,O)),x?w=x.point:w={x:(v.x+y.x)/2,y:(v.y+y.y)/2},p={connection:h,segmentStartIndex:g,segmentEndIndex:b,segmentStart:v,segmentEnd:y,axis:O,dragPosition:w},i.init(f,w,"connectionSegment.move",{cursor:O==="x"?"resize-ew":"resize-ns",data:{connection:h,connectionGfx:_,context:p}}))};function s(f,h){if(!a)return h;var d=f.waypoints,p;return f.waypoints=h,p=a.getCroppedWaypoints(f),f.waypoints=d,p}function c(f){r.update("connection",f.connection,f.connectionGfx)}function u(f,h,d){var p=f.newWaypoints,_=f.segmentStartIndex+h,g=p[_],b=f.segmentEndIndex+h,S=p[b],v=Qa(f.axis),y=sl(d,g,S,v);gt(f.draggerGfx,y.x,y.y)}function l(f,h){var d=0,p=f.filter(function(_,g){return Wi(f[g-1],f[g+1],_)?(d=g<=h?d-1:d,!1):!0});return{waypoints:p,segmentOffset:d}}e.on("connectionSegment.move.start",function(f){var h=f.context,d=f.connection,p=n.getLayer("overlays");h.originalWaypoints=d.waypoints.slice(),h.draggerGfx=Xa(p,h.segmentStart,h.segmentEnd),H(h.draggerGfx).add("djs-dragging"),n.addMarker(d,Yr)}),e.on("connectionSegment.move.move",function(f){var h=f.context,d=h.connection,p=h.segmentStartIndex,_=h.segmentEndIndex,g=h.segmentStart,b=h.segmentEnd,S=h.axis,v=h.originalWaypoints.slice(),y=Zr(g,S,f["d"+S]),x=Zr(b,S,f["d"+S]),E=v.length,O=0;v[p]=y,v[_]=x;var w,C;p<2&&(w=Ct(d.source,y),p===1?w==="intersect"&&(v.shift(),v[0]=y,O--):w!=="intersect"&&(v.unshift(g),O++)),_>E-3&&(C=Ct(d.target,x),_===E-2?C==="intersect"&&(v.pop(),v[v.length-1]=x):C!=="intersect"&&v.push(b)),h.newWaypoints=d.waypoints=s(d,v),u(h,O,f),h.newSegmentStartIndex=p+O,c(f)}),e.on("connectionSegment.move.hover",function(f){f.context.hover=f.hover,n.addMarker(f.hover,Kr)}),e.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(f){var h=f.context.hover;h&&n.removeMarker(h,Kr)}),e.on("connectionSegment.move.cleanup",function(f){var h=f.context,d=h.connection;h.draggerGfx&&K(h.draggerGfx),n.removeMarker(d,Yr)}),e.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(f){var h=f.context,d=h.connection;d.waypoints=h.originalWaypoints,c(f)}),e.on("connectionSegment.move.end",function(f){var h=f.context,d=h.connection,p=h.newWaypoints,_=h.newSegmentStartIndex;p=p.map(function(x){return{original:x.original,x:Math.round(x.x),y:Math.round(x.y)}});var g=l(p,_),b=g.waypoints,S=s(d,b),v=g.segmentOffset,y={segmentMove:{segmentStartIndex:h.segmentStartIndex,newSegmentStartIndex:_+v}};o.updateWaypoints(d,S,y)})}ts.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var cl=Math.abs,qr=Math.round;function ul(t,e,n){n=n===void 0?10:n;var i,r;for(i=0;i<e.length;i++)if(r=e[i],cl(r-t)<=n)return r}function ll(t){return{x:t.x,y:t.y}}function fl(t){return{x:t.x+t.width,y:t.y+t.height}}function he(t,e){return!t||isNaN(t.x)||isNaN(t.y)?e:{x:qr(t.x+t.width/2),y:qr(t.y+t.height/2)}}function Ne(t,e){var n=t.snapped;return n?typeof e=="string"?n[e]:n.x&&n.y:!1}function mt(t,e,n){if(typeof e!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var i,r=t[e],o=t.snapped=t.snapped||{};return n===!1?o[e]=!1:(o[e]=!0,i=n-r,t[e]+=i,t["d"+e]+=i),r}function es(t){return t.children||[]}var hl=Math.abs,Jr=Math.round,li=10;function ns(t){function e(o,a){if(N(o)){for(var s=o.length;s--;)if(hl(o[s]-a)<=li)return o[s]}else{o=+o;var c=a%o;if(c<li)return a-c;if(c>o-li)return a-c+o}return a}function n(o,a){if(o.waypoints)return el(a,o);if(o.width)return{x:Jr(o.width/2+o.x),y:Jr(o.height/2+o.y)}}function i(o){var a=o.context,s=a.snapPoints,c=a.connection,u=c.waypoints,l=a.segmentStart,f=a.segmentStartIndex,h=a.segmentEnd,d=a.segmentEndIndex,p=a.axis;if(s)return s;var _=[u[f-1],l,h,u[d+1]];return f<2&&_.unshift(n(c.source,o)),d>u.length-3&&_.unshift(n(c.target,o)),a.snapPoints=s={horizontal:[],vertical:[]},m(_,function(g){g&&(g=g.original||g,p==="y"&&s.horizontal.push(g.y),p==="x"&&s.vertical.push(g.x))}),s}t.on("connectionSegment.move.move",1500,function(o){var a=i(o),s=o.x,c=o.y,u,l;if(!!a){u=e(a.vertical,s),l=e(a.horizontal,c);var f=s-u,h=c-l;M(o,{dx:o.dx-f,dy:o.dy-h,x:u,y:l}),(f||a.vertical.indexOf(s)!==-1)&&mt(o,"x",u),(h||a.horizontal.indexOf(c)!==-1)&&mt(o,"y",l)}});function r(o){var a=o.snapPoints,s=o.connection.waypoints,c=o.bendpointIndex;if(a)return a;var u=[s[c-1],s[c+1]];return o.snapPoints=a={horizontal:[],vertical:[]},m(u,function(l){l&&(l=l.original||l,a.horizontal.push(l.y),a.vertical.push(l.x))}),a}t.on(["connect.hover","connect.move","connect.end"],1500,function(o){var a=o.context,s=a.hover,c=s&&n(s,o);!dl(s)||!c||!c.x||!c.y||(mt(o,"x",c.x),mt(o,"y",c.y))}),t.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(o){var a=o.context,s=r(a),c=a.hover,u=c&&n(c,o),l=o.x,f=o.y,h,d;if(!!s){h=e(u?s.vertical.concat([u.x]):s.vertical,l),d=e(u?s.horizontal.concat([u.y]):s.horizontal,f);var p=l-h,_=f-d;M(o,{dx:o.dx-p,dy:o.dy-_,x:o.x-p,y:o.y-_}),(p||s.vertical.indexOf(l)!==-1)&&mt(o,"x",h),(_||s.horizontal.indexOf(f)!==-1)&&mt(o,"y",d)}})}ns.$inject=["eventBus"];function dl(t){return t&&!!t.waypoints}var cd={__depends__:[bt,Mt],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",qa],bendpointMove:["type",nr],bendpointMovePreview:["type",Ja],connectionSegmentMove:["type",ts],bendpointSnapping:["type",ns]};function is(t,e,n,i){function r(a,s){return i.allowed("connection.create",{source:a,target:s})}function o(a,s){return r(s,a)}t.on("connect.hover",function(a){var s=a.context,c=s.start,u=a.hover,l;if(s.hover=u,l=s.canExecute=r(c,u),!Er(l)){if(l!==!1){s.source=c,s.target=u;return}l=s.canExecute=o(c,u),!Er(l)&&l!==!1&&(s.source=u,s.target=c)}}),t.on(["connect.out","connect.cleanup"],function(a){var s=a.context;s.hover=null,s.source=null,s.target=null,s.canExecute=!1}),t.on("connect.end",function(a){var s=a.context,c=s.canExecute,u=s.connectionStart,l={x:a.x,y:a.y},f=s.source,h=s.target;if(!c)return!1;var d=null,p={connectionStart:Ti(s)?l:u,connectionEnd:Ti(s)?u:l};xt(c)&&(d=c),s.connection=n.connect(f,h,d,p)}),this.start=function(a,s,c,u){xt(c)||(u=c,c=V(s)),e.init(a,"connect",{autoActivate:u,data:{shape:s,context:{start:s,connectionStart:c}}})}}is.$inject=["eventBus","dragging","modeling","rules"];function Ti(t){var e=t.hover,n=t.source,i=t.target;return e&&n&&e===n&&n!==i}var pl=1100,gl=900,Qr="connect-ok",to="connect-not-ok";function rs(t,e,n){var i=t.get("connectionPreview",!1);i&&e.on("connect.move",function(r){var o=r.context,a=o.canExecute,s=o.hover,c=o.source,u=o.start,l=o.startPosition,f=o.target,h=o.connectionStart||l,d=o.connectionEnd||{x:r.x,y:r.y},p=h,_=d;Ti(o)&&(p=d,_=h),i.drawPreview(o,a,{source:c||u,target:f||s,connectionStart:p,connectionEnd:_})}),e.on("connect.hover",gl,function(r){var o=r.context,a=r.hover,s=o.canExecute;s!==null&&n.addMarker(a,s?Qr:to)}),e.on(["connect.out","connect.cleanup"],pl,function(r){var o=r.hover;o&&(n.removeMarker(o,Qr),n.removeMarker(o,to))}),i&&e.on("connect.cleanup",function(r){i.cleanUp(r.context)})}rs.$inject=["injector","eventBus","canvas"];var vl={__depends__:[Ee,Mt,bt],__init__:["connectPreview"],connect:["type",is],connectPreview:["type",rs]},yl="djs-connection-preview";function Tt(t,e,n,i){this._canvas=e,this._graphicsFactory=n,this._elementFactory=i,this._connectionDocking=t.get("connectionDocking",!1),this._layouter=t.get("layouter",!1)}Tt.$inject=["injector","canvas","graphicsFactory","elementFactory"];Tt.prototype.drawPreview=function(t,e,n){n=n||{};var i=t.connectionPreviewGfx,r=t.getConnection,o=n.source,a=n.target,s=n.waypoints,c=n.connectionStart,u=n.connectionEnd,l=n.noLayout,f=n.noCropping,h=n.noNoop,d,p=this;if(i||(i=t.connectionPreviewGfx=this.createConnectionPreviewGfx()),$i(i),r||(r=t.getConnection=_l(function(_,g,b){return p.getConnection(_,g,b)})),e&&(d=r(e,o,a)),!d){!h&&this.drawNoopPreview(i,n);return}d.waypoints=s||[],this._layouter&&!l&&(d.waypoints=this._layouter.layoutConnection(d,{source:o,target:a,connectionStart:c,connectionEnd:u,waypoints:n.waypoints||d.waypoints})),(!d.waypoints||!d.waypoints.length)&&(d.waypoints=[o?V(o):c,a?V(a):u]),this._connectionDocking&&(o||a)&&!f&&(d.waypoints=this._connectionDocking.getCroppedWaypoints(d,o,a)),this._graphicsFactory.drawConnection(i,d)};Tt.prototype.drawNoopPreview=function(t,e){var n=e.source,i=e.target,r=e.connectionStart||V(n),o=e.connectionEnd||V(i),a=this.cropWaypoints(r,o,n,i),s=this.createNoopConnection(a[0],a[1]);D(t,s)};Tt.prototype.cropWaypoints=function(t,e,n,i){var r=this._graphicsFactory,o=n&&r.getShapePath(n),a=i&&r.getShapePath(i),s=r.getConnectionPath({waypoints:[t,e]});return t=n&&wi(o,s,!0)||t,e=i&&wi(a,s,!1)||e,[t,e]};Tt.prototype.cleanUp=function(t){t&&t.connectionPreviewGfx&&K(t.connectionPreviewGfx)};Tt.prototype.getConnection=function(t){var e=ml(t);return this._elementFactory.createConnection(e)};Tt.prototype.createConnectionPreviewGfx=function(){var t=$("g");return P(t,{pointerEvents:"none"}),H(t).add(yl),D(this._canvas.getActiveLayer(),t),t};Tt.prototype.createNoopConnection=function(t,e){return Bi([t,e],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function _l(t){var e={};return function(n){var i=JSON.stringify(n),r=e[i];return r||(r=e[i]=t.apply(null,arguments)),r}}function ml(t){return xt(t)?t:{}}var ud={__init__:["connectionPreview"],connectionPreview:["type",Tt]},xl=["marker-start","marker-mid","marker-end"],El=["circle","ellipse","line","path","polygon","polyline","path","rect"];function ie(t,e,n,i){this._elementRegistry=t,this._canvas=n,this._styles=i,this._clonedMarkers={};var r=this;e.on("drag.cleanup",function(){m(r._clonedMarkers,function(o){K(o)}),r._clonedMarkers={}})}ie.$inject=["elementRegistry","eventBus","canvas","styles"];ie.prototype.getGfx=function(t){return this._elementRegistry.getGraphics(t)};ie.prototype.addDragger=function(t,e,n){n=n||this.getGfx(t);var i=Xo(n),r=n.getBoundingClientRect();return this._cloneMarkers(Tn(i)),P(i,this._styles.cls("djs-dragger",[],{x:r.top,y:r.left})),D(e,i),i};ie.prototype.addFrame=function(t,e){var n=$("rect",{class:"djs-resize-overlay",width:t.width,height:t.height,x:t.x,y:t.y});return D(e,n),n};ie.prototype._cloneMarkers=function(t){var e=this;if(t.childNodes)for(var n=0;n<t.childNodes.length;n++)e._cloneMarkers(t.childNodes[n]);!Rl(t)||xl.forEach(function(i){if(P(t,i)){var r=wl(t,i,e._canvas.getContainer());e._cloneMarker(t,r,i)}})};ie.prototype._cloneMarker=function(t,e,n){var i=e.id,r=this._clonedMarkers[i];if(!r){r=Xo(e);var o=i+"-clone";r.id=o,H(r).add("djs-dragger").add("djs-dragger-marker"),this._clonedMarkers[i]=r;var a=Q("defs",this._canvas._svg);a||(a=$("defs"),D(this._canvas._svg,a)),D(a,r)}var s=Cl(this._clonedMarkers[i].id);P(t,n,s)};function wl(t,e,n){var i=Sl(P(t,e));return Q("marker#"+i,n||document)}function Sl(t){return t.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function Cl(t){return"url(#"+t+")"}function Rl(t){return El.indexOf(t.nodeName)!==-1}var Bn={__init__:["previewSupport"],previewSupport:["type",ie]},bl="drop-ok",eo="drop-not-ok",no="attach-ok",io="new-parent",ro="create",Ml=2e3;function os(t,e,n,i,r){function o(c,u,l,f,h){if(!u)return!1;c=at(c,function(S){var v=S.labelTarget;return!S.parent&&!(Tl(S)&&c.indexOf(v)!==-1)});var d=nt(c,function(S){return!ke(S)}),p=!1,_=!1,g=!1;ao(c)&&(p=r.allowed("shape.attach",{position:l,shape:d,target:u})),p||(ao(c)?g=r.allowed("shape.create",{position:l,shape:d,source:f,target:u}):g=r.allowed("elements.create",{elements:c,position:l,target:u}));var b=h.connectionTarget;return g||p?(d&&f&&(_=r.allowed("connection.create",{source:b===f?d:f,target:b===f?f:d,hints:{targetParent:u,targetAttach:p}})),{attach:p,connect:_}):g===null||p===null?null:!1}function a(c,u){[no,bl,eo,io].forEach(function(l){l===u?t.addMarker(c,l):t.removeMarker(c,l)})}n.on(["create.move","create.hover"],function(c){var u=c.context,l=u.elements,f=c.hover,h=u.source,d=u.hints||{};if(!f){u.canExecute=!1,u.target=null;return}oo(c);var p={x:c.x,y:c.y},_=u.canExecute=f&&o(l,f,p,h,d);f&&_!==null&&(u.target=f,_&&_.attach?a(f,no):a(f,_?io:eo))}),n.on(["create.end","create.out","create.cleanup"],function(c){var u=c.hover;u&&a(u,null)}),n.on("create.end",function(c){var u=c.context,l=u.source,f=u.shape,h=u.elements,d=u.target,p=u.canExecute,_=p&&p.attach,g=p&&p.connect,b=u.hints||{};if(p===!1||!d)return!1;oo(c);var S={x:c.x,y:c.y};g?f=i.appendShape(l,f,S,d,{attach:_,connection:g===!0?{}:g,connectionTarget:b.connectionTarget}):(h=i.createElements(h,S,d,M({},b,{attach:_})),f=nt(h,function(v){return!ke(v)})),M(u,{elements:h,shape:f}),M(c,{elements:h,shape:f})});function s(){var c=e.context();c&&c.prefix===ro&&e.cancel()}n.on("create.init",function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],Ml,function(){n.off("elements.changed",s)})}),this.start=function(c,u,l){N(u)||(u=[u]);var f=nt(u,function(p){return!ke(p)});if(!!f){l=M({elements:u,hints:{},shape:f},l||{}),m(u,function(p){I(p.x)||(p.x=0),I(p.y)||(p.y=0)});var h=at(u,function(p){return!p.hidden}),d=q(h);m(u,function(p){ke(p)&&(p.waypoints=pt(p.waypoints,function(_){return{x:_.x-d.x-d.width/2,y:_.y-d.y-d.height/2}})),M(p,{x:p.x-d.x-d.width/2,y:p.y-d.y-d.height/2})}),e.init(c,ro,{cursor:"grabbing",autoActivate:!0,data:{shape:f,elements:u,context:l}})}}}os.$inject=["canvas","dragging","eventBus","modeling","rules"];function oo(t){var e=t.context,n=e.createConstraints;!n||(n.left&&(t.x=Math.max(t.x,n.left)),n.right&&(t.x=Math.min(t.x,n.right)),n.top&&(t.y=Math.max(t.y,n.top)),n.bottom&&(t.y=Math.min(t.y,n.bottom)))}function ke(t){return!!t.waypoints}function ao(t){return t&&t.length===1&&!ke(t[0])}function Tl(t){return!!t.labelTarget}var Pl=750;function as(t,e,n,i,r){function o(a){var s=$("g");P(s,r.cls("djs-drag-group",["no-events"]));var c=$("g");return a.forEach(function(u){var l;u.hidden||(u.waypoints?(l=n._createContainer("connection",c),n.drawConnection(Tn(l),u)):(l=n._createContainer("shape",c),n.drawShape(Tn(l),u),gt(l,u.x,u.y)),i.addDragger(u,s,l))}),s}e.on("create.move",Pl,function(a){var s=a.hover,c=a.context,u=c.elements,l=c.dragGroup;l||(l=c.dragGroup=o(u));var f;s?(l.parentNode||(f=t.getActiveLayer(),D(f,l)),gt(l,a.x,a.y)):K(l)}),e.on("create.cleanup",function(a){var s=a.context,c=s.dragGroup;c&&K(c)})}as.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];var Ol={__depends__:[bt,Bn,Mt,Ee],__init__:["create","createPreview"],create:["type",os],createPreview:["type",as]};function Ke(){}Ke.prototype.get=function(){return this._data};Ke.prototype.set=function(t){this._data=t};Ke.prototype.clear=function(){var t=this._data;return delete this._data,t};Ke.prototype.isEmpty=function(){return!this._data};var Ll={clipboard:["type",Ke]};function rr(t){var e=this;this._lastMoveEvent=null;function n(i){e._lastMoveEvent=i}t.on("canvas.init",function(i){var r=e._svg=i.svg;r.addEventListener("mousemove",n)}),t.on("canvas.destroy",function(){e._lastMouseEvent=null,e._svg.removeEventListener("mousemove",n)})}rr.$inject=["eventBus"];rr.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||Il(0,0)};function Il(t,e){var n=document.createEvent("MouseEvent"),i=t,r=e,o=t,a=e;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,i,r,o,a,!1,!1,!1,!1,0,null),n}var Ye={__init__:["mouse"],mouse:["type",rr]};function _t(t,e,n,i,r,o,a,s){this._canvas=t,this._create=e,this._clipboard=n,this._elementFactory=i,this._eventBus=r,this._modeling=o,this._mouse=a,this._rules=s,r.on("copyPaste.copyElement",function(c){var u=c.descriptor,l=c.element,f=c.elements;u.priority=1,u.id=l.id;var h=nt(f,function(d){return d===l.parent});h&&(u.parent=l.parent.id),kl(l)&&(u.priority=2,u.host=l.host.id),Vn(l)&&(u.priority=3,u.source=l.source.id,u.target=l.target.id,u.waypoints=Al(l)),Wn(l)&&(u.priority=4,u.labelTarget=l.labelTarget.id),m(["x","y","width","height"],function(d){I(l[d])&&(u[d]=l[d])}),u.hidden=l.hidden,u.collapsed=l.collapsed}),r.on("copyPaste.pasteElements",function(c){var u=c.hints;M(u,{createElementsBehavior:!1})})}_t.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"];_t.prototype.copy=function(t){var e,n;return N(t)||(t=t?[t]:[]),e=this._eventBus.fire("copyPaste.canCopyElements",{elements:t}),e===!1?n={}:n=this.createTree(N(e)?e:t),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:t,tree:n}),n};_t.prototype.paste=function(t){var e=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=t&&t.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var i=this._createElements(e);if(t&&t.element&&t.point)return this._paste(i,t.element,t.point,n);this._create.start(this._mouse.getLastMoveEvent(),i,{hints:n||{}})}};_t.prototype._paste=function(t,e,n,i){m(t,function(o){I(o.x)||(o.x=0),I(o.y)||(o.y=0)});var r=q(t);return m(t,function(o){Vn(o)&&(o.waypoints=pt(o.waypoints,function(a){return{x:a.x-r.x-r.width/2,y:a.y-r.y-r.height/2}})),M(o,{x:o.x-r.x-r.width/2,y:o.y-r.y-r.height/2})}),this._modeling.createElements(t,n,e,M({},i))};_t.prototype._createElements=function(t){var e=this,n=this._eventBus,i={},r=[];return m(t,function(o,a){o=Nt(o,"priority"),m(o,function(s){var c=M({},ve(s,["priority"]));i[s.parent]?c.parent=i[s.parent]:delete c.parent,n.fire("copyPaste.pasteElement",{cache:i,descriptor:c});var u;if(Vn(c)){c.source=i[s.source],c.target=i[s.target],u=i[s.id]=e.createConnection(c),r.push(u);return}if(Wn(c)){c.labelTarget=i[c.labelTarget],u=i[s.id]=e.createLabel(c),r.push(u);return}c.host&&(c.host=i[c.host]),u=i[s.id]=e.createShape(c),r.push(u)})}),r};_t.prototype.createConnection=function(t){var e=this._elementFactory.createConnection(ve(t,["id"]));return e};_t.prototype.createLabel=function(t){var e=this._elementFactory.createLabel(ve(t,["id"]));return e};_t.prototype.createShape=function(t){var e=this._elementFactory.createShape(ve(t,["id"]));return e};_t.prototype.hasRelations=function(t,e){var n,i,r;return!(Vn(t)&&(i=nt(e,Dt({id:t.source.id})),r=nt(e,Dt({id:t.target.id})),!i||!r)||Wn(t)&&(n=nt(e,Dt({id:t.labelTarget.id})),!n))};_t.prototype.createTree=function(t){var e=this._rules,n=this,i={},r=[],o=na(t);function a(u,l){return e.allowed("element.copy",{element:u,elements:l})}function s(u,l){var f=nt(r,function(h){return u===h.element});if(!f){r.push({element:u,depth:l});return}f.depth<l&&(r=c(f,r),r.push({element:f.element,depth:l}))}function c(u,l){var f=l.indexOf(u);return f!==-1&&l.splice(f,1),l}return Dn(o,function(u,l,f){if(Wn(u))return;m(u.labels,function(p){s(p,f)});function h(p){p&&p.length&&m(p,function(_){m(_.labels,function(g){s(g,f)}),s(_,f)})}m([u.attachers,u.incoming,u.outgoing],h),s(u,f);var d=[];return u.children&&(d=u.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:u,children:d}),d}),t=pt(r,function(u){return u.element}),r=pt(r,function(u){return u.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:u.descriptor,element:u.element,elements:t}),u}),r=Nt(r,function(u){return u.descriptor.priority}),t=pt(r,function(u){return u.element}),m(r,function(u){var l=u.depth;if(!n.hasRelations(u.element,t)){co(u.element,t);return}if(!a(u.element,t)){co(u.element,t);return}i[l]||(i[l]=[]),i[l].push(u.descriptor)}),i};function kl(t){return!!t.host}function Vn(t){return!!t.waypoints}function Wn(t){return!!t.labelTarget}function Al(t){return pt(t.waypoints,function(e){return e=so(e),e.original&&(e.original=so(e.original)),e})}function so(t){return M({},t)}function co(t,e){var n=e.indexOf(t);return n===-1?e:e.splice(n,1)}var ld={__depends__:[Ll,Ol,Ye,Mt],__init__:["copyPaste"],copyPaste:["type",_t]},uo=Math.round;function or(t){this._modeling=t}or.$inject=["modeling"];or.prototype.replaceElement=function(t,e,n){if(t.waypoints)return null;var i=this._modeling,r=e.width||t.width,o=e.height||t.height,a=e.x||t.x,s=e.y||t.y,c=uo(a+r/2),u=uo(s+o/2);return i.replaceShape(t,M({},e,{x:c,y:u,width:r,height:o}),n)};var fd={__init__:["replace"],replace:["type",or]},Ln=Math.max,In=Math.min,$l=20;function hd(t,e){return{top:t.top-e.top,right:t.right-e.right,bottom:t.bottom-e.bottom,left:t.left-e.left}}function Dl(t,e,n){var i=n.x,r=n.y,o={x:t.x,y:t.y,width:t.width,height:t.height};return e.indexOf("n")!==-1?(o.y=t.y+r,o.height=t.height-r):e.indexOf("s")!==-1&&(o.height=t.height+r),e.indexOf("e")!==-1?o.width=t.width+i:e.indexOf("w")!==-1&&(o.x=t.x+i,o.width=t.width-i),o}function dd(t,e){return{x:t.x+(e.left||0),y:t.y+(e.top||0),width:t.width-(e.left||0)+(e.right||0),height:t.height-(e.top||0)+(e.bottom||0)}}function hn(t,e,n){var i=e[t],r=n.min&&n.min[t],o=n.max&&n.max[t];return I(r)&&(i=(/top|left/.test(t)?In:Ln)(i,r)),I(o)&&(i=(/top|left/.test(t)?Ln:In)(i,o)),i}function jl(t,e){if(!e)return t;var n=A(t);return Ui({top:hn("top",n,e),right:hn("right",n,e),bottom:hn("bottom",n,e),left:hn("left",n,e)})}function Hl(t,e,n,i){var r=A(e),o={top:/n/.test(t)?r.bottom-n.height:r.top,left:/w/.test(t)?r.right-n.width:r.left,bottom:/s/.test(t)?r.top+n.height:r.bottom,right:/e/.test(t)?r.left+n.width:r.right},a=i?A(i):o,s={top:In(o.top,a.top),left:In(o.left,a.left),bottom:Ln(o.bottom,a.bottom),right:Ln(o.right,a.right)};return Ui(s)}function Oe(t,e){return typeof t<"u"?t:$l}function Nl(t,e){var n,i,r,o;return typeof e=="object"?(n=Oe(e.left),i=Oe(e.right),r=Oe(e.top),o=Oe(e.bottom)):n=i=r=o=Oe(e),{x:t.x-n,y:t.y-r,width:t.width+n+i,height:t.height+r+o}}function zl(t){return!(t.waypoints||t.type==="label")}function Gl(t,e){var n;if(t.length===void 0?n=at(t.children,zl):n=t,n.length)return Nl(q(n),e)}var ss=".djs-palette-toggle",cs=".entry",Bl=ss+", "+cs,Pi="djs-palette-",Vl="shown",Oi="open",lo="two-column",Wl=1e3;function F(t,e){this._eventBus=t,this._canvas=e;var n=this;t.on("tool-manager.update",function(i){var r=i.tool;n.updateToolHighlight(r)}),t.on("i18n.changed",function(){n._update()}),t.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}F.$inject=["eventBus","canvas"];F.prototype.registerProvider=function(t,e){e||(e=t,t=Wl),this._eventBus.on("palette.getProviders",t,function(n){n.providers.push(e)}),this._rebuild()};F.prototype.getEntries=function(){var t=this._getProviders();return t.reduce(Fl,{})};F.prototype._rebuild=function(){if(!!this._diagramInitialized){var t=this._getProviders();!t.length||(this._container||this._init(),this._update())}};F.prototype._init=function(){var t=this,e=this._eventBus,n=this._getParentContainer(),i=this._container=Y(F.HTML_MARKUP);n.appendChild(i),it(n).add(Pi+Vl),yt.bind(i,Bl,"click",function(r){var o=r.delegateTarget;if(Hi(o,ss))return t.toggle();t.trigger("click",r)}),j.bind(i,"mousedown",function(r){r.stopPropagation()}),yt.bind(i,cs,"dragstart",function(r){t.trigger("dragstart",r)}),e.on("canvas.resized",this._layoutChanged,this),e.fire("palette.create",{container:i})};F.prototype._getProviders=function(t){var e=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};F.prototype._toggleState=function(t){t=t||{};var e=this._getParentContainer(),n=this._container,i=this._eventBus,r,o=it(n),a=it(e);"twoColumn"in t?r=t.twoColumn:r=this._needsCollapse(e.clientHeight,this._entries||{}),o.toggle(lo,r),a.toggle(Pi+lo,r),"open"in t&&(o.toggle(Oi,t.open),a.toggle(Pi+Oi,t.open)),i.fire("palette.changed",{twoColumn:r,open:this.isOpen()})};F.prototype._update=function(){var t=Q(".djs-palette-entries",this._container),e=this._entries=this.getEntries();$n(t),m(e,function(n,i){var r=n.group||"default",o=Q("[data-group="+Ni(r)+"]",t);o||(o=Y('<div class="group"></div>'),ot(o,"data-group",r),t.appendChild(o));var a=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),s=Y(a);if(o.appendChild(s),!n.separator&&(ot(s,"data-action",i),n.title&&ot(s,"title",n.title),n.className&&Ul(s,n.className),n.imageUrl)){var c=Y("<img>");ot(c,"src",n.imageUrl),s.appendChild(c)}}),this.open()};F.prototype.trigger=function(t,e,n){var i,r,o=e.delegateTarget||e.target;return o?(i=ot(o,"data-action"),r=e.originalEvent||e,this.triggerEntry(i,t,r,n)):e.preventDefault()};F.prototype.triggerEntry=function(t,e,n,i){var r=this._entries,o,a;if(o=r[t],!!o){if(a=o.action,st(a)){if(e==="click")return a(n,i)}else if(a[e])return a[e](n,i);n.preventDefault()}};F.prototype._layoutChanged=function(){this._toggleState({})};F.prototype._needsCollapse=function(t,e){var n=50,i=Object.keys(e).length*46;return t<i+n};F.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};F.prototype.open=function(){this._toggleState({open:!0})};F.prototype.toggle=function(t){this.isOpen()?this.close():this.open()};F.prototype.isActiveTool=function(t){return t&&this._activeTool===t};F.prototype.updateToolHighlight=function(t){var e,n;this._toolsContainer||(e=Q(".djs-palette-entries",this._container),this._toolsContainer=Q("[data-group=tools]",e)),n=this._toolsContainer,m(n.children,function(i){var r=i.getAttribute("data-action");if(!!r){var o=it(i);r=r.replace("-tool",""),o.contains("entry")&&r===t?o.add("highlighted-entry"):o.remove("highlighted-entry")}})};F.prototype.isOpen=function(){return it(this._container).has(Oi)};F.prototype._getParentContainer=function(){return this._canvas.getContainer()};F.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function Ul(t,e){var n=it(t),i=N(e)?e:e.split(/\s+/g);i.forEach(function(r){n.add(r)})}function Fl(t,e){var n=e.getPaletteEntries();return st(n)?n(t):(m(n,function(i,r){t[r]=i}),t)}var pd={__init__:["palette"],palette:["type",F]},Kl={horizontal:["x","width"],vertical:["y","height"]},fo=5;function Pt(t,e){this._modeling=t,this._filters=[],this.registerFilter(function(n){var i=e.allowed("elements.distribute",{elements:n});return N(i)?i:i?n:[]})}Pt.$inject=["modeling","rules"];Pt.prototype.registerFilter=function(t){if(typeof t!="function")throw new Error("the filter has to be a function");this._filters.push(t)};Pt.prototype.trigger=function(t,e){var n=this._modeling,i,r;if(!(t.length<3)&&(this._setOrientation(e),r=this._filterElements(t),i=this._createGroups(r),!(i.length<=2)))return n.distributeElements(i,this._axis,this._dimension),i};Pt.prototype._filterElements=function(t){var e=this._filters,n=this._axis,i=this._dimension,r=[].concat(t);return e.length?(m(e,function(o){r=o(r,n,i)}),r):t};Pt.prototype._createGroups=function(t){var e=[],n=this,i=this._axis,r=this._dimension;if(!i)throw new Error('must have a defined "axis" and "dimension"');var o=Nt(t,i);return m(o,function(a,s){var c=n._findRange(a,i,r),u,l=e[e.length-1];l&&n._hasIntersection(l.range,c)?e[e.length-1].elements.push(a):(u={range:c,elements:[a]},e.push(u))}),e};Pt.prototype._setOrientation=function(t){var e=Kl[t];this._axis=e[0],this._dimension=e[1]};Pt.prototype._hasIntersection=function(t,e){return Math.max(t.min,t.max)>=Math.min(e.min,e.max)&&Math.min(t.min,t.max)<=Math.max(e.min,e.max)};Pt.prototype._findRange=function(t){var e=t[this._axis],n=t[this._dimension];return{min:e+fo,max:e+n-fo}};var gd={__init__:["distributeElements"],distributeElements:["type",Pt]},us="is not a registered action",Yl="is already registered";function Ot(t,e){this._actions={};var n=this;t.on("diagram.init",function(){n._registerDefaultActions(e),t.fire("editorActions.init",{editorActions:n})})}Ot.$inject=["eventBus","injector"];Ot.prototype._registerDefaultActions=function(t){var e=t.get("commandStack",!1),n=t.get("modeling",!1),i=t.get("selection",!1),r=t.get("zoomScroll",!1),o=t.get("copyPaste",!1),a=t.get("canvas",!1),s=t.get("rules",!1),c=t.get("keyboardMove",!1),u=t.get("keyboardMoveSelection",!1);e&&(this.register("undo",function(){e.undo()}),this.register("redo",function(){e.redo()})),o&&i&&this.register("copy",function(){var l=i.get();if(l.length)return o.copy(l)}),o&&this.register("paste",function(){o.paste()}),r&&this.register("stepZoom",function(l){r.stepZoom(l.value)}),a&&this.register("zoom",function(l){a.zoom(l.value)}),n&&i&&s&&this.register("removeSelection",function(){var l=i.get();if(!!l.length){var f=s.allowed("elements.delete",{elements:l}),h;f!==!1&&(N(f)?h=f:h=l,h.length&&n.removeElements(h.slice()))}}),c&&this.register("moveCanvas",function(l){c.moveCanvas(l)}),u&&this.register("moveSelection",function(l){u.moveSelection(l.direction,l.accelerated)})};Ot.prototype.trigger=function(t,e){if(!this._actions[t])throw ar(t,us);return this._actions[t](e)};Ot.prototype.register=function(t,e){var n=this;if(typeof t=="string")return this._registerAction(t,e);m(t,function(i,r){n._registerAction(r,i)})};Ot.prototype._registerAction=function(t,e){if(this.isRegistered(t))throw ar(t,Yl);this._actions[t]=e};Ot.prototype.unregister=function(t){if(!this.isRegistered(t))throw ar(t,us);this._actions[t]=void 0};Ot.prototype.getActions=function(){return Object.keys(this._actions)};Ot.prototype.isRegistered=function(t){return!!this._actions[t]};function ar(t,e){return new Error(t+" "+e)}var vd={__init__:["editorActions"],editorActions:["type",Ot]},wn=10;function fi(t,e,n){return n||(n="round"),Math[n](t/e)*e}var Zl=1200,Xl=800;function Wt(t,e,n){var i=!n||n.active!==!1;this._eventBus=e;var r=this;e.on("diagram.init",Xl,function(){r.setActive(i)}),e.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],Zl,function(o){var a=o.originalEvent;if(!(!r.active||a&&vt(a))){var s=o.context,c=s.gridSnappingContext;c||(c=s.gridSnappingContext={}),["x","y"].forEach(function(u){var l={},f=Jl(o,u,t);f&&(l.offset=f);var h=ql(o,u);h&&M(l,h),Ne(o,u)||r.snapEvent(o,u,l)})}})}Wt.prototype.snapEvent=function(t,e,n){var i=this.snapValue(t[e],n);mt(t,e,i)};Wt.prototype.getGridSpacing=function(){return wn};Wt.prototype.snapValue=function(t,e){var n=0;e&&e.offset&&(n=e.offset),t+=n,t=fi(t,wn);var i,r;return e&&e.min&&(i=e.min,I(i)&&(i=fi(i+n,wn,"ceil"),t=Math.max(t,i))),e&&e.max&&(r=e.max,I(r)&&(r=fi(r+n,wn,"floor"),t=Math.min(t,r))),t-=n,t};Wt.prototype.isActive=function(){return this.active};Wt.prototype.setActive=function(t){this.active=t,this._eventBus.fire("gridSnapping.toggle",{active:t})};Wt.prototype.toggleActive=function(){this.setActive(!this.active)};Wt.$inject=["elementRegistry","eventBus","config.gridSnapping"];function ql(t,e){var n=t.context,i=n.createConstraints,r=n.resizeConstraints||{},o=n.gridSnappingContext,a=o.snapConstraints;if(a&&a[e])return a[e];a||(a=o.snapConstraints={}),a[e]||(a[e]={});var s=n.direction;i&&(Sn(e)?(a.x.min=i.left,a.x.max=i.right):(a.y.min=i.top,a.y.max=i.bottom));var c=r.min,u=r.max;return c&&(Sn(e)?po(s)?a.x.max=c.left:a.x.min=c.right:ho(s)?a.y.max=c.top:a.y.min=c.bottom),u&&(Sn(e)?po(s)?a.x.min=u.left:a.x.max=u.right:ho(s)?a.y.min=u.top:a.y.max=u.bottom),a[e]}function Jl(t,e,n){var i=t.context,r=t.shape,o=i.gridSnappingContext,a=o.snapLocation,s=o.snapOffset;return s&&I(s[e])||(s||(s=o.snapOffset={}),I(s[e])||(s[e]=0),!r)||(n.get(r.id)||(Sn(e)?s[e]+=r[e]+r.width/2:s[e]+=r[e]+r.height/2),!a)||(e==="x"?/left/.test(a)?s[e]-=r.width/2:/right/.test(a)&&(s[e]+=r.width/2):/top/.test(a)?s[e]-=r.height/2:/bottom/.test(a)&&(s[e]+=r.height/2)),s[e]}function Sn(t){return t==="x"}function ho(t){return t.indexOf("n")!==-1}function po(t){return t.indexOf("w")!==-1}function re(t,e){rt.call(this,t),this._gridSnapping=e;var n=this;this.preExecute("shape.resize",function(i){var r=i.context,o=r.hints||{},a=o.autoResize;if(!!a){var s=r.shape,c=r.newBounds;je(a)?r.newBounds=n.snapComplex(c,a):r.newBounds=n.snapSimple(s,c)}})}re.$inject=["eventBus","gridSnapping","modeling"];lt(re,rt);re.prototype.snapSimple=function(t,e){var n=this._gridSnapping;return e.width=n.snapValue(e.width,{min:e.width}),e.height=n.snapValue(e.height,{min:e.height}),e.x=t.x+t.width/2-e.width/2,e.y=t.y+t.height/2-e.height/2,e};re.prototype.snapComplex=function(t,e){return/w|e/.test(e)&&(t=this.snapHorizontally(t,e)),/n|s/.test(e)&&(t=this.snapVertically(t,e)),t};re.prototype.snapHorizontally=function(t,e){var n=this._gridSnapping,i=/w/.test(e),r=/e/.test(e),o={};return o.width=n.snapValue(t.width,{min:t.width}),r&&(i?(o.x=n.snapValue(t.x,{max:t.x}),o.width+=n.snapValue(t.x-o.x,{min:t.x-o.x})):t.x=t.x+t.width-o.width),M(t,o),t};re.prototype.snapVertically=function(t,e){var n=this._gridSnapping,i=/n/.test(e),r=/s/.test(e),o={};return o.height=n.snapValue(t.height,{min:t.height}),i&&(r?(o.y=n.snapValue(t.y,{max:t.y}),o.height+=n.snapValue(t.y-o.y,{min:t.y-o.y})):t.y=t.y+t.height-o.height),M(t,o),t};var Ql=2e3;function ls(t,e){t.on(["spaceTool.move","spaceTool.end"],Ql,function(n){var i=n.context;if(!!i.initialized){var r=i.axis,o;r==="x"?(o=e.snapValue(n.dx),n.x=n.x+o-n.dx,n.dx=o):(o=e.snapValue(n.dy),n.y=n.y+o-n.dy,n.dy=o)}})}ls.$inject=["eventBus","gridSnapping"];var tf={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",re],gridSnappingSpaceToolBehavior:["type",ls]},yd={__depends__:[tf],__init__:["gridSnapping"],gridSnapping:["type",Wt]},ef={moveSpeed:1,moveSpeedAccelerated:10},nf=1500,go="left",vo="up",yo="right",_o="down",rf={ArrowLeft:go,Left:go,ArrowUp:vo,Up:vo,ArrowRight:yo,Right:yo,ArrowDown:_o,Down:_o},of={left:function(t){return{x:-t,y:0}},up:function(t){return{x:0,y:-t}},right:function(t){return{x:t,y:0}},down:function(t){return{x:0,y:t}}};function fs(t,e,n,i,r){var o=this;this._config=M({},ef,t||{}),e.addListener(nf,function(a){var s=a.keyEvent,c=rf[s.key];if(!!c&&!e.isCmd(s)){var u=e.isShift(s);return o.moveSelection(c,u),!0}}),this.moveSelection=function(a,s){var c=r.get();if(!!c.length){var u=this._config[s?"moveSpeedAccelerated":"moveSpeed"],l=of[a](u),f=i.allowed("elements.move",{shapes:c});f&&n.moveElements(c,l)}}}fs.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];var _d={__depends__:[Oa,Ee],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",fs]},mo=10;function Ze(t,e,n,i){this._dragging=i,this._rules=e;var r=this;function o(c,u){var l=c.shape,f=c.direction,h=c.resizeConstraints,d;c.delta=u,d=Dl(l,f,u),c.newBounds=jl(d,h),c.canExecute=r.canResize(c)}function a(c){var u=c.resizeConstraints,l=c.minBounds;u===void 0&&(l===void 0&&(l=r.computeMinResizeBox(c)),c.resizeConstraints={min:A(l)})}function s(c){var u=c.shape,l=c.canExecute,f=c.newBounds;if(l){if(f=tc(f),!af(u,f))return;n.resizeShape(u,f)}}t.on("resize.start",function(c){a(c.context)}),t.on("resize.move",function(c){var u={x:c.dx,y:c.dy};o(c.context,u)}),t.on("resize.end",function(c){s(c.context)})}Ze.prototype.canResize=function(t){var e=this._rules,n=He(t,["newBounds","shape","delta","direction"]);return e.allowed("shape.resize",n)};Ze.prototype.activate=function(t,e,n){var i=this._dragging,r,o;if(typeof n=="string"&&(n={direction:n}),r=M({shape:e},n),o=r.direction,!o)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");i.init(t,hs(e,o),"resize",{autoActivate:!0,cursor:sf(o),data:{shape:e,context:r}})};Ze.prototype.computeMinResizeBox=function(t){var e=t.shape,n=t.direction,i,r;return i=t.minDimensions||{width:mo,height:mo},r=Gl(e,t.childrenBoxPadding),Hl(n,e,i,r)};Ze.$inject=["eventBus","rules","modeling","dragging"];function af(t,e){return t.x!==e.x||t.y!==e.y||t.width!==e.width||t.height!==e.height}function hs(t,e){var n=V(t),i=A(t),r={x:n.x,y:n.y};return e.indexOf("n")!==-1?r.y=i.top:e.indexOf("s")!==-1&&(r.y=i.bottom),e.indexOf("e")!==-1?r.x=i.right:e.indexOf("w")!==-1&&(r.x=i.left),r}function sf(t){var e="resize-";return t==="n"||t==="s"?e+"ns":t==="e"||t==="w"?e+"ew":t==="nw"||t==="se"?e+"nwse":e+"nesw"}var xo="djs-resizing",Eo="resize-not-ok",cf=500;function ds(t,e,n){function i(o){var a=o.shape,s=o.newBounds,c=o.frame;c||(c=o.frame=n.addFrame(a,e.getActiveLayer()),e.addMarker(a,xo)),s.width>5&&P(c,{x:s.x,width:s.width}),s.height>5&&P(c,{y:s.y,height:s.height}),o.canExecute?H(c).remove(Eo):H(c).add(Eo)}function r(o){var a=o.shape,s=o.frame;s&&K(o.frame),e.removeMarker(a,xo)}t.on("resize.move",cf,function(o){i(o.context)}),t.on("resize.cleanup",function(o){r(o.context)})}ds.$inject=["eventBus","canvas","previewSupport"];var dn=-6,pn=8,gn=20,Le="djs-resizer",uf=["n","w","s","e","nw","ne","se","sw"];function Ut(t,e,n,i){this._resize=i,this._canvas=e;var r=this;t.on("selection.changed",function(o){var a=o.newSelection;r.removeResizers(),a.length===1&&m(a,Ge(r.addResizer,r))}),t.on("shape.changed",function(o){var a=o.element;n.isSelected(a)&&(r.removeResizers(),r.addResizer(a))})}Ut.prototype.makeDraggable=function(t,e,n){var i=this._resize;function r(o){Vt(o)&&i.activate(o,t,n)}j.bind(e,"mousedown",r),j.bind(e,"touchstart",r)};Ut.prototype._createResizer=function(t,e,n,i){var r=this._getResizersParent(),o=lf(i),a=$("g");H(a).add(Le),H(a).add(Le+"-"+t.id),H(a).add(Le+"-"+i),D(r,a);var s=$("rect");P(s,{x:-pn/2+o.x,y:-pn/2+o.y,width:pn,height:pn}),H(s).add(Le+"-visual"),D(a,s);var c=$("rect");return P(c,{x:-gn/2+o.x,y:-gn/2+o.y,width:gn,height:gn}),H(c).add(Le+"-hit"),D(a,c),yc(a,e,n),a};Ut.prototype.createResizer=function(t,e){var n=hs(t,e),i=this._createResizer(t,n.x,n.y,e);this.makeDraggable(t,i,e)};Ut.prototype.addResizer=function(t){var e=this;ff(t)||!this._resize.canResize({shape:t})||m(uf,function(n){e.createResizer(t,n)})};Ut.prototype.removeResizers=function(){var t=this._getResizersParent();$i(t)};Ut.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};Ut.$inject=["eventBus","canvas","selection","resize"];function lf(t){var e={x:0,y:0};return t.indexOf("e")!==-1?e.x=-dn:t.indexOf("w")!==-1&&(e.x=dn),t.indexOf("s")!==-1?e.y=-dn:t.indexOf("n")!==-1&&(e.y=dn),e}function ff(t){return!!t.waypoints}var md={__depends__:[Mt,bt,Bn],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Ze],resizePreview:["type",ds],resizeHandles:["type",Ut]};function Un(t,e,n){var i=$e(e),r=$e(n),o=jt(t,i),a={x:o.x*(n.width/e.width),y:o.y*(n.height/e.height)};return fe({x:r.x+a.x,y:r.y+a.y})}function wo(t,e,n){var i=$e(t),r=$e(e),o=$e(n),a=jt(t,i),s=jt(i,r),c=hf(i,e,n);if(c)return c;var u={x:s.x*(n.width/e.width),y:s.y*(n.height/e.height)},l={x:o.x+u.x,y:o.y+u.y};return fe({x:l.x+a.x-t.x,y:l.y+a.y-t.y})}function hf(t,e,n){var i=A(e),r=A(n);if(df(i,r))return null;var o=Ct(e,t),a,s,c;if(o==="top")a={x:0,y:r.bottom-i.bottom};else if(o==="bottom")a={x:0,y:r.top-i.top};else if(o==="right")a={x:r.left-i.left,y:0};else if(o==="left")a={x:r.right-i.right,y:0};else return null;return s={x:t.x+a.x,y:t.y+a.y},c=Ct(n,s),c!==o?null:a}function df(t,e){return pf(t,e)||gf(t,e)}function pf(t,e){return t.right!==e.right&&t.left!==e.left}function gf(t,e){return t.top!==e.top&&t.bottom!==e.bottom}function sr(t,e,n){var i=Fn(t),r=gs(i,e),o=i[0];return r.length?r[r.length-1]:Un(o.original||o,n,e)}function cr(t,e,n){var i=Fn(t),r=gs(i,e),o=i[i.length-1];return r.length?r[0]:Un(o.original||o,n,e)}function ur(t,e,n){var i=Fn(t),r=ps(e,n),o=i[0];return Un(o.original||o,r,e)}function lr(t,e,n){var i=Fn(t),r=ps(e,n),o=i[i.length-1];return Un(o.original||o,r,e)}function ps(t,e){return{x:t.x-e.x,y:t.y-e.y,width:t.width,height:t.height}}function Fn(t){var e=t.waypoints;if(!e.length)throw new Error("connection#"+t.id+": no waypoints");return e}function gs(t,e){var n=pt(t,yf);return at(n,function(i){return vf(i,e)})}function vf(t,e){return Ct(e,t,1)==="intersect"}function yf(t){return t.original||t}function vs(t){rt.call(this,t);var e=this;this.preExecute(["shape.create","connection.create"],function(n){var i=n.context,r=i.shape||i.connection,o=i.parent,a=e.getOrdering(r,o);a&&(a.parent!==void 0&&(i.parent=a.parent),i.parentIndex=a.index)}),this.preExecute(["shape.move","connection.move"],function(n){var i=n.context,r=i.shape||i.connection,o=i.newParent||r.parent,a=e.getOrdering(r,o);a&&(a.parent!==void 0&&(i.newParent=a.parent),i.newParentIndex=a.index)})}vs.prototype.getOrdering=function(t,e){return null};lt(vs,rt);var _f=250;function oe(t,e){this._eventBus=t,this._dragging=e,this._tools=[],this._active=null}oe.$inject=["eventBus","dragging"];oe.prototype.registerTool=function(t,e){var n=this._tools;if(!e)throw new Error(`A tool has to be registered with it's "events"`);n.push(t),this.bindEvents(t,e)};oe.prototype.isActive=function(t){return t&&this._active===t};oe.prototype.length=function(t){return this._tools.length};oe.prototype.setActive=function(t){var e=this._eventBus;this._active!==t&&(this._active=t,e.fire("tool-manager.update",{tool:t}))};oe.prototype.bindEvents=function(t,e){var n=this._eventBus,i=this._dragging,r=[];n.on(e.tool+".init",function(o){var a=o.context;if(!a.reactivate&&this.isActive(t)){this.setActive(null),i.cancel();return}this.setActive(t)},this),m(e,function(o){r.push(o+".ended"),r.push(o+".canceled")}),n.on(r,_f,function(o){!this._active||mf(o)||this.setActive(null)},this)};function mf(t){var e=t.originalEvent&&t.originalEvent.target;return e&&Gt(e,'.group[data-group="tools"]')}var Kn={__depends__:[bt],__init__:["toolManager"],toolManager:["type",oe]};function xf(t,e){if(t==="x"){if(e>0)return"e";if(e<0)return"w"}if(t==="y"){if(e>0)return"s";if(e<0)return"n"}return null}function Ef(t,e){var n=[];return m(t.concat(e),function(i){var r=i.incoming,o=i.outgoing;m(r.concat(o),function(a){var s=a.source,c=a.target;(Ie(t,s)||Ie(t,c)||Ie(e,s)||Ie(e,c))&&(Ie(n,a)||n.push(a))})}),n}function Ie(t,e){return t.indexOf(e)!==-1}function wf(t,e,n){var i=t.x,r=t.y,o=t.width,a=t.height,s=n.x,c=n.y;switch(e){case"n":return{x:i,y:r+c,width:o,height:a-c};case"s":return{x:i,y:r,width:o,height:a+c};case"w":return{x:i+s,y:r,width:o-s,height:a};case"e":return{x:i,y:r,width:o+s,height:a};default:throw new Error("unknown direction: "+e)}}var hi=Math.abs,Sf=Math.round,St={x:"width",y:"height"},ys="crosshair",kt={n:"top",w:"left",s:"bottom",e:"right"},Cf=1500,vn={n:"s",w:"e",s:"n",e:"w"},yn=20;function Lt(t,e,n,i,r,o,a){this._canvas=t,this._dragging=e,this._eventBus=n,this._modeling=i,this._rules=r,this._toolManager=o,this._mouse=a;var s=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",function(c){n.once("spaceTool.selection.ended",function(){s.activateMakeSpace(c.originalEvent)})}),n.on("spaceTool.move",Cf,function(c){var u=c.context,l=u.initialized;l||(l=u.initialized=s.init(c,u)),l&&Co(c)}),n.on("spaceTool.end",function(c){var u=c.context,l=u.axis,f=u.direction,h=u.movingShapes,d=u.resizingShapes,p=u.start;if(!!u.initialized){Co(c);var _={x:0,y:0};_[l]=Sf(c["d"+l]),s.makeSpace(h,d,_,f,p),n.once("spaceTool.ended",function(g){s.activateSelection(g.originalEvent,!0,!0)})}})}Lt.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"];Lt.prototype.activateSelection=function(t,e,n){this._dragging.init(t,"spaceTool.selection",{autoActivate:e,cursor:ys,data:{context:{reactivate:n}},trapClick:!1})};Lt.prototype.activateMakeSpace=function(t){this._dragging.init(t,"spaceTool",{autoActivate:!0,cursor:ys,data:{context:{}}})};Lt.prototype.makeSpace=function(t,e,n,i,r){return this._modeling.createSpace(t,e,n,i,r)};Lt.prototype.init=function(t,e){var n=hi(t.dx)>hi(t.dy)?"x":"y",i=t["d"+n],r=t[n]-i;if(hi(i)<5)return!1;i<0&&(i*=-1),Pn(t)&&(i*=-1);var o=xf(n,i),a=this._canvas.getRootElement(),s=ra(a,!0),c=this.calculateAdjustments(s,n,i,r),u=this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:o,shapes:c.resizingShapes,start:r}),l=Rf(c,n,o,r,u);return M(e,c,{axis:n,direction:o,spaceToolConstraints:l,start:r}),Gn("resize-"+(n==="x"?"ew":"ns")),!0};Lt.prototype.calculateAdjustments=function(t,e,n,i){var r=this._rules,o=[],a=[],s=[],c=[];function u(h){o.includes(h)||o.push(h);var d=h.label;d&&!o.includes(d)&&o.push(d)}function l(h){a.includes(h)||a.push(h)}m(t,function(h){if(!(!h.parent||Ii(h))){if(Li(h)){c.push(h);return}var d=h[e],p=d+h[St[e]];if(bf(h)&&(n>0&&V(h)[e]>i||n<0&&V(h)[e]<i)){s.push(h);return}if(n>0&&d>i||n<0&&p<i){u(h);return}if(d<i&&p>i&&r.allowed("shape.resize",{shape:h})){l(h);return}}}),m(o,function(h){var d=h.attachers;d&&m(d,function(p){u(p)})});var f=o.concat(a);return m(s,function(h){var d=h.host;te(f,d)&&u(h)}),f=o.concat(a),m(c,function(h){var d=h.source,p=h.target,_=h.label;te(f,d)&&te(f,p)&&_&&u(_)}),{movingShapes:o,resizingShapes:a}};Lt.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)};Lt.prototype.isActive=function(){var t=this._dragging.context();return t?/^spaceTool/.test(t.prefix):!1};function So(t){return{top:t.top-yn,right:t.right+yn,bottom:t.bottom+yn,left:t.left-yn}}function Co(t){var e=t.context,n=e.spaceToolConstraints;if(!!n){var i,r;I(n.left)&&(i=Math.max(t.x,n.left),t.dx=t.dx+i-t.x,t.x=i),I(n.right)&&(i=Math.min(t.x,n.right),t.dx=t.dx+i-t.x,t.x=i),I(n.top)&&(r=Math.max(t.y,n.top),t.dy=t.dy+r-t.y,t.y=r),I(n.bottom)&&(r=Math.min(t.y,n.bottom),t.dy=t.dy+r-t.y,t.y=r)}}function Rf(t,e,n,i,r){var o=t.movingShapes,a=t.resizingShapes;if(!!a.length){var s={},c,u;return m(a,function(l){var f=l.attachers,h=l.children,d=A(l),p=at(h,function(R){return!Li(R)&&!Ii(R)&&!te(o,R)&&!te(a,R)}),_=at(h,function(R){return!Li(R)&&!Ii(R)&&te(o,R)}),g,b,S,v=[],y=[],x,E,O,w;p.length&&(b=So(A(q(p))),g=i-d[kt[n]]+b[kt[n]],n==="n"?s.bottom=u=I(u)?Math.min(u,g):g:n==="w"?s.right=u=I(u)?Math.min(u,g):g:n==="s"?s.top=c=I(c)?Math.max(c,g):g:n==="e"&&(s.left=c=I(c)?Math.max(c,g):g)),_.length&&(S=So(A(q(_))),g=i-S[kt[vn[n]]]+d[kt[vn[n]]],n==="n"?s.bottom=u=I(u)?Math.min(u,g):g:n==="w"?s.right=u=I(u)?Math.min(u,g):g:n==="s"?s.top=c=I(c)?Math.max(c,g):g:n==="e"&&(s.left=c=I(c)?Math.max(c,g):g)),f&&f.length&&(f.forEach(function(R){te(o,R)?v.push(R):y.push(R)}),v.length&&(x=A(q(v.map(V))),E=d[kt[vn[n]]]-(x[kt[vn[n]]]-i)),y.length&&(O=A(q(y.map(V))),w=O[kt[n]]-(d[kt[n]]-i)),n==="n"?(g=Math.min(E||1/0,w||1/0),s.bottom=u=I(u)?Math.min(u,g):g):n==="w"?(g=Math.min(E||1/0,w||1/0),s.right=u=I(u)?Math.min(u,g):g):n==="s"?(g=Math.max(E||-1/0,w||-1/0),s.top=c=I(c)?Math.max(c,g):g):n==="e"&&(g=Math.max(E||-1/0,w||-1/0),s.left=c=I(c)?Math.max(c,g):g));var C=r&&r[l.id];C&&(n==="n"?(g=i+l[St[e]]-C[St[e]],s.bottom=u=I(u)?Math.min(u,g):g):n==="w"?(g=i+l[St[e]]-C[St[e]],s.right=u=I(u)?Math.min(u,g):g):n==="s"?(g=i-l[St[e]]+C[St[e]],s.top=c=I(c)?Math.max(c,g):g):n==="e"&&(g=i-l[St[e]]+C[St[e]],s.left=c=I(c)?Math.max(c,g):g))}),s}}function te(t,e){return t.indexOf(e)!==-1}function bf(t){return!!t.host}function Li(t){return!!t.waypoints}function Ii(t){return!!t.labelTarget}var di="djs-dragging",Ro="djs-resizing",Mf=250,_n=Math.max;function _s(t,e,n,i,r){function o(a,s){m(a,function(c){r.addDragger(c,s),n.addMarker(c,di)})}t.on("spaceTool.selection.start",function(a){var s=n.getLayer("space"),c=a.context,u={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},l=$("g");P(l,i.cls("djs-crosshair-group",["no-events"])),D(s,l);var f=$("path");P(f,"d",u.x),H(f).add("djs-crosshair"),D(l,f);var h=$("path");P(h,"d",u.y),H(h).add("djs-crosshair"),D(l,h),c.crosshairGroup=l}),t.on("spaceTool.selection.move",function(a){var s=a.context.crosshairGroup;gt(s,a.x,a.y)}),t.on("spaceTool.selection.cleanup",function(a){var s=a.context,c=s.crosshairGroup;c&&K(c)}),t.on("spaceTool.move",Mf,function(a){var s=a.context,c=s.line,u=s.axis,l=s.movingShapes,f=s.resizingShapes;if(!!s.initialized){if(!s.dragGroup){var h=n.getLayer("space");c=$("path"),P(c,"d","M0,0 L0,0"),H(c).add("djs-crosshair"),D(h,c),s.line=c;var d=$("g");P(d,i.cls("djs-drag-group",["no-events"])),D(n.getActiveLayer(),d),o(l,d);var p=s.movingConnections=e.filter(function(y){var x=!1;m(l,function(C){m(C.outgoing,function(R){y===R&&(x=!0)})});var E=!1;m(l,function(C){m(C.incoming,function(R){y===R&&(E=!0)})});var O=!1;m(f,function(C){m(C.outgoing,function(R){y===R&&(O=!0)})});var w=!1;return m(f,function(C){m(C.incoming,function(R){y===R&&(w=!0)})}),Tf(y)&&(x||O)&&(E||w)});o(p,d),s.dragGroup=d}if(!s.frameGroup){var _=$("g");P(_,i.cls("djs-frame-group",["no-events"])),D(n.getActiveLayer(),_);var g=[];m(f,function(y){var x=r.addFrame(y,_),E=x.getBBox();g.push({element:x,initialBounds:E}),n.addMarker(y,Ro)}),s.frameGroup=_,s.frames=g}var b={x:"M"+a.x+", -10000 L"+a.x+", 10000",y:"M -10000, "+a.y+" L 10000, "+a.y};P(c,{d:b[u]});var S={x:"y",y:"x"},v={x:a.dx,y:a.dy};v[S[s.axis]]=0,gt(s.dragGroup,v.x,v.y),m(s.frames,function(y){var x=y.element,E=y.initialBounds,O,w;s.direction==="e"?P(x,{width:_n(E.width+v.x,5)}):(O=_n(E.width-v.x,5),P(x,{width:O,x:E.x+E.width-O})),s.direction==="s"?P(x,{height:_n(E.height+v.y,5)}):(w=_n(E.height-v.y,5),P(x,{height:w,y:E.y+E.height-w}))})}}),t.on("spaceTool.cleanup",function(a){var s=a.context,c=s.movingShapes,u=s.movingConnections,l=s.resizingShapes,f=s.line,h=s.dragGroup,d=s.frameGroup;m(c,function(p){n.removeMarker(p,di)}),m(u,function(p){n.removeMarker(p,di)}),h&&(K(f),K(h)),m(l,function(p){n.removeMarker(p,Ro)}),d&&K(d)})}_s.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];function Tf(t){return t.waypoints}var xd={__init__:["spaceToolPreview"],__depends__:[bt,Mt,Kn,Bn,Ye],spaceTool:["type",Lt],spaceToolPreview:["type",_s]};function B(t,e){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=e,this._eventBus=t,this._uid=1,t.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}B.$inject=["eventBus","injector"];B.prototype.execute=function(t,e){if(!t)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:t,context:e};this._pushAction(n),this._internalExecute(n),this._popAction(n)};B.prototype.canExecute=function(t,e){const n={command:t,context:e},i=this._getHandler(t);let r=this._fire(t,"canExecute",n);if(r===void 0){if(!i)return!1;i.canExecute&&(r=i.canExecute(e))}return r};B.prototype.clear=function(t){this._stack.length=0,this._stackIdx=-1,t!==!1&&this._fire("changed",{trigger:"clear"})};B.prototype.undo=function(){let t=this._getUndoAction(),e;if(t){for(this._currentExecution.trigger="undo",this._pushAction(t);t&&(this._internalUndo(t),e=this._getUndoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};B.prototype.redo=function(){let t=this._getRedoAction(),e;if(t){for(this._currentExecution.trigger="redo",this._pushAction(t);t&&(this._internalExecute(t,!0),e=this._getRedoAction(),!(!e||e.id!==t.id));)t=e;this._popAction()}};B.prototype.register=function(t,e){this._setHandler(t,e)};B.prototype.registerHandler=function(t,e){if(!t||!e)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(e);this.register(t,n)};B.prototype.canUndo=function(){return!!this._getUndoAction()};B.prototype.canRedo=function(){return!!this._getRedoAction()};B.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};B.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};B.prototype._internalUndo=function(t){const e=t.command,n=t.context,i=this._getHandler(e);this._atomicDo(()=>{this._fire(e,"revert",t),i.revert&&this._markDirty(i.revert(n)),this._revertedAction(t),this._fire(e,"reverted",t)})};B.prototype._fire=function(t,e,n){arguments.length<3&&(n=e,e=null);const i=e?[t+"."+e,e]:[t];let r;n=this._eventBus.createEvent(n);for(const o of i)if(r=this._eventBus.fire("commandStack."+o,n),n.cancelBubble)break;return r};B.prototype._createId=function(){return this._uid++};B.prototype._atomicDo=function(t){const e=this._currentExecution;e.atomic=!0;try{t()}finally{e.atomic=!1}};B.prototype._internalExecute=function(t,e){const n=t.command,i=t.context,r=this._getHandler(n);if(!r)throw new Error("no command handler registered for <"+n+">");this._pushAction(t),e||(this._fire(n,"preExecute",t),r.preExecute&&r.preExecute(i),this._fire(n,"preExecuted",t)),this._atomicDo(()=>{this._fire(n,"execute",t),r.execute&&this._markDirty(r.execute(i)),this._executedAction(t,e),this._fire(n,"executed",t)}),e||(this._fire(n,"postExecute",t),r.postExecute&&r.postExecute(i),this._fire(n,"postExecuted",t)),this._popAction(t)};B.prototype._pushAction=function(t){const e=this._currentExecution,n=e.actions,i=n[0];if(e.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+t.command+")");t.id||(t.id=i&&i.id||this._createId()),n.push(t)};B.prototype._popAction=function(){const t=this._currentExecution,e=t.trigger,n=t.actions,i=t.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:Hs("id",i.reverse())}),i.length=0,this._fire("changed",{trigger:e}),t.trigger=null)};B.prototype._markDirty=function(t){const e=this._currentExecution;!t||(t=N(t)?t:[t],e.dirty=e.dirty.concat(t))};B.prototype._executedAction=function(t,e){const n=++this._stackIdx;e||this._stack.splice(n,this._stack.length,t)};B.prototype._revertedAction=function(t){this._stackIdx--};B.prototype._getHandler=function(t){return this._handlerMap[t]};B.prototype._setHandler=function(t,e){if(!t||!e)throw new Error("command and handler required");if(this._handlerMap[t])throw new Error("overriding handler for command <"+t+">");this._handlerMap[t]=e};var Ed={commandStack:["type",B]},Pf=new Yi("tt");function Of(t){var e=Y('<div class="djs-tooltip-container" />');return Et(e,{position:"absolute",width:"0",height:"0"}),t.insertBefore(e,t.firstChild),e}function Lf(t,e,n){Et(t,{left:e+"px",top:n+"px"})}function fr(t,e){t.style.display=e===!1?"none":""}var ms="djs-tooltip",pi="."+ms;function ut(t,e){this._eventBus=t,this._canvas=e,this._ids=Pf,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=Of(e.getContainer());var n=this;yt.bind(this._tooltipRoot,pi,"mousedown",function(i){i.stopPropagation()}),yt.bind(this._tooltipRoot,pi,"mouseover",function(i){n.trigger("mouseover",i)}),yt.bind(this._tooltipRoot,pi,"mouseout",function(i){n.trigger("mouseout",i)}),this._init()}ut.$inject=["eventBus","canvas"];ut.prototype.add=function(t){if(!t.position)throw new Error("must specifiy tooltip position");if(!t.html)throw new Error("must specifiy tooltip html");var e=this._ids.next();return t=M({},this._tooltipDefaults,t,{id:e}),this._addTooltip(t),t.timeout&&this.setTimeout(t),e};ut.prototype.trigger=function(t,e){var n=e.delegateTarget||e.target,i=this.get(ot(n,"data-tooltip-id"));!i||(t==="mouseover"&&i.timeout&&this.clearTimeout(i),t==="mouseout"&&i.timeout&&(i.timeout=1e3,this.setTimeout(i)))};ut.prototype.get=function(t){return typeof t!="string"&&(t=t.id),this._tooltips[t]};ut.prototype.clearTimeout=function(t){if(t=this.get(t),!!t){var e=t.removeTimer;e&&(clearTimeout(e),t.removeTimer=null)}};ut.prototype.setTimeout=function(t){if(t=this.get(t),!!t){this.clearTimeout(t);var e=this;t.removeTimer=setTimeout(function(){e.remove(t)},t.timeout)}};ut.prototype.remove=function(t){var e=this.get(t);e&&(pe(e.html),pe(e.htmlContainer),delete e.htmlContainer,delete this._tooltips[e.id])};ut.prototype.show=function(){fr(this._tooltipRoot)};ut.prototype.hide=function(){fr(this._tooltipRoot,!1)};ut.prototype._updateRoot=function(t){var e=t.scale||1,n=t.scale||1,i="matrix("+e+",0,0,"+n+","+-1*t.x*e+","+-1*t.y*n+")";this._tooltipRoot.style.transform=i,this._tooltipRoot.style["-ms-transform"]=i};ut.prototype._addTooltip=function(t){var e=t.id,n=t.html,i,r=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),je(n)&&(n=Y(n)),i=Y('<div data-tooltip-id="'+e+'" class="'+ms+'">'),Et(i,{position:"absolute"}),i.appendChild(n),t.type&&it(i).add("djs-tooltip-"+t.type),t.className&&it(i).add(t.className),t.htmlContainer=i,r.appendChild(i),this._tooltips[e]=t,this._updateTooltip(t)};ut.prototype._updateTooltip=function(t){var e=t.position,n=t.htmlContainer;Lf(n,e.x,e.y)};ut.prototype._updateTooltipVisibilty=function(t){m(this._tooltips,function(e){var n=e.show,i=e.htmlContainer,r=!0;n&&((n.minZoom>t.scale||n.maxZoom<t.scale)&&(r=!1),fr(i,r))})};ut.prototype._init=function(){var t=this;function e(n){t._updateRoot(n),t._updateTooltipVisibilty(n),t.show()}this._eventBus.on("canvas.viewbox.changing",function(n){t.hide()}),this._eventBus.on("canvas.viewbox.changed",function(n){e(n.viewbox)})};var wd={__init__:["tooltips"],tooltips:["type",ut]};function Ht(t,e){if(typeof e!="function")throw new Error("removeFn iterator must be a function");if(!!t){for(var n;n=t[0];)e(n);return t}}var If=250,bo=1400;function hr(t,e,n){rt.call(this,e);var i=t.get("movePreview",!1);e.on("shape.move.start",bo,function(r){var o=r.context,a=o.shapes,s=o.validatedShapes;o.shapes=Mo(a),o.validatedShapes=Mo(s)}),i&&e.on("shape.move.start",If,function(r){var o=r.context,a=o.shapes,s=[];m(a,function(c){m(c.labels,function(u){!u.hidden&&o.shapes.indexOf(u)===-1&&s.push(u),c.labelTarget&&s.push(c)})}),m(s,function(c){i.makeDraggable(o,c,!0)})}),this.preExecuted("elements.move",bo,function(r){var o=r.context,a=o.closure,s=a.enclosedElements,c=[];m(s,function(u){m(u.labels,function(l){s[l.id]||c.push(l)})}),a.addAll(c)}),this.preExecute(["connection.delete","shape.delete"],function(r){var o=r.context,a=o.connection||o.shape;Ht(a.labels,function(s){n.removeShape(s,{nested:!0})})}),this.execute("shape.delete",function(r){var o=r.context,a=o.shape,s=a.labelTarget;s&&(o.labelTargetIndex=Vi(s.labels,a),o.labelTarget=s,a.labelTarget=null)}),this.revert("shape.delete",function(r){var o=r.context,a=o.shape,s=o.labelTarget,c=o.labelTargetIndex;s&&(Rt(s.labels,a,c),a.labelTarget=s)})}lt(hr,rt);hr.$inject=["injector","eventBus","modeling"];function Mo(t){return at(t,function(e){return t.indexOf(e.labelTarget)===-1})}var Sd={__init__:["labelSupport"],labelSupport:["type",hr]},kf=251,To=1401,Po="attach-ok";function dr(t,e,n,i,r){rt.call(this,e);var o=t.get("movePreview",!1);e.on("shape.move.start",To,function(a){var s=a.context,c=s.shapes,u=s.validatedShapes;s.shapes=Af(c),s.validatedShapes=$f(u)}),o&&e.on("shape.move.start",kf,function(a){var s=a.context,c=s.shapes,u=ki(c);m(u,function(l){o.makeDraggable(s,l,!0),m(l.labels,function(f){o.makeDraggable(s,f,!0)})})}),o&&e.on("shape.move.start",function(a){var s=a.context,c=s.shapes;if(c.length===1){var u=c[0],l=u.host;l&&(n.addMarker(l,Po),e.once(["shape.move.out","shape.move.cleanup"],function(){n.removeMarker(l,Po)}))}}),this.preExecuted("elements.move",To,function(a){var s=a.context,c=s.closure,u=s.shapes,l=ki(u);m(l,function(f){c.add(f,c.topLevel[f.host.id])})}),this.postExecuted("elements.move",function(a){var s=a.context,c=s.shapes,u=s.newHost,l;u&&c.length!==1||(u?l=c:l=at(c,function(f){var h=f.host;return Df(f)&&!jf(c,h)}),m(l,function(f){r.updateAttachment(f,u)}))}),this.postExecuted("elements.move",function(a){var s=a.context.shapes;m(s,function(c){m(c.attachers,function(u){m(u.outgoing.slice(),function(l){var f=i.allowed("connection.reconnect",{connection:l,source:l.source,target:l.target});f||r.removeConnection(l)}),m(u.incoming.slice(),function(l){var f=i.allowed("connection.reconnect",{connection:l,source:l.source,target:l.target});f||r.removeConnection(l)})})})}),this.postExecute("shape.create",function(a){var s=a.context,c=s.shape,u=s.host;u&&r.updateAttachment(c,u)}),this.postExecute("shape.replace",function(a){var s=a.context,c=s.oldShape,u=s.newShape;Ht(c.attachers,function(l){var f=i.allowed("elements.move",{target:u,shapes:[l]});f==="attach"?r.updateAttachment(l,u):r.removeShape(l)}),u.attachers.length&&m(u.attachers,function(l){var f=wo(l,c,u);r.moveShape(l,f,l.parent)})}),this.postExecute("shape.resize",function(a){var s=a.context,c=s.shape,u=s.oldBounds,l=s.newBounds,f=c.attachers,h=s.hints||{};h.attachSupport!==!1&&m(f,function(d){var p=wo(d,u,l);r.moveShape(d,p,d.parent),m(d.labels,function(_){r.moveShape(_,p,_.parent)})})}),this.preExecute("shape.delete",function(a){var s=a.context.shape;Ht(s.attachers,function(c){r.removeShape(c)}),s.host&&r.updateAttachment(s,null)})}lt(dr,rt);dr.$inject=["injector","eventBus","canvas","rules","modeling"];function ki(t){return Cn(pt(t,function(e){return e.attachers||[]}))}function Af(t){var e=ki(t);return Ns("id",t,e)}function $f(t){var e=ze(t,"id");return at(t,function(n){for(;n;){if(n.host&&e[n.host.id])return!1;n=n.parent}return!0})}function Df(t){return!!t.host}function jf(t,e){return t.indexOf(e)!==-1}var Cd={__depends__:[Mt],__init__:["attachSupport"],attachSupport:["type",dr]};function Yn(t,e){this._modeling=t,this._canvas=e}Yn.$inject=["modeling","canvas"];Yn.prototype.preExecute=function(t){var e=this._modeling,n=t.elements,i=t.alignment;m(n,function(r){var o={x:0,y:0};et(i.left)?o.x=i.left-r.x:et(i.right)?o.x=i.right-r.width-r.x:et(i.center)?o.x=i.center-Math.round(r.width/2)-r.x:et(i.top)?o.y=i.top-r.y:et(i.bottom)?o.y=i.bottom-r.height-r.y:et(i.middle)&&(o.y=i.middle-Math.round(r.height/2)-r.y),e.moveElements([r],o,r.parent)})};Yn.prototype.postExecute=function(t){};function Zn(t){this._modeling=t}Zn.$inject=["modeling"];Zn.prototype.preExecute=function(t){var e=t.source;if(!e)throw new Error("source required");var n=t.target||e.parent,i=t.shape,r=t.hints||{};i=t.shape=this._modeling.createShape(i,t.position,n,{attach:r.attach}),t.shape=i};Zn.prototype.postExecute=function(t){var e=t.hints||{};Hf(t.source,t.shape)||(e.connectionTarget===t.source?this._modeling.connect(t.shape,t.source,t.connection):this._modeling.connect(t.source,t.shape,t.connection))};function Hf(t,e){return Jo(t.outgoing,function(n){return n.target===e})}function Xn(t,e){this._canvas=t,this._layouter=e}Xn.$inject=["canvas","layouter"];Xn.prototype.execute=function(t){var e=t.connection,n=t.source,i=t.target,r=t.parent,o=t.parentIndex,a=t.hints;if(!n||!i)throw new Error("source and target required");if(!r)throw new Error("parent required");return e.source=n,e.target=i,e.waypoints||(e.waypoints=this._layouter.layoutConnection(e,a)),this._canvas.addConnection(e,r,o),e};Xn.prototype.revert=function(t){var e=t.connection;return this._canvas.removeConnection(e),e.source=null,e.target=null,e};var mn=Math.round;function pr(t){this._modeling=t}pr.$inject=["modeling"];pr.prototype.preExecute=function(t){var e=t.elements,n=t.parent,i=t.parentIndex,r=t.position,o=t.hints,a=this._modeling;m(e,function(f){I(f.x)||(f.x=0),I(f.y)||(f.y=0)});var s=at(e,function(f){return!f.hidden}),c=q(s);m(e,function(f){Oo(f)&&(f.waypoints=pt(f.waypoints,function(h){return{x:mn(h.x-c.x-c.width/2+r.x),y:mn(h.y-c.y-c.height/2+r.y)}})),M(f,{x:mn(f.x-c.x-c.width/2+r.x),y:mn(f.y-c.y-c.height/2+r.y)})});var u=na(e),l={};m(e,function(f){if(Oo(f)){l[f.id]=I(i)?a.createConnection(l[f.source.id],l[f.target.id],i,f,f.parent||n,o):a.createConnection(l[f.source.id],l[f.target.id],f,f.parent||n,o);return}var h=M({},o);u.indexOf(f)===-1&&(h.autoResize=!1),l[f.id]=I(i)?a.createShape(f,He(f,["x","y","width","height"]),f.parent||n,i,h):a.createShape(f,He(f,["x","y","width","height"]),f.parent||n,h)}),t.elements=ji(l)};function Oo(t){return!!t.waypoints}var Lo=Math.round;function Ft(t){this._canvas=t}Ft.$inject=["canvas"];Ft.prototype.execute=function(t){var e=t.shape,n=t.position,i=t.parent,r=t.parentIndex;if(!i)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?M(e,n):M(e,{x:n.x-Lo(e.width/2),y:n.y-Lo(e.height/2)}),this._canvas.addShape(e,i,r),e};Ft.prototype.revert=function(t){var e=t.shape;return this._canvas.removeShape(e),e};function Xe(t){Ft.call(this,t)}lt(Xe,Ft);Xe.$inject=["canvas"];var Nf=Ft.prototype.execute;Xe.prototype.execute=function(t){var e=t.shape;return Gf(e),e.labelTarget=t.labelTarget,Nf.call(this,t)};var zf=Ft.prototype.revert;Xe.prototype.revert=function(t){return t.shape.labelTarget=null,zf.call(this,t)};function Gf(t){["width","height"].forEach(function(e){typeof t[e]>"u"&&(t[e]=0)})}function qe(t,e){this._canvas=t,this._modeling=e}qe.$inject=["canvas","modeling"];qe.prototype.preExecute=function(t){var e=this._modeling,n=t.connection;Ht(n.incoming,function(i){e.removeConnection(i,{nested:!0})}),Ht(n.outgoing,function(i){e.removeConnection(i,{nested:!0})})};qe.prototype.execute=function(t){var e=t.connection,n=e.parent;return t.parent=n,t.parentIndex=Vi(n.children,e),t.source=e.source,t.target=e.target,this._canvas.removeConnection(e),e.source=null,e.target=null,e};qe.prototype.revert=function(t){var e=t.connection,n=t.parent,i=t.parentIndex;return e.source=t.source,e.target=t.target,Rt(n.children,e,i),this._canvas.addConnection(e,n),e};function gr(t,e){this._modeling=t,this._elementRegistry=e}gr.$inject=["modeling","elementRegistry"];gr.prototype.postExecute=function(t){var e=this._modeling,n=this._elementRegistry,i=t.elements;m(i,function(r){!n.get(r.id)||(r.waypoints?e.removeConnection(r):e.removeShape(r))})};function Je(t,e){this._canvas=t,this._modeling=e}Je.$inject=["canvas","modeling"];Je.prototype.preExecute=function(t){var e=this._modeling,n=t.shape;Ht(n.incoming,function(i){e.removeConnection(i,{nested:!0})}),Ht(n.outgoing,function(i){e.removeConnection(i,{nested:!0})}),Ht(n.children,function(i){Bf(i)?e.removeConnection(i,{nested:!0}):e.removeShape(i,{nested:!0})})};Je.prototype.execute=function(t){var e=this._canvas,n=t.shape,i=n.parent;return t.oldParent=i,t.oldParentIndex=Vi(i.children,n),e.removeShape(n),n};Je.prototype.revert=function(t){var e=this._canvas,n=t.shape,i=t.oldParent,r=t.oldParentIndex;return Rt(i.children,n,r),e.addShape(n,i),n};function Bf(t){return t.waypoints}function qn(t){this._modeling=t}qn.$inject=["modeling"];var Io={x:"y",y:"x"};qn.prototype.preExecute=function(t){var e=this._modeling,n=t.groups,i=t.axis,r=t.dimension;function o(g,b){g.range.min=Math.min(b[i],g.range.min),g.range.max=Math.max(b[i]+b[r],g.range.max)}function a(g){return g[i]+g[r]/2}function s(g){return g.length-1}function c(g){return g.max-g.min}function u(g,b){var S={y:0};S[i]=g-a(b),S[i]&&(S[Io[i]]=0,e.moveElements([b],S,b.parent))}var l=n[0],f=s(n),h=n[f],d,p,_=0;m(n,function(g,b){var S,v,y;if(g.elements.length<2){b&&b!==n.length-1&&(o(g,g.elements[0]),_+=c(g.range));return}S=Nt(g.elements,i),v=S[0],b===f&&(v=S[s(S)]),y=a(v),g.range=null,m(S,function(x){if(u(y,x),g.range===null){g.range={min:x[i],max:x[i]+x[r]};return}o(g,x)}),b&&b!==n.length-1&&(_+=c(g.range))}),p=Math.abs(h.range.min-l.range.max),d=Math.round((p-_)/(n.length-1)),!(d<n.length-1)&&m(n,function(g,b){var S={},v;g===l||g===h||(v=n[b-1],g.range.max=0,m(g.elements,function(y,x){S[Io[i]]=0,S[i]=v.range.max-y[i]+d,g.range.min!==y[i]&&(S[i]+=y[i]-g.range.min),S[i]&&e.moveElements([y],S,y.parent),g.range.max=Math.max(y[i]+y[r],x?g.range.max:0)}))})};qn.prototype.postExecute=function(t){};function Jn(t,e){this._layouter=t,this._canvas=e}Jn.$inject=["layouter","canvas"];Jn.prototype.execute=function(t){var e=t.connection,n=e.waypoints;return M(t,{oldWaypoints:n}),e.waypoints=this._layouter.layoutConnection(e,t.hints),e};Jn.prototype.revert=function(t){var e=t.connection;return e.waypoints=t.oldWaypoints,e};function vr(){}vr.prototype.execute=function(t){var e=t.connection,n=t.delta,i=t.newParent||e.parent,r=t.newParentIndex,o=e.parent;return t.oldParent=o,t.oldParentIndex=Ve(o.children,e),Rt(i.children,e,r),e.parent=i,m(e.waypoints,function(a){a.x+=n.x,a.y+=n.y,a.original&&(a.original.x+=n.x,a.original.y+=n.y)}),e};vr.prototype.revert=function(t){var e=t.connection,n=e.parent,i=t.oldParent,r=t.oldParentIndex,o=t.delta;return Ve(n.children,e),Rt(i.children,e,r),e.parent=i,m(e.waypoints,function(a){a.x-=o.x,a.y-=o.y,a.original&&(a.original.x-=o.x,a.original.y-=o.y)}),e};function yr(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}yr.prototype.add=function(t,e){return this.addAll([t],e)};yr.prototype.addAll=function(t,e){var n=Ks(t,!!e,this);return M(this,n),this};function Qe(t){this._modeling=t}Qe.prototype.moveRecursive=function(t,e,n){return t?this.moveClosure(this.getClosure(t),e,n):[]};Qe.prototype.moveClosure=function(t,e,n,i,r){var o=this._modeling,a=t.allShapes,s=t.allConnections,c=t.enclosedConnections,u=t.topLevel,l=!1;r&&r.parent===n&&(l=!0),m(a,function(f){o.moveShape(f,e,u[f.id]&&!l&&n,{recurse:!1,layout:!1})}),m(s,function(f){var h=!!a[f.source.id],d=!!a[f.target.id];c[f.id]&&h&&d?o.moveConnection(f,e,u[f.id]&&!l&&n):o.layoutConnection(f,{connectionStart:h&&ur(f,f.source,e),connectionEnd:d&&lr(f,f.target,e)})})};Qe.prototype.getClosure=function(t){return new yr().addAll(t,!0)};function Qn(t){this._helper=new Qe(t)}Qn.$inject=["modeling"];Qn.prototype.preExecute=function(t){t.closure=this._helper.getClosure(t.shapes)};Qn.prototype.postExecute=function(t){var e=t.hints,n;e&&e.primaryShape&&(n=e.primaryShape,e.oldParent=n.parent),this._helper.moveClosure(t.closure,t.delta,t.newParent,t.newHost,n)};function ae(t){this._modeling=t,this._helper=new Qe(t)}ae.$inject=["modeling"];ae.prototype.execute=function(t){var e=t.shape,n=t.delta,i=t.newParent||e.parent,r=t.newParentIndex,o=e.parent;return t.oldBounds=He(e,["x","y","width","height"]),t.oldParent=o,t.oldParentIndex=Ve(o.children,e),Rt(i.children,e,r),M(e,{parent:i,x:e.x+n.x,y:e.y+n.y}),e};ae.prototype.postExecute=function(t){var e=t.shape,n=t.delta,i=t.hints,r=this._modeling;i.layout!==!1&&(m(e.incoming,function(o){r.layoutConnection(o,{connectionEnd:lr(o,e,n)})}),m(e.outgoing,function(o){r.layoutConnection(o,{connectionStart:ur(o,e,n)})})),i.recurse!==!1&&this.moveChildren(t)};ae.prototype.revert=function(t){var e=t.shape,n=t.oldParent,i=t.oldParentIndex,r=t.delta;return Rt(n.children,e,i),M(e,{parent:n,x:e.x-r.x,y:e.y-r.y}),e};ae.prototype.moveChildren=function(t){var e=t.delta,n=t.shape;this._helper.moveRecursive(n.children,e,null)};ae.prototype.getNewParent=function(t){return t.newParent||t.shape.parent};function tn(t){this._modeling=t}tn.$inject=["modeling"];tn.prototype.execute=function(t){var e=t.newSource,n=t.newTarget,i=t.connection,r=t.dockingOrPoints;if(!e&&!n)throw new Error("newSource or newTarget required");return N(r)&&(t.oldWaypoints=i.waypoints,i.waypoints=r),e&&(t.oldSource=i.source,i.source=e),n&&(t.oldTarget=i.target,i.target=n),i};tn.prototype.postExecute=function(t){var e=t.connection,n=t.newSource,i=t.newTarget,r=t.dockingOrPoints,o=t.hints||{},a={};o.connectionStart&&(a.connectionStart=o.connectionStart),o.connectionEnd&&(a.connectionEnd=o.connectionEnd),o.layoutConnection!==!1&&(n&&(!i||o.docking==="source")&&(a.connectionStart=a.connectionStart||ko(N(r)?r[0]:r)),i&&(!n||o.docking==="target")&&(a.connectionEnd=a.connectionEnd||ko(N(r)?r[r.length-1]:r)),o.newWaypoints&&(a.waypoints=o.newWaypoints),this._modeling.layoutConnection(e,a))};tn.prototype.revert=function(t){var e=t.oldSource,n=t.oldTarget,i=t.oldWaypoints,r=t.connection;return e&&(r.source=e),n&&(r.target=n),i&&(r.waypoints=i),r};function ko(t){return t.original||t}function It(t,e){this._modeling=t,this._rules=e}It.$inject=["modeling","rules"];It.prototype.preExecute=function(t){var e=this,n=this._modeling,i=this._rules,r=t.oldShape,o=t.newData,a=t.hints||{},s;function c(p,_,g){return i.allowed("connection.reconnect",{connection:g,source:p,target:_})}var u={x:o.x,y:o.y},l={x:r.x,y:r.y,width:r.width,height:r.height};s=t.newShape=t.newShape||e.createShape(o,u,r.parent,a),r.host&&n.updateAttachment(s,r.host);var f;a.moveChildren!==!1&&(f=r.children.slice(),n.moveElements(f,{x:0,y:0},s,a));var h=r.incoming.slice(),d=r.outgoing.slice();m(h,function(p){var _=p.source,g=c(_,s,p);g&&e.reconnectEnd(p,s,cr(p,s,l),a)}),m(d,function(p){var _=p.target,g=c(s,_,p);g&&e.reconnectStart(p,s,sr(p,s,l),a)})};It.prototype.postExecute=function(t){var e=t.oldShape;this._modeling.removeShape(e)};It.prototype.execute=function(t){};It.prototype.revert=function(t){};It.prototype.createShape=function(t,e,n,i){return this._modeling.createShape(t,e,n,i)};It.prototype.reconnectStart=function(t,e,n,i){this._modeling.reconnectStart(t,e,n,i)};It.prototype.reconnectEnd=function(t,e,n,i){this._modeling.reconnectEnd(t,e,n,i)};function en(t){this._modeling=t}en.$inject=["modeling"];en.prototype.execute=function(t){var e=t.shape,n=t.newBounds,i=t.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(i&&(n.width<i.width||n.height<i.height))throw new Error("width and height cannot be less than minimum height and width");if(!i&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return t.oldBounds={width:e.width,height:e.height,x:e.x,y:e.y},M(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};en.prototype.postExecute=function(t){var e=this._modeling,n=t.shape,i=t.oldBounds,r=t.hints||{};r.layout!==!1&&(m(n.incoming,function(o){e.layoutConnection(o,{connectionEnd:cr(o,n,i)})}),m(n.outgoing,function(o){e.layoutConnection(o,{connectionStart:sr(o,n,i)})}))};en.prototype.revert=function(t){var e=t.shape,n=t.oldBounds;return M(e,{width:n.width,height:n.height,x:n.x,y:n.y}),e};function Kt(t){this._modeling=t}Kt.$inject=["modeling"];Kt.prototype.preExecute=function(t){var e=t.delta,n=t.direction,i=t.movingShapes,r=t.resizingShapes,o=t.start,a={};this.moveShapes(i,e),m(r,function(s){a[s.id]=Wf(s)}),this.resizeShapes(r,e,n),this.updateConnectionWaypoints(Ef(i,r),e,n,o,i,r,a)};Kt.prototype.execute=function(){};Kt.prototype.revert=function(){};Kt.prototype.moveShapes=function(t,e){var n=this;m(t,function(i){n._modeling.moveShape(i,e,null,{autoResize:!1,layout:!1,recurse:!1})})};Kt.prototype.resizeShapes=function(t,e,n){var i=this;m(t,function(r){var o=wf(r,n,e);i._modeling.resizeShape(r,o,null,{attachSupport:!1,autoResize:!1,layout:!1})})};Kt.prototype.updateConnectionWaypoints=function(t,e,n,i,r,o,a){var s=this,c=r.concat(o);m(t,function(u){var l=u.source,f=u.target,h=Vf(u),d=xs(n),p={};At(c,l)&&At(c,f)?(h=pt(h,function(_){return $o(_,i,n)&&(_[d]=_[d]+e[d]),_.original&&$o(_.original,i,n)&&(_.original[d]=_.original[d]+e[d]),_}),s._modeling.updateWaypoints(u,h,{labelBehavior:!1})):(At(c,l)||At(c,f))&&(At(r,l)?p.connectionStart=ur(u,l,e):At(r,f)?p.connectionEnd=lr(u,f,e):At(o,l)?p.connectionStart=sr(u,l,a[l.id]):At(o,f)&&(p.connectionEnd=cr(u,f,a[f.id])),s._modeling.layoutConnection(u,p))})};function Ao(t){return M({},t)}function Vf(t){return pt(t.waypoints,function(e){return e=Ao(e),e.original&&(e.original=Ao(e.original)),e})}function xs(t){switch(t){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function $o(t,e,n){var i=xs(n);if(/e|s/.test(n))return t[i]>e;if(/n|w/.test(n))return t[i]<e}function At(t,e){return t.indexOf(e)!==-1}function Wf(t){return{x:t.x,y:t.y,height:t.height,width:t.width}}function ti(t){this._modeling=t}ti.$inject=["modeling"];ti.prototype.execute=function(t){var e=t.shape,n=e.children;t.oldChildrenVisibility=Es(n),e.collapsed=!e.collapsed;var i=ws(n,e.collapsed);return[e].concat(i)};ti.prototype.revert=function(t){var e=t.shape,n=t.oldChildrenVisibility,i=e.children,r=Ss(i,n);return e.collapsed=!e.collapsed,[e].concat(r)};function Es(t){var e={};return m(t,function(n){e[n.id]=n.hidden,n.children&&(e=M({},e,Es(n.children)))}),e}function ws(t,e){var n=[];return m(t,function(i){i.hidden=e,n=n.concat(i),i.children&&(n=n.concat(ws(i.children,i.collapsed||e)))}),n}function Ss(t,e){var n=[];return m(t,function(i){i.hidden=e[i.id],n=n.concat(i),i.children&&(n=n.concat(Ss(i.children,e)))}),n}function ei(t){this._modeling=t}ei.$inject=["modeling"];ei.prototype.execute=function(t){var e=t.shape,n=t.newHost,i=e.host;return t.oldHost=i,t.attacherIdx=Cs(i,e),Rs(n,e),e.host=n,e};ei.prototype.revert=function(t){var e=t.shape,n=t.newHost,i=t.oldHost,r=t.attacherIdx;return e.host=i,Cs(n,e),Rs(i,e,r),e};function Cs(t,e){return Ve(t&&t.attachers,e)}function Rs(t,e,n){if(!!t){var i=t.attachers;i||(t.attachers=i=[]),Rt(i,e,n)}}function _r(){}_r.prototype.execute=function(t){var e=t.connection,n=t.newWaypoints;return t.oldWaypoints=e.waypoints,e.waypoints=n,e};_r.prototype.revert=function(t){var e=t.connection,n=t.oldWaypoints;return e.waypoints=n,e};function G(t,e,n){this._eventBus=t,this._elementFactory=e,this._commandStack=n;var i=this;t.on("diagram.init",function(){i.registerHandlers(n)})}G.$inject=["eventBus","elementFactory","commandStack"];G.prototype.getHandlers=function(){return{"shape.append":Zn,"shape.create":Ft,"shape.delete":Je,"shape.move":ae,"shape.resize":en,"shape.replace":It,"shape.toggleCollapse":ti,spaceTool:Kt,"label.create":Xe,"connection.create":Xn,"connection.delete":qe,"connection.move":vr,"connection.layout":Jn,"connection.updateWaypoints":_r,"connection.reconnect":tn,"elements.create":pr,"elements.move":Qn,"elements.delete":gr,"elements.distribute":qn,"elements.align":Yn,"element.updateAttachment":ei}};G.prototype.registerHandlers=function(t){m(this.getHandlers(),function(e,n){t.registerHandler(n,e)})};G.prototype.moveShape=function(t,e,n,i,r){typeof i=="object"&&(r=i,i=null);var o={shape:t,delta:e,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("shape.move",o)};G.prototype.updateAttachment=function(t,e){var n={shape:t,newHost:e};this._commandStack.execute("element.updateAttachment",n)};G.prototype.moveElements=function(t,e,n,i){i=i||{};var r=i.attach,o=n,a;r===!0?(a=n,o=n.parent):r===!1&&(a=null);var s={shapes:t,delta:e,newParent:o,newHost:a,hints:i};this._commandStack.execute("elements.move",s)};G.prototype.moveConnection=function(t,e,n,i,r){typeof i=="object"&&(r=i,i=void 0);var o={connection:t,delta:e,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("connection.move",o)};G.prototype.layoutConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.layout",n)};G.prototype.createConnection=function(t,e,n,i,r,o){typeof n=="object"&&(o=r,r=i,i=n,n=void 0),i=this._create("connection",i);var a={source:t,target:e,parent:r,parentIndex:n,connection:i,hints:o};return this._commandStack.execute("connection.create",a),a.connection};G.prototype.createShape=function(t,e,n,i,r){typeof i!="number"&&(r=i,i=void 0),r=r||{};var o=r.attach,a,s;t=this._create("shape",t),o?(a=n.parent,s=n):a=n;var c={position:e,shape:t,parent:a,parentIndex:i,host:s,hints:r};return this._commandStack.execute("shape.create",c),c.shape};G.prototype.createElements=function(t,e,n,i,r){N(t)||(t=[t]),typeof i!="number"&&(r=i,i=void 0),r=r||{};var o={position:e,elements:t,parent:n,parentIndex:i,hints:r};return this._commandStack.execute("elements.create",o),o.elements};G.prototype.createLabel=function(t,e,n,i){n=this._create("label",n);var r={labelTarget:t,position:e,parent:i||t.parent,shape:n};return this._commandStack.execute("label.create",r),r.shape};G.prototype.appendShape=function(t,e,n,i,r){r=r||{},e=this._create("shape",e);var o={source:t,position:n,target:i,shape:e,connection:r.connection,connectionParent:r.connectionParent,hints:r};return this._commandStack.execute("shape.append",o),o.shape};G.prototype.removeElements=function(t){var e={elements:t};this._commandStack.execute("elements.delete",e)};G.prototype.distributeElements=function(t,e,n){var i={groups:t,axis:e,dimension:n};this._commandStack.execute("elements.distribute",i)};G.prototype.removeShape=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.delete",n)};G.prototype.removeConnection=function(t,e){var n={connection:t,hints:e||{}};this._commandStack.execute("connection.delete",n)};G.prototype.replaceShape=function(t,e,n){var i={oldShape:t,newData:e,hints:n||{}};return this._commandStack.execute("shape.replace",i),i.newShape};G.prototype.alignElements=function(t,e){var n={elements:t,alignment:e};this._commandStack.execute("elements.align",n)};G.prototype.resizeShape=function(t,e,n,i){var r={shape:t,newBounds:e,minBounds:n,hints:i};this._commandStack.execute("shape.resize",r)};G.prototype.createSpace=function(t,e,n,i,r){var o={delta:n,direction:i,movingShapes:t,resizingShapes:e,start:r};this._commandStack.execute("spaceTool",o)};G.prototype.updateWaypoints=function(t,e,n){var i={connection:t,newWaypoints:e,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",i)};G.prototype.reconnect=function(t,e,n,i,r){var o={connection:t,newSource:e,newTarget:n,dockingOrPoints:i,hints:r||{}};this._commandStack.execute("connection.reconnect",o)};G.prototype.reconnectStart=function(t,e,n,i){i||(i={}),this.reconnect(t,e,t.target,n,M(i,{docking:"source"}))};G.prototype.reconnectEnd=function(t,e,n,i){i||(i={}),this.reconnect(t,t.source,e,n,M(i,{docking:"target"}))};G.prototype.connect=function(t,e,n,i){return this.createConnection(t,e,n||{},t.parent,i)};G.prototype._create=function(t,e){return e instanceof Ue?e:this._elementFactory.create(t,e)};G.prototype.toggleCollapse=function(t,e){var n={shape:t,hints:e||{}};this._commandStack.execute("shape.toggleCollapse",n)};function Uf(){}Uf.prototype.layoutConnection=function(t,e){return e=e||{},[e.connectionStart||V(e.source||t.source),e.connectionEnd||V(e.target||t.target)]};var xn=20,Ff=5,kn=Math.round,Do=20,Kf={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Yf(t,e){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[e].test(t)}function Zf(t,e){return{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[t].test(e)}function bs(t,e,n){var i=Ct(e,t,Ff),r=n.split(":")[0],o=kn((e.x-t.x)/2+t.x),a=kn((e.y-t.y)/2+t.y),s,c,u=Zf(r,i),l=/h|r|l/.test(r),f=!1,h=!1;return u?(s=l?{x:o,y:t.y}:{x:t.x,y:a},c=l?"h:h":"v:v"):(f=Yf(i,r),c=l?"h:v":"v:h",f?l?(h=a===t.y,s={x:t.x+xn*(/l/.test(r)?-1:1),y:h?a+xn:a}):(h=o===t.x,s={x:h?o+xn:o,y:t.y+xn*(/t/.test(r)?-1:1)}):s={x:o,y:a}),{waypoints:mr(t,s,c).concat(s),directions:c,turnNextDirections:h}}function Xf(t,e,n){return bs(t,e,n)}function qf(t,e,n){var i=bs(e,t,jo(n));return{waypoints:i.waypoints.slice().reverse(),directions:jo(i.directions),turnNextDirections:i.turnNextDirections}}function Jf(t,e){var n=t.directions.split(":")[1],i=e.directions.split(":")[0];t.turnNextDirections&&(n=n=="h"?"v":"h"),e.turnNextDirections&&(i=i=="h"?"v":"h");var r=n+":"+i,o=mr(t.waypoints[t.waypoints.length-1],e.waypoints[0],r);return{waypoints:o,directions:r}}function jo(t){return t.split(":").reverse().join(":")}function Qf(t,e,n){var i=kn((e.x-t.x)/2+t.x),r=kn((e.y-t.y)/2+t.y);if(n==="h:v")return[{x:e.x,y:t.y}];if(n==="v:h")return[{x:t.x,y:e.y}];if(n==="h:h")return[{x:i,y:t.y},{x:i,y:e.y}];if(n==="v:v")return[{x:t.x,y:r},{x:e.x,y:r}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}function mr(t,e,n){if(n=n||"h:h",!sh(n))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(Ms(n)){var i=Xf(t,e,n),r=qf(t,e,n),o=Jf(i,r);return[].concat(i.waypoints,o.waypoints,r.waypoints)}return Qf(t,e,n)}function th(t,e,n){var i=mr(t,e,n);return i.unshift(t),i.push(e),uh(i)}function eh(t,e,n,i,r){var o=r&&r.preferredLayouts||[],a=zs(o,"straight")[0]||"h:h",s=Kf[a]||0,c=Ct(t,e,s),u=ah(c,a);n=n||V(t),i=i||V(e);var l=u.split(":"),f=No(n,t,l[0],ch(c)),h=No(i,e,l[1],c);return th(f,h,u)}function Rd(t,e,n,i,r,o){N(n)&&(r=n,o=i,n=V(t),i=V(e)),o=M({preferredLayouts:[]},o),r=r||[];var a=o.preferredLayouts,s=a.indexOf("straight")!==-1,c;return c=s&&ih(t,e,n,i,o),c||(c=o.connectionEnd&&oh(e,t,i,r),c)||(c=o.connectionStart&&rh(t,e,n,r),c)?c:!o.connectionStart&&!o.connectionEnd&&r&&r.length?r:eh(t,e,n,i,o)}function nh(t,e,n){return t>=e&&t<=n}function Ho(t,e,n){var i={x:"width",y:"height"};return nh(e[t],n[t],n[t]+n[i[t]])}function ih(t,e,n,i,r){var o={},a,s;return s=Ct(t,e),/^(top|bottom|left|right)$/.test(s)?(/top|bottom/.test(s)&&(a="x"),/left|right/.test(s)&&(a="y"),r.preserveDocking==="target"?Ho(a,i,t)?(o[a]=i[a],[{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y,original:{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y}},{x:i.x,y:i.y}]):null:Ho(a,n,e)?(o[a]=n[a],[{x:n.x,y:n.y},{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y,original:{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y}}]):null):null}function rh(t,e,n,i){return xr(t,e,n,i)}function oh(t,e,n,i){var r=i.slice().reverse();return r=xr(t,e,n,r),r?r.reverse():null}function xr(t,e,n,i){function r(l){return l.length<3?!0:l.length>4?!1:!!nt(l,function(f,h){var d=l[h-1];return d&&We(f,d)<3})}function o(l,f,h){var d=$t(f,l);switch(d){case"v":return{x:h.x,y:l.y};case"h":return{x:l.x,y:h.y}}return{x:l.x,y:l.y}}function a(l,f,h){var d;for(d=l.length-2;d!==0;d--)if(Sr(l[d],f,Do)||Sr(l[d],h,Do))return l.slice(d);return l}if(r(i))return null;var s=i[0],c=i.slice(),u;return c[0]=n,c[1]=o(c[1],s,n),u=a(c,t,e),u!==c&&(c=xr(t,e,n,u)),c&&$t(c)?null:c}function ah(t,e){if(Ms(e))return e;switch(t){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return e}}function sh(t){return t&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(t)}function Ms(t){return t&&/t|r|b|l/.test(t)}function ch(t){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[t]}function No(t,e,n,i){if(n==="h"&&(n=/left/.test(i)?"l":"r"),n==="v"&&(n=/top/.test(i)?"t":"b"),n==="t")return{original:t,x:t.x,y:e.y};if(n==="r")return{original:t,x:e.x+e.width,y:t.y};if(n==="b")return{original:t,x:t.x,y:e.y+e.height};if(n==="l")return{original:t,x:e.x,y:t.y};throw new Error("unexpected dockingDirection: <"+n+">")}function uh(t){return t.reduce(function(e,n,i){var r=e[e.length-1],o=t[i+1];return Wi(r,o,n,0)||e.push(n),e},[])}function zo(t){return M({original:t.point.original||t.point},t.actual)}function se(t,e){this._elementRegistry=t,this._graphicsFactory=e}se.$inject=["elementRegistry","graphicsFactory"];se.prototype.getCroppedWaypoints=function(t,e,n){e=e||t.source,n=n||t.target;var i=this.getDockingPoint(t,e,!0),r=this.getDockingPoint(t,n),o=t.waypoints.slice(i.idx+1,r.idx);return o.unshift(zo(i)),o.push(zo(r)),o};se.prototype.getDockingPoint=function(t,e,n){var i=t.waypoints,r,o,a;return r=n?0:i.length-1,o=i[r],a=this._getIntersection(e,t,n),{point:o,actual:a||o,idx:r}};se.prototype._getIntersection=function(t,e,n){var i=this._getShapePath(t),r=this._getConnectionPath(e);return wi(i,r,n)};se.prototype._getConnectionPath=function(t){return this._graphicsFactory.getConnectionPath(t)};se.prototype._getShapePath=function(t){return this._graphicsFactory.getShapePath(t)};se.prototype._getGfx=function(t){return this._elementRegistry.getGraphics(t)};var lh=500,fh=1250,hh=1500,An=Math.round;function dh(t){return{x:t.x+An(t.width/2),y:t.y+An(t.height/2)}}function Ts(t,e,n,i,r){function o(s,c,u,l){return r.allowed("elements.move",{shapes:s,delta:c,position:u,target:l})}t.on("shape.move.start",hh,function(s){var c=s.context,u=s.shape,l=i.get().slice();l.indexOf(u)===-1&&(l=[u]),l=ph(l),M(c,{shapes:l,validatedShapes:l,shape:u})}),t.on("shape.move.start",fh,function(s){var c=s.context,u=c.validatedShapes,l;if(l=c.canExecute=o(u),!l)return!1}),t.on("shape.move.move",lh,function(s){var c=s.context,u=c.validatedShapes,l=s.hover,f={x:s.dx,y:s.dy},h={x:s.x,y:s.y},d;if(d=o(u,f,h,l),c.delta=f,c.canExecute=d,d===null){c.target=null;return}c.target=l}),t.on("shape.move.end",function(s){var c=s.context,u=c.delta,l=c.canExecute,f=l==="attach",h=c.shapes;if(l===!1)return!1;u.x=An(u.x),u.y=An(u.y),!(u.x===0&&u.y===0)&&n.moveElements(h,u,c.target,{primaryShape:c.shape,attach:f})}),t.on("element.mousedown",function(s){if(!!Vt(s)){var c=me(s);if(!c)throw new Error("must supply DOM mousedown event");return a(c,s.element)}});function a(s,c,u,l){if(xt(u)&&(l=u,u=!1),!(c.waypoints||!c.parent)&&!H(s.target).has("djs-hit-no-move")){var f=dh(c);return e.init(s,f,"shape.move",{cursor:"grabbing",autoActivate:u,data:{shape:c,context:l||{}}}),!0}}this.start=a}Ts.$inject=["eventBus","dragging","modeling","selection","rules"];function ph(t){var e=ze(t,"id");return at(t,function(n){for(;n=n.parent;)if(e[n.id])return!1;return!0})}var Go=499,gi="djs-dragging",Bo="drop-ok",Vo="drop-not-ok",Wo="new-parent",Uo="attach-ok";function Ps(t,e,n,i){function r(c){var u=o(c),l=gh(u);return l}function o(c){var u=ra(c,!0),l=pt(u,function(f){return(f.incoming||[]).concat(f.outgoing||[])});return Cn(u.concat(l))}function a(c,u){[Uo,Bo,Vo,Wo].forEach(function(l){l===u?e.addMarker(c,l):e.removeMarker(c,l)})}function s(c,u,l){i.addDragger(u,c.dragGroup),l&&e.addMarker(u,gi),c.allDraggedElements?c.allDraggedElements.push(u):c.allDraggedElements=[u]}t.on("shape.move.start",Go,function(c){var u=c.context,l=u.shapes,f=u.allDraggedElements,h=r(l);if(!u.dragGroup){var d=$("g");P(d,n.cls("djs-drag-group",["no-events"]));var p=e.getActiveLayer();D(p,d),u.dragGroup=d}h.forEach(function(_){i.addDragger(_,u.dragGroup)}),f?f=Cn([f,o(l)]):f=o(l),m(f,function(_){e.addMarker(_,gi)}),u.allDraggedElements=f,u.differentParents=vh(l)}),t.on("shape.move.move",Go,function(c){var u=c.context,l=u.dragGroup,f=u.target,h=u.shape.parent,d=u.canExecute;f&&(d==="attach"?a(f,Uo):u.canExecute&&f&&f.id!==h.id?a(f,Wo):a(f,u.canExecute?Bo:Vo)),gt(l,c.dx,c.dy)}),t.on(["shape.move.out","shape.move.cleanup"],function(c){var u=c.context,l=u.target;l&&a(l,null)}),t.on("shape.move.cleanup",function(c){var u=c.context,l=u.allDraggedElements,f=u.dragGroup;m(l,function(h){e.removeMarker(h,gi)}),f&&K(f)}),this.makeDraggable=s}Ps.$inject=["eventBus","canvas","styles","previewSupport"];function gh(t){var e=at(t,function(n){return yh(n)?nt(t,Dt({id:n.source.id}))&&nt(t,Dt({id:n.target.id})):!0});return e}function vh(t){return Gs(ze(t,function(e){return e.parent&&e.parent.id}))!==1}function yh(t){return t.waypoints}var bd={__depends__:[jn,Ee,Sa,Mt,bt,Bn],__init__:["move","movePreview"],move:["type",Ts],movePreview:["type",Ps]},Os="crosshair";function ce(t,e,n,i,r,o,a){this._selection=r,this._dragging=n,this._mouse=a;var s=this,c={create:function(u){var l=e.getActiveLayer(),f;f=u.frame=$("rect"),P(f,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),D(l,f)},update:function(u){var l=u.frame,f=u.bbox;P(l,{x:f.x,y:f.y,width:f.width,height:f.height})},remove:function(u){u.frame&&K(u.frame)}};o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),t.on("lasso.selection.end",function(u){var l=u.originalEvent.target;!u.hover&&!(l instanceof SVGElement)||t.once("lasso.selection.ended",function(){s.activateLasso(u.originalEvent,!0)})}),t.on("lasso.end",function(u){var l=vi(u),f=i.filter(function(h){return h});s.select(f,l)}),t.on("lasso.start",function(u){var l=u.context;l.bbox=vi(u),c.create(l)}),t.on("lasso.move",function(u){var l=u.context;l.bbox=vi(u),c.update(l)}),t.on("lasso.cleanup",function(u){var l=u.context;c.remove(l)}),t.on("element.mousedown",1500,function(u){if(!!Ea(u))return s.activateLasso(u.originalEvent),!0})}ce.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];ce.prototype.activateLasso=function(t,e){this._dragging.init(t,"lasso",{autoActivate:e,cursor:Os,data:{context:{}}})};ce.prototype.activateSelection=function(t,e){this._dragging.init(t,"lasso.selection",{trapClick:!1,autoActivate:e,cursor:Os,data:{context:{}}})};ce.prototype.select=function(t,e){var n=Ys(t,e);this._selection.select(ji(n))};ce.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateSelection(t,!!t)};ce.prototype.isActive=function(){var t=this._dragging.context();return t&&/^lasso/.test(t.prefix)};function vi(t){var e={x:t.x-t.dx,y:t.y-t.dy},n={x:t.x,y:t.y},i;return e.x<=n.x&&e.y<n.y||e.x<n.x&&e.y<=n.y?i={x:e.x,y:e.y,width:n.x-e.x,height:n.y-e.y}:e.x>=n.x&&e.y<n.y||e.x>n.x&&e.y<=n.y?i={x:n.x,y:e.y,width:e.x-n.x,height:n.y-e.y}:e.x<=n.x&&e.y>n.y||e.x<n.x&&e.y>=n.y?i={x:e.x,y:n.y,width:n.x-e.x,height:e.y-n.y}:e.x>=n.x&&e.y>n.y||e.x>n.x&&e.y>=n.y?i={x:n.x,y:n.y,width:e.x-n.x,height:e.y-n.y}:i={x:n.x,y:n.y,width:0,height:0},i}var Md={__depends__:[Kn,Ye],__init__:["lassoTool"],lassoTool:["type",ce]},yi=1500,Ls="grab";function Re(t,e,n,i,r,o){this._dragging=n,this._mouse=o;var a=this,s=i.get("keyboard",!1);r.registerTool("hand",{tool:"hand",dragging:"hand.move"}),t.on("element.mousedown",yi,function(c){if(!!Pn(c))return a.activateMove(c.originalEvent,!0),!1}),s&&s.addListener(yi,function(c){if(!(!Fo(c.keyEvent)||a.isActive())){var u=a._mouse.getLastMoveEvent();a.activateMove(u,!!u)}},"keyboard.keydown"),s&&s.addListener(yi,function(c){!Fo(c.keyEvent)||!a.isActive()||a.toggle()},"keyboard.keyup"),t.on("hand.end",function(c){var u=c.originalEvent.target;if(!c.hover&&!(u instanceof SVGElement))return!1;t.once("hand.ended",function(){a.activateMove(c.originalEvent,{reactivate:!0})})}),t.on("hand.move.move",function(c){var u=e.viewbox().scale;e.scroll({dx:c.dx*u,dy:c.dy*u})}),t.on("hand.move.end",function(c){var u=c.context,l=u.reactivate;return!Pn(c)&&l&&t.once("hand.move.ended",function(f){a.activateHand(f.originalEvent,!0,!0)}),!1})}Re.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];Re.prototype.activateMove=function(t,e,n){typeof e=="object"&&(n=e,e=!1),this._dragging.init(t,"hand.move",{autoActivate:e,cursor:Ls,data:{context:n||{}}})};Re.prototype.activateHand=function(t,e,n){this._dragging.init(t,"hand",{trapClick:!1,autoActivate:e,cursor:Ls,data:{context:{reactivate:n}}})};Re.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();this.activateHand(t,!!t)};Re.prototype.isActive=function(){var t=this._dragging.context();return t?/^(hand|hand\.move)$/.test(t.prefix):!1};function Fo(t){return X("Space",t)}var Td={__depends__:[Kn,Ye],__init__:["handTool"],handTool:["type",Re]},Ko="connect-ok",Yo="connect-not-ok";function be(t,e,n,i,r,o,a){var s=this;this._dragging=e,this._rules=o,this._mouse=a,r.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),t.on("global-connect.hover",function(c){var u=c.context,l=c.hover,f=u.canStartConnect=s.canStartConnect(l);f!==null&&(u.startTarget=l,i.addMarker(l,f?Ko:Yo))}),t.on(["global-connect.out","global-connect.cleanup"],function(c){var u=c.context.startTarget,l=c.context.canStartConnect;u&&i.removeMarker(u,l?Ko:Yo)}),t.on(["global-connect.ended"],function(c){var u=c.context,l=u.startTarget,f={x:c.x,y:c.y},h=s.canStartConnect(l);if(!!h)return t.once("element.out",function(){t.once(["connect.ended","connect.canceled"],function(){t.fire("global-connect.drag.ended")}),n.start(null,l,f)}),!1})}be.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"];be.prototype.start=function(t,e){this._dragging.init(t,"global-connect",{autoActivate:e,trapClick:!1,data:{context:{}}})};be.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var t=this._mouse.getLastMoveEvent();return this.start(t,!!t)};be.prototype.isActive=function(){var t=this._dragging.context();return t&&/^global-connect/.test(t.prefix)};be.prototype.canStartConnect=function(t){return this._rules.allowed("connection.start",{source:t})};var Pd={__depends__:[vl,Mt,bt,Kn,Ye],globalConnect:["type",be]};function Yt(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}Yt.prototype.getSnapOrigin=function(t){return this._snapOrigins[t]};Yt.prototype.setSnapOrigin=function(t,e){this._snapOrigins[t]=e,this._snapLocations.indexOf(t)===-1&&this._snapLocations.push(t)};Yt.prototype.addDefaultSnap=function(t,e){var n=this._defaultSnaps[t];n||(n=this._defaultSnaps[t]=[]),n.push(e)};Yt.prototype.getSnapLocations=function(){return this._snapLocations};Yt.prototype.setSnapLocations=function(t){this._snapLocations=t};Yt.prototype.pointsForTarget=function(t){var e=t.id||t,n=this._targets[e];return n||(n=this._targets[e]=new ni,n.initDefaults(this._defaultSnaps)),n};function ni(t){this._snapValues={}}ni.prototype.add=function(t,e){var n=this._snapValues[t];n||(n=this._snapValues[t]={x:[],y:[]}),n.x.indexOf(e.x)===-1&&n.x.push(e.x),n.y.indexOf(e.y)===-1&&n.y.push(e.y)};ni.prototype.snap=function(t,e,n,i){var r=this._snapValues[e];return r&&ul(t[n],r[n],i)};ni.prototype.initDefaults=function(t){var e=this;m(t||{},function(n,i){m(n,function(r){e.add(i,r)})})};var _h=1250;function nn(t,e,n){var i=this;this._elementRegistry=t,e.on(["create.start","shape.move.start"],function(r){i.initSnap(r)}),e.on(["create.move","create.end","shape.move.move","shape.move.end"],_h,function(r){var o=r.context,a=o.shape,s=o.snapContext,c=o.target;if(!(r.originalEvent&&vt(r.originalEvent))&&!(Ne(r)||!c)){var u=s.pointsForTarget(c);u.initialized||(u=i.addSnapTargetPoints(u,a,c),u.initialized=!0),n.snap(r,u)}}),e.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}nn.$inject=["elementRegistry","eventBus","snapping"];nn.prototype.initSnap=function(t){var e=this._elementRegistry,n=t.context,i=n.shape,r=n.snapContext;r||(r=n.snapContext=new Yt);var o;e.get(i.id)?o=he(i,t):o={x:t.x+he(i).x,y:t.y+he(i).y};var a={x:o.x-i.width/2,y:o.y-i.height/2},s={x:o.x+i.width/2,y:o.y+i.height/2};return r.setSnapOrigin("mid",{x:o.x-t.x,y:o.y-t.y}),Ai(i)||(r.setSnapOrigin("top-left",{x:a.x-t.x,y:a.y-t.y}),r.setSnapOrigin("bottom-right",{x:s.x-t.x,y:s.y-t.y})),r};nn.prototype.addSnapTargetPoints=function(t,e,n){var i=this.getSnapTargets(e,n);return m(i,function(r){if(Ai(r)){Ai(e)&&t.add("mid",he(r));return}if(mh(r)){if(r.waypoints.length<3)return;var o=r.waypoints.slice(1,-1);m(o,function(a){t.add("mid",a)});return}t.add("mid",he(r))}),!I(e.x)||!I(e.y)||this._elementRegistry.get(e.id)&&t.add("mid",he(e)),t};nn.prototype.getSnapTargets=function(t,e){return es(e).filter(function(n){return!xh(n)})};function mh(t){return!!t.waypoints}function xh(t){return!!t.hidden}function Ai(t){return!!t.labelTarget}var Eh=1250;function rn(t,e){var n=this;t.on(["resize.start"],function(i){n.initSnap(i)}),t.on(["resize.move","resize.end"],Eh,function(i){var r=i.context,o=r.shape,a=o.parent,s=r.direction,c=r.snapContext;if(!(i.originalEvent&&vt(i.originalEvent))&&!Ne(i)){var u=c.pointsForTarget(a);u.initialized||(u=n.addSnapTargetPoints(u,o,a,s),u.initialized=!0),bh(s)&&mt(i,"x",i.x),Mh(s)&&mt(i,"y",i.y),e.snap(i,u)}}),t.on(["resize.cleanup"],function(){e.hide()})}rn.prototype.initSnap=function(t){var e=t.context,n=e.shape,i=e.direction,r=e.snapContext;r||(r=e.snapContext=new Yt);var o=Is(n,i);return r.setSnapOrigin("corner",{x:o.x-t.x,y:o.y-t.y}),r};rn.prototype.addSnapTargetPoints=function(t,e,n,i){var r=this.getSnapTargets(e,n);return m(r,function(o){t.add("corner",fl(o)),t.add("corner",ll(o))}),t.add("corner",Is(e,i)),t};rn.$inject=["eventBus","snapping"];rn.prototype.getSnapTargets=function(t,e){return es(e).filter(function(n){return!wh(n,t)&&!Sh(n)&&!Ch(n)&&!Rh(n)})};function Is(t,e){var n=V(t),i=A(t),r={x:n.x,y:n.y};return e.indexOf("n")!==-1?r.y=i.top:e.indexOf("s")!==-1&&(r.y=i.bottom),e.indexOf("e")!==-1?r.x=i.right:e.indexOf("w")!==-1&&(r.x=i.left),r}function wh(t,e){return t.host===e}function Sh(t){return!!t.waypoints}function Ch(t){return!!t.hidden}function Rh(t){return!!t.labelTarget}function bh(t){return t==="n"||t==="s"}function Mh(t){return t==="e"||t==="w"}var Th=7,Ph=1e3;function Zt(t){this._canvas=t,this._asyncHide=qo(Ge(this.hide,this),Ph)}Zt.$inject=["canvas"];Zt.prototype.snap=function(t,e){var n=t.context,i=n.snapContext,r=i.getSnapLocations(),o={x:Ne(t,"x"),y:Ne(t,"y")};m(r,function(a){var s=i.getSnapOrigin(a),c={x:t.x+s.x,y:t.y+s.y};if(m(["x","y"],function(u){var l;o[u]||(l=e.snap(c,a,u,Th),l!==void 0&&(o[u]={value:l,originValue:l-s[u]}))}),o.x&&o.y)return!1}),this.showSnapLine("vertical",o.x&&o.x.value),this.showSnapLine("horizontal",o.y&&o.y.value),m(["x","y"],function(a){var s=o[a];xt(s)&&mt(t,a,s.originValue)})};Zt.prototype._createLine=function(t){var e=this._canvas.getLayer("snap"),n=$("path");return P(n,{d:"M0,0 L0,0"}),H(n).add("djs-snap-line"),D(e,n),{update:function(i){I(i)?t==="horizontal"?P(n,{d:"M-100000,"+i+" L+100000,"+i,display:""}):P(n,{d:"M "+i+",-100000 L "+i+", +100000",display:""}):P(n,{display:"none"})}}};Zt.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};Zt.prototype.showSnapLine=function(t,e){var n=this.getSnapLine(t);n&&n.update(e),this._asyncHide()};Zt.prototype.getSnapLine=function(t){return this._snapLines||this._createSnapLines(),this._snapLines[t]};Zt.prototype.hide=function(){m(this._snapLines,function(t){t.update()})};var Od={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",nn],resizeSnapping:["type",rn],snapping:["type",Zt]};function L(t,e,n,i){this._open=!1,this._results=[],this._eventMaps=[],this._canvas=t,this._eventBus=e,this._overlays=n,this._selection=i,this._container=Y(L.BOX_HTML),this._searchInput=Q(L.INPUT_SELECTOR,this._container),this._resultsContainer=Q(L.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),e.on(["canvas.destroy","diagram.destroy"],this.close,this)}L.$inject=["canvas","eventBus","overlays","selection"];L.prototype._bindEvents=function(){var t=this;function e(n,i,r,o){t._eventMaps.push({el:n,type:r,listener:yt.bind(n,i,r,o)})}e(document,"html","click",function(n){t.close()}),e(this._container,L.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),e(this._container,L.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),t._scrollToNode(n.delegateTarget),t._preselect(n.delegateTarget)}),e(this._container,L.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),t._select(n.delegateTarget)}),e(this._container,L.INPUT_SELECTOR,"keydown",function(n){X("ArrowUp",n)&&n.preventDefault(),X("ArrowDown",n)&&n.preventDefault()}),e(this._container,L.INPUT_SELECTOR,"keyup",function(n){if(X("Escape",n))return t.close();if(X("Enter",n)){var i=t._getCurrentResult();return i?t._select(i):t.close()}if(X("ArrowUp",n))return t._scrollToDirection(!0);if(X("ArrowDown",n))return t._scrollToDirection();X(["ArrowLeft","ArrowRight"],n)||t._search(n.delegateTarget.value)})};L.prototype._unbindEvents=function(){this._eventMaps.forEach(function(t){yt.unbind(t.el,t.type,t.listener)})};L.prototype._search=function(t){var e=this;if(this._clearResults(),!(!t||t==="")){var n=this._searchProvider.find(t);if(!!n.length){n.forEach(function(r){var o=r.element.id,a=e._createResultNode(r,o);e._results[o]={element:r.element,node:a}});var i=Q(L.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(i),this._preselect(i)}}};L.prototype._scrollToDirection=function(t){var e=this._getCurrentResult();if(!!e){var n=t?e.previousElementSibling:e.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};L.prototype._scrollToNode=function(t){if(!(!t||t===this._getCurrentResult())){var e=t.offsetTop,n=this._resultsContainer.scrollTop,i=e-this._resultsContainer.clientHeight+t.clientHeight;e<n?this._resultsContainer.scrollTop=e:n<i&&(this._resultsContainer.scrollTop=i)}};L.prototype._clearResults=function(){$n(this._resultsContainer),this._results=[],this._resetOverlay(),this._eventBus.fire("searchPad.cleared")};L.prototype._getCurrentResult=function(){return Q(L.RESULT_SELECTED_SELECTOR,this._resultsContainer)};L.prototype._createResultNode=function(t,e){var n=Y(L.RESULT_HTML);return t.primaryTokens.length>0&&Zo(n,t.primaryTokens,L.RESULT_PRIMARY_HTML),Zo(n,t.secondaryTokens,L.RESULT_SECONDARY_HTML),ot(n,L.RESULT_ID_ATTRIBUTE,e),this._resultsContainer.appendChild(n),n};L.prototype.registerProvider=function(t){this._searchProvider=t};L.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._bindEvents(),this._open=!0,it(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};L.prototype.close=function(){!this.isOpen()||(this._unbindEvents(),this._open=!1,it(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._resetOverlay(),this._eventBus.fire("searchPad.closed"))};L.prototype.toggle=function(){this.isOpen()?this.close():this.open()};L.prototype.isOpen=function(){return this._open};L.prototype._preselect=function(t){var e=this._getCurrentResult();if(t!==e){e&&it(e).remove(L.RESULT_SELECTED_CLASS);var n=ot(t,L.RESULT_ID_ATTRIBUTE),i=this._results[n].element;it(t).add(L.RESULT_SELECTED_CLASS),this._resetOverlay(i),this._canvas.scrollToElement(i,{top:400}),this._selection.select(i),this._eventBus.fire("searchPad.preselected",i)}};L.prototype._select=function(t){var e=ot(t,L.RESULT_ID_ATTRIBUTE),n=this._results[e].element;this.close(),this._resetOverlay(),this._canvas.scrollToElement(n,{top:400}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};L.prototype._resetOverlay=function(t){if(this._overlayId&&this._overlays.remove(this._overlayId),t){var e=q(t),n=Oh(e);this._overlayId=this._overlays.add(t,n)}};function Oh(t){var e=6,n=t.width+e*2,i=t.height+e*2,r={width:n+"px",height:i+"px"},o=Y('<div class="'+L.OVERLAY_CLASS+'"></div>');return Et(o,r),{position:{bottom:i-e,right:n-e},show:!0,html:o}}function Zo(t,e,n){var i=Lh(e),r=Y(n);r.innerHTML=i,t.appendChild(r)}function Lh(t){var e="";return t.forEach(function(n){n.matched?e+='<strong class="'+L.RESULT_HIGHLIGHT_CLASS+'">'+Lr(n.matched)+"</strong>":e+=Lr(n.normal)}),e!==""?e:null}L.CONTAINER_SELECTOR=".djs-search-container";L.INPUT_SELECTOR=".djs-search-input input";L.RESULTS_CONTAINER_SELECTOR=".djs-search-results";L.RESULT_SELECTOR=".djs-search-result";L.RESULT_SELECTED_CLASS="djs-search-result-selected";L.RESULT_SELECTED_SELECTOR="."+L.RESULT_SELECTED_CLASS;L.RESULT_ID_ATTRIBUTE="data-result-id";L.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";L.OVERLAY_CLASS="djs-search-overlay";L.BOX_HTML='<div class="djs-search-container djs-draggable djs-scrollable"><div class="djs-search-input"><input type="text"/></div><div class="djs-search-results"></div></div>';L.RESULT_HTML='<div class="djs-search-result"></div>';L.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';L.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';var Ld={__depends__:[Ma,Ee],searchPad:["type",L]};export{Dn as $,qh as A,ee as B,rt as C,ma as D,vl as E,Ol as F,qi as G,pd as H,gd as I,Ot as J,Kh as K,q as L,Yh as M,vd as N,Ma as O,Qh as P,$t as Q,Fh as R,Ee as S,Fi as T,yd as U,Oa as V,md as W,jt as X,Rt as Y,Zh as Z,Ve as _,gt as a,Xu as a0,ad as a1,fe as a2,od as a3,sd as a4,Un as a5,Ka as a6,Ju as a7,cr as a8,sr as a9,Ne as aA,ll as aB,fl as aC,Od as aD,Ld as aE,Xh as aF,rd as aG,cd as aH,ud as aI,_d as aJ,bd as aK,jn as aL,ra as aa,tc as ab,Gl as ac,Mt as ad,vs as ae,Lt as af,xd as ag,ga as ah,_e as ai,G as aj,Uf as ak,uh as al,Rd as am,Ed as an,wd as ao,Sd as ap,Cd as aq,se as ar,Md as as,Td as at,Pd as au,Bn as av,vt as aw,he as ax,mt as ay,nn as az,Bi as b,Gi as c,Wh as d,Lr as e,Ui as f,V as g,A as h,Uh as i,Se as j,na as k,Jh as l,td as m,nd as n,Ct as o,ed as p,id as q,_c as r,ne as s,yc as t,tr as u,ld as v,fd as w,hd as x,dd as y,Pn as z};
