import{v as P,b as f,g as x,y as m,c as l,q as M}from"./min-dash.9e14f76b.js";function N(){}N.prototype.get=function(e){return this.$model.properties.get(this,e)};N.prototype.set=function(e,t){this.$model.properties.set(this,e,t)};function B(e,t){this.model=e,this.properties=t}B.prototype.createType=function(e){var t=this.model,r=this.properties,i=Object.create(N.prototype);f(e.properties,function(s){!s.isMany&&s.default!==void 0&&(i[s.name]=s.default)}),r.defineModel(i,t),r.defineDescriptor(i,e);var o=e.ns.name;function n(s){r.define(this,"$type",{value:o,enumerable:!0}),r.define(this,"$attrs",{value:{}}),r.define(this,"$parent",{writable:!0}),f(s,m(function(a,y){this.set(y,a)},this))}return n.prototype=i,n.hasType=i.$instanceOf=this.model.hasType,r.defineModel(n,t),r.defineDescriptor(n,e),n};var k={String:!0,Boolean:!0,Integer:!0,Real:!0,Element:!0},T={String:function(e){return e},Boolean:function(e){return e==="true"},Integer:function(e){return parseInt(e,10)},Real:function(e){return parseFloat(e)}};function O(e,t){var r=T[e];return r?r(t):t}function v(e){return!!k[e]}function S(e){return!!T[e]}function c(e,t){var r=e.split(/:/),i,o;if(r.length===1)i=e,o=t;else if(r.length===2)i=r[1],o=r[0];else throw new Error("expected <prefix:localName> or <localName>, got "+e);return e=(o?o+":":"")+i,{name:e,prefix:o,localName:i}}function p(e){this.ns=e,this.name=e.name,this.allTypes=[],this.allTypesByName={},this.properties=[],this.propertiesByName={}}p.prototype.build=function(){return M(this,["ns","name","allTypes","allTypesByName","properties","propertiesByName","bodyProperty","idProperty"])};p.prototype.addProperty=function(e,t,r){typeof t=="boolean"&&(r=t,t=void 0),this.addNamedProperty(e,r!==!1);var i=this.properties;t!==void 0?i.splice(t,0,e):i.push(e)};p.prototype.replaceProperty=function(e,t,r){var i=e.ns,o=this.properties,n=this.propertiesByName,s=e.name!==t.name;if(e.isId){if(!t.isId)throw new Error("property <"+t.ns.name+"> must be id property to refine <"+e.ns.name+">");this.setIdProperty(t,!1)}if(e.isBody){if(!t.isBody)throw new Error("property <"+t.ns.name+"> must be body property to refine <"+e.ns.name+">");this.setBodyProperty(t,!1)}var a=o.indexOf(e);if(a===-1)throw new Error("property <"+i.name+"> not found in property list");o.splice(a,1),this.addProperty(t,r?void 0:a,s),n[i.name]=n[i.localName]=t};p.prototype.redefineProperty=function(e,t,r){var i=e.ns.prefix,o=t.split("#"),n=c(o[0],i),s=c(o[1],n.prefix).name,a=this.propertiesByName[s];if(a)this.replaceProperty(a,e,r);else throw new Error("refined property <"+s+"> not found");delete e.redefines};p.prototype.addNamedProperty=function(e,t){var r=e.ns,i=this.propertiesByName;t&&(this.assertNotDefined(e,r.name),this.assertNotDefined(e,r.localName)),i[r.name]=i[r.localName]=e};p.prototype.removeNamedProperty=function(e){var t=e.ns,r=this.propertiesByName;delete r[t.name],delete r[t.localName]};p.prototype.setBodyProperty=function(e,t){if(t&&this.bodyProperty)throw new Error("body property defined multiple times (<"+this.bodyProperty.ns.name+">, <"+e.ns.name+">)");this.bodyProperty=e};p.prototype.setIdProperty=function(e,t){if(t&&this.idProperty)throw new Error("id property defined multiple times (<"+this.idProperty.ns.name+">, <"+e.ns.name+">)");this.idProperty=e};p.prototype.assertNotTrait=function(e){if((e.extends||[]).length)throw new Error(`cannot create <${e.name}> extending <${e.extends}>`)};p.prototype.assertNotDefined=function(e,t){var r=e.name,i=this.propertiesByName[r];if(i)throw new Error("property <"+r+"> already defined; override of <"+i.definedBy.ns.name+"#"+i.ns.name+"> by <"+e.definedBy.ns.name+"#"+e.ns.name+"> not allowed without redefines")};p.prototype.hasProperty=function(e){return this.propertiesByName[e]};p.prototype.addTrait=function(e,t){t&&this.assertNotTrait(e);var r=this.allTypesByName,i=this.allTypes,o=e.name;o in r||(f(e.properties,m(function(n){n=l({},n,{name:n.ns.localName,inherited:t}),Object.defineProperty(n,"definedBy",{value:e});var s=n.replaces,a=n.redefines;s||a?this.redefineProperty(n,s||a,s):(n.isBody&&this.setBodyProperty(n),n.isId&&this.setIdProperty(n),this.addProperty(n))},this)),i.push(e),r[o]=e)};function d(e,t){this.packageMap={},this.typeMap={},this.packages=[],this.properties=t,f(e,m(this.registerPackage,this))}d.prototype.getPackage=function(e){return this.packageMap[e]};d.prototype.getPackages=function(){return this.packages};d.prototype.registerPackage=function(e){e=l({},e);var t=this.packageMap;w(t,e,"prefix"),w(t,e,"uri"),f(e.types,m(function(r){this.registerType(r,e)},this)),t[e.uri]=t[e.prefix]=e,this.packages.push(e)};d.prototype.registerType=function(e,t){e=l({},e,{superClass:(e.superClass||[]).slice(),extends:(e.extends||[]).slice(),properties:(e.properties||[]).slice(),meta:l(e.meta||{})});var r=c(e.name,t.prefix),i=r.name,o={};f(e.properties,m(function(n){var s=c(n.name,r.prefix),a=s.name;v(n.type)||(n.type=c(n.type,s.prefix).name),l(n,{ns:s,name:a}),o[a]=n},this)),l(e,{ns:r,name:i,propertiesByName:o}),f(e.extends,m(function(n){var s=this.typeMap[n];s.traits=s.traits||[],s.traits.push(i)},this)),this.definePackage(e,t),this.typeMap[i]=e};d.prototype.mapTypes=function(e,t,r){var i=v(e.name)?{name:e.name}:this.typeMap[e.name],o=this;function n(y,E){var $=c(y,v(y)?"":e.prefix);o.mapTypes($,t,E)}function s(y){return n(y,!0)}function a(y){return n(y,!1)}if(!i)throw new Error("unknown type <"+e.name+">");f(i.superClass,r?s:a),t(i,!r),f(i.traits,s)};d.prototype.getEffectiveDescriptor=function(e){var t=c(e),r=new p(t);this.mapTypes(t,function(o,n){r.addTrait(o,n)});var i=r.build();return this.definePackage(i,i.allTypes[i.allTypes.length-1].$pkg),i};d.prototype.definePackage=function(e,t){this.properties.define(e,"$pkg",{value:t})};function w(e,t,r){var i=t[r];if(i in e)throw new Error("package with "+r+" <"+i+"> already defined")}function h(e){this.model=e}h.prototype.set=function(e,t,r){if(!P(t)||!t.length)throw new TypeError("property name must be a non-empty string");var i=this.getProperty(e,t),o=i&&i.name;D(r)?i?delete e[o]:delete e.$attrs[g(t)]:i?o in e?e[o]=r:b(e,i,r):e.$attrs[g(t)]=r};h.prototype.get=function(e,t){var r=this.getProperty(e,t);if(!r)return e.$attrs[g(t)];var i=r.name;return!e[i]&&r.isMany&&b(e,r,[]),e[i]};h.prototype.define=function(e,t,r){if(!r.writable){var i=r.value;r=l({},r,{get:function(){return i}}),delete r.value}Object.defineProperty(e,t,r)};h.prototype.defineDescriptor=function(e,t){this.define(e,"$descriptor",{value:t})};h.prototype.defineModel=function(e,t){this.define(e,"$model",{value:t})};h.prototype.getProperty=function(e,t){var r=this.model,i=r.getPropertyDescriptor(e,t);if(i)return i;if(t.includes(":"))return null;const o=r.config.strict;if(typeof o<"u"){const n=new TypeError(`unknown property <${t}> on <${e.$type}>`);if(o)throw n;typeof console<"u"&&console.warn(n)}return null};function D(e){return typeof e>"u"}function b(e,t,r){Object.defineProperty(e,t.name,{enumerable:!t.isReference,writable:!0,value:r,configurable:!0})}function g(e){return e.replace(/^:/,"")}function u(e,t={}){this.properties=new h(this),this.factory=new B(this,this.properties),this.registry=new d(e,this.properties),this.typeCache={},this.config=t}u.prototype.create=function(e,t){var r=this.getType(e);if(!r)throw new Error("unknown type <"+e+">");return new r(t)};u.prototype.getType=function(e){var t=this.typeCache,r=P(e)?e:e.ns.name,i=t[r];return i||(e=this.registry.getEffectiveDescriptor(r),i=t[r]=this.factory.createType(e)),i};u.prototype.createAny=function(e,t,r){var i=c(e),o={$type:e,$instanceOf:function(s){return s===this.$type}},n={name:e,isGeneric:!0,ns:{prefix:i.prefix,localName:i.localName,uri:t}};return this.properties.defineDescriptor(o,n),this.properties.defineModel(o,this),this.properties.define(o,"$parent",{enumerable:!1,writable:!0}),this.properties.define(o,"$instanceOf",{enumerable:!1,writable:!0}),f(r,function(s,a){x(s)&&s.value!==void 0?o[s.name]=s.value:o[a]=s}),o};u.prototype.getPackage=function(e){return this.registry.getPackage(e)};u.prototype.getPackages=function(){return this.registry.getPackages()};u.prototype.getElementDescriptor=function(e){return e.$descriptor};u.prototype.hasType=function(e,t){t===void 0&&(t=e,e=this);var r=e.$model.getElementDescriptor(e);return t in r.allTypesByName};u.prototype.getPropertyDescriptor=function(e,t){return this.getElementDescriptor(e).propertiesByName[t]};u.prototype.getTypeDescriptor=function(e){return this.registry.typeMap[e]};export{u as M,O as c,S as i,c as p};
